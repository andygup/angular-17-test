"use strict";(self.webpackChunkangular_17_test=self.webpackChunkangular_17_test||[]).push([[6635],{57487:(w,A,e)=>{e.d(A,{T:()=>S});var R=e(15861),P=e(79412),y=e(65430),V=e(78857),p=e(75747),m=e(55768),I=e(49602),C=e(44526),d=e(32196),O=e(56035),g=e(86171),x=e(19903);function U(B,s){const r=s.length;if(B<s[0].value||1===r)return s[0].size;for(let a=1;a<r;a++)if(B<s[a].value)return s[a-1].size+(B-s[a-1].value)/(s[a].value-s[a-1].value)*(s[a].size-s[a-1].size);return s[r-1].size}class L{constructor(){this.symbolLevels=[],this.vvColorValues=new Float32Array(8),this.vvColors=new Float32Array(32),this.vvOpacityValues=new Float32Array(8),this.vvOpacities=new Float32Array(8),this.vvSizeMinMaxValue=new Float32Array(4),this.outsideLabelsVisible=!1,this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1},this._technique=O.v}getSizeVVFieldStops(s){const r=this._vvSizeFieldStops;if(r)switch(r.type){case"static":return r;case"level-dependent":return r.levels[s]??(()=>{let a=1/0,i=0;for(const o in r.levels){const u=parseFloat(o),l=Math.abs(s-u);l<a&&(a=l,i=u)}if(a===1/0)return{sizes:new Float32Array([0,0,0,0,0,0]),values:new Float32Array([0,0,0,0,0,0])};const c=2**((s-i)/2),_=r.levels[i],E=new Float32Array(_.values);return E[2]*=c,E[3]*=c,{sizes:_.sizes,values:E}})();default:return}}get vvMaterialParameters(){return this._vvMaterialParameters}update(s){null!=this._vvInfo&&this._updateVisualVariables(this._vvInfo.vvRanges,s)}setInfo(s,r,a){this._updateEffects(a),this._vvInfo=r,this._technique=(0,g.EJ)(s),this.rendererSchema=this._technique.createOrUpdateRendererSchema(this.rendererSchema,s)}getVariation(){return{...this._technique.getVariation(this.rendererSchema),outsideLabelsVisible:this.outsideLabelsVisible,supportsTextureFloat:(0,x.hc)("2d").supportsTextureFloat}}getVariationHash(){return this._technique.getVariationHash(this.rendererSchema)<<1|(this.outsideLabelsVisible?1:0)}_updateEffects(s){this.outsideLabelsVisible=null!=s&&s.excludedLabelsVisible}_updateVisualVariables(s,r){const a=this._vvMaterialParameters;if(a.vvOpacityEnabled=!1,a.vvSizeEnabled=!1,a.vvColorEnabled=!1,a.vvRotationEnabled=!1,!s)return;const i=s.size;if(i){if(a.vvSizeEnabled=!0,i.minMaxValue){const o=i.minMaxValue;let u,l;if((0,d.$K)(o.minSize)&&(0,d.$K)(o.maxSize))if((0,d.hj)(o.minSize)&&(0,d.hj)(o.maxSize))u=(0,m.F2)(o.minSize),l=(0,m.F2)(o.maxSize);else{const f=r.scale;u=(0,m.F2)(U(f,o.minSize.stops)),l=(0,m.F2)(U(f,o.maxSize.stops))}this.vvSizeMinMaxValue.set([o.minDataValue,o.maxDataValue,u,l])}if(i.scaleStops&&(this.vvSizeScaleStopsValue=(0,m.F2)(U(r.scale,i.scaleStops.stops))),i.unitValue){const o=(0,I.c9)(r.spatialReference)/C.a[i.unitValue.unit];this.vvSizeUnitValueToPixelsRatio=o/r.resolution}i.fieldStops&&(this._vvSizeFieldStops=i.fieldStops)}const c=s.color;c&&(a.vvColorEnabled=!0,this.vvColorValues.set(c.values),this.vvColors.set(c.colors));const _=s.opacity;_&&(a.vvOpacityEnabled=!0,this.vvOpacityValues.set(_.values),this.vvOpacities.set(_.opacities));const E=s.rotation;E&&(a.vvRotationEnabled=!0,a.vvRotationType=E.type)}}class S extends p.Z{constructor(s){super(s),this._rendererInfo=new L,this._materialItemsRequestQueue=new y.Z,this.attributeView=new V.H(()=>this.onAttributeStoreUpdate())}destroy(){this.children.forEach(s=>s.destroy()),this.removeAllChildren(),this.attributeView.destroy(),this._materialItemsRequestQueue.clear()}setRendererInfo(s,r,a){this._rendererInfo.setInfo(s,r,a),this.requestRender()}getMaterialItems(s,r){var a=this;return(0,R.Z)(function*(){if(!s||0===s.length)return[];const i=(0,P.hh)();return a._materialItemsRequestQueue.push({items:s,abortOptions:r,resolver:i}),a.requestRender(),i.promise})()}doRender(s){if(s.context.capabilities.enable("textureFloat"),s.context.capabilities.enable("vao"),this._materialItemsRequestQueue.length>0){let r=this._materialItemsRequestQueue.pop();for(;r;)this._processMaterialItemRequest(s,r),r=this._materialItemsRequestQueue.pop()}super.doRender(s)}renderChildren(s){for(const r of this.children)r.commit(s);this._rendererInfo.update(s.state),super.renderChildren(s)}createRenderParams(s){const r=super.createRenderParams(s);return r.rendererInfo=this._rendererInfo,r.attributeView=this.attributeView,r}onAttributeStoreUpdate(){}_processMaterialItemRequest(s,{items:r,abortOptions:a,resolver:i}){const{painter:c,pixelRatio:_}=s,E=r.map(o=>c.textureManager.rasterizeItem(o.symbol,_,o.glyphIds,a));Promise.all(E).then(o=>{if(!this.stage)return void i.reject();const u=o.map((l,f)=>({id:r[f].id,mosaicItem:l}));i.resolve(u)},i.reject)}}},75747:(w,A,e)=>{e.d(A,{Z:()=>I});var R=e(14007),P=e(43101),y=e(92311),V=e(58960),p=e(46356);const m=(C,d)=>C.key.level-d.key.level!=0?C.key.level-d.key.level:C.key.row-d.key.row!=0?C.key.row-d.key.row:C.key.col-d.key.col;class I extends y.Z{constructor(d){super(),this._tileInfoView=d}renderChildren(d){this.sortChildren(m),this.setStencilReference(d),super.renderChildren(d)}createRenderParams(d){const{state:O}=d,g=super.createRenderParams(d);return g.requiredLevel=this._tileInfoView.getClosestInfoForScale(O.scale).level,g.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(O.scale),g}prepareRenderPasses(d){const O=super.prepareRenderPasses(d);return O.push(d.registerRenderPass({name:"stencil",brushes:[p.Z],drawPhase:P.jx.DEBUG|P.jx.MAP|P.jx.HIGHLIGHT,target:()=>this.getStencilTarget()})),(0,R.Z)("esri-tiles-debug")&&O.push(d.registerRenderPass({name:"tileInfo",brushes:[V.Z],drawPhase:P.jx.DEBUG,target:()=>this.children})),O}getStencilTarget(){return this.children}setStencilReference(d){let O=1;for(const g of this.children)g.stencilRef=O++}}},86635:(w,A,e)=>{e.r(A),e.d(A,{default:()=>b});var R=e(15861),P=e(50484),y=e(57678),V=e(83944),p=e(5603),m=e(1258),I=e(77675),C=e(80543),g=(e(1535),e(14007),e(10141)),x=e(40579),U=e(21664),L=e(46947),S=e(44042),B=e(74539),s=e(62737),r=e(64157),a=e(93509),i=e(50800),c=e(68994),_=e(50145);const E=["route-info","direction-line","direction-point","polygon-barrier","polyline-barrier","point-barrier","stop"],o={graphic:null,property:null,oldValue:null,newValue:null};function u(t){return t instanceof x.Z||t instanceof U.Z||t instanceof L.Z||t instanceof S.Z||t instanceof B.Z||t instanceof s.Z||t instanceof r.Z}let v=class extends((0,a.y)(_.Z)){constructor(){super(...arguments),this._graphics=new V.Z,this._highlightIds=new Map,this._networkFeatureMap=new Map,this._networkGraphicMap=new Map}get _routeItems(){return new p.Z({getCollections:()=>null==this.layer||this.destroyed?[]:[null!=this.layer.routeInfo?new V.Z([this.layer.routeInfo]):null,this.layer.directionLines,this.layer.directionPoints,this.layer.polygonBarriers,this.layer.polylineBarriers,this.layer.pointBarriers,this.layer.stops]})}initialize(){this._updatingHandles.addOnCollectionChange(()=>this._routeItems,t=>this._routeItemsChanged(t),I.nn)}destroy(){this._networkFeatureMap.clear(),this._networkGraphicMap.clear(),this._graphics.removeAll(),this._get("_routeItems")?.destroy()}attach(){this._createGraphicsView()}detach(){this._destroyGraphicsView()}fetchPopupFeatures(t){var n=this;return(0,R.Z)(function*(){return n._graphicsView.hitTest(t).filter(h=>!!h.popupTemplate)})()}highlight(t){let n;n=u(t)?[this._getNetworkFeatureUid(t)]:function f(t){return Array.isArray(t)&&t.length>0&&u(t[0])}(t)?t.map(D=>this._getNetworkFeatureUid(D)):function l(t){return V.Z.isCollection(t)&&t.length&&u(t.at(0))}(t)?t.map(D=>this._getNetworkFeatureUid(D)).toArray():[t.uid];const h=n.filter(y.pC);return h.length?(this._addHighlight(h),(0,m.kB)(()=>this._removeHighlight(h))):(0,m.kB)()}hitTest(t,n){var h=this;return(0,R.Z)(function*(){if(h.suspended)return null;const D=h._graphicsView.hitTest(t).filter(y.pC).map(M=>h._networkGraphicMap.get(M));if(!D.length)return null;const{layer:T}=h;return D.reverse().map(M=>({type:"route",layer:T,mapPoint:t,networkFeature:M}))})()}isUpdating(){return this._graphicsView.updating}moveStart(){}moveEnd(){}update(t){this._graphicsView.processUpdate(t)}viewChange(){this._graphicsView.viewChange()}_addHighlight(t){for(const n of t)if(this._highlightIds.has(n)){const h=this._highlightIds.get(n);this._highlightIds.set(n,h+1)}else this._highlightIds.set(n,1);this._updateHighlight()}_createGraphic(t){const n=t.toGraphic();return n.layer=this.layer,n.sourceLayer=this.layer,n}_createGraphicsView(){const t=this.view,h=new i.Z(t.featuresTilingScheme);this._graphicsView=new c.Z({container:h,graphics:this._graphics,requestUpdateCallback:()=>this.requestUpdate(),view:t}),this.container.addChild(h),this._updateHighlight()}_destroyGraphicsView(){this.container.removeChild(this._graphicsView.container),this._graphicsView.destroy()}_getDrawOrder(t){const n=this._networkGraphicMap.get(t);return E.indexOf(n.type)}_getNetworkFeatureUid(t){return this._networkFeatureMap.has(t)?this._networkFeatureMap.get(t).uid:null}_removeHighlight(t){for(const n of t)if(this._highlightIds.has(n)){const h=this._highlightIds.get(n)-1;0===h?this._highlightIds.delete(n):this._highlightIds.set(n,h)}this._updateHighlight()}_routeItemsChanged(t){if(t.removed.length){this._graphics.removeMany(t.removed.map(n=>{const h=this._networkFeatureMap.get(n);return this._networkFeatureMap.delete(n),this._networkGraphicMap.delete(h),h}));for(const n of t.removed)this.removeHandles(n)}if(t.added.length){this._graphics.addMany(t.added.map(n=>{const h=this._createGraphic(n);return null==h.symbol?null:(this._networkFeatureMap.set(n,h),this._networkGraphicMap.set(h,n),h)}).filter(y.pC));for(const n of t.added)this.addHandles([(0,I.YP)(()=>n.geometry,(h,D)=>{this._updateGraphic(n,"geometry",h,D)}),(0,I.YP)(()=>n.symbol,(h,D)=>{this._updateGraphic(n,"symbol",h,D)})],n);this._graphics.sort((n,h)=>this._getDrawOrder(n)-this._getDrawOrder(h))}}_updateGraphic(t,n,h,D){if(!this._networkFeatureMap.has(t)){const M=this._createGraphic(t);return this._networkFeatureMap.set(t,M),this._networkGraphicMap.set(M,t),void this._graphics.add(M)}const T=this._networkFeatureMap.get(t);T[n]=h,o.graphic=T,o.property=n,o.oldValue=D,o.newValue=h,this._graphicsView.graphicUpdateHandler(o)}_updateHighlight(){const t=Array.from(this._highlightIds.keys());this._graphicsView.setHighlight(t)}};(0,P._)([(0,C.Cb)()],v.prototype,"_graphics",void 0),(0,P._)([(0,C.Cb)()],v.prototype,"_routeItems",null),v=(0,P._)([(0,g.j)("esri.views.2d.layers.RouteLayerView2D")],v);const b=v},26055:(w,A,e)=>{e.d(A,{Z:()=>s});var R=e(51172),P=e(57487),y=e(51006),V=e(71602),p=e(7077),m=e(33520),I=e(93566),C=e(64456),d=e(32196),O=e(39853),g=e(39237),x=e(46682);const U=Math.PI/180;class S extends C.s{constructor(a){super(),this._program=null,this._vao=null,this._vertexBuffer=null,this._indexBuffer=null,this._dvsMat3=(0,V.c)(),this._localOrigin={x:0,y:0},this._getBounds=a}destroy(){this._vao&&(this._vao.dispose(),this._vao=null,this._vertexBuffer=null,this._indexBuffer=null),this._program=(0,R.M2)(this._program)}doRender(a){const{context:i}=a,c=this._getBounds();if(c.length<1)return;this._createShaderProgram(i),this._updateMatricesAndLocalOrigin(a),this._updateBufferData(i,c),i.setBlendingEnabled(!0),i.setDepthTestEnabled(!1),i.setStencilWriteMask(0),i.setStencilTestEnabled(!1),i.setBlendFunction(g.zi.ONE,g.zi.ONE_MINUS_SRC_ALPHA),i.setColorMask(!0,!0,!0,!0);const _=this._program;i.bindVAO(this._vao),i.useProgram(_),_.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),i.gl.lineWidth(1),i.drawElements(g.MX.LINES,8*c.length,g.g.UNSIGNED_INT,0),i.bindVAO()}_createTransforms(){return{dvs:(0,V.c)()}}_createShaderProgram(a){this._program||(this._program=a.programCache.acquire("precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos = u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position = vec4(pos.xy, 0.0, 1.0);\n        }","precision mediump float;\n      void main() {\n        gl_FragColor = vec4(0.75, 0.0, 0.0, 0.75);\n      }",B().attributes))}_updateMatricesAndLocalOrigin(a){const{state:i}=a,{displayMat3:c,size:_,resolution:E,pixelRatio:o,rotation:u,viewpoint:l}=i,f=U*u,{x:v,y:b}=l.targetGeometry,t=(0,I.or)(v,i.spatialReference);this._localOrigin.x=t,this._localOrigin.y=b;const n=o*_[0],h=o*_[1],D=E*n,T=E*h,M=(0,y.g)(this._dvsMat3);(0,y.m)(M,M,c),(0,y.h)(M,M,(0,p.f)(n/2,h/2)),(0,y.c)(M,M,(0,m.f)(_[0]/D,-h/T,1)),(0,y.r)(M,M,-f)}_updateBufferData(a,i){const{x:c,y:_}=this._localOrigin,o=new Float32Array(8*i.length),u=new Uint32Array(8*i.length);let l=0,f=0;for(const v of i)v&&(o[2*l]=v[0]-c,o[2*l+1]=v[1]-_,o[2*l+2]=v[0]-c,o[2*l+3]=v[3]-_,o[2*l+4]=v[2]-c,o[2*l+5]=v[3]-_,o[2*l+6]=v[2]-c,o[2*l+7]=v[1]-_,u[f]=l+0,u[f+1]=l+3,u[f+2]=l+3,u[f+3]=l+2,u[f+4]=l+2,u[f+5]=l+1,u[f+6]=l+1,u[f+7]=l+0,l+=4,f+=8);if(this._vertexBuffer?this._vertexBuffer.setData(o.buffer):this._vertexBuffer=O.f.createVertex(a,g.l1.DYNAMIC_DRAW,o.buffer),this._indexBuffer?this._indexBuffer.setData(u):this._indexBuffer=O.f.createIndex(a,g.l1.DYNAMIC_DRAW,u),!this._vao){const v=B();this._vao=new x.U(a,v.attributes,v.bufferLayouts,{geometry:this._vertexBuffer},this._indexBuffer)}}}const B=()=>(0,d.cM)("bounds",{geometry:[{location:0,name:"a_position",count:2,type:g.g.FLOAT}]});let s=class extends P.T{constructor(r){super(r),this.checkHighlight=()=>!0}destroy(){super.destroy(),this._boundsRenderer=(0,R.SC)(this._boundsRenderer)}enableRenderingBounds(r){this._boundsRenderer=new S(r),this.requestRender()}get hasHighlight(){return this.checkHighlight()}onTileData(r,a){r.patch(a),this.contains(r)||this.addChild(r),this.requestRender()}onTileError(r){r.clear(),this.contains(r)||this.addChild(r)}_renderChildren(r,a){for(const i of this.children)i.isReady&&i.hasData&&(i.commit(r),r.context.setStencilFunction(g.wb.EQUAL,i.stencilRef,255),i.getDisplayList().replay(r,i,a))}}},50800:(w,A,e)=>{e.d(A,{Z:()=>y});var R=e(43101),P=e(26055);class y extends P.Z{renderChildren(p){this.attributeView.update(),this.children.some(m=>m.hasData)&&(this.attributeView.bindTextures(p.context,!1),super.renderChildren(p),p.drawPhase===R.jx.MAP&&this._renderChildren(p),this.hasHighlight&&p.drawPhase===R.jx.HIGHLIGHT&&this._renderHighlight(p),this._boundsRenderer&&this._boundsRenderer.doRender(p))}_renderHighlight(p){const{painter:m}=p,I=m.effects.highlight;I.bind(p),this._renderChildren(p,I.defines),I.draw(p),I.unbind()}}}}]);