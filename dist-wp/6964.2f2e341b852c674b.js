"use strict";(self.webpackChunkangular_17_test=self.webpackChunkangular_17_test||[]).push([[6964],{36964:(se,x,i)=>{i.r(x),i.d(x,{load:()=>J});var p=i(15861),f=i(57964),A=i(89713),B=i(23933),C=i(81390),K=i(4906),w=i(79936),F=i(61018),S=i(453),y=i(46011),G=i(50318),$=i(39262),X=i(6661);function J(e,r){return h.apply(this,arguments)}function h(){return h=(0,p.Z)(function*(e,r){const n=e.instance.portalItem;if(n?.id)return yield n.load(r),function N(e){const r=e.instance.portalItem;if(!r?.type||!e.supportedTypes.includes(r.type))throw new f.Z("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}'",{type:r?.type,expectedType:e.supportedTypes.join(", ")})}(e),function Q(e,r){return m.apply(this,arguments)}(e,r)}),h.apply(this,arguments)}function m(){return m=(0,p.Z)(function*(e,r){const n=e.instance,t=n.portalItem;if(!t)return;const{url:s,title:l}=t,a=(0,S.ht)(t);if("group"===n.type)return function z(e,r,n){return g.apply(this,arguments)}(n,a,e);s&&n.read({url:s},a);const o=new C.L,u=yield j(e,o,r);return u&&n.read(u,a),n.resourceReferences={portalItem:t,paths:a.readResourcePaths??[]},"subtype-group"!==n.type&&n.read({title:l},a),(0,$.y)(n,a)}),m.apply(this,arguments)}function g(){return g=(0,p.Z)(function*(e,r,n){const t=e.portalItem;if(!e.sourceIsPortalItem)return;const{title:s,type:l}=t;if("Group Layer"===l){if(!(0,G._$)(t,"Map"))throw new f.Z("portal:invalid-layer-item-typekeyword","'Group Layer' item without 'Map' type keyword is not supported");return function V(e){return E.apply(this,arguments)}(e)}return e.read({title:s},r),function Y(e,r){return L.apply(this,arguments)}(e,n)}),g.apply(this,arguments)}function E(){return(E=(0,p.Z)(function*(e){const r=e.portalItem,n=yield r.fetchData("json");if(!n)return;const t=(0,S.wk)(r);e.read(n,t),yield(0,K.populateGroupLayer)(e,n,{context:t}),e.resourceReferences={portalItem:r,paths:t.readResourcePaths??[]}})).apply(this,arguments)}function L(){return L=(0,p.Z)(function*(e,r){let n;const{portalItem:t}=e;if(!t)return;const s=t.type,l=r.layerModuleTypeMap;switch(s){case"Feature Service":case"Feature Collection":n=l.FeatureLayer;break;case"Stream Service":n=l.StreamLayer;break;case"Scene Service":n=l.SceneLayer;break;default:throw new f.Z("portal:unsupported-item-type-as-group",`The item type '${s}' is not supported as a 'IGroupLayer'`)}const a=new C.L;let[o,u]=yield Promise.all([n(),j(r,a)]),c=()=>o;if("Feature Service"===s){u=t.url?yield(0,y.$O)(u,t.url,a):{};const R=(0,y.XX)(u),U=(0,y._Y)(u),d=[];if(R.length||U?.length){R.length&&d.push("SubtypeGroupLayer"),U?.length&&d.push("OrientedImageryLayer");const W=[];for(const _ of d)W.push((0,l[_])());const ae=yield Promise.all(W),Z=new Map;d.forEach((_,v)=>{Z.set(_,ae[v])}),c=_=>_.layerType?Z.get(_.layerType)??o:o}const ne=yield function re(e){return O.apply(this,arguments)}(t.url);return yield M(e,c,u,ne)}return"Scene Service"===s&&t.url&&(u=yield(0,y.CD)(t,u,a)),(0,y.Q4)(u)>0?yield M(e,c,u):yield function H(e,r){return I.apply(this,arguments)}(e,c)}),L.apply(this,arguments)}function I(){return(I=(0,p.Z)(function*(e,r){const{portalItem:n}=e;if(!n?.url)return;const t=yield(0,X.T)(n.url);t&&M(e,r,{layers:t.layers?.map(y.bS),tables:t.tables?.map(y.bS)})})).apply(this,arguments)}function M(e,r,n,t){return P.apply(this,arguments)}function P(){return(P=(0,p.Z)(function*(e,r,n,t){let s=n.layers||[];const l=n.tables||[];if("Feature Collection"===e.portalItem?.type?(s.forEach((a,o)=>{a.id=o,"Table"===a?.layerDefinition?.type&&l.push(a)}),s=s.filter(a=>"Table"!==a?.layerDefinition?.type)):(s.reverse(),l.reverse()),s.forEach(a=>{const o=t?.(a);if(o||!t){const u=b(e,r(a),n,a,o);e.add(u)}}),l.length){const a=yield w.T.FeatureLayer();l.forEach(o=>{const u=t?.(o);if(u||!t){const c=b(e,a,n,o,u);e.tables.add(c)}})}})).apply(this,arguments)}function b(e,r,n,t,s){const l=e.portalItem,a={portalItem:l.clone(),layerId:t.id};null!=t.url&&(a.url=t.url);const o=new r(a);if("sourceJSON"in o&&(o.sourceJSON=s),"subtype-group"!==o.type&&(o.sublayerTitleMode="service-name"),"Feature Collection"===l.type){const u={origin:"portal-item",portal:l.portal||F.Z.getDefault()};o.read(t,u);const c=n.showLegend;null!=c&&o.read({showLegend:c},u)}return o}function j(e,r,n){return T.apply(this,arguments)}function T(){return T=(0,p.Z)(function*(e,r,n){if(!1===e.supportsData)return;const t=e.instance,s=t.portalItem;if(!s)return;let l=null;try{l=yield s.fetchData("json",n)}catch{}if(function ee(e){return"stream"!==e.type&&"layerId"in e}(t)){let a=null;const o=yield function k(e,r,n){return D.apply(this,arguments)}(s,l,r);if((l?.layers||l?.tables)&&o>0){if(null==t.layerId){const u=(0,y.XX)(l);t.layerId="subtype-group"===t.type?u?.[0]:(0,y.Ok)(l)}a=function q(e,r){const{layerId:n}=r,t=e.layers?.find(s=>s.id===n)||e.tables?.find(s=>s.id===n);return t&&function te(e,r){return!("feature"===r.type&&"layerType"in e&&"SubtypeGroupLayer"===e.layerType||"subtype-group"===r.type&&!("layerType"in e))}(t,r)?t:null}(l,t),a&&null!=l.showLegend&&(a.showLegend=l.showLegend)}return o>1&&"sublayerTitleMode"in t&&"service-name"!==t.sublayerTitleMode&&(t.sublayerTitleMode="item-title-and-service-name"),a}return l}),T.apply(this,arguments)}function D(){return(D=(0,p.Z)(function*(e,r,n){if(r?.layers&&r?.tables)return(0,y.Q4)(r);const t=(0,A.Qc)(e.url);if(!t)return 1;const s=yield n.fetchServiceMetadata(t.url.path).catch(()=>null);return(r?.layers?.length??s?.layers?.length??0)+(r?.tables?.length??s?.tables?.length??0)})).apply(this,arguments)}function O(){return(O=(0,p.Z)(function*(e){const{layersJSON:r}=yield(0,B.V)(e);if(!r)return null;const n=[...r.layers,...r.tables];return t=>n.find(s=>s.id===t.id)})).apply(this,arguments)}}}]);