"use strict";(self.webpackChunkangular_17_test=self.webpackChunkangular_17_test||[]).push([[8866,5251],{60084:($,P,o)=>{o.d(P,{D:()=>p});var d=o(26496);function p(S){S?.writtenProperties&&S.writtenProperties.forEach(({target:m,propName:x,newOrigin:_})=>{(0,d.l)(m)&&_&&m.originOf(x)!==_&&m.updateOrigin(x,_)})}},26496:($,P,o)=>{function d(p){return p&&"getAtOrigin"in p&&"originOf"in p}o.d(P,{l:()=>d})},38866:($,P,o)=>{o.d(P,{xp:()=>H,Vt:()=>J});var d=o(15861),p=o(50484),S=o(66476),m=o(57964),x=o(4703),_=o(79412),D=o(6785),y=o(80543),g=(o(1535),o(57678),o(14007),o(62185)),L=o(10141),Z=o(7547),j=o(60084),b=o(26894),C=o(69063),A=o(43814),N=o(89713),s=o(8966),r=o(7741);var R=o(61018),I=o(27835),w=o(65820),E=o(46018);const h="esri.layers.mixins.SceneService",W=x.Z.getLogger(h),J=T=>{let f=class extends T{constructor(){var n;super(...arguments),n=this,this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=(0,_.Ds)(function(){var e=(0,d.Z)(function*(t,a,l){switch(t){case H.SAVE:return n._save(a);case H.SAVE_AS:return n._saveAs(l,a)}});return function(t,a,l){return e.apply(this,arguments)}}())}readSpatialReference(n,e){return this._readSpatialReference(e)}_readSpatialReference(n){if(null!=n.spatialReference)return A.Z.fromJSON(n.spatialReference);{const e=n.store,t=e.indexCRS||e.geographicCRS,a=t&&parseInt(t.substring(t.lastIndexOf("/")+1,t.length),10);return null!=a?new A.Z(a):null}}readFullExtent(n,e,t){if(null!=n&&"object"==typeof n){const O=null==n.spatialReference?{...n,spatialReference:this._readSpatialReference(e)}:n;return b.Z.fromJSON(O,t)}const a=e.store,l=this._readSpatialReference(e);return null==l||null==a?.extent||!Array.isArray(a.extent)||a.extent.some(O=>O<F)?null:new b.Z({xmin:a.extent[0],ymin:a.extent[1],xmax:a.extent[2],ymax:a.extent[3],spatialReference:l})}parseVersionString(n){const e={major:Number.NaN,minor:Number.NaN,versionString:n},t=n.split(".");return t.length>=2&&(e.major=parseInt(t[0],10),e.minor=parseInt(t[1],10)),e}readVersion(n,e){const t=e.store,a=null!=t.version?t.version.toString():"";return this.parseVersionString(a)}readTitlePortalItem(n){return"item-title"!==this.sublayerTitleMode?void 0:n}readTitleService(n,e){const t=this.portalItem?.title;if("item-title"===this.sublayerTitleMode)return(0,N.a7)(this.url,e.name);let a=e.name;if(!a&&this.url){const l=(0,N.Qc)(this.url);null!=l&&(a=l.title)}return"item-title-and-service-name"===this.sublayerTitleMode&&t&&(a=t+" - "+a),(0,N.ld)(a)}set url(n){const e=(0,N.XG)({layer:this,url:n,nonStandardUrlAllowed:!1,logger:W});this._set("url",e.url),null!=e.layerId&&this._set("layerId",e.layerId)}writeUrl(n,e,t,a){(0,N.wH)(this,n,"layers",e,a)}get parsedUrl(){const n=this._get("url"),e=(0,D.mN)(n);return null!=this.layerId&&(e.path=`${e.path}/layers/${this.layerId}`),e}_fetchIndexAndUpdateExtent(n,e){var t=this;return(0,d.Z)(function*(){t.indexInfo=(0,r.T)(t.parsedUrl.path,t.rootNode,n,t.apiKey,W,e),null==t.fullExtent||t.fullExtent.hasZ||t._updateExtent(yield t.indexInfo)})()}_updateExtent(n){if("page"===n?.type){const e=n.rootIndex%n.pageSize,t=n.rootPage?.nodes?.[e];if(null==t?.obb?.center||null==t.obb.halfSize)throw new m.Z("sceneservice:invalid-node-page","Invalid node page.");if(t.obb.center[0]<F||null==this.fullExtent||this.fullExtent.hasZ)return;const a=t.obb.halfSize,l=t.obb.center[2],O=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);this.fullExtent.zmin=l-O,this.fullExtent.zmax=l+O}else if("node"===n?.type){const e=n.rootNode?.mbs;if(!Array.isArray(e)||4!==e.length||e[0]<F)return;const t=e[2],a=e[3],{fullExtent:l}=this;l&&(l.zmin=t-a,l.zmax=t+a)}}_fetchService(n){var e=this;return(0,d.Z)(function*(){if(null==e.url)throw new m.Z("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(null==e.layerId&&/SceneServer\/*$/i.test(e.url)){const t=yield e._fetchFirstLayerId(n);null!=t&&(e.layerId=t)}return e._fetchServiceLayer(n)})()}_fetchFirstLayerId(n){var e=this;return(0,d.Z)(function*(){const t=yield(0,S.Z)(e.url,{query:{f:"json",token:e.apiKey},responseType:"json",signal:n});if(t.data&&Array.isArray(t.data.layers)&&t.data.layers.length>0)return t.data.layers[0].id})()}_fetchServiceLayer(n){var e=this;return(0,d.Z)(function*(){const t=yield(0,S.Z)(e.parsedUrl?.path??"",{query:{f:"json",token:e.apiKey},responseType:"json",signal:n});t.ssl&&(e.url=e.url.replace(/^http:/i,"https:"));let a=!1;if(t.data.layerType&&"Voxel"===t.data.layerType&&(a=!0),a)return e._fetchVoxelServiceLayer();const l=t.data;e.read(l,e._getServiceContext()),e.validateLayer(l)})()}_fetchVoxelServiceLayer(n){var e=this;return(0,d.Z)(function*(){const t=(yield(0,S.Z)(e.parsedUrl?.path+"/layer",{query:{f:"json",token:e.apiKey},responseType:"json",signal:n})).data;e.read(t,e._getServiceContext()),e.validateLayer(t)})()}_getServiceContext(){return{origin:"service",portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl}}_ensureLoadBeforeSave(){var n=this;return(0,d.Z)(function*(){yield n.load(),"beforeSave"in n&&"function"==typeof n.beforeSave&&(yield n.beforeSave())})()}validateLayer(n){}_updateTypeKeywords(n,e,t){n.typeKeywords||(n.typeKeywords=[]);const a=e.getTypeKeywords();for(const l of a)n.typeKeywords.push(l);n.typeKeywords&&(n.typeKeywords=n.typeKeywords.filter((l,O,M)=>M.indexOf(l)===O),t===V.newItem&&(n.typeKeywords=n.typeKeywords.filter(l=>"Hosted Service"!==l)))}_saveAs(n,e){var t=this;return(0,d.Z)(function*(){const a={...G,...e};let l=I.default.from(n);if(!l)throw new m.Z("sceneservice:portal-item-required","_saveAs() requires a portal item to save to");(0,w.w)(l),l.id&&(l=l.clone(),l.id=null);const O=l.portal||R.Z.getDefault();yield t._ensureLoadBeforeSave(),l.type=z,l.portal=O;const M={origin:"portal-item",url:null,messages:[],portal:O,portalItem:l,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},v={layers:[t.write({},M)]};return yield Promise.all(M.resources.pendingOperations??[]),yield t._validateAgainstJSONSchema(v,M,a),l.url=t.url,l.title||(l.title=t.title),t._updateTypeKeywords(l,a,V.newItem),yield O.signIn(),yield O.user?.addItem({item:l,folder:a?.folder,data:v}),yield(0,E.Hn)(t.resourceReferences,M,null),t.portalItem=l,(0,j.D)(M),M.portalItem=l,l})()}_save(n){var e=this;return(0,d.Z)(function*(){const t={...G,...n};if(!e.portalItem)throw new m.Z("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService");if((0,w.w)(e.portalItem),e.portalItem.type!==z)throw new m.Z("sceneservice:portal-item-wrong-type",`Portal item needs to have type "${z}"`);yield e._ensureLoadBeforeSave();const a={origin:"portal-item",url:e.portalItem.itemUrl&&(0,D.mN)(e.portalItem.itemUrl),messages:[],portal:e.portalItem.portal||R.Z.getDefault(),portalItem:e.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},l={layers:[e.write({},a)]};return yield Promise.all(a.resources.pendingOperations??[]),yield e._validateAgainstJSONSchema(l,a,t),e.portalItem.url=e.url,e.portalItem.title||(e.portalItem.title=e.title),e._updateTypeKeywords(e.portalItem,t,V.existingItem),yield(0,E.bx)(e.portalItem,l,e.resourceReferences,a,null),(0,j.D)(a),e.portalItem})()}_validateAgainstJSONSchema(n,e,t){return(0,d.Z)(function*(){let a=e.messages?.filter(v=>"error"===v.type).map(v=>new m.Z(v.name,v.message,v.details))??[];t?.validationOptions?.ignoreUnsupported&&(a=a.filter(v=>"layer:unsupported"!==v.name&&"symbol:unsupported"!==v.name&&"symbol-layer:unsupported"!==v.name&&"property:unsupported"!==v.name&&"url:unsupported"!==v.name&&"scenemodification:unsupported"!==v.name));const l=t?.validationOptions,O=l?.enabled,M=null;if(O&&M){const v=(yield M()).validate(n,t.portalItemLayerType);if(v.length>0){const Q=`Layer item did not validate:\n${v.join("\n")}`;if(W.error(`_validateAgainstJSONSchema(): ${Q}`),"throw"===l.failPolicy){const X=v.map(Y=>new m.Z("sceneservice:schema-validation",Y)).concat(a);throw new m.Z("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:X})}}}if(a.length>0)throw new m.Z("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:a})})()}};return(0,p._)([(0,y.Cb)(s.id)],f.prototype,"id",void 0),(0,p._)([(0,y.Cb)({type:A.Z})],f.prototype,"spatialReference",void 0),(0,p._)([(0,g.r)("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],f.prototype,"readSpatialReference",null),(0,p._)([(0,y.Cb)({type:b.Z})],f.prototype,"fullExtent",void 0),(0,p._)([(0,g.r)("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],f.prototype,"readFullExtent",null),(0,p._)([(0,y.Cb)({readOnly:!0,type:C.Z})],f.prototype,"heightModelInfo",void 0),(0,p._)([(0,y.Cb)({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],f.prototype,"minScale",void 0),(0,p._)([(0,y.Cb)({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],f.prototype,"maxScale",void 0),(0,p._)([(0,y.Cb)({readOnly:!0})],f.prototype,"version",void 0),(0,p._)([(0,g.r)("version",["store.version"])],f.prototype,"readVersion",null),(0,p._)([(0,y.Cb)({type:String,json:{read:{source:"copyrightText"}}})],f.prototype,"copyright",void 0),(0,p._)([(0,y.Cb)({type:String,json:{read:!1}})],f.prototype,"sublayerTitleMode",void 0),(0,p._)([(0,y.Cb)({type:String})],f.prototype,"title",void 0),(0,p._)([(0,g.r)("portal-item","title")],f.prototype,"readTitlePortalItem",null),(0,p._)([(0,g.r)("service","title",["name"])],f.prototype,"readTitleService",null),(0,p._)([(0,y.Cb)({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],f.prototype,"layerId",void 0),(0,p._)([(0,y.Cb)(s.HQ)],f.prototype,"url",null),(0,p._)([(0,Z.c)("url")],f.prototype,"writeUrl",null),(0,p._)([(0,y.Cb)()],f.prototype,"parsedUrl",null),(0,p._)([(0,y.Cb)({readOnly:!0})],f.prototype,"store",void 0),(0,p._)([(0,y.Cb)({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],f.prototype,"rootNode",void 0),f=(0,p._)([(0,L.j)(h)],f),f},F=-1e38;var V,T;(T=V||(V={}))[T.existingItem=0]="existingItem",T[T.newItem=1]="newItem";const z="Scene Service",G={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};var H;!function(T){T[T.SAVE=0]="SAVE",T[T.SAVE_AS=1]="SAVE_AS"}(H||(H={}))},7741:($,P,o)=>{o.d(P,{T:()=>m});var d=o(15861),p=o(66476),S=o(57964);function m(_,D,y,B,U,K){return x.apply(this,arguments)}function x(){return(x=(0,d.Z)(function*(_,D,y,B,U,K){let g=null;if(null!=y){const b=`${_}/nodepages/`,C=b+Math.floor(y.rootIndex/y.nodesPerPage);try{return{type:"page",rootPage:(yield(0,p.Z)(C,{query:{f:"json",token:B},responseType:"json",signal:K})).data,rootIndex:y.rootIndex,pageSize:y.nodesPerPage,lodMetric:y.lodSelectionMetricType,urlPrefix:b}}catch(A){U?.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",C,A),g=A}}if(!D)return null;const L=D?.split("/").pop(),Z=`${_}/nodes/`,j=Z+L;try{return{type:"node",rootNode:(yield(0,p.Z)(j,{query:{f:"json",token:B},responseType:"json",signal:K})).data,urlPrefix:Z}}catch(b){throw new S.Z("sceneservice:root-node-missing","Root node missing.",{pageError:g,nodeError:b,url:j})}})).apply(this,arguments)}},5251:($,P,o)=>{o.r(P),o.d(P,{addOrUpdateResource:()=>D,contentToBlob:()=>b,fetchResources:()=>x,getSiblingOfSameType:()=>A,getSiblingOfSameTypeI:()=>N,removeAllResources:()=>K,removeResource:()=>B,splitPrefixFileNameAndExtension:()=>Z});var d=o(15861),p=o(66476),S=o(57964),m=o(6785);function x(s){return _.apply(this,arguments)}function _(){return(_=(0,d.Z)(function*(s,r={},i){yield s.load(i);const u=(0,m.v_)(s.itemUrl,"resources"),{start:c=1,num:R=10,sortOrder:I="asc",sortField:w="created"}=r,E={query:{start:c,num:R,sortOrder:I,sortField:w,token:s.apiKey},signal:i?.signal},h=yield s.portal.request(u,E);return{total:h.total,nextStart:h.nextStart,resources:h.resources.map(({created:W,size:J,resource:F})=>({created:new Date(W),size:J,resource:s.resourceFromPath(F)}))}})).apply(this,arguments)}function D(s,r,i,u){return y.apply(this,arguments)}function y(){return(y=(0,d.Z)(function*(s,r,i,u){if(!s.hasPath())throw new S.Z(`portal-item-resource-${r}:invalid-path`,"Resource does not have a valid path");const c=s.portalItem;yield c.load(u);const R=(0,m.v_)(c.userItemUrl,"add"===r?"addResources":"updateResources"),[I,w]=L(s.path),E=new FormData;return I&&"."!==I&&E.append("resourcesPrefix",I),null!=u&&u.compress&&E.append("compress","true"),E.append("fileName",w),E.append("file",i,w),E.append("f","json"),u?.access&&E.append("access",u.access),yield c.portal.request(R,{method:"post",body:E,signal:u?.signal}),s})).apply(this,arguments)}function B(s,r,i){return U.apply(this,arguments)}function U(){return(U=(0,d.Z)(function*(s,r,i){if(!r.hasPath())throw new S.Z("portal-item-resources-remove:invalid-path","Resource does not have a valid path");yield s.load(i);const u=(0,m.v_)(s.userItemUrl,"removeResources");yield s.portal.request(u,{method:"post",query:{resource:r.path},signal:i?.signal}),r.portalItem=null})).apply(this,arguments)}function K(s,r){return g.apply(this,arguments)}function g(){return(g=(0,d.Z)(function*(s,r){yield s.load(r);const i=(0,m.v_)(s.userItemUrl,"removeResources");return s.portal.request(i,{method:"post",query:{deleteAll:!0},signal:r?.signal})})).apply(this,arguments)}function L(s){const r=s.lastIndexOf("/");return-1===r?[".",s]:[s.slice(0,r),s.slice(r+1)]}function Z(s){const[r,i]=function j(s){const r=(0,m.Ml)(s);return null==r?[s,""]:[s.slice(0,s.length-r.length-1),`.${r}`]}(s),[u,c]=L(r);return[u,c,i]}function b(s){return C.apply(this,arguments)}function C(){return(C=(0,d.Z)(function*(s){return"blob"===s.type?s.blob:"json"===s.type?new Blob([s.jsonString],{type:"application/json"}):(yield(0,p.Z)(s.url,{responseType:"blob"})).data})).apply(this,arguments)}function A(s,r){if(!s.hasPath())return null;const[i,,u]=Z(s.path);return s.portalItem.resourceFromPath((0,m.v_)(i,r+u))}function N(s,r){if(!s.hasPath())return null;const[i,,u]=Z(s.path);return s.portalItem.resourceFromPath((0,m.v_)(i,r+u))}},65820:($,P,o)=>{o.d(P,{w:()=>m});var d=o(11931),p=o(57964),S=o(40907);function m(x){if(d.default.apiKey&&(0,S.r)(x.portal.url))throw new p.Z("save-api-key-utils:api-key-not-supported",`Saving is not supported on ${x.portal.url} when using an api key`)}},46018:($,P,o)=>{o.d(P,{Hn:()=>D,Pl:()=>N,bx:()=>B});var d=o(15861),p=o(37636),S=o(57964),m=o(79412),x=o(19986),_=o(5251);function D(r,i){return y.apply(this,arguments)}function y(){return(y=(0,d.Z)(function*(r,i,u=null){const c=yield K(r,i,u);yield L(c,i,u)})).apply(this,arguments)}function B(r,i,u,c){return U.apply(this,arguments)}function U(){return(U=(0,d.Z)(function*(r,i,u,c,R=null){const I=yield K(u,c,R);yield r.update({data:i}),yield L(I,c,R)})).apply(this,arguments)}function K(r,i){return g.apply(this,arguments)}function g(){return(g=(0,d.Z)(function*(r,i,u=null){if(!i?.resources)return;const c=i.portalItem===r.portalItem?new Set(r.paths):new Set;r.paths.length=0,r.portalItem=i.portalItem;const R=new Set(i.resources.toKeep.map(h=>h.resource.path)),I=new Set,w=[];R.forEach(h=>{c.delete(h),r.paths.push(h)});for(const h of i.resources.toUpdate)if(c.delete(h.resource.path),R.has(h.resource.path)||I.has(h.resource.path)){const{resource:W,content:J,finish:F,error:V}=h,z=(0,_.getSiblingOfSameTypeI)(W,(0,x.DO)());r.paths.push(z.path),w.push(j({resource:z,content:J,compress:h.compress,finish:F,error:V},u))}else r.paths.push(h.resource.path),w.push(C(h,u)),I.add(h.resource.path);for(const h of i.resources.toAdd)r.paths.push(h.resource.path),c.has(h.resource.path)?c.delete(h.resource.path):w.push(j(h,u));if(0===w.length)return c;const E=yield(0,m.UO)(w);if((0,m.k_)(u),E.length>0)throw new S.Z("save:resources","Failed to save one or more resources",{errors:E});return c})).apply(this,arguments)}function L(r,i){return Z.apply(this,arguments)}function Z(){return(Z=(0,d.Z)(function*(r,i,u=null){if(!r||!i.portalItem)return;const c=[];for(const R of r){const I=i.portalItem.resourceFromPath(R);c.push(I.portalItem.removeResource(I,u))}yield(0,m.as)(c)})).apply(this,arguments)}function j(r,i){return b.apply(this,arguments)}function b(){return(b=(0,d.Z)(function*(r,i){const u={...i??{},compress:r.compress},c=yield(0,p.q6)(r.resource.portalItem.addResource(r.resource,yield(0,_.contentToBlob)(r.content),u));if(!0!==c.ok)throw r.error?.(c.error),c.error;r.finish?.(r.resource)})).apply(this,arguments)}function C(r,i){return A.apply(this,arguments)}function A(){return(A=(0,d.Z)(function*(r,i){const u=yield(0,p.q6)(r.resource.update(yield(0,_.contentToBlob)(r.content),i));if(!0!==u.ok)throw r.error?.(u.error),u.error;r.finish?.(r.resource)})).apply(this,arguments)}function N(r){return s.apply(this,arguments)}function s(){return(s=(0,d.Z)(function*(r){const i=[];for(const u of r.allLayers)if("beforeSave"in u&&"function"==typeof u.beforeSave){const c=u.beforeSave();c&&i.push(c)}yield Promise.allSettled(i)})).apply(this,arguments)}}}]);