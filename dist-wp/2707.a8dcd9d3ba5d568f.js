"use strict";(self.webpackChunkangular_17_test=self.webpackChunkangular_17_test||[]).push([[2707],{52707:(v,c,o)=>{o.r(c),o.d(c,{default:()=>W});var E=o(15861),h=o(50484),d=(o(14007),o(4703),o(1535),o(57678),o(57964),o(10141)),O=o(657),C=o(96043),I=o(99657),L=o(5863),i=o(51424);class l{constructor(t,_){this.offset=t,this.extent=_}}let f=class extends L.Z{constructor(){super(...arguments),this.type="heatmap",this._tileKeyToFeatureSets=new Map}initialize(){this.addHandles([this.tileStore.on("update",this.onTileUpdate.bind(this))])}update(r,t){var _=this;return(0,E.Z)(function*(){const s=t.schema.processors[0];"heatmap"===s.type&&(0,O.Hg)(_._schema,s)&&(r.mesh=!0,_._schema=s)})()}onTileUpdate(r){for(const t of r.removed)this._tileKeyToFeatureSets.delete(t.key.id)}onTileClear(r){return this._tileKeyToFeatureSets.delete(r.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:r.id,data:{clear:!0}})}onTileMessage(r,t,_){var s=this;return(0,E.Z)(function*(){s._tileKeyToFeatureSets.has(r.key.id)||s._tileKeyToFeatureSets.set(r.key.id,new Map);const e=s._tileKeyToFeatureSets.get(r.key.id);if(e&&null!=t.addOrUpdate&&t.addOrUpdate.hasFeatures&&e.set(t.addOrUpdate.instance,t),t.end){const n=[],y=function R(r){const t=r.key,_=new Map,s=256,e=I.i9,n=r.tileInfoView.tileInfo.isWrappable;return _.set((0,i.M)(t,-1,-1,n).id,new l([-e,-e],[e-s,e-s,e,e])),_.set((0,i.M)(t,0,-1,n).id,new l([0,-e],[0,e-s,e,e])),_.set((0,i.M)(t,1,-1,n).id,new l([e,-e],[0,e-s,s,e])),_.set((0,i.M)(t,-1,0,n).id,new l([-e,0],[e-s,0,e,e])),_.set((0,i.M)(t,1,0,n).id,new l([e,0],[0,0,s,e])),_.set((0,i.M)(t,-1,1,n).id,new l([-e,e],[e-s,0,e,s])),_.set((0,i.M)(t,0,1,n).id,new l([0,e],[0,0,e,s])),_.set((0,i.M)(t,1,1,n).id,new l([e,e],[0,0,s,s])),_}(r);s._tileKeyToFeatureSets.forEach((K,T)=>{if(T===r.key.id)K.forEach(({addOrUpdate:M})=>{M&&n.push(M)});else if(y.has(T)){const M=y.get(T),[A,g]=M.offset;K.forEach(({addOrUpdate:m})=>{if(m){const S=m.transform(A,g,1,1);n.push(S)}})}});const U=(0,C.QM)(n,s._schema.mesh,512,512);return s.remoteClient.invoke("tileRenderer.onTileData",{tileKey:r.key.id,intensityInfo:U},{..._,transferList:[U.matrix]})}})()}onTileError(r,t,_){return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:r.id,error:t},_)}};f=(0,h._)([(0,d.j)("esri.views.2d.layers.features.processors.HeatmapProcessor")],f);const W=f},51424:(v,c,o)=>{function E(h,p,D,P){const a=h.clone(),u=1<<a.level,d=a.col+p,O=a.row+D;return P&&d<0?(a.col=d+u,a.world-=1):d>=u?(a.col=d-u,a.world+=1):a.col=d,a.row=O,a}o.d(c,{M:()=>E})}}]);