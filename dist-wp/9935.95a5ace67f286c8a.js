"use strict";(self.webpackChunkangular_17_test=self.webpackChunkangular_17_test||[]).push([[9935],{35244:(W,M,_)=>{_.d(M,{s:()=>L});var r=_(45425),h=_(71602),f=_(6118),c=_(13305);class o extends c.I{constructor(i,l,E,d,g,C,B=null){super(i,l,E,d,g,C),this.bitmap=new f.eY(B),this.bitmap.coordScale=[g,C],this.bitmap.once("isReady",()=>this.ready())}destroy(){super.destroy(),this.bitmap.destroy()}beforeRender(i){this.bitmap.beforeRender(i),super.beforeRender(i)}afterRender(i){this.bitmap.afterRender(i),super.afterRender(i)}set stencilRef(i){this.bitmap.stencilRef=i}get stencilRef(){return this.bitmap.stencilRef}_createTransforms(){return{dvs:(0,h.c)(),tileMat3:(0,h.c)()}}setTransform(i){super.setTransform(i),this.bitmap.transforms.dvs=this.transforms.dvs}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap&&(this.bitmap.stage=null)}}var O=_(88098),U=_(43101),u=_(75747);class L extends u.Z{get requiresDedicatedFBO(){return this.children.some(i=>"additive"===i.bitmap.blendFunction)}createTile(i){const l=this._tileInfoView.getTileBounds((0,r.Ue)(),i),E=this._tileInfoView.getTileResolution(i.level),[d,g]=this._tileInfoView.tileInfo.size;return new o(i,E,l[0],l[3],d,g)}prepareRenderPasses(i){const l=i.registerRenderPass({name:"bitmap (tile)",brushes:[O.U.bitmap],target:()=>this.children.map(E=>E.bitmap),drawPhase:U.jx.MAP});return[...super.prepareRenderPasses(i),l]}doRender(i){this.visible&&i.drawPhase===U.jx.MAP&&super.doRender(i)}}},1646:(W,M,_)=>{_.r(M),_.d(M,{default:()=>b});var r=_(15861),h=_(50484),f=_(1258),c=_(4703),o=_(79412),O=_(80543),R=(_(1535),_(57678),_(14007),_(10141)),i=_(33721),l=_(72262),y=(_(57964),_(66679),_(6210),_(11931),_(66476),_(6785),_(54786),_(64456),_(84892),_(88278),_(55117),_(99273),_(2902),_(43101),_(15585),_(48243),_(32196),_(36895),_(39237),_(35208),_(94544),_(99657),_(65311),_(10827),_(56035),_(53730),_(31894),_(18121),_(39853),_(83018),_(3380),_(17091),_(46682),_(55898),_(40176),_(71960),_(82906),_(10264),_(59078),_(7077),_(17866),_(38550),_(59319),_(61362),_(68359),_(23783),_(56064),_(8735),_(7081),_(89877),_(53299),_(11462),_(63298),_(90771),_(47403),_(68994)),V=(_(78857),_(37636),_(83944),_(12926),_(714),_(4460),_(10842),_(49602),_(44526),_(33520),_(93566),_(46266),_(6016),_(93114)),S=_(93509),H=_(18209),v=_(73430),G=_(6777),p=_(54529),Z=_(87766),Q=_(40394),x=_(50145),F=_(32126),A=_(64269),w=_(9171);const z=[0,0];let P=class extends((0,F.Z)((0,V.Y)((0,S.y)(x.Z)))){constructor(){super(...arguments),this._fetchQueue=null,this._highlightGraphics=new l.J,this._highlightView=null,this._popupHighlightHelper=null,this._tileStrategy=null,this.layer=null}get resampling(){return!("resampling"in this.layer)||!1!==this.layer.resampling}get tilemapCache(){return"tilemapCache"in this.layer?this.layer.tilemapCache:null}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume(),this._highlightView?.processUpdate(e)}attach(){const e="tileServers"in this.layer?this.layer.tileServers:null,s=this.tilemapCache;if(this._tileInfoView=new G.Z(this.layer.tileInfo,this.layer.fullExtent,s?.effectiveMinLOD,s?.effectiveMaxLOD),this._fetchQueue=new Z.Z({tileInfoView:this._tileInfoView,concurrency:e&&10*e.length||10,process:(t,n)=>this.fetchTile(t,n)}),this._tileStrategy=new Q.Z({cachePolicy:"keep",resampling:this.resampling,acquireTile:t=>this.acquireTile(t),releaseTile:t=>this.releaseTile(t),tileInfoView:this._tileInfoView}),(0,A.Uf)(this,this.layer)){const t=this._highlightView=new y.Z({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new H.Z(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1});this.container.addChild(this._highlightView.container),this._popupHighlightHelper=new A.VF({createFetchPopupFeaturesQueryGeometry:(n,a)=>(0,w.K)(n,a,this.view),highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:(n,a)=>{t.graphicUpdateHandler({graphic:n,property:a})},layerView:this,updatingHandles:this._updatingHandles})}this.requestUpdate(),this.addAttachHandles(this._updatingHandles.add(()=>this.resampling,()=>{this.doRefresh()})),super.attach()}detach(){super.detach(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._popupHighlightHelper?.destroy(),this._highlightView?.destroy(),this._fetchQueue=this._tileStrategy=this._tileInfoView=this._popupHighlightHelper=null}fetchPopupFeatures(e,s){var t=this;return(0,r.Z)(function*(){return t._popupHighlightHelper?t._popupHighlightHelper.fetchPopupFeatures(e,s):[]})()}highlight(e){return this._popupHighlightHelper?this._popupHighlightHelper.highlight(e):(0,f.kB)()}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}supportsSpatialReference(e){return(0,i.fS)(this.layer.tileInfo?.spatialReference,e)}doRefresh(){var e=this;return(0,r.Z)(function*(){if(e.attached){if(e.suspended)return e._tileStrategy.clear(),void e.requestUpdate();e._fetchQueue.reset(),e._tileStrategy.refresh(s=>e._updatingHandles.addPromise(e._enqueueTileFetch(s)))}})()}acquireTile(e){const s=this._bitmapView.createTile(e),t=s.bitmap;return[t.x,t.y]=this._tileInfoView.getTileCoords(z,s.key),t.resolution=this._tileInfoView.getTileResolution(s.key),[t.width,t.height]=this._tileInfoView.tileInfo.size,this._updatingHandles.addPromise(this._enqueueTileFetch(s)),this._bitmapView.addChild(s),this.requestUpdate(),s}releaseTile(e){this._fetchQueue.abort(e.key.id),this._bitmapView.removeChild(e),e.once("detach",()=>e.destroy()),this.requestUpdate()}fetchTile(e,s={}){var t=this;return(0,r.Z)(function*(){const n=t.tilemapCache,{signal:a,resamplingLevel:m=0}=s;if(!n)try{return yield t._fetchImage(e,a)}catch(D){if(!(0,o.D_)(D)&&!t.resampling)return(0,v.V)(t._tileInfoView.tileInfo.size);if(m<3){const j=t._tileInfoView.getTileParentId(e.id);if(j){const K=new p.Z(j),Y=yield t.fetchTile(K,{...s,resamplingLevel:m+1});return(0,v.i)(t._tileInfoView,Y,K,e)}}throw D}const T=new p.Z(0,0,0,0);let I;try{if(yield n.fetchAvailabilityUpsample(e.level,e.row,e.col,T,{signal:a}),T.level!==e.level&&!t.resampling)return(0,v.V)(t._tileInfoView.tileInfo.size);I=yield t._fetchImage(T,a)}catch(D){if((0,o.D_)(D))throw D;I=yield t._fetchImage(e,a)}return t.resampling?(0,v.i)(t._tileInfoView,I,T,e):I})()}_enqueueTileFetch(e){var s=this;return(0,r.Z)(function*(){if(!s._fetchQueue.has(e.key.id)){try{const t=yield s._fetchQueue.push(e.key);e.bitmap.source=t,e.bitmap.width=s._tileInfoView.tileInfo.size[0],e.bitmap.height=s._tileInfoView.tileInfo.size[1],e.once("attach",()=>s.requestUpdate())}catch(t){(0,o.D_)(t)||c.Z.getLogger(s).error(t)}s.requestUpdate()}})()}_fetchImage(e,s){var t=this;return(0,r.Z)(function*(){return t.layer.fetchImageBitmapTile(e.level,e.row,e.col,{signal:s})})()}};(0,h._)([(0,O.Cb)()],P.prototype,"resampling",null),(0,h._)([(0,O.Cb)()],P.prototype,"tilemapCache",null),P=(0,h._)([(0,R.j)("esri.views.2d.layers.TileLayerView2D")],P);const b=P}}]);