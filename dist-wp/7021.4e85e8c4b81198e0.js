"use strict";(self.webpackChunkangular_17_test=self.webpackChunkangular_17_test||[]).push([[7021],{89568:(rt,G,t)=>{function h(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function C(O){return[O[0],O[1],O[2],O[3],O[4],O[5],O[6],O[7],O[8],O[9],O[10],O[11],O[12],O[13],O[14],O[15]]}function V(O,F){return new Float64Array(O,F,16)}t.d(G,{I:()=>Z,a:()=>h,b:()=>C,c:()=>V});const Z=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Z,clone:C,create:h,createView:V,fromValues:function $(O,F,L,z,A,p,v,g,P,N,Q,B,J,b,R,n){return[O,F,L,z,A,p,v,g,P,N,Q,B,J,b,R,n]}},Symbol.toStringTag,{value:"Module"}))},43548:(rt,G,t)=>{t.d(G,{a:()=>Z,b:()=>V,c:()=>C,d:()=>F,e:()=>T,n:()=>L,s:()=>O,t:()=>$});var h=t(58466);function C(p,v,g){$(p.typedBuffer,v.typedBuffer,g,p.typedBufferStride,v.typedBufferStride)}function $(p,v,g,P=3,N=P){if(p.length/P!==Math.ceil(v.length/N))return h.c.error("source and destination buffers need to have the same number of elements"),p;const Q=p.length/P,B=g[0],J=g[1],b=g[2],R=g[4],n=g[5],u=g[6],y=g[8],D=g[9],M=g[10],k=g[12],c=g[13],l=g[14];let f=0,E=0;for(let j=0;j<Q;j++){const tt=v[f],Y=v[f+1],K=v[f+2];p[E]=B*tt+R*Y+y*K+k,p[E+1]=J*tt+n*Y+D*K+c,p[E+2]=b*tt+u*Y+M*K+l,f+=N,E+=P}return p}function V(p,v,g){Z(p.typedBuffer,v.typedBuffer,g,p.typedBufferStride,v.typedBufferStride)}function Z(p,v,g,P=3,N=P){if(p.length/P!==Math.ceil(v.length/N))return void h.c.error("source and destination buffers need to have the same number of elements");const Q=p.length/P,B=g[0],J=g[1],b=g[2],R=g[3],n=g[4],u=g[5],y=g[6],D=g[7],M=g[8];let k=0,c=0;for(let l=0;l<Q;l++){const f=v[k],E=v[k+1],j=v[k+2];p[c]=B*f+R*E+y*j,p[c+1]=J*f+n*E+D*j,p[c+2]=b*f+u*E+M*j,k+=N,c+=P}}function T(p,v,g){O(p.typedBuffer,v,g,p.typedBufferStride)}function O(p,v,g,P=3){const N=Math.min(p.length/P,v.count),Q=v.typedBuffer,B=v.typedBufferStride;let J=0,b=0;for(let R=0;R<N;R++)p[b]=g*Q[J],p[b+1]=g*Q[J+1],p[b+2]=g*Q[J+2],J+=B,b+=P}function F(p,v){L(p.typedBuffer,v.typedBuffer,p.typedBufferStride,v.typedBufferStride)}function L(p,v,g=3,P=g){const N=Math.min(p.length/g,v.length/P);let Q=0,B=0;for(let J=0;J<N;J++){const b=v[Q],R=v[Q+1],n=v[Q+2],u=b*b+R*R+n*n;if(u>0){const y=1/Math.sqrt(u);p[B]=y*b,p[B+1]=y*R,p[B+2]=y*n}Q+=P,B+=g}}Object.freeze(Object.defineProperty({__proto__:null,normalize:L,normalizeView:F,scale:O,scaleView:T,shiftRight:function z(p,v,g){const P=Math.min(p.count,v.count),N=p.typedBuffer,Q=p.typedBufferStride,B=v.typedBuffer,J=v.typedBufferStride;let b=0,R=0;for(let n=0;n<P;n++)N[R]=B[b]>>g,N[R+1]=B[b+1]>>g,N[R+2]=B[b+2]>>g,b+=J,R+=Q},transformMat3:Z,transformMat3View:V,transformMat4:$,transformMat4View:C},Symbol.toStringTag,{value:"Module"}))},58466:(rt,G,t)=>{t.d(G,{c:()=>C});const C=t(4703).Z.getLogger("esri.views.3d.support.buffer.math")},85559:(rt,G,t)=>{t.d(G,{g:()=>h});const h={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},67021:(rt,G,t)=>{t.r(G),t.d(G,{default:()=>bt});var h=t(15861),C=t(50484),V=(t(2189),t(26152)),Z=t(66476),T=t(34411),O=t(57678),F=t(57964),L=t(14007),z=t(84303),A=t(67016),p=t(4703),v=t(71763),g=t(79412),P=t(6785),N=t(19986),Q=t(80543),J=(t(1535),t(10141)),b=t(26894),R=t(60838),n=t(89568),u=t(99279),y=t(43548);function D(r){const{vertexSpace:s}=r;if(s.isRelative)return r.clone();const{anchor:e}=r,i=e.clone(),d=(0,R.d)(M,[-i.x,-i.y,-i.z]),m=new u.Z({origin:[i.x,i.y,i.z]}),S=r.cloneWithVertexSpace(m),{position:x}=S.vertexAttributes;return S.vertexAttributes.position=(0,y.t)(new Float64Array(x.length),x,d),S.vertexAttributesChanged(),S}const M=(0,n.a)();var k=t(47689),c=t(35458),l=t(49602),f=t(83821),E=t(40637),j=t(52334);function tt(r,s,e){return Y.apply(this,arguments)}function Y(){return(Y=(0,h.Z)(function*(r,s,e){const{geometry:i}=s,d={...s.attributes};if(null!=e&&"mesh"===i?.type){const{transformFieldRoles:m}=e,{origin:S,spatialReference:x,transform:U}=i,I=r.spatialReference;yield(0,f.initializeProjection)(x,I);const H=(0,f.project)(S,I);if(d[m.originX]=H.x,d[m.originY]=H.y,d[m.originZ]=H.z??0,null!=U){const{translation:X,scale:q,rotation:_}=U,{vertexSpace:at}=i,st=at.isGeoreferenced?1:(0,l.r6)(x)/(0,l.r6)(I);d[m.translationX]=X[0]*st,d[m.translationY]=X[2]*st,d[m.translationZ]=-X[1]*st,d[m.scaleX]=q[0],d[m.scaleY]=q[2],d[m.scaleZ]=q[1],d[m.rotationX]=_[0],d[m.rotationY]=_[2],d[m.rotationZ]=-_[1],d[m.rotationDeg]=_[3]}return{attributes:d}}return null==i?{attributes:d}:"mesh"===i.type||"extent"===i.type?null:{geometry:i.toJSON(),attributes:d}})).apply(this,arguments)}function ot(){return(ot=(0,h.Z)(function*(r,s){const e=yield Promise.all((s.addAttachments??[]).map(m=>pt(r,m))),i=yield Promise.all((s.updateAttachments??[]).map(m=>pt(r,m))),d=s.deleteAttachments??[];return e.length||i.length||d.length?{adds:e,updates:i,deletes:[...d]}:null})).apply(this,arguments)}function pt(r,s){return dt.apply(this,arguments)}function dt(){return(dt=(0,h.Z)(function*(r,s){const{feature:e,attachment:i}=s,{globalId:d,name:m,contentType:S,data:x,uploadId:U}=i,I={globalId:d};if(e&&("attributes"in e?I.parentGlobalId=e.attributes?.[r.globalIdField]:e.globalId&&(I.parentGlobalId=e.globalId)),U)I.uploadId=U;else if(x){const H=yield(0,P.IR)(x);H&&(I.contentType=H.mediaType,I.data=H.data),x instanceof File&&(I.name=x.name)}return m&&(I.name=m),S&&(I.contentType=S),I})).apply(this,arguments)}function et(r){const s=!0===r.success?null:r.error||{code:void 0,description:void 0};return{objectId:r.objectId,globalId:r.globalId,error:s?new F.Z("feature-layer-source:edit-failure",s.description,{code:s.code}):null}}function ut(r,s){return new c.Z({attributes:r.attributes,geometry:(0,E.im)({...r.geometry,spatialReference:s})})}function gt(r,s){return{adds:r?.adds?.map(e=>ut(e,s))||[],updates:r?.updates?.map(e=>({original:ut(e[0],s),current:ut(e[1],s)}))||[],deletes:r?.deletes?.map(e=>ut(e,s))||[],spatialReference:s}}var St=t(60324),Rt=t(59211),Ot=t(89713),yt=t(43497),Ft=t(11642),At=t(46708),Pt=t(18101),It=t(91866),xt=t(93604),Ct=t(43814);const Zt=new z.X({originalAndCurrentFeatures:"original-and-current-features",none:"none"}),Dt=new Set(["Feature Layer","Oriented Imagery Layer","Table"]),Mt=new z.X({Started:"published",Publishing:"publishing",Stopped:"unavailable"});let lt=class extends A.Z{constructor(){var r;super(...arguments),r=this,this.type="feature-layer",this.refresh=(0,g.Ds)((0,h.Z)(function*(){yield r.load();const s=r.sourceJSON.editingInfo?.lastEditDate;if(null==s)return{dataChanged:!0,updates:{}};try{yield r._fetchService(null)}catch{return{dataChanged:!0,updates:{}}}const e=s!==r.sourceJSON.editingInfo?.lastEditDate;return{dataChanged:e,updates:e?{editingInfo:r.sourceJSON.editingInfo,extent:r.sourceJSON.extent}:null}})),this._ongoingAssetUploads=new Map}load(r){const e=this._fetchService(this.layer.sourceJSON,{...r}).then(()=>this.layer.setUserPrivileges(this.sourceJSON.serviceItemId,r)).then(()=>this._ensureLatestMetadata(r));return this.addResolvingPromise(e),Promise.resolve(this)}get queryTask(){const{capabilities:r,parsedUrl:s,dynamicDataSource:e,infoFor3D:i,gdbVersion:d,spatialReference:m,fieldsIndex:S}=this.layer,x=(0,L.Z)("featurelayer-pbf")&&r?.query.supportsFormatPBF&&null==i;return new Rt.Z({url:s.path,pbfSupported:x,fieldsIndex:S,infoFor3D:i,dynamicDataSource:e,gdbVersion:d,sourceSpatialReference:m,queryAttachmentsSupported:r?.operations?.supportsQueryAttachments??!1})}addAttachment(r,s){var e=this;return(0,h.Z)(function*(){yield e.load();const{layer:i}=e;yield(0,yt.nU)(i,"editing");const d=r.attributes[i.objectIdField],m=i.parsedUrl.path+"/"+d+"/addAttachment",S=e._getLayerRequestOptions(),x=e._getFormDataForAttachment(s,S.query);try{return et((yield(0,Z.Z)(m,{body:x})).data.addAttachmentResult)}catch(U){throw e._createAttachmentErrorResult(d,U)}})()}updateAttachment(r,s,e){var i=this;return(0,h.Z)(function*(){yield i.load();const{layer:d}=i;yield(0,yt.nU)(d,"editing");const m=r.attributes[d.objectIdField],S=d.parsedUrl.path+"/"+m+"/updateAttachment",x=i._getLayerRequestOptions({query:{attachmentId:s}}),U=i._getFormDataForAttachment(e,x.query);try{return et((yield(0,Z.Z)(S,{body:U})).data.updateAttachmentResult)}catch(I){throw i._createAttachmentErrorResult(m,I)}})()}applyEdits(r,s){var e=this;return(0,h.Z)(function*(){yield e.load();const{layer:i}=e;yield(0,yt.nU)(i,"editing");const d=i.infoFor3D,m=null!=d,S=m||(s?.globalIdUsed??!1),x=m?yield e._uploadMeshesAndGetAssetMapEditsJSON(r):null,U=r.addFeatures?.map(w=>tt(e.layer,w,d))??[],I=(yield Promise.all(U)).filter(O.pC),H=r.updateFeatures?.map(w=>tt(e.layer,w,d))??[],X=(yield Promise.all(H)).filter(O.pC),q=function ft(r,s,e){if(!s||0===s.length)return[];if(e&&(0,j.isFeatureIdentifierArrayWithGlobalId)(s))return s.map(d=>d.globalId);if((0,j.isFeatureIdentifierArrayWithObjectId)(s))return s.map(d=>d.objectId);const i=e?r.globalIdField:r.objectIdField;return i?s.map(d=>d.getAttribute(i)):[]}(e.layer,r.deleteFeatures,S);(0,Pt.P)(I,X,i.spatialReference);const _=yield function K(r,s){return ot.apply(this,arguments)}(e.layer,r),at=i.capabilities.editing.supportsAsyncApplyEdits&&m,st=s?.gdbVersion||i.gdbVersion,W={gdbVersion:st,rollbackOnFailure:s?.rollbackOnFailureEnabled,useGlobalIds:S,returnEditMoment:s?.returnEditMoment,usePreviousEditMoment:s?.usePreviousEditMoment,async:at};yield(0,xt.Px)(e.layer.url,st,!0);const ht=(0,xt.JV)(e.layer.url,st||null);s?.returnServiceEditsOption?(W.edits=JSON.stringify([{id:i.layerId,adds:I,updates:X,deletes:q,attachments:_,assetMaps:x}]),W.returnServiceEditsOption=Zt.toJSON(s?.returnServiceEditsOption),W.returnServiceEditsInSourceSR=s?.returnServiceEditsInSourceSR):(W.adds=I.length?JSON.stringify(I):null,W.updates=X.length?JSON.stringify(X):null,W.deletes=q.length?S?JSON.stringify(q):q.join(","):null,W.attachments=_&&JSON.stringify(_),W.assetMaps=null!=x?JSON.stringify(x):void 0);const nt=e._getLayerRequestOptions({method:"post",query:W});ht&&(nt.authMode="immediate",nt.query.returnEditMoment=!0,nt.query.sessionId=xt.U8);const it=s?.returnServiceEditsOption?i.url:i.parsedUrl.path;let ct;try{ct=at?yield e._asyncApplyEdits(it+"/applyEdits",nt):yield(0,Z.Z)(it+"/applyEdits",nt)}catch(w){if(!function vt(r){const s=r.details.raw,i=+s.extendedCode;return 500==+s.code&&(-2147217144===i||-2147467261===i)}(w))throw w;nt.authMode="immediate",ct=at?yield e._asyncApplyEdits(it+"/applyEdits",nt):yield(0,Z.Z)(it+"/applyEdits",nt)}return!i.capabilities.operations?.supportsEditing&&i.effectiveCapabilities?.operations?.supportsEditing&&(yield V.id?.findCredential(i.url)?.refreshToken()),e._createEditsResult(ct)})()}deleteAttachments(r,s){var e=this;return(0,h.Z)(function*(){yield e.load();const{layer:i}=e;yield(0,yt.nU)(i,"editing");const d=r.attributes[i.objectIdField],m=i.parsedUrl.path+"/"+d+"/deleteAttachments";try{return(yield(0,Z.Z)(m,e._getLayerRequestOptions({query:{attachmentIds:s.join(",")},method:"post"}))).data.deleteAttachmentResults.map(et)}catch(S){throw e._createAttachmentErrorResult(d,S)}})()}fetchRecomputedExtents(r={}){var s=this;return this.load({signal:r.signal}).then((0,h.Z)(function*(){const i=s._getLayerRequestOptions({...r,query:{returnUpdates:!0}}),{layerId:d,url:m}=s.layer,{data:S}=yield(0,Z.Z)(`${m}/${d}`,i),{id:x,extent:U,fullExtent:I,timeExtent:H}=S,X=U||I;return{id:x,fullExtent:X&&b.Z.fromJSON(X),timeExtent:H&&T.Z.fromJSON({start:H[0],end:H[1]})}}))}queryAttachments(r,s={}){var e=this;return(0,h.Z)(function*(){yield e.load();const i=e._getLayerRequestOptions(s);return e.queryTask.executeAttachmentQuery(r,i)})()}queryFeatures(r,s){var e=this;return(0,h.Z)(function*(){yield e.load();const i=yield e.queryTask.execute(r,{...s,query:e._createRequestQueryOptions(s)});return r.outStatistics?.length&&i.features.length&&i.features.forEach(d=>{const m=d.attributes;r.outStatistics?.forEach(({outStatisticFieldName:S})=>{if(S){const x=S.toLowerCase();x&&x in m&&S!==x&&(m[S]=m[x],delete m[x])}})}),i})()}queryFeaturesJSON(r,s){var e=this;return(0,h.Z)(function*(){return yield e.load(),e.queryTask.executeJSON(r,{...s,query:e._createRequestQueryOptions(s)})})()}queryObjectIds(r,s){var e=this;return(0,h.Z)(function*(){return yield e.load(),e.queryTask.executeForIds(r,{...s,query:e._createRequestQueryOptions(s)})})()}queryFeatureCount(r,s){var e=this;return(0,h.Z)(function*(){return yield e.load(),e.queryTask.executeForCount(r,{...s,query:e._createRequestQueryOptions(s)})})()}queryExtent(r,s){var e=this;return(0,h.Z)(function*(){return yield e.load(),e.queryTask.executeForExtent(r,{...s,query:e._createRequestQueryOptions(s)})})()}queryRelatedFeatures(r,s){var e=this;return(0,h.Z)(function*(){return yield e.load(),e.queryTask.executeRelationshipQuery(r,{...s,query:e._createRequestQueryOptions(s)})})()}queryRelatedFeaturesCount(r,s){var e=this;return(0,h.Z)(function*(){return yield e.load(),e.queryTask.executeRelationshipQueryForCount(r,{...s,query:e._createRequestQueryOptions(s)})})()}queryTopFeatures(r,s){var e=this;return(0,h.Z)(function*(){return yield e.load(),e.queryTask.executeTopFeaturesQuery(r,{...s,query:e._createRequestQueryOptions(s)})})()}queryTopObjectIds(r,s){var e=this;return(0,h.Z)(function*(){return yield e.load(),e.queryTask.executeForTopIds(r,{...s,query:e._createRequestQueryOptions(s)})})()}queryTopExtents(r,s){var e=this;return(0,h.Z)(function*(){return yield e.load(),e.queryTask.executeForTopExtents(r,{...s,query:e._createRequestQueryOptions(s)})})()}queryTopCount(r,s){var e=this;return(0,h.Z)(function*(){return yield e.load(),e.queryTask.executeForTopCount(r,{...s,query:e._createRequestQueryOptions(s)})})()}fetchPublishingStatus(){var r=this;return(0,h.Z)(function*(){if(!(0,Ot.M8)(r.layer.url))return"unavailable";const s=(0,P.v_)(r.layer.url,"status"),e=yield(0,Z.Z)(s,{query:{f:"json"}});return Mt.fromJSON(e.data.status)})()}uploadAssets(r,s){var e=this;return(0,h.Z)(function*(){const{uploadAssets:i}=yield t.e(912).then(t.bind(t,10912));return i(r,{layer:e.layer,ongoingUploads:e._ongoingAssetUploads},s)})()}_asyncApplyEdits(r,s){return(0,h.Z)(function*(){const e=(yield(0,Z.Z)(r,s)).data.statusUrl;for(;;){const i=(yield(0,Z.Z)(e,{query:{f:"json"},responseType:"json"})).data;switch(i.status){case"Completed":return(0,Z.Z)(i.resultUrl,{query:{f:"json"},responseType:"json"});case"CompletedWithErrors":throw new F.Z("async-applyEdits-failed","asynchronous applyEdits call failed.");case"Failed ImportChanges":case"InProgress":case"Pending":case"ExportAttachments":case"ExportChanges":case"ExportingData":case"ExportingSnapshot":case"ImportAttachments":case"ProvisioningReplica":case"UnRegisteringReplica":break;default:throw new F.Z("async-applyEdits-failed","asynchronous applyEdits call failed (undefined response status)")}yield(0,g.e4)(Tt)}})()}_createRequestQueryOptions(r){const s={...this.layer.customParameters,token:this.layer.apiKey,...r?.query};return this.layer.datesInUnknownTimezone&&(s.timeReferenceUnknownClient=!0),s}_fetchService(r,s){var e=this;return(0,h.Z)(function*(){if(!r){const d={};(0,L.Z)("featurelayer-advanced-symbols")&&(d.returnAdvancedSymbols=!0),s?.cacheBust&&(d._ts=Date.now());const{data:m}=yield(0,Z.Z)(e.layer.parsedUrl.path,e._getLayerRequestOptions({query:d,signal:s?.signal}));r=m}e.sourceJSON=yield e._patchServiceJSON(r,s?.signal);const i=r.type;if(!Dt.has(i))throw new F.Z("feature-layer-source:unsupported-type",`Source type "${i}" is not supported`)})()}_patchServiceJSON(r,s){var e=this;return(0,h.Z)(function*(){if("Table"!==r.type&&r.geometryType&&!r?.drawingInfo?.renderer&&!r.defaultSymbol){const i=(0,St.bU)(r.geometryType).renderer;(0,v.RB)("drawingInfo.renderer",i,r)}if("esriGeometryMultiPatch"===r.geometryType&&r.infoFor3D&&(r.geometryType="mesh"),null==r.extent)try{const{data:i}=yield(0,Z.Z)(e.layer.url,e._getLayerRequestOptions({signal:s}));i.spatialReference&&(r.extent={xmin:0,ymin:0,xmax:0,ymax:0,spatialReference:i.spatialReference})}catch(i){(0,g.r9)(i)}return r})()}_ensureLatestMetadata(r){var s=this;return(0,h.Z)(function*(){if(s.layer.userHasUpdateItemPrivileges&&s.sourceJSON.cacheMaxAge>0)return s._fetchService(null,{...r,cacheBust:!0})})()}_uploadMeshesAndGetAssetMapEditsJSON(r){var s=this;return(0,h.Z)(function*(){const{addAssetFeatures:e}=r;if(!e?.length)return null;const i=yield s._filterRedundantAssetMaps(e);if(!e?.length)return null;const d=new Array,m=new Map;for(const S of i){const{geometry:x}=S,{vertexSpace:U}=x;if(U.isRelative)d.push(x);else{const I=D(x);m.set(I,x),S.geometry=I,d.push(I)}}yield s.uploadAssets(d);for(const[S,x]of m)x.addExternalSources(S.metadata.externalSources.items);return{adds:s._getAssetMapEditsJSON(i),updates:[],deletes:[]}})()}_getAssetMapEditsJSON(r){const s=new Array,e=this.layer.globalIdField,i=this.layer.parsedUrl;for(const d of r){const m=d.geometry,{metadata:S}=m,x=S.getExternalSourcesOnService(i),U=d.getAttribute(e);if(0===x.length){p.Z.getLogger(this).error(`Skipping feature ${U}. The mesh it is associated with has not been uploaded to the service and cannot be mapped to it.`);continue}const{source:I}=x.find(k.yT)??x[0],{vertexSpace:H}=m,X=H.isGeoreferenced?["PROJECT_VERTICES"]:[];for(const q of I)1===q.parts.length?s.push({globalId:(0,N.zS)(),parentGlobalId:U,assetName:q.assetName,assetHash:q.parts[0].partHash,flags:X}):p.Z.getLogger(this).error(`Skipping asset ${q.assetName}. It does not have exactly one part, so we cannot map it to a feature.`)}return s}_createEditsResult(r){const s=r.data,{layerId:e}=this.layer,i=[];let d=null;if(Array.isArray(s))for(const S of s)i.push({id:S.id,editedFeatures:S.editedFeatures}),S.id===e&&(d={addResults:S.addResults??[],updateResults:S.updateResults??[],deleteResults:S.deleteResults??[],attachments:S.attachments,editMoment:S.editMoment});else d=s;const m=function mt(r){const s=r?.assetMaps;if(s){for(const d of s.addResults)d.success||p.Z.getLogger("esri.layers.graphics.sources.support.sourceUtils").error(`Failed to map asset to feature with globalId ${d.globalId}.`);for(const d of s.updateResults)d.success||p.Z.getLogger("esri.layers.graphics.sources.support.sourceUtils").error(`Failed to map asset to feature with globalId ${d.globalId}.`)}const e=r?.attachments,i={addFeatureResults:r?.addResults?.map(et)??[],updateFeatureResults:r?.updateResults?.map(et)??[],deleteFeatureResults:r?.deleteResults?.map(et)??[],addAttachmentResults:e?.addResults?e.addResults.map(et):[],updateAttachmentResults:e?.updateResults?e.updateResults.map(et):[],deleteAttachmentResults:e?.deleteResults?e.deleteResults.map(et):[]};return r?.editMoment&&(i.editMoment=r.editMoment),i}(d);if(i.length>0){m.editedFeatureResults=[];for(const S of i){const{editedFeatures:x}=S,U=x?.spatialReference?new Ct.Z(x.spatialReference):null;m.editedFeatureResults.push({layerId:S.id,editedFeatures:gt(x,U)})}}return m}_createAttachmentErrorResult(r,s){return{objectId:r,globalId:null,error:new F.Z("feature-layer-source:attachment-failure",s.details.messages?.[0]||s.message,{code:s.details.httpStatus||s.details.messageCode})}}_getFormDataForAttachment(r,s){const e=r instanceof FormData?r:r&&r.elements?new FormData(r):null;if(e)for(const i in s){const d=s[i];null!=d&&(e.set?e.set(i,d):e.append(i,d))}return e}_getLayerRequestOptions(r={}){const{parsedUrl:s,gdbVersion:e,dynamicDataSource:i}=this.layer;return{...r,query:{gdbVersion:e,layer:i?JSON.stringify({source:i}):void 0,...s.query,f:"json",...this._createRequestQueryOptions(r)},responseType:"json"}}_filterRedundantAssetMaps(r){var s=this;return(0,h.Z)(function*(){const{layer:e}=s,{globalIdField:i,infoFor3D:d,parsedUrl:m}=e;if(null==d||null==i)return r;const S=(0,Ft.$6)(d);if(null==S)return r;const x=(0,P.v_)(m.path,`../${S.id}`),U=new Array,I=new Array;for(const W of r)W.geometry.metadata.getExternalSourcesOnService(m).length>0?I.push(W):U.push(W);const H=I.map(W=>W.getAttribute(i)).filter(O.pC);if(0===H.length)return r;const{assetMapFieldRoles:{parentGlobalId:X,assetHash:q}}=d,_=new It.Z;_.where=`${X} IN (${H.map(W=>`'${W}'`)})`,_.outFields=[q,X],_.returnGeometry=!1;const at=yield(0,At.e)(x,_),{features:st}=at;return 0===st.length?r:[...U,...I.filter(W=>{const ht=W.getAttribute(i);if(!ht)return!0;const{metadata:nt}=W.geometry,it=st.filter(w=>w.getAttribute(X)===ht);if(0===it.length)return!0;const ct=it.map(w=>w.getAttribute(q));return nt.getExternalSourcesOnService(m).flatMap(({source:w})=>w.flatMap(Et=>Et.parts.map(Ut=>Ut.partHash))).some(w=>ct.every(Et=>w!==Et))})]})()}};(0,C._)([(0,Q.Cb)()],lt.prototype,"type",void 0),(0,C._)([(0,Q.Cb)({constructOnly:!0})],lt.prototype,"layer",void 0),(0,C._)([(0,Q.Cb)({readOnly:!0})],lt.prototype,"queryTask",null),lt=(0,C._)([(0,J.j)("esri.layers.graphics.sources.FeatureLayerSource")],lt);const Tt=1e3,bt=lt},59211:(rt,G,t)=>{t.d(G,{Z:()=>k});var h=t(15861),C=t(50484),$=t(73514),V=t(57964),Z=t(14007),T=t(79412),O=t(6785),F=t(80543),A=(t(1535),t(57678),t(10141)),p=t(11642),v=t(46054),g=t(15462),P=t(24859),Q=(t(2189),t(82784)),B=t(91866),J=t(26894);function R(){return(R=(0,h.Z)(function*(c,l,f){const E=(0,g.en)(c);return(0,Q.Vr)(E,B.Z.from(l),{...f}).then(j=>({count:j.data.count,extent:J.Z.fromJSON(j.data.extent)}))})).apply(this,arguments)}var n=t(61375),u=t(46708),y=t(36026),D=t(93792);let M=class extends $.Z{constructor(c){super(c),this.dynamicDataSource=null,this.fieldsIndex=null,this.gdbVersion=null,this.infoFor3D=null,this.pbfSupported=!1,this.queryAttachmentsSupported=!1,this.sourceSpatialReference=null,this.url=null}get parsedUrl(){return(0,O.mN)(this.url)}execute(c,l){var f=this;return(0,h.Z)(function*(){const E=yield f.executeJSON(c,l);return f.featureSetFromJSON(c,E,l)})()}executeJSON(c,l){var f=this;return(0,h.Z)(function*(){const E=f._normalizeQuery(c),j=null!=c.outStatistics?.[0],tt=(0,Z.Z)("featurelayer-pbf-statistics"),Y=!j||tt;let K;if(f.pbfSupported&&Y)try{K=yield(0,y.t)(f.url,E,l)}catch(ot){if("query:parsing-pbf"!==ot.name)throw ot;f.pbfSupported=!1}return f.pbfSupported&&Y||(K=yield(0,u.F)(f.url,E,l)),f._normalizeFields(K.fields),K})()}featureSetFromJSON(c,l,f){var E=this;return(0,h.Z)(function*(){if(!E._queryIs3DObjectFormat(c)||null==E.infoFor3D||!l.features)return D.Z.fromJSON(l);const{meshFeatureSetFromJSON:j}=yield(0,T.Hl)(Promise.all([t.e(1716),t.e(4612),t.e(2859),t.e(6215),t.e(8592),t.e(7045)]).then(t.bind(t,17045)),f);return j(c,E.infoFor3D,l)})()}executeForCount(c,l){return(0,P.P)(this.url,this._normalizeQuery(c),l)}executeForExtent(c,l){return function b(c,l,f){return R.apply(this,arguments)}(this.url,this._normalizeQuery(c),l)}executeForIds(c,l){return(0,n.G)(this.url,this._normalizeQuery(c),l)}executeRelationshipQuery(c,l){var f=this;return(0,h.Z)(function*(){const[{default:E},{executeRelationshipQuery:j}]=yield(0,T.Hl)(Promise.all([Promise.resolve().then(t.bind(t,46556)),t.e(3005).then(t.bind(t,83005))]),l);return c=E.from(c),(f.gdbVersion||f.dynamicDataSource)&&((c=c.clone()).gdbVersion=c.gdbVersion||f.gdbVersion,c.dynamicDataSource=c.dynamicDataSource||f.dynamicDataSource),j(f.url,c,l)})()}executeRelationshipQueryForCount(c,l){var f=this;return(0,h.Z)(function*(){const[{default:E},{executeRelationshipQueryForCount:j}]=yield(0,T.Hl)(Promise.all([Promise.resolve().then(t.bind(t,46556)),t.e(3005).then(t.bind(t,83005))]),l);return c=E.from(c),(f.gdbVersion||f.dynamicDataSource)&&((c=c.clone()).gdbVersion=c.gdbVersion||f.gdbVersion,c.dynamicDataSource=c.dynamicDataSource||f.dynamicDataSource),j(f.url,c,l)})()}executeAttachmentQuery(c,l){var f=this;return(0,h.Z)(function*(){const{executeAttachmentQuery:E,fetchAttachments:j,processAttachmentQueryResult:tt}=yield(0,T.Hl)(t.e(4662).then(t.bind(t,4662)),l),Y=(0,g.en)(f.url);return tt(Y,yield f.queryAttachmentsSupported?E(Y,c,l):j(Y,c,l))})()}executeTopFeaturesQuery(c,l){var f=this;return(0,h.Z)(function*(){const{executeTopFeaturesQuery:E}=yield(0,T.Hl)(Promise.all([t.e(8592),t.e(8778)]).then(t.bind(t,38778)),l);return E(f.parsedUrl,c,f.sourceSpatialReference,l)})()}executeForTopIds(c,l){var f=this;return(0,h.Z)(function*(){const{executeForTopIds:E}=yield(0,T.Hl)(Promise.all([t.e(8592),t.e(8009)]).then(t.bind(t,98009)),l);return E(f.parsedUrl,c,l)})()}executeForTopExtents(c,l){var f=this;return(0,h.Z)(function*(){const{executeForTopExtents:E}=yield(0,T.Hl)(Promise.all([t.e(8592),t.e(8080)]).then(t.bind(t,78080)),l);return E(f.parsedUrl,c,l)})()}executeForTopCount(c,l){var f=this;return(0,h.Z)(function*(){const{executeForTopCount:E}=yield(0,T.Hl)(Promise.all([t.e(8592),t.e(4032)]).then(t.bind(t,34032)),l);return E(f.parsedUrl,c,l)})()}_normalizeQuery(c){let l=B.Z.from(c);l.sourceSpatialReference=l.sourceSpatialReference||this.sourceSpatialReference,(this.gdbVersion||this.dynamicDataSource)&&(l=l===c?l.clone():l,l.gdbVersion=c.gdbVersion||this.gdbVersion,l.dynamicDataSource=c.dynamicDataSource?v.n.from(c.dynamicDataSource):this.dynamicDataSource);const{infoFor3D:f}=this;if(null!=f&&this._queryIs3DObjectFormat(c)){l=l===c?l.clone():l,l.formatOf3DObjects=null;const{supportedFormats:E,queryFormats:j}=f,tt=(0,p.S0)("model/gltf-binary",E)??(0,p.Ow)("glb",E),Y=(0,p.S0)("model/gltf+json",E)??(0,p.Ow)("gtlf",E);for(const K of j){if(K===tt){l.formatOf3DObjects=K;break}K!==Y||l.formatOf3DObjects||(l.formatOf3DObjects=K)}if(!l.formatOf3DObjects)throw new V.Z("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(null==l.outFields||!l.outFields.includes("*")){l=l===c?l.clone():l,null==l.outFields&&(l.outFields=[]);const{originX:K,originY:ot,originZ:pt,translationX:dt,translationY:ft,translationZ:mt,scaleX:et,scaleY:ut,scaleZ:gt,rotationX:vt,rotationY:St,rotationZ:Rt,rotationDeg:Ot}=f.transformFieldRoles;l.outFields.push(K,ot,pt,dt,ft,mt,et,ut,gt,vt,St,Rt,Ot)}}return l}_normalizeFields(c){if(null!=this.fieldsIndex&&null!=c)for(const l of c){const f=this.fieldsIndex.get(l.name);f&&Object.assign(l,f.toJSON())}}_queryIs3DObjectFormat(c){return null!=this.infoFor3D&&!0===c.returnGeometry&&"xyFootprint"!==c.multipatchOption&&!c.outStatistics}};(0,C._)([(0,F.Cb)({type:v.n})],M.prototype,"dynamicDataSource",void 0),(0,C._)([(0,F.Cb)()],M.prototype,"fieldsIndex",void 0),(0,C._)([(0,F.Cb)()],M.prototype,"gdbVersion",void 0),(0,C._)([(0,F.Cb)()],M.prototype,"infoFor3D",void 0),(0,C._)([(0,F.Cb)({readOnly:!0})],M.prototype,"parsedUrl",null),(0,C._)([(0,F.Cb)()],M.prototype,"pbfSupported",void 0),(0,C._)([(0,F.Cb)()],M.prototype,"queryAttachmentsSupported",void 0),(0,C._)([(0,F.Cb)()],M.prototype,"sourceSpatialReference",void 0),(0,C._)([(0,F.Cb)({type:String})],M.prototype,"url",void 0),M=(0,C._)([(0,A.j)("esri.tasks.QueryTask")],M);const k=M},60324:(rt,G,t)=>{t.d(G,{Dm:()=>F,Hq:()=>L,MS:()=>z,bU:()=>Z});var h=t(14007),C=t(34222),$=t(85559),V=t(19579);function Z(A){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===A||"esriGeometryMultipoint"===A?V.I4:"esriGeometryPolyline"===A?V.ET:V.lF}}}const T=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let O=1;function F(A,p){if((0,h.Z)("esri-csp-restrictions"))return()=>({[p]:null,...A});try{let v=`this.${p} = null;`;for(const P in A)v+=`this${T.test(P)?`.${P}`:`["${P}"]`} = ${JSON.stringify(A[P])};`;const g=new Function(`\n      return class AttributesClass$${O++} {\n        constructor() {\n          ${v};\n        }\n      }\n    `)();return()=>new g}catch{return()=>({[p]:null,...A})}}function L(A={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,C.d9)(A)}}]}function z(A,p){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:A},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:p,supportsDelete:p,supportsEditing:p,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:p,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:$.g,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:p,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}},24859:(rt,G,t)=>{t.d(G,{P:()=>Z});var h=t(15861),C=t(15462),$=t(82784),V=t(91866);function Z(O,F,L){return T.apply(this,arguments)}function T(){return(T=(0,h.Z)(function*(O,F,L){const z=(0,C.en)(O);return(0,$.hH)(z,V.Z.from(F),{...L}).then(A=>A.data.count)})).apply(this,arguments)}},61375:(rt,G,t)=>{t.d(G,{G:()=>Z});var h=t(15861),C=t(15462),$=t(82784),V=t(91866);function Z(O,F,L){return T.apply(this,arguments)}function T(){return(T=(0,h.Z)(function*(O,F,L){const z=(0,C.en)(O);return(0,$.Ev)(z,V.Z.from(F),{...L}).then(A=>A.data.objectIds)})).apply(this,arguments)}},46708:(rt,G,t)=>{t.d(G,{F:()=>F,e:()=>T});var h=t(15861),C=t(15462),$=t(82784),V=t(93792),Z=t(91866);function T(z,A,p){return O.apply(this,arguments)}function O(){return(O=(0,h.Z)(function*(z,A,p){const v=yield F(z,A,p);return V.Z.fromJSON(v)})).apply(this,arguments)}function F(z,A,p){return L.apply(this,arguments)}function L(){return(L=(0,h.Z)(function*(z,A,p){const v=(0,C.en)(z),g={...p},P=Z.Z.from(A),{data:N}=yield(0,$.JT)(v,P,P.sourceSpatialReference,g);return N})).apply(this,arguments)}},36026:(rt,G,t)=>{t.d(G,{t:()=>J});var h=t(15861),C=t(15462),$=t(51172),V=t(53456),Z=t(10842);function T(R,n){return n}function O(R,n,u,y){switch(u){case 0:return A(R,n+y,0);case 1:return"lowerLeft"===R.originPosition?A(R,n+y,1):function p({translate:R,scale:n},u,y){return R[y]-u*n[y]}(R,n+y,1)}}function F(R,n,u,y){return 2===u?A(R,n,2):O(R,n,u,y)}function L(R,n,u,y){return 2===u?A(R,n,3):O(R,n,u,y)}function z(R,n,u,y){return 3===u?A(R,n,3):F(R,n,u,y)}function A({translate:R,scale:n},u,y){return R[y]+u*n[y]}class v{constructor(n){this._options=n,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this._previousCoordinate=[0,0],this._transform=null,this._applyTransform=T,this._lengths=[],this._currentLengthIndex=0,this._toAddInCurrentPath=0,this._vertexDimension=0,this._coordinateBuffer=null,this._coordinateBufferPtr=0,this._attributesConstructor=class{}}createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(n){if(this._options.applyTransform&&(n.transform=null),this._attributesConstructor=class{},this._coordinateBuffer=null,this._lengths.length=0,!n.hasZ)return;const u=(0,V.k)(n.geometryType,this._options.sourceSpatialReference,n.spatialReference);if(null!=u)for(const y of n.features)u(y.geometry)}createSpatialReference(){return{}}addField(n,u){const y=n.fields;(0,$.O3)(y),y.push(u);const D=y.map(M=>M.name);this._attributesConstructor=function(){for(const M of D)this[M]=null}}addFeature(n,u){n.features.push(u)}prepareFeatures(n){switch(this._transform=n.transform,this._options.applyTransform&&n.transform&&(this._applyTransform=this._deriveApplyTransform(n)),this._vertexDimension=2,n.hasZ&&this._vertexDimension++,n.hasM&&this._vertexDimension++,n.geometryType){case"esriGeometryPoint":this.addCoordinate=(u,y,D)=>this.addCoordinatePoint(u,y,D),this.createGeometry=u=>this.createPointGeometry(u);break;case"esriGeometryPolygon":this.addCoordinate=(u,y,D)=>this._addCoordinatePolygon(u,y,D),this.createGeometry=u=>this._createPolygonGeometry(u);break;case"esriGeometryPolyline":this.addCoordinate=(u,y,D)=>this._addCoordinatePolyline(u,y,D),this.createGeometry=u=>this._createPolylineGeometry(u);break;case"esriGeometryMultipoint":this.addCoordinate=(u,y,D)=>this._addCoordinateMultipoint(u,y,D),this.createGeometry=u=>this._createMultipointGeometry(u)}}createFeature(){return this._lengths.length=0,this._currentLengthIndex=0,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0,this._coordinateBuffer=null,this._coordinateBufferPtr=0,{attributes:new this._attributesConstructor}}allocateCoordinates(){}addLength(n,u,y){0===this._lengths.length&&(this._toAddInCurrentPath=u),this._lengths.push(u)}addQueryGeometry(n,u){const{queryGeometry:y,queryGeometryType:D}=u,M=(0,Z.$g)(y.clone(),y,!1,!1,this._transform),k=(0,Z.di)(M,D,!1,!1);n.queryGeometryType=D,n.queryGeometry={...k}}createPointGeometry(n){const u={x:0,y:0,spatialReference:n.spatialReference};return n.hasZ&&(u.z=0),n.hasM&&(u.m=0),u}addCoordinatePoint(n,u,y){switch(u=this._applyTransform(this._transform,u,y,0),y){case 0:n.x=u;break;case 1:n.y=u;break;case 2:"z"in n?n.z=u:n.m=u;break;case 3:n.m=u}}_transformPathLikeValue(n,u){let y=0;return u<=1&&(y=this._previousCoordinate[u],this._previousCoordinate[u]+=n),this._applyTransform(this._transform,n,u,y)}_addCoordinatePolyline(n,u,y){this._dehydratedAddPointsCoordinate(n.paths,u,y)}_addCoordinatePolygon(n,u,y){this._dehydratedAddPointsCoordinate(n.rings,u,y)}_addCoordinateMultipoint(n,u,y){0===y&&n.points.push([]);const D=this._transformPathLikeValue(u,y);n.points[n.points.length-1].push(D)}_createPolygonGeometry(n){return{rings:[[]],spatialReference:n.spatialReference,hasZ:!!n.hasZ,hasM:!!n.hasM}}_createPolylineGeometry(n){return{paths:[[]],spatialReference:n.spatialReference,hasZ:!!n.hasZ,hasM:!!n.hasM}}_createMultipointGeometry(n){return{points:[],spatialReference:n.spatialReference,hasZ:!!n.hasZ,hasM:!!n.hasM}}_dehydratedAddPointsCoordinate(n,u,y){0===y&&0==this._toAddInCurrentPath--&&(n.push([]),this._toAddInCurrentPath=this._lengths[++this._currentLengthIndex]-1,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0);const D=this._transformPathLikeValue(u,y),M=n[n.length-1];0===y&&(this._coordinateBufferPtr=0,this._coordinateBuffer=new Array(this._vertexDimension),M.push(this._coordinateBuffer)),this._coordinateBuffer[this._coordinateBufferPtr++]=D}_deriveApplyTransform(n){const{hasZ:u,hasM:y}=n;return u&&y?z:u?F:y?L:O}}var g=t(82784),N=(t(93792),t(91866));function J(R,n,u){return b.apply(this,arguments)}function b(){return(b=(0,h.Z)(function*(R,n,u){const y=(0,C.en)(R),D={...u},M=N.Z.from(n),k=!M.quantizationParameters,{data:c}=yield(0,g.qp)(y,M,new v({sourceSpatialReference:M.sourceSpatialReference,applyTransform:k}),D);return c})).apply(this,arguments)}}}]);