"use strict";(self.webpackChunkangular_17_test=self.webpackChunkangular_17_test||[]).push([[9900],{49900:(Sr,ke,h)=>{h.r(ke),h.d(ke,{default:()=>Un});var b=h(15861),p=h(50484),de=(h(2189),h(83944)),x=h(57964),re=h(4703),$e=h(79412),d=h(80543),B=(h(1535),h(57678),h(14007)),G=h(10141),J=h(82664),Ge=h(95060),Y=h(10842),Jt=h(62209),ue=h(73514),Vt=h(8611),qt=h(38955),we=h(5391),_e=h(83821),Ce=h(33721),Xt=h(83502),Nr=h(40637);class X{constructor(){this._featureLookup=new Map}static getInstance(){return X.instance||(X.instance=new X),X.instance}static resetInstance(){X.instance&&(X.instance=null)}deleteFromStore(t){t.forEach(a=>{this._featureLookup.delete(a)})}readFromStoreByList(t){const a=[];return t.forEach(o=>{const i=this.readFromStoreById(o);i&&a.push(i)}),a}readFromStoreById(t){return this._featureLookup.get(t)??null}writeToStore(t,a,o){const i=[];return t.forEach(s=>{if(!s?.id)return;s.properties||(s.properties=[]);let l,y=null;if(o&&s.properties[o]&&(y=(0,Y.GH)(s.properties[o])),"originId"in s&&"destinationId"in s&&(s.properties.ESRI__ORIGIN_ID=s.originId,s.properties.ESRI__DESTINATION_ID=s.destinationId),s.properties[a]=s.id,s.id&&this._featureLookup.has(s.id)&&this._featureLookup.get(s.id).attributes){const m=this._featureLookup.get(s.id),u=JSON.parse(JSON.stringify(Object.assign(m.attributes,s.properties)));o&&s.properties[o]&&(u[o]=(0,Nr.im)(s.properties[o])),l=new Xt.u_(y?JSON.parse(JSON.stringify(y)):m?.geometry?JSON.parse(JSON.stringify(m.geometry)):null,u,null,s.properties[a])}else l=new Xt.u_(y?JSON.parse(JSON.stringify(y)):null,s.properties,null,s.properties[a]);this._featureLookup.set(s.id,l),i.push(l)}),i}}var Pr=h(26152),Te=h(66476);let De=class extends ue.Z{constructor(e){super(e),this.resultRows=[]}};(0,p._)([(0,d.Cb)()],De.prototype,"resultRows",void 0),De=(0,p._)([(0,G.j)("esri.rest.knowledgeGraph.GraphQueryResult")],De);const er=De;let Re=class extends ue.Z{constructor(e){super(e),this.resultRowsStream=new ReadableStream}};(0,p._)([(0,d.Cb)()],Re.prototype,"resultRowsStream",void 0),Re=(0,p._)([(0,G.j)("esri.rest.knowledgeGraph.GraphQueryResult")],Re);const tr=Re;var ne=h(89317),rr=h(43814);let ae=class extends ne.wq{constructor(e){super(e),this.name=null,this.unique=null,this.ascending=null,this.description=null,this.fieldNames=null}};(0,p._)([(0,d.Cb)({type:String,json:{write:!0}})],ae.prototype,"name",void 0),(0,p._)([(0,d.Cb)({type:Boolean,json:{write:!0}})],ae.prototype,"unique",void 0),(0,p._)([(0,d.Cb)({type:Boolean,json:{write:!0}})],ae.prototype,"ascending",void 0),(0,p._)([(0,d.Cb)({type:String,json:{write:!0}})],ae.prototype,"description",void 0),(0,p._)([(0,d.Cb)({type:[String],json:{write:!0}})],ae.prototype,"fieldNames",void 0),ae=(0,p._)([(0,G.j)("esri.rest.knowledgeGraph.FieldIndex")],ae);const nr=ae;let U=class extends ne.wq{constructor(e){super(e),this.name=null,this.alias=null,this.fieldType=null,this.geometryType=null,this.hasM=null,this.hasZ=null,this.nullable=null,this.editable=null,this.required=null,this.defaultVisibility=null,this.systemMaintained=null,this.role=null,this.defaultValue=null}};(0,p._)([(0,d.Cb)({type:String,json:{write:!0}})],U.prototype,"name",void 0),(0,p._)([(0,d.Cb)({type:String,json:{write:!0}})],U.prototype,"alias",void 0),(0,p._)([(0,d.Cb)({type:String,json:{write:!0}})],U.prototype,"fieldType",void 0),(0,p._)([(0,d.Cb)({type:String,json:{write:!0}})],U.prototype,"geometryType",void 0),(0,p._)([(0,d.Cb)({type:Boolean,json:{write:!0}})],U.prototype,"hasM",void 0),(0,p._)([(0,d.Cb)({type:Boolean,json:{write:!0}})],U.prototype,"hasZ",void 0),(0,p._)([(0,d.Cb)({type:Boolean,json:{write:!0}})],U.prototype,"nullable",void 0),(0,p._)([(0,d.Cb)({type:Boolean,json:{write:!0}})],U.prototype,"editable",void 0),(0,p._)([(0,d.Cb)({type:Boolean,json:{write:!0}})],U.prototype,"required",void 0),(0,p._)([(0,d.Cb)({type:Boolean,json:{write:!0}})],U.prototype,"defaultVisibility",void 0),(0,p._)([(0,d.Cb)({type:Boolean,json:{write:!0}})],U.prototype,"systemMaintained",void 0),(0,p._)([(0,d.Cb)()],U.prototype,"role",void 0),(0,p._)([(0,d.Cb)({type:Object,json:{type:String,write:{writer:(e,t)=>{t.defaultValue=null!=e?e.toString():null}}}})],U.prototype,"defaultValue",void 0),U=(0,p._)([(0,G.j)("esri.rest.knowledgeGraph.GraphProperty")],U);const ar=U;let ee=class extends ne.wq{constructor(e){super(e),this.name=null,this.alias=null,this.role=null,this.strict=null,this.properties=null,this.fieldIndexes=null}};(0,p._)([(0,d.Cb)({type:String,json:{write:!0}})],ee.prototype,"name",void 0),(0,p._)([(0,d.Cb)({type:String,json:{write:!0}})],ee.prototype,"alias",void 0),(0,p._)([(0,d.Cb)({type:String,json:{write:!0}})],ee.prototype,"role",void 0),(0,p._)([(0,d.Cb)({type:Boolean,json:{write:!0}})],ee.prototype,"strict",void 0),(0,p._)([(0,d.Cb)({type:[ar],json:{write:!0}})],ee.prototype,"properties",void 0),(0,p._)([(0,d.Cb)({type:[nr],json:{write:!0}})],ee.prototype,"fieldIndexes",void 0),ee=(0,p._)([(0,G.j)("esri.rest.knowledgeGraph.GraphObjectType")],ee);const or=ee;let Ye=class extends or{constructor(e){super(e)}};Ye=(0,p._)([(0,G.j)("esri.rest.knowledgeGraph.EntityType")],Ye);const Ke=Ye;let Se=class extends or{constructor(e){super(e),this.endPoints=[]}};(0,p._)([(0,d.Cb)()],Se.prototype,"endPoints",void 0),Se=(0,p._)([(0,G.j)("esri.rest.knowledgeGraph.RelationshipType")],Se);const Je=Se;let $=class extends ne.wq{constructor(e){super(e),this.timestamp=null,this.spatialReference=null,this.strict=null,this.objectIdField=null,this.globalIdField=null,this.arcgisManaged=null,this.identifierInfo=null,this.searchIndexes=null,this.entityTypes=null,this.relationshipTypes=null}};(0,p._)([(0,d.Cb)({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.timestamp=e?.getTime()}}}})],$.prototype,"timestamp",void 0),(0,p._)([(0,d.Cb)({type:rr.Z,json:{write:!0}})],$.prototype,"spatialReference",void 0),(0,p._)([(0,d.Cb)({type:Boolean,json:{write:!0}})],$.prototype,"strict",void 0),(0,p._)([(0,d.Cb)({type:String,json:{write:!0}})],$.prototype,"objectIdField",void 0),(0,p._)([(0,d.Cb)({type:String,json:{write:!0}})],$.prototype,"globalIdField",void 0),(0,p._)([(0,d.Cb)()],$.prototype,"arcgisManaged",void 0),(0,p._)([(0,d.Cb)()],$.prototype,"identifierInfo",void 0),(0,p._)([(0,d.Cb)()],$.prototype,"searchIndexes",void 0),(0,p._)([(0,d.Cb)({type:[Ke],json:{write:!0}})],$.prototype,"entityTypes",void 0),(0,p._)([(0,d.Cb)({type:[Je],json:{write:!0}})],$.prototype,"relationshipTypes",void 0),$=(0,p._)([(0,G.j)("esri.rest.knowledgeGraph.DataModel")],$);const ir=$;let Z=class extends ne.wq{constructor(e){super(e),this.capabilities=[],this.supportsSearch=!1,this.supportedQueryFormats=[],this.allowGeometryUpdates=!1,this.searchMaxRecordCount=null,this.serviceCapabilities=null,this.maxRecordCount=null,this.description="",this.copyrightText="",this.units="",this.spatialReference=null,this.currentVersion=null,this.dateFieldsTimeReference=null,this.serviceItemId="",this.supportsDocuments=!1,this.dataEditingNotSupported=!1,this.schemaEditingNotSupported=!1}};(0,p._)([(0,d.Cb)({type:[String],json:{write:!0}})],Z.prototype,"capabilities",void 0),(0,p._)([(0,d.Cb)({type:Boolean,json:{write:!0}})],Z.prototype,"supportsSearch",void 0),(0,p._)([(0,d.Cb)({type:[String],json:{write:!0}})],Z.prototype,"supportedQueryFormats",void 0),(0,p._)([(0,d.Cb)({type:Boolean,json:{write:!0}})],Z.prototype,"allowGeometryUpdates",void 0),(0,p._)([(0,d.Cb)({type:Number,json:{write:!0}})],Z.prototype,"searchMaxRecordCount",void 0),(0,p._)([(0,d.Cb)({type:Object,json:{write:!0}})],Z.prototype,"serviceCapabilities",void 0),(0,p._)([(0,d.Cb)({type:Number,json:{write:!0}})],Z.prototype,"maxRecordCount",void 0),(0,p._)([(0,d.Cb)({type:String,json:{write:!0}})],Z.prototype,"description",void 0),(0,p._)([(0,d.Cb)({type:String,json:{write:!0}})],Z.prototype,"copyrightText",void 0),(0,p._)([(0,d.Cb)({type:String,json:{write:!0}})],Z.prototype,"units",void 0),(0,p._)([(0,d.Cb)({type:Object,json:{write:!0}})],Z.prototype,"spatialReference",void 0),(0,p._)([(0,d.Cb)({type:Number,json:{write:!0}})],Z.prototype,"currentVersion",void 0),(0,p._)([(0,d.Cb)({type:Object,json:{write:!0}})],Z.prototype,"dateFieldsTimeReference",void 0),(0,p._)([(0,d.Cb)({type:String,json:{write:!0}})],Z.prototype,"serviceItemId",void 0),(0,p._)([(0,d.Cb)({type:Boolean,json:{write:!0}})],Z.prototype,"supportsDocuments",void 0),(0,p._)([(0,d.Cb)({type:Boolean,json:{write:!0}})],Z.prototype,"dataEditingNotSupported",void 0),(0,p._)([(0,d.Cb)({type:Boolean,json:{write:!0}})],Z.prototype,"schemaEditingNotSupported",void 0),Z=(0,p._)([(0,G.j)("esri.rest.knowledgeGraph.ServiceDefinition")],Z);const sr=Z;let ye=class extends ne.wq{constructor(e){super(e),this.dataModel=null,this.serviceDefinition=null}};(0,p._)([(0,d.Cb)({type:String,json:{write:!0}})],ye.prototype,"url",void 0),(0,p._)([(0,d.Cb)({type:ir,json:{write:!0}})],ye.prototype,"dataModel",void 0),(0,p._)([(0,d.Cb)({type:sr,json:{write:!0}})],ye.prototype,"serviceDefinition",void 0),ye=(0,p._)([(0,G.j)("esri.rest.knowledgeGraph.KnowledgeGraph")],ye);const Zr=ye;var Ve=h(98930);const lr="esri/rest/knowledgeGraph/wasmInterface/";let qe,Xe=null;function oe(){return et.apply(this,arguments)}function et(){return et=(0,b.Z)(function*(){const e=Xe??qe;if(e)return e;const t=(0,B.Z)("wasm-simd");return qe=function Or(e){return tt.apply(this,arguments)}(t),qe}),et.apply(this,arguments)}function tt(){return(tt=(0,b.Z)(function*(e){if(e){const{default:a}=yield h.e(1974).then(h.bind(h,31974)).then(o=>o.a);return a({locateFile:o=>(0,Ve.V)(lr+o)})}const{default:t}=yield h.e(6645).then(h.bind(h,36645)).then(a=>a.a);return t({locateFile:a=>(0,Ve.V)(lr+a)})})).apply(this,arguments)}var pr=h(12628),Ee=h(85039),ie=h(64222),rt=h(32184);function dr(e,t){const a=new t.ArrayValue;return a.deleteLater(),e.forEach(o=>{a.add_value(at(o,t))}),a}function ur(e,t){const a=new t.ObjectValue;a.deleteLater();for(const[o,i]of Object.entries(e))a.set_key_value(o,at(i,t));return a}function nt(e,t){if(e instanceof pr.Z)return function zr(e,t){const a=new t.GeometryValue;a.deleteLater(),a.geometry_type=a.geometry_type=t.esriGeometryType.esriGeometryMultipoint,a.has_z=e.hasZ,a.has_m=e.hasM;const o=[],i=[];i[0]=e.points.length;let s=0;return e.points.forEach(l=>{l.forEach(y=>{o[s]=y,s++})}),a.coords=new Float64Array(o),a.lengths=new Uint32Array(i),a}(e,t);if(e instanceof Ee.Z)return function Hr(e,t){const a=new t.GeometryValue;a.deleteLater(),a.geometry_type=t.esriGeometryType.esriGeometryPoint,a.has_z=e.hasZ,a.has_m=e.hasM;const o=[],i=[];i[0]=1,o[0]=e.x,o[1]=e.y;let s=2;return e.hasZ&&(o[s]=e.z,s++),e.hasM&&(o[s]=e.m,s++),a.coords=new Float64Array(o),a.lengths=new Uint32Array(i),a}(e,t);if(e instanceof ie.Z||e instanceof we.Z)return function Ur(e,t){const a=new t.GeometryValue;a.deleteLater(),a.has_z=e.hasZ,a.has_m=e.hasM;const o=[],i=[];let s=[];e instanceof ie.Z?(a.geometry_type=t.esriGeometryType.esriGeometryPolyline,s=e.paths):e instanceof we.Z&&(a.geometry_type=t.esriGeometryType.esriGeometryPolygon,s=e.rings);let l=0,y=0;return s.forEach(m=>{let u=0;m.forEach(f=>{u++,f.forEach(T=>{o[y]=T,y++})}),i[l]=u,l++}),a.coords=new Float64Array(o),a.lengths=new Uint32Array(i),a}(e,t);throw new x.Z("knowledge-graph:unsupported-geometry","Only Point, Multipoint, Polyline, and Polygon geometry are supported by ArcGIS Knowledge",{geometry:e})}function at(e,t){if(null==e)return"";if("object"!=typeof e||e instanceof Date)return e;if(e instanceof rt.Z)return nt(e,t);if(Array.isArray(e)){const a=new t.ArrayValue;return a.deleteLater(),e.forEach(o=>{a.add_value(at(o,t))}),a}return ur(e,t)}let Ne=class extends ne.wq{constructor(e){super(e),this.properties=null}};(0,p._)([(0,d.Cb)({json:{write:!0}})],Ne.prototype,"properties",void 0),Ne=(0,p._)([(0,G.j)("esri.rest.knowledgeGraph.GraphObject")],Ne);const ot=Ne;let xe=class extends ot{constructor(e){super(e),this.typeName=null,this.id=null}};(0,p._)([(0,d.Cb)({type:String,json:{write:!0}})],xe.prototype,"typeName",void 0),(0,p._)([(0,d.Cb)({type:String,json:{write:!0}})],xe.prototype,"id",void 0),xe=(0,p._)([(0,G.j)("esri.rest.knowledgeGraph.GraphNamedObject")],xe);const yr=xe;let Fe=class extends yr{constructor(e){super(e),this.layoutGeometry=null}};(0,p._)([(0,d.Cb)({type:Ee.Z,json:{write:!0}})],Fe.prototype,"layoutGeometry",void 0),Fe=(0,p._)([(0,G.j)("esri.rest.knowledgeGraph.Entity")],Fe);const cr=Fe;let ce=class extends yr{constructor(e){super(e),this.originId=null,this.destinationId=null,this.layoutGeometry=null}};(0,p._)([(0,d.Cb)({type:String,json:{write:!0}})],ce.prototype,"originId",void 0),(0,p._)([(0,d.Cb)({type:String,json:{write:!0}})],ce.prototype,"destinationId",void 0),(0,p._)([(0,d.Cb)({type:ie.Z,json:{write:!0}})],ce.prototype,"layoutGeometry",void 0),ce=(0,p._)([(0,G.j)("esri.rest.Relationship.Relationship")],ce);const hr=ce;function je(e,t){if(!e.typeName)throw new x.Z("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits");if(e instanceof cr){const a=new t.EntityValue;a.deleteLater(),a.type_name=e.typeName;for(const[o,i]of Object.entries(e.properties))a.set_key_value(o,mr(i,t));return e.id&&a.set_id(e.id),a}if(e instanceof hr){const a=new t.RelationshipValue;a.deleteLater(),a.type_name=e.typeName;for(const[o,i]of Object.entries(e.properties))a.set_key_value(o,mr(i,t));return e.id&&a.set_id(e.id),e.originId&&e.destinationId&&a.set_related_entity_ids(e.originId,e.destinationId),a}throw new x.Z("knowledge-graph:applyEdits-encoding-failure","Could not determine the type of a named graph object passed to the encoder")}function mr(e,t){return null==e?"":"object"!=typeof e||e instanceof Date?e:e instanceof rt.Z?nt(e,t):""}let se=class extends ue.Z{constructor(e){super(e),this.name=null,this.supportedCategory=null,this.analyzers=[],this.searchProperties=new Map}};(0,p._)([(0,d.Cb)()],se.prototype,"name",void 0),(0,p._)([(0,d.Cb)()],se.prototype,"supportedCategory",void 0),(0,p._)([(0,d.Cb)()],se.prototype,"analyzers",void 0),(0,p._)([(0,d.Cb)()],se.prototype,"searchProperties",void 0),se=(0,p._)([(0,G.j)("esri.rest.knowledgeGraph.SearchIndex")],se);const Br=se;var Pe,Ze,Oe,it,st,lt,pt,e;function Yr(e){return e.deleteLater(),new Ke(dt(e))}function Kr(e){return e.deleteLater(),new nr({name:e.name,unique:e.unique,ascending:e.ascending,description:e.description,fieldNames:Xr(e.fields)})}function dt(e){return{name:e.name,alias:e.alias,role:Pe[e.role.value]?Pe[e.role.value]:null,strict:e.strict,properties:en(e.properties),fieldIndexes:tn(e.field_indexes)}}function Jr(e){return e.deleteLater(),new ar({alias:e.alias,name:e.name,fieldType:Ze[e.field_type.value]?Ze[e.field_type.value]:null,geometryType:Oe[e.geometry_type.value]?Oe[e.geometry_type.value]:null,hasM:e.has_m,hasZ:e.has_z,nullable:e.nullable,editable:e.editable,required:e.required,defaultVisibility:e.default_visibility,systemMaintained:e.system_maintained,role:lt[e.role.value],defaultValue:e.default_value})}function Vr(e){e.deleteLater();const t=dt(e),a=[];for(let o=0;o<e.end_points.size();o++){const i=e.end_points.get(o);a.push({originEntityType:i.origin_entity_type,destinationEntityType:i.dest_entity_type})}return new Je(Object.assign({endPoints:a},t))}function qr(e){const t=[];for(let a=0;a<e.size();a++)t.push(Yr(e.get(a)));return t}function Xr(e){const t=[];for(let a=0;a<e.size();a++)t.push(e.get(a));return t}function en(e){const t=[];for(let a=0;a<e.size();a++)t.push(Jr(e.get(a)));return t}function tn(e){const t=[];for(let a=0;a<e.size();a++)t.push(Kr(e.get(a)));return t}function rn(e){const t=[];for(let a=0;a<e.size();a++)t.push(Vr(e.get(a)));return t}function nn(e){const t=[];for(let a=0;a<e.size();a++){const o=new Br,i=e.get(0);o.name=i.name,o.supportedCategory=st[i.supported_category.value];const s=i.analyzers.size();for(let l=0;l<s;l++)o.analyzers.push({name:i.analyzers.get(l).name});for(let l=0;l<i.search_properties.keys().size();l++){const y=i.search_properties.keys().get(l),m=i.search_properties.get(y),u=[];for(let f=0;f<m.property_names.size();f++)u.push(m.property_names.get(f));o.searchProperties.set(y,{propertyNames:u})}t.push(o)}return t}(e=Pe||(Pe={}))[e.Regular=0]="Regular",e[e.Provenance=1]="Provenance",e[e.Document=2]="Document",function(e){e[e.esriFieldTypeSmallInteger=0]="esriFieldTypeSmallInteger",e[e.esriFieldTypeInteger=1]="esriFieldTypeInteger",e[e.esriFieldTypeSingle=2]="esriFieldTypeSingle",e[e.esriFieldTypeDouble=3]="esriFieldTypeDouble",e[e.esriFieldTypeString=4]="esriFieldTypeString",e[e.esriFieldTypeDate=5]="esriFieldTypeDate",e[e.esriFieldTypeOID=6]="esriFieldTypeOID",e[e.esriFieldTypeGeometry=7]="esriFieldTypeGeometry",e[e.esriFieldTypeBlob=8]="esriFieldTypeBlob",e[e.esriFieldTypeRaster=9]="esriFieldTypeRaster",e[e.esriFieldTypeGUID=10]="esriFieldTypeGUID",e[e.esriFieldTypeGlobalID=11]="esriFieldTypeGlobalID",e[e.esriFieldTypeXML=12]="esriFieldTypeXML",e[e.esriFieldTypeBigInteger=13]="esriFieldTypeBigInteger",e[e.esriFieldTypeDateOnly=14]="esriFieldTypeDateOnly",e[e.esriFieldTypeTimeOnly=15]="esriFieldTypeTimeOnly",e[e.esriFieldTypeTimestampOffset=16]="esriFieldTypeTimestampOffset"}(Ze||(Ze={})),function(e){e[e.esriGeometryNull=0]="esriGeometryNull",e[e.esriGeometryPoint=1]="esriGeometryPoint",e[e.esriGeometryMultipoint=2]="esriGeometryMultipoint",e[e.esriGeometryPolyline=3]="esriGeometryPolyline",e[e.esriGeometryPolygon=4]="esriGeometryPolygon",e[e.esriGeometryEnvelope=5]="esriGeometryEnvelope",e[e.esriGeometryAny=6]="esriGeometryAny",e[e.esriGeometryMultiPatch=7]="esriGeometryMultiPatch"}(Oe||(Oe={})),function(e){e[e.esriMethodHintUNSPECIFIED=0]="esriMethodHintUNSPECIFIED",e[e.esriUUIDESRI=1]="esriUUIDESRI",e[e.esriUUIDRFC4122=2]="esriUUIDRFC4122"}(it||(it={})),function(e){e[e.esriTypeUNSPECIFIED=0]="esriTypeUNSPECIFIED",e[e.esriTypeEntity=1]="esriTypeEntity",e[e.esriTypeRelationship=2]="esriTypeRelationship",e[e.esriTypeBoth=4]="esriTypeBoth"}(st||(st={})),function(e){e[e.esriGraphPropertyUNSPECIFIED=0]="esriGraphPropertyUNSPECIFIED",e[e.esriGraphPropertyRegular=1]="esriGraphPropertyRegular",e[e.esriGraphPropertyDocumentName=2]="esriGraphPropertyDocumentName",e[e.esriGraphPropertyDocumentTitle=3]="esriGraphPropertyDocumentTitle",e[e.esriGraphPropertyDocumentUrl=4]="esriGraphPropertyDocumentUrl",e[e.esriGraphPropertyDocumentText=5]="esriGraphPropertyDocumentText",e[e.esriGraphPropertyDocumentKeywords=6]="esriGraphPropertyDocumentKeywords",e[e.esriGraphPropertyDocumentContentType=7]="esriGraphPropertyDocumentContentType",e[e.esriGraphPropertyDocumentMetadata=8]="esriGraphPropertyDocumentMetadata",e[e.esriGraphPropertyDocumentFileExtension=9]="esriGraphPropertyDocumentFileExtension"}(lt||(lt={})),function(e){e[e.esriIdentifierInfoTypeUNSPECIFIED=0]="esriIdentifierInfoTypeUNSPECIFIED",e[e.esriIdentifierInfoTypeDatabaseNative=1]="esriIdentifierInfoTypeDatabaseNative",e[e.esriIdentifierInfoTypeUniformProperty=2]="esriIdentifierInfoTypeUniformProperty"}(pt||(pt={}));let ut=class extends ot{constructor(e){super(e)}};ut=(0,p._)([(0,G.j)("esri.rest.knowledgeGraph.ObjectValue")],ut);const an=ut;let Ae=class extends ne.wq{constructor(e){super(e),this.path=null}};(0,p._)([(0,d.Cb)({type:[ot],json:{write:!0}})],Ae.prototype,"path",void 0),Ae=(0,p._)([(0,G.j)("esri.rest.knowledgeGraph.Path")],Ae);const on=Ae;var K,le,fr;function gr(e){const t={},a=yt(e,t),o=e.lengths,i=e.coords;let s="";if(e.geometry_type.value===K.ESRI_GEOMETRY_POLYGON)s="rings";else{if(e.geometry_type.value!==K.ESRI_GEOMETRY_POLYLINE)throw new x.Z("KnowledgeGraph:illegal-geometry-type","Illegal Geometry type for multipath conversion");s="paths"}t[s]=[];let l=0;return o.forEach(y=>{const m=[];for(let u=0;u<y;u++){const f=[];for(let T=0;T<a;T++)f[T]=i[l],l++;m.push(f)}t[s].push(m)}),t}function yt(e,t){let a=2;return e.has_z?(t.hasZ=e.has_z,a++):t.hasZ=!1,e.has_m?(t.hasM=e.has_m,a++):t.hasM=!1,a}!function(e){e[e.ESRI_GEOMETRY_NULL=0]="ESRI_GEOMETRY_NULL",e[e.ESRI_GEOMETRY_POINT=1]="ESRI_GEOMETRY_POINT",e[e.ESRI_GEOMETRY_MULTIPOINT=2]="ESRI_GEOMETRY_MULTIPOINT",e[e.ESRI_GEOMETRY_POLYLINE=3]="ESRI_GEOMETRY_POLYLINE",e[e.ESRI_GEOMETRY_POLYGON=4]="ESRI_GEOMETRY_POLYGON",e[e.ESRI_GEOMETRY_ENVELOPE=5]="ESRI_GEOMETRY_ENVELOPE",e[e.ESRI_GEOMETRY_ANY=6]="ESRI_GEOMETRY_ANY",e[e.ESRI_GEOMETRY_MULTI_PATCH=7]="ESRI_GEOMETRY_MULTI_PATCH"}(K||(K={})),function(e){e[e.OBJECT=0]="OBJECT",e[e.ENTITY=1]="ENTITY",e[e.RELATIONSHIP=2]="RELATIONSHIP",e[e.PATH=3]="PATH",e[e.ARRAY=4]="ARRAY"}(le||(le={})),function(e){e[e.view=0]="view",e[e.edit=1]="edit"}(fr||(fr={}));const Qe=re.Z.getLogger("esri.rest.knowledgeGraph.WasmToQueryResponseObjConstructors"),un={decodedWasmObjToQueryResponseObj:(e,t)=>{if(null==e)return null;if("object"!=typeof e||"getDate"in e)return e;if("geometry_type"in e)switch(e.geometry_type.value){case null:return null;case K.ESRI_GEOMETRY_POINT:return function ln(e){const t={};let a=2;yt(e,t);const o=e.coords;return t.x=o[0],t.y=o[1],e.has_z&&(t.z=o[a],a++),e.has_m&&(t.m=o[a]),new Ee.Z(t)}(e);case K.ESRI_GEOMETRY_MULTIPOINT:return function sn(e){const t={},a=yt(e,t),i=e.coords,s=e.lengths[0];t.points=[];let l=0;for(let y=0;y<s;y++){const m=[];for(let u=0;u<a;u++)m[u]=i[l],l++;t.points.push(m)}return new pr.Z(t)}(e);case K.ESRI_GEOMETRY_POLYLINE:return function pn(e){return new ie.Z(gr(e))}(e);case K.ESRI_GEOMETRY_POLYGON:return function dn(e){return new we.Z(gr(e))}(e);case K.ESRI_GEOMETRY_ENVELOPE:case K.ESRI_GEOMETRY_MULTI_PATCH:return Qe.warnOnce("Envelope and Multipatch are not supported on knowledge entities, but one of those geometry types was detected. Result interpreted as null"),null;default:return Qe.warnOnce("Unknown or blank geometry type returned - Result interpreted as null"),null}else{if(!("object_value_type"in e))return Qe.warnOnce("A decoded value came back of a type that is not supported. Result interpreted as null"),null;switch(e.object_value_type.value){case le.OBJECT:return function cn(e,t){return new an(Ue(e,t))}(e,t);case le.ENTITY:return br(e,t);case le.RELATIONSHIP:return wr(e,t);case le.PATH:return function hn(e,t){const a=e.entity_count(),o=e.relationship_count(),i=[];for(let s=0;s<a;s++)i.push(br(e.get_entity_at(s),t)),s<o&&i.push(wr(e.get_relationship_at(s),t));return new on({path:i})}(e,t);case le.ARRAY:return function yn(e,t){const a=[],o=e.count();for(let i=0;i<o;i++){const s=e.get_value_at(i);a.push(ct(s,t))}return a}(e,t);default:return Qe.warnOnce("Unknown graph object type detected!  Result interpreted as null"),null}}}};function ct(e,t){return un.decodedWasmObjToQueryResponseObj(e,t)}function br(e,t){const a=e.type_name,o=Ue(e,t),i=e.get_id();return new cr(Object.assign({typeName:a,id:i},o))}function Ue(e,t){const a={},o=e.key_count();for(let i=0;i<o;i++)a[e.get_key_at(i)]=ct(e.get_value_at(i),t);return{properties:a}}function wr(e,t){const a=e.type_name,o=Ue(e,t);return new hr(Object.assign({typeName:a,id:e.get_id(),originId:e.get_origin_entity_id(),destinationId:e.get_destination_entity_id()},o))}let he=class extends ue.Z{constructor(e){super(e),this.hasError=null,this.error=null,this.editResults=[]}};(0,p._)([(0,d.Cb)()],he.prototype,"hasError",void 0),(0,p._)([(0,d.Cb)()],he.prototype,"error",void 0),(0,p._)([(0,d.Cb)()],he.prototype,"editResults",void 0),he=(0,p._)([(0,G.j)("esri.rest.knowledgeGraph.GraphApplyEdits")],he);const mn=he,te={fetchKnowledgeGraph:function(){var e=(0,b.Z)(function*(t){const a=new Zr({url:t}),o=[];return o.push(He(a)),o.push(function bn(e){return Ct.apply(this,arguments)}(a)),yield Promise.all(o),a});return function(a){return e.apply(this,arguments)}}(),refreshDataModel:function(){var e=(0,b.Z)(function*(t){t.dataModel=yield Cr(t)});return function(a){return e.apply(this,arguments)}}(),refreshServiceDefinition:function(){var e=(0,b.Z)(function*(t){const a=(yield(0,Te.Z)(t.url,{query:{f:"json"}})).data;return a.capabilities=a?.capabilities?.split(","),a.supportedQueryFormats=a?.supportedQueryFormats?.split(","),t.serviceDefinition=new sr(a),t.serviceDefinition});return function(a){return e.apply(this,arguments)}}(),executeQueryStreaming:function(){var e=(0,b.Z)(function*(t,a,o){const i=`${t.url}/graph/query`;yield xt(t);const s=yield kt(i,o);s.data.body=yield function Cn(e,t){return Lt.apply(this,arguments)}(a,t);const l=yield Tt(s.data.url,s.data);if(t.dataModel)return new tr({resultRowsStream:yield _r(l,t.dataModel)});throw new x.Z("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")});return function(a,o,i){return e.apply(this,arguments)}}(),executeApplyEdits:function(){var e=(0,b.Z)(function*(t,a,o){if(t.serviceDefinition?.dataEditingNotSupported)throw new x.Z("knowledge-graph:data-editing-not-supported","The Knowledge Graph Service definition indicated that data editing is not supported");const i=`${t.url}/graph/applyEdits`;yield xt(t);const s=yield kt(i,o);return s.data.body=yield function _n(e,t){return Mt.apply(this,arguments)}(a,t),function En(e){return Dt.apply(this,arguments)}(yield Tt(s.data.url,s.data))});return function(a,o,i){return e.apply(this,arguments)}}(),executeQuery:function(){var e=(0,b.Z)(function*(t,a,o){const i=`${t.url}/graph/query`,s=yield(0,Te.Z)(i,{responseType:"array-buffer",query:{f:"pbf",openCypherQuery:a.openCypherQuery,...o?.query},signal:o?.signal,timeout:o?.timeout}),l=s.getHeader?.("content-type"),y=s.data;if(l?.includes("application/x-protobuf")){const m=new((yield oe()).GraphQueryDecoder);if(m.deleteLater(),t.dataModel)return new er({resultRows:Rt(m,y,t.dataModel)});throw new x.Z("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}throw new x.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:l,data:s.data})});return function(a,o,i){return e.apply(this,arguments)}}(),executeSearch:function(){var e=(0,b.Z)(function*(t,a,o){const i=a.typeCategoryFilter,s=`${t.url}/graph/search`,l=yield(0,Te.Z)(s,{responseType:"array-buffer",query:{f:"pbf",searchQuery:`"${a.searchQuery}"`,typeCategoryFilter:i,...o?.query},signal:o?.signal,timeout:o?.timeout}),y=l.getHeader?.("content-type"),m=l.data;if(y?.includes("application/x-protobuf")){const u=new((yield oe()).GraphQueryDecoder);if(u.deleteLater(),t.dataModel)return new er({resultRows:Rt(u,m,t.dataModel)});throw new x.Z("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}throw new x.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:y,data:l.data})});return function(a,o,i){return e.apply(this,arguments)}}(),executeSearchStreaming:function(){var e=(0,b.Z)(function*(t,a,o){const i=`${t.url}/graph/search`;yield xt(t);const s=yield kt(i,o);s.data.body=yield function Tn(e){return It.apply(this,arguments)}(a);const l=yield Tt(s.data.url,s.data);if(t.dataModel)return new tr({resultRowsStream:yield _r(l,t.dataModel)});throw new x.Z("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")});return function(a,o,i){return e.apply(this,arguments)}}(),_fetchWrapper:function(){var e=(0,b.Z)(function*(t,a){return fetch(t,a)});return function(a,o){return e.apply(this,arguments)}}()};function ze(e,t,a){return ft.apply(this,arguments)}function ft(){return ft=(0,b.Z)(function*(e,t,a){return te.executeQueryStreaming(e,t,a)}),ft.apply(this,arguments)}function wt(){return wt=(0,b.Z)(function*(e){return te.fetchKnowledgeGraph(e)}),wt.apply(this,arguments)}function He(e){return _t.apply(this,arguments)}function _t(){return _t=(0,b.Z)(function*(e){return te.refreshDataModel(e)}),_t.apply(this,arguments)}function Ct(){return Ct=(0,b.Z)(function*(e){return te.refreshServiceDefinition(e)}),Ct.apply(this,arguments)}function Tt(e,t){return Et.apply(this,arguments)}function Et(){return Et=(0,b.Z)(function*(e,t){return te._fetchWrapper(e,t)}),Et.apply(this,arguments)}function xt(e){return vt.apply(this,arguments)}function vt(){return vt=(0,b.Z)(function*(e){Pr.id?.findCredential(e.url)||(e.dataModel?yield Cr(e):yield He(e))}),vt.apply(this,arguments)}function ve(e,t,a){if(0!==e.error_code)throw new x.Z(t,a,{errorCode:e.error_code,errorMessage:e.error_message})}function wn(e,t,a,o){null==t?a.set_param_key_value(e,""):"object"!=typeof t||t instanceof Date?a.set_param_key_value(e,t):a.set_param_key_value(e,t instanceof rt.Z?nt(t,o):t instanceof Array?dr(t,o):ur(t,o))}function Mt(){return Mt=(0,b.Z)(function*(e,t){if(t.dataModel||(yield He(t)),!t.dataModel)throw new x.Z("knowledge-graph:data-model-undefined","Encoding could not proceed because a data model was not provided and it could not be determined from the service");const a=yield oe(),o=!!e.options?.cascadeDelete,i=new a.GraphApplyEditsEncoder(a.SpatialReferenceUtil.WGS84(),e.options?.inputQuantizationParameters?function Wr(e){return{xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}(e.options?.inputQuantizationParameters):a.InputQuantizationUtil.WGS84_lossless());i.deleteLater(),i.cascade_delete=o;try{let l;e.entityAdds?.forEach(y=>{l=i.add_entity(je(y,a)),ve(l,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")}),e.relationshipAdds?.forEach(y=>{if(!y.originId||!y.destinationId)throw new x.Z("knowledge-graph:relationship-origin-destination-missing","When adding a new relationship, you must provide both an origin and destination id on the appropriate class property");l=i.add_relationship(je(y,a)),ve(l,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")}),e.entityUpdates?.forEach(y=>{if(!y.id)throw new x.Z("knowledge-graph:entity-id-missing","When updating an entity or relationship, you must specify the id on the class level property");l=i.update_entity(je(y,a)),ve(l,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")}),e.relationshipUpdates?.forEach(y=>{if(!y.id)throw new x.Z("knowledge-graph:relationship-id-missing","When updating an entity or relationship, you must specify the id on the class level property");l=i.update_relationship(je(y,a)),ve(l,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")}),e.entityDeletes?.forEach(y=>{if(!y.typeName)throw new x.Z("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");const m=i.make_delete_helper(y.typeName,!0);m.deleteLater(),y.ids?.forEach(u=>{m.delete_by_id(u)})}),e.relationshipDeletes?.forEach(y=>{if(!y.typeName)throw new x.Z("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");const m=i.make_delete_helper(y.typeName,!1);y.ids?.forEach(u=>{m.delete_by_id(u)})}),i.encode()}catch(l){throw new x.Z("knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed",{error:l})}const s=i.get_encoding_result();return ve(s.error,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed"),s.get_byte_buffer()}),Mt.apply(this,arguments)}function Lt(){return Lt=(0,b.Z)(function*(e,t){const a=yield oe(),o=new a.GraphQueryRequestEncoder;if(o.deleteLater(),o.output_spatial_reference=a.SpatialReferenceUtil.WGS84(),o.open_cypher_query=e.openCypherQuery,e.bindParameters)for(const[s,l]of Object.entries(e.bindParameters))wn(s,l,o,a);if(e.bindGeometryQuantizationParameters)!function Ar(e,t){t.input_quantization_parameters={xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}(e.bindGeometryQuantizationParameters,o);else{if(t.dataModel||(yield He(t)),4326!==t.dataModel?.spatialReference?.wkid)throw new x.Z("knowledge-graph:SR-quantization-mismatch","If the DataModel indicates a coordinate system other than WGS84, inputQuantizationParameters must be provided to the query encoder");o.input_quantization_parameters=a.InputQuantizationUtil.WGS84_lossless()}e.outputQuantizationParameters&&function Qr(e,t,a){if(!e.extent)throw new x.Z("knowledge-graph:illegal-output-quantization","The Output quantization provided to the encoder had an illegal value as part of its extent",e.extent);if(!e.quantizeMode)throw new x.Z("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal mode setting",e.quantizeMode);if(!e.tolerance)throw new x.Z("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal tolerance setting",e.quantizeMode);t.output_quantization_parameters={extent:{xmax:e.extent.xmax,ymax:e.extent.ymax,xmin:e.extent.xmin,ymin:e.extent.ymin},quantize_mode:a.esriQuantizeMode[e.quantizeMode],tolerance:e.tolerance}}(e.outputQuantizationParameters,o,a);try{o.encode()}catch(s){throw new x.Z("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{error:s})}const i=o.get_encoding_result();if(0!==i.error.error_code)throw new x.Z("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{errorCode:i.error.error_code,errorMessage:i.error.error_message});return i.get_byte_buffer()}),Lt.apply(this,arguments)}function It(){return It=(0,b.Z)(function*(e){const t=yield oe(),a=new t.GraphSearchRequestEncoder;if(a.deleteLater(),a.search_query=e.searchQuery,a.type_category_filter=t.esriNamedTypeCategory[e.typeCategoryFilter],!0===e.returnSearchContext&&(a.return_search_context=e.returnSearchContext),null!=e.start&&e.start>0&&(a.start_index=e.start),null!=e.num&&(a.max_num_results=e.num),null!=e.idsFilter&&Array.isArray(e.idsFilter)&&e.idsFilter.length>0)try{a.set_ids_filter(dr(e.idsFilter,t))}catch(i){throw new x.Z("knowledge-graph:ids-format-error","Attempting to set ids filter failed.  This is usually caused by an incorrectly formatted UUID string",{error:i})}e.namedTypesFilter?.forEach(i=>{a.add_named_type_filter(i)});try{a.encode()}catch(i){throw new x.Z("knowledge-graph:search-encoding-failed","Attempting to encode the search failed",{error:i})}const o=a.get_encoding_result();if(0!==o.error.error_code)throw new x.Z("knowledge-graph:search-encoding-failed","Attempting to get encoding result from the query failed",{errorCode:o.error.error_code,errorMessage:o.error.error_message});return o.get_byte_buffer()}),It.apply(this,arguments)}function kt(e,t){return Gt.apply(this,arguments)}function Gt(){return Gt=(0,b.Z)(function*(e,t){return(0,Te.Z)(e,{responseType:"native-request-init",method:"post",query:{f:"pbf",...t?.query},body:"x",headers:{"Content-Type":"application/octet-stream"},signal:t?.signal,timeout:t?.timeout})}),Gt.apply(this,arguments)}function Dt(){return Dt=(0,b.Z)(function*(e){const t=e.headers.get("content-type");if(t?.includes("application/x-protobuf")){const a=yield e.arrayBuffer(),o=new((yield oe()).GraphApplyEditsDecoder);return o.deleteLater(),o.decode(new Uint8Array(a)),function fn(e){const t=new mn;t.hasError=e.has_error(),t.hasError&&(t.error={errorCode:e.error.error_code,errorMessage:e.error.error_message});const a=e.get_edit_results_count();for(let o=0;o<a;o++){const i=e.get_edit_results_at(o),s=e.get_edit_results_type_name_at(o),l=[],y=[],m=[],u=i.get_add_results_count(),f=i.get_update_results_count(),T=i.get_delete_results_count();for(let I=0;I<u;I++){const w=i.get_add_result_at(I);l.push({id:w.id,error:{errorCode:w.error.error_code,errorMessage:w.error.error_message}})}for(let I=0;I<f;I++){const w=i.get_update_result_at(I);y.push({id:w.id,error:{errorCode:w.error.error_code,errorMessage:w.error.error_message}})}for(let I=0;I<T;I++){const w=i.get_delete_result_at(I);m.push({id:w.id,error:{errorCode:w.error.error_code,errorMessage:w.error.error_message}})}t.editResults.push({typeName:s,adds:l,updates:y,deletes:m})}return t}(o)}throw new x.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:t,data:e.text()})}),Dt.apply(this,arguments)}function Rt(e,t,a){e.push_buffer(new Uint8Array(t));const o=[];let i=0;for(;e.next_row();){i||(i=e.get_header_keys().size());const s=new Array(i);for(let l=0;l<i;l++){const y=e.get_value(l);s[l]=ct(y,a)}o.push(s)}if(e.has_error())throw new x.Z("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded",{errorCode:e.error.error_code,errorMessage:e.error.error_message});return o}function _r(e,t){return St.apply(this,arguments)}function St(){return St=(0,b.Z)(function*(e,t){const a=e.headers.get("content-type");if(e.headers.get("content-length")&&re.Z.getLogger("esri.rest.knowledgeGraph.knowledgeGraphService").warnOnce("Found `Content-Length` header when expecting a streaming HTTP response! Please investigate whether all intermediate HTTP proxies and/or load balancers are configured such that they don't forcefully buffer the entire response before returning it to the client. A valid HTTP streaming response should use Chunked Transfer Encoding and not have a Content Length defined."),a?.includes("application/x-protobuf")){const o=e.body?.getReader(),i=new((yield oe()).GraphQueryDecoder);return i.deleteLater(),new ReadableStream({start:s=>(0,b.Z)(function*(){try{return function l(){return o?.read().then(({done:y,value:m})=>{if(y){let f;if(i.has_error()&&(f=new x.Z("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded",{errorCode:i.error.error_code,errorMessage:i.error.error_message})),o.releaseLock(),f)throw s.error(f),f;return void s.close()}const u=Rt(i,m,t);return u.length>0&&s.enqueue(u),l()})}()}catch(y){o?.releaseLock(),s.error(new x.Z("knowledge-graph:stream-decoding-error","The server returned a valid response, but there was an error decoding the response stream",{error:y})),s.close()}})()})}throw new x.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:a,data:e.text()})}),St.apply(this,arguments)}function Cr(e){return Nt.apply(this,arguments)}function Nt(){return Nt=(0,b.Z)(function*(e){const t=`${e.url}/dataModel/queryDataModel`,a=yield(0,Te.Z)(t,{responseType:"array-buffer",query:{f:"pbf"}}),o=a.getHeader?.("content-type"),i=a.data;if(o?.includes("application/x-protobuf")){const s=(yield oe()).decode_data_model_from_protocol_buffer(new Uint8Array(i));if(!s)throw new x.Z("knowledge-graph:data-model-decode-failure","The server responded to the data model query, but the response failed to be decoded.  This typically occurs when the Knowledge JS API (4.26 or later) is used with an unsupported backend (11.0 or earlier)");return function $r(e){return e.deleteLater(),new ir({timestamp:e.timestamp,spatialReference:new rr.Z(e.spatial_reference),strict:e.strict,objectIdField:e.objectid_property,globalIdField:e.globalid_property,arcgisManaged:e.arcgis_managed,identifierInfo:{identifierMappingInfo:{identifierInfoType:pt[e.identifier_info?.identifier_mapping_info?.identifier_info_type?.value],databaseNativeIdentifier:e.identifier_info?.identifier_mapping_info?.database_native_identifier,uniformPropertyIdentifier:{identifierPropertyName:e.identifier_info?.identifier_mapping_info?.uniform_property_identifier?.identifier_property_name}},identifierGenerationInfo:{uuidMethodHint:it[e.identifier_info?.identifier_generation_info?.uuid_method_hint?.value]}},searchIndexes:nn(e.search_indexes),entityTypes:qr(e.entity_types),relationshipTypes:rn(e.relationship_types)})}(s)}throw new x.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:o,data:a.data})}),Nt.apply(this,arguments)}let We=class extends ue.Z{constructor(e){super(e),this.openCypherQuery=""}};(0,p._)([(0,d.Cb)()],We.prototype,"openCypherQuery",void 0),We=(0,p._)([(0,G.j)("esri.rest.knowledgeGraph.GraphQuery")],We);const xn=We;let me=class extends xn{constructor(e){super(e),this.bindParameters=null,this.bindGeometryQuantizationParameters=null,this.outputQuantizationParameters=null}};(0,p._)([(0,d.Cb)()],me.prototype,"bindParameters",void 0),(0,p._)([(0,d.Cb)()],me.prototype,"bindGeometryQuantizationParameters",void 0),(0,p._)([(0,d.Cb)()],me.prototype,"outputQuantizationParameters",void 0),me=(0,p._)([(0,G.j)("esri.rest.knowledgeGraph.GraphQueryStreaming")],me);const Me=me;function vn(e){if(!e.spatialReference.isWGS84)throw new x.Z("knowledge-graph:layer-support-utils","The extentToInBoundsRings function only supports WGS84 spatial references.");let t;return t=e.xmax>180&&e.xmin<180?[[[e.xmin,e.ymin],[e.xmin,e.ymax],[180,e.ymax],[180,e.ymin],[e.xmin,e.ymin]],[[-180,e.ymin],[-180,e.ymax],[e.xmax-360,e.ymax],[e.xmax-360,e.ymin],[-180,e.ymin]]]:e.xmax>180&&e.xmin>180?[[[e.xmin-360,e.ymin],[e.xmin-360,e.ymax],[e.xmax-360,e.ymax],[e.xmax-360,e.ymin],[e.xmin-360,e.ymin]]]:e.xmax>-180&&e.xmin<-180?[[[e.xmin+360,e.ymin],[e.xmin+360,e.ymax],[180,e.ymax],[180,e.ymin],[e.xmin+360,e.ymin]],[[-180,e.ymin],[-180,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[-180,e.ymin]]]:e.xmax<-180&&e.xmin<-180?[[[e.xmin+360,e.ymin],[e.xmin+360,e.ymax],[e.xmax+360,e.ymax],[e.xmax+360,e.ymin],[e.xmin+360,e.ymin]]]:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]],t}function Ft(){return Ft=(0,b.Z)(function*(e,t){const a=[],o=new Map,i=[];if(t.dataModel?.relationshipTypes)for(const s of t.dataModel.relationshipTypes)s.name&&o.set(s.name,[]);for(const s of e)o.has(s.typeName)&&o.get(s.typeName)?.push(s.id);for(const[s,l]of o){if(l.length<1)continue;const y=new Me({openCypherQuery:`MATCH (n)-[r:${s}]->(m) WHERE id(r) in $ids RETURN id(n), labels(n)[0], id(m), labels(m)[0]`,bindParameters:{ids:l}});i.push(ze(t,y).then(function(){var m=(0,b.Z)(function*(u){const f=u.resultRowsStream.getReader();for(;;){const{done:T,value:I}=yield f.read();if(T)break;for(const w of I)a.push({id:w[0],typeName:w[1]}),a.push({id:w[2],typeName:w[3]})}});return function(u){return m.apply(this,arguments)}}()))}return yield Promise.all(i),a}),Ft.apply(this,arguments)}var fe=h(91866),Le=h(26894);const N="ESRI__ID",Ie="ESRI__ORIGIN_ID",jt="ESRI__DESTINATION_ID",O="ESRI__LAYOUT_GEOMETRY",Tr=re.Z.getLogger("esri.rest.knowledgeGraph.knowledgeGraphLayer.KnowledgeGraphLayerDataManager");let V=class extends ue.Z{constructor(e){super(e),this.inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},this.entityTypeNames=new Set,this.relationshipTypeNames=new Set,this.geographicLookup=new Map,this.sublayerCaches=new Map,this.nodeConnectionsLookup=new Map,this.memberIdTypeLookup=new Map,this._processingCacheUpdatesLookup=new Map;const t=new Map;e.knowledgeGraph.dataModel.entityTypes?.forEach(a=>{a.name&&(t.set(a.name,"entity"),this._processingCacheUpdatesLookup.set(a.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.entityTypeNames.add(a.name),a.properties?.forEach(o=>{o.geometryType&&"esriGeometryNull"!==o.geometryType&&this.geographicLookup.set(a.name,{name:o.name??"",geometryType:o.geometryType})}))}),e.knowledgeGraph.dataModel.relationshipTypes?.forEach(a=>{a.name&&(t.set(a.name,"relationship"),this._processingCacheUpdatesLookup.set(a.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.relationshipTypeNames.add(a.name),a.properties?.forEach(o=>{o.geometryType&&"esriGeometryNull"!==o.geometryType&&this.geographicLookup.set(a.name,{name:o.name??"",geometryType:o.geometryType})}))}),e.inclusionModeDefinition?.namedTypeDefinitions.forEach((a,o)=>{if("entity"===t.get(o))this.entityTypeNames.add(o);else{if("relationship"!==t.get(o))return Tr.warn(`A named type, ${o}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(o);this.relationshipTypeNames.add(o)}const i=new Map;a.members?.forEach(s=>{this.memberIdTypeLookup.set(s.id,o);const l=this.getById(s.id);l&&i.set(s.id,l)}),this.sublayerCaches.set(o,i)})}addToLayer(e){e.forEach(({typeName:t,id:a})=>{if(!this.inclusionModeDefinition)throw new x.Z("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(this.inclusionModeDefinition.namedTypeDefinitions.has(t)){if(this.inclusionModeDefinition.namedTypeDefinitions.has(t)){const o=this.inclusionModeDefinition.namedTypeDefinitions.get(t);o.members||(o.members=new Map),o.members.set(a,{id:a}),this.memberIdTypeLookup.set(a,t)}}else{const o=new Map;o.set(a,{id:a}),this.inclusionModeDefinition.namedTypeDefinitions.set(t,{useAllData:!1,members:o}),this.memberIdTypeLookup.set(a,t)}})}getById(e){return X.getInstance().readFromStoreById(e)}getData(e,t,a){var o=this;return(0,b.Z)(function*(){if(t.objectType.name&&o.inclusionModeDefinition?.namedTypeDefinitions&&o.inclusionModeDefinition.namedTypeDefinitions.size>0&&!o.inclusionModeDefinition.namedTypeDefinitions.has(t.objectType.name))return[];let i;if(i=e||new fe.Z({where:"1=1",outFields:["*"]}),"link-chart"===t.parentCompositeLayer.type){const s=t.parentCompositeLayer,l=o._processingCacheUpdatesLookup.get(t.objectType.name??""),y=i.outFields,m=i.geometry;let u="",f="";m&&m.extent&&(u=(0,J.fC)(m.extent.ymin,m.extent.xmin,12),f=(0,J.fC)(m.extent.ymax,m.extent.xmax,12)),y&&1===y.length&&y[0]===N&&"1=1"===i.where||(yield Promise.all(l??[]));const T=o.sublayerCaches.has(t.objectType.name??"")?Array.from(o.sublayerCaches.get(t.objectType.name)?.values()):[],I=[];return T.forEach(w=>{if(w.geometry=s.linkChartDiagramLookup.get(w.attributes[t.objectIdField]),w.attributes[O]=w.geometry,u&&f){const C=s.linkChartGeohashLookup.get(w.attributes[t.objectIdField]);C?C>=u&&C<=f&&I.push(w):I.push(w)}else I.push(w)}),I}return o.retrieveDataFromService(i,t,a)})()}getConnectedRecordIds(e){var t=this;return(0,b.Z)(function*(){const a=[],o=[],i=new Map;return e.forEach(s=>{if(t.memberIdTypeLookup.has(s)){const l=t.memberIdTypeLookup.get(s);if(!t.entityTypeNames.has(l))return;i.has(l)?i.get(l)?.push(s):i.set(l,[s])}}),i.forEach((s,l)=>{const y=`MATCH (n:${l})-[r]-(m) WHERE id(n) IN $ids RETURN id(r), type(r), id(m), labels(m)[0]`,m=new Promise(u=>{(0,b.Z)(function*(){const f=(yield ze(t.knowledgeGraph,new Me({openCypherQuery:y,bindParameters:{ids:s}}))).resultRowsStream.getReader();try{for(;;){const{done:T,value:I}=yield f.read();if(T)break;for(let w=0;w<I.length;w++){const C=I[w];a.push({id:C[0],typeName:C[1]}),a.push({id:C[2],typeName:C[3]})}}}catch(T){if("AbortError"!==T.name)throw T;Tr.info("Request aborted as expected")}})().then(()=>{u()})});o.push(m)}),yield Promise.all(o),a})()}refreshCacheContent(e,t,a,o=!0){var i=this;return(0,b.Z)(function*(){const s=X.getInstance(),l=[],y=new Map,m=new Map;i.knowledgeGraph.dataModel.entityTypes?.forEach(u=>{u.name&&m.set(u.name,u)}),i.knowledgeGraph.dataModel.relationshipTypes?.forEach(u=>{u.name&&m.set(u.name,u)}),e||i.inclusionModeDefinition?e?e.forEach(u=>{if(i.memberIdTypeLookup.has(u)){const f=i.memberIdTypeLookup.get(u);y.has(f)?y.get(f)?.push(u):y.set(f,[u])}}):i.inclusionModeDefinition?.namedTypeDefinitions?.forEach((u,f)=>{u.useAllData?y.set(f,null):u.members&&u.members.forEach(T=>{y.has(f)&&null!==y.get(f)?y.get(f)?.push(T.id):y.set(f,[T.id])})}):(i.knowledgeGraph.dataModel.entityTypes?.forEach(u=>{u.name&&y.set(u.name,null)}),i.knowledgeGraph.dataModel.entityTypes?.forEach(u=>{u.name&&y.set(u.name,null)}));for(const[u,f]of y){const T=new Promise(I=>{(function(){var C=(0,b.Z)(function*(){const M=new Set,_=[];let j,L="",F=!1;if(t||m.get(u)?.properties?.forEach(g=>{g.name&&M.add(g.name)}),a&&i.geographicLookup.has(u)){const g=i.geographicLookup.get(u)?.name;g&&M.add(g)}if(i.entityTypeNames.has(u))L=`MATCH (n:${u}) ${f?"WHERE id(n) IN $ids ":""}return ID(n)`,M.forEach(g=>{L+=`, n.${g}`,_.push(g)});else{if(!i.relationshipTypeNames.has(u))throw new x.Z("knowledge-graph:layer-data-manager",`The graph type of ${u} could not be determined. Was this type set in the KG data model and inclusion definition?`);F=!0,L=`MATCH ()-[n:${u}]->() ${f?"WHERE id(n) IN $ids ":""}return ID(n), id(startNode(n)), id(endNode(n))`,M.forEach(g=>{L+=`, n.${g}`,_.push(g)})}j=new Me(f?{openCypherQuery:L,bindParameters:{ids:f}}:{openCypherQuery:L});const S=(yield ze(i.knowledgeGraph,j)).resultRowsStream.getReader();for(;;){const{done:g,value:R}=yield S.read();if(g)break;const v=[];for(let E=0;E<R.length;E++){const Q=R[E];let A=0,W=0;const H={properties:{}};for(H.id=Q[A],A++,W++,F&&(H.originId=Q[A],A++,W++,H.destinationId=Q[A],A++,W++,(0,Vt.s1)(i.nodeConnectionsLookup,H.originId,()=>new Set).add(H.id),(0,Vt.s1)(i.nodeConnectionsLookup,H.destinationId,()=>new Set).add(H.id));A<Q.length;A++)H.properties[_[A-W]]=Q[A];v.push(H)}const c=s.writeToStore(v,N,i.geographicLookup.get(u)?.name);i.sublayerCaches.has(u)||i.sublayerCaches.set(u,new Map),o&&!i.inclusionModeDefinition?.namedTypeDefinitions.has(u)&&i.inclusionModeDefinition?.namedTypeDefinitions.set(u,{useAllData:!1,members:new Map}),o&&!i.inclusionModeDefinition?.namedTypeDefinitions.get(u).members&&(i.inclusionModeDefinition.namedTypeDefinitions.get(u).members=new Map);const k=i.sublayerCaches.get(u);c.forEach(E=>{k?.set(E.attributes[N],E),o&&!i.inclusionModeDefinition?.namedTypeDefinitions.get(u).members.has(E.attributes[N])&&(i.inclusionModeDefinition?.namedTypeDefinitions.get(u).members.set(E.attributes[N],{id:E.attributes[N]}),i.memberIdTypeLookup.set(E.attributes[N],u))})}});return function(){return C.apply(this,arguments)}})()().then(()=>{I(null)})});l.push(T),i._processingCacheUpdatesLookup.get(u)?.push(T)}yield Promise.all(l)})()}removeFromLayer(e){const t=new Set,a=new Set(e.map(o=>o.id));for(const o of e)t.add(o.typeName),this.memberIdTypeLookup.delete(o.id),this.inclusionModeDefinition?.namedTypeDefinitions.forEach(i=>{i.members?.has(o.id)&&i.members.delete(o.id)});t.forEach(o=>{this.sublayerCaches.get(o)?.forEach((i,s)=>{a.has(s)&&this.sublayerCaches.get(o)?.delete(s)})})}retrieveDataFromService(e,t,a){var o=this;return(0,b.Z)(function*(){const i=X.getInstance(),s=new Set,l=[];let y,m="",u=[];const f="relationship"===t.graphType,T=o.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData,I=t.parentCompositeLayer.sublayerIdsCache.get(t.objectType.name);let w=!T&&I?Array.from(I).sort():null;if(o.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData)o.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData&&null!=e.objectIds&&(w=e.objectIds);else if(null!=e.objectIds&&w&&w.length>0){const M=e.objectIds;e.objectIds=w.filter(_=>M.includes(_))}else if(null!=e.objectIds)w=e.objectIds;else{if(o.inclusionModeDefinition?.namedTypeDefinitions.has(t.objectType.name)&&(!o.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members||o.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members?.size<1))return e.objectIds=[],[];e.objectIds=w}if(null!=e.outFields){const M=e.outFields;M.includes("*")?t.fields.forEach(_=>{s.add(_.name)}):M.forEach(_=>{_!==N&&_!==t.geometryFieldName&&s.add(_)})}if(null!=e.geometry){const M=e.geometry;let _;const j=t.parentCompositeLayer.dataManager.knowledgeGraph.serviceDefinition,L=j?.spatialReference,F=j?.serviceCapabilities?.geometryCapabilities;let S=F?.geometryMaxBoundingRectangleSizeX,g=F?.geometryMaxBoundingRectangleSizeY;if(M?.extent?.spatialReference&&!M.spatialReference?.isWGS84?(yield(0,_e.initializeProjection)(M.extent.spatialReference,Ce.Zn),_=(0,_e.project)(M.extent,Ce.Zn)):_=M.extent,S&&g&&L){if(4326!==L.wkid){const R=new Le.Z({spatialReference:L,xmax:S,ymax:g}),v=(0,_e.project)(R,Ce.Zn);S=v.xmax,g=v.ymax}if(_.xmax-_.xmin>S)throw new x.Z("knowledge-graph:layer-data-manager",`Extent x bounds should be within ${S}\xb0 latitude, limit exceeded`);if(_.ymax-_.ymin>g)throw new x.Z("knowledge-graph:layer-data-manager",`Extent y bounds should be within ${g}\xb0 longitude, limit exceeded`)}if(null!=e.where&&"1=1"!==e.where){const R=yield(0,qt.E)(e.where.toUpperCase(),t.fieldsIndex);t.fields.forEach(v=>{R.fieldNames.includes(v.name)&&s.add(v.name)})}m=f?`Match ()-[n:${t.objectType.name}]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n), id(startNode(r)), id(endNode(r))`:`Match (n:${t.objectType.name}) WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n)`,t.geometryFieldName&&s.add(t.geometryFieldName),s.forEach(R=>{m+=`, n.${R}`,l.push(R)}),y=new Me({openCypherQuery:m,bindParameters:{param_filter_geom:new we.Z({rings:vn(_)})}})}else{let M="";if(null!=e.where&&"1=1"!==e.where){const L=yield(0,qt.E)(e.where,t.fieldsIndex);t.fields.forEach(v=>{L.fieldNames.includes(v.name)&&s.add(v.name)});const F=new Set(["column-reference","string","number","binary-expression"]),S=new Set(["=","<","<=","<>",">",">=","AND","OR","LIKE"]);let g=!1;const R=v=>{if("column-reference"===v.type)return`n.${v.column}`;if("string"===v.type)return`'${v.value}'`;if("number"===v.type)return`${v.value}`;if("binary-expression"===v.type&&F.has(v.left.type)&&F.has(v.right.type)&&S.has(v.operator))return`${R(v.left)} ${v.operator} ${R(v.right)}`;if("binary-expression"===v.type&&"LIKE"===v.operator){let c="";if("function"===v.left.type&&"column-reference"===v.left.args.value[0].type)c+=`lower(n.${v.left.args.value[0].column})`;else{if("column-reference"!==v.left.type)return g=!0,"";c+=`lower(n.${v.left.column})`}if(c+=" CONTAINS (","string"!==v.right.type)return g=!0,"";{let k=v.right.value;"%"===k.charAt(0)&&(k=k.slice(1)),"%"===k.charAt(k.length-1)&&(k=k.slice(0,-1)),c+=`'${k.toLowerCase()}')`}return c}return g=!0,""};M=R(L.parseTree),g&&(M="")}let _="";_=f?`Match ()-[n:${t.objectType.name}]->()`:`Match (n:${t.objectType.name})`;let j=!1;w&&(j=!0,_+=" WHERE ID(n) IN $ids"),M&&(_+=j?" AND":" WHERE",_+=` ${M}`),_+=" return ID(n)",f&&(_+=", id(startNode(n)), id(endNode(n))"),e.returnGeometry&&t.geometryFieldName&&s.add(t.geometryFieldName),s.forEach(L=>{_+=`, n.${L}`,l.push(L)}),y=new Me(w?{openCypherQuery:_,bindParameters:{ids:w}}:{openCypherQuery:_})}const C=(yield ze(t.parentCompositeLayer.dataManager.knowledgeGraph,y,a)).resultRowsStream.getReader();for(;;){const{done:M,value:_}=yield C.read();if(M)break;const j=[];for(let L=0;L<_.length;L++){const F=_[L];let S=0,g=0;const R={properties:{}};for(R.id=F[S],S++,g++,f&&(R.originId=F[S],S++,g++,R.destinationId=F[S],S++,g++);S<F.length;S++)R.properties[l[S-g]]=F[S];j.push(R)}u=u.concat(i.writeToStore(j,N,t.parentCompositeLayer.dataManager.geographicLookup.get(t.objectType.name)?.name))}return u})()}};(0,p._)([(0,d.Cb)()],V.prototype,"knowledgeGraph",void 0),(0,p._)([(0,d.Cb)()],V.prototype,"inclusionModeDefinition",void 0),(0,p._)([(0,d.Cb)()],V.prototype,"entityTypeNames",void 0),(0,p._)([(0,d.Cb)()],V.prototype,"relationshipTypeNames",void 0),(0,p._)([(0,d.Cb)()],V.prototype,"geographicLookup",void 0),(0,p._)([(0,d.Cb)()],V.prototype,"sublayerCaches",void 0),(0,p._)([(0,d.Cb)()],V.prototype,"nodeConnectionsLookup",void 0),(0,p._)([(0,d.Cb)()],V.prototype,"memberIdTypeLookup",void 0),V=(0,p._)([(0,G.j)("esri.rest.knowledgeGraph.knowledgeGraphLayer.KnowledgeGraphLayerDataManager")],V);var Ln=h(62691),Pt=(h(36699),h(15212),h(53722),h(82752),h(28999),h(38748),h(50923),h(42212),h(91963)),In=h(41007),kn=(h(36885),h(53919)),Gn=h(36518),Be=h(60324);const Er=(0,h(27969).v)(),Rn=e=>{let t=class extends e{constructor(){super(...arguments),this.fields=[],this.fieldsIndex=null}};return(0,p._)([(0,d.Cb)(Er.fields)],t.prototype,"fields",void 0),(0,p._)([(0,d.Cb)(Er.fieldsIndex)],t.prototype,"fieldsIndex",void 0),t=(0,p._)([(0,G.j)("esri.layers.knowledgeGraphLayer.KnowledgeGraphSublayerBase")],t),t};var xr=h(19855),Sn=h(96159),Nn=h(25836),vr=h(29717),Mr=h(81247),Fn=h(85295),jn=h(93792),Pn=h(33331),Zn=h(30668),ge=h(31709);let P=class extends((0,Sn.M)(Rn((0,xr.h)((0,vr.M)((0,Nn.Q)(Ge.Z)))))){constructor(e){if(super(e),this.capabilities=(0,Be.MS)(!1,!1),this.definitionExpression="",this.displayField="",this.elevationInfo=null,this.geometryType=null,this.geometryFieldName=null,this.graphType=null,this.hasM=!1,this.hasZ=!1,this.labelsVisible=null,this.labelingInfo=null,this.objectIdField=N,this.objectType=null,this.parentCompositeLayer=null,this.popupTemplate=null,this.source={openPorts:()=>this.load().then(()=>{const t=new MessageChannel;return new Zn.Z(t.port1,{channel:t,client:{queryFeatures:(a,o={})=>{const i=fe.Z.fromJSON(a);return this.queryFeaturesJSON(i,o)}}}),[t.port2]})},this.type="knowledge-graph-sublayer","link-chart"===e.parentCompositeLayer.type)this.geometryType="relationship"===e.graphType?"polyline":"point",this.geometryFieldName=O;else if(e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name)?.geometryType&&"esriGeometryNull"!==e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name)?.geometryType){const t=e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name);this.geometryFieldName=t?.name??null,this.geometryType=t?.geometryType?ge.M.fromJSON(t.geometryType):null;const a=t?.name,o=a?e.objectType.properties?.[a]:null;o?(this.hasM=o.hasM??!1,this.hasZ=o.hasZ??!1):(this.hasM=!1,this.hasZ=!1)}else this.geometryType=null;e.objectType.properties?.forEach(t=>{let o=t.fieldType;"esriFieldTypeOID"===o&&(o="esriFieldTypeInteger"),this.fields.push(Mr.Z.fromJSON({name:t.name,type:o,alias:t.alias,defaultValue:null,editable:t.editable,nullable:t.nullable}))}),this.fields.push(Mr.Z.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1})),this._set("fields",[...this.fields]),e.parentCompositeLayer.dataManager.knowledgeGraph.dataModel?.spatialReference&&(this.spatialReference=e.parentCompositeLayer.dataManager.knowledgeGraph.dataModel.spatialReference),this.renderer=(0,Pt.i)("link-chart"===e.parentCompositeLayer.type?"relationship"===e.graphType?(0,Be.bU)(ge.M.toJSON("polyline")).renderer:(0,Be.bU)(ge.M.toJSON("point")).renderer:(0,Be.bU)(ge.M.toJSON(this.geometryType)).renderer)}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){(0,Fn.YN)(e,this.fieldsIndex),this._set("renderer",e)}createPopupTemplate(e){return(0,Pn.eZ)(this,e)}createQuery(){return new fe.Z({where:"1=1",outFields:["*"]})}getField(e){for(let t=0;t<this.fields.length;t++)if(this.fields[t].name===e)return this.fields[t];throw new Error("Field not found")}getFieldDomain(e,t){return null}queryFeatures(e,t){var a=this;return(0,b.Z)(function*(){const{resolvedQuery:o,queryEngine:i}=yield a._setupQueryObjects(e),s=jn.Z.fromJSON(yield i.executeQuery(o.toJSON(),t?.signal));return s.features.forEach(l=>{l.sourceLayer=a}),s})()}queryFeaturesJSON(e,t){var a=this;return(0,b.Z)(function*(){const{resolvedQuery:o,queryEngine:i}=yield a._setupQueryObjects(e);return yield i.executeQuery(o.toJSON(),t?.signal)})()}queryFeatureCount(e,t){var a=this;return(0,b.Z)(function*(){const{resolvedQuery:o,queryEngine:i}=yield a._setupQueryObjects(e);return i.executeQueryForCount(o.toJSON(),t?.signal)})()}queryExtent(e={},t){var a=this;return(0,b.Z)(function*(){const o={...e,returnGeometry:!0},{resolvedQuery:i,queryEngine:s}=yield a._setupQueryObjects(o),l=yield s.executeQueryForExtent(i.toJSON(),t?.signal);let y;return y=null!=l.extent?.xmin&&null!=l.extent?.xmax&&null!=l.extent?.ymin&&null!=l.extent?.ymax?new Le.Z(l.extent):new Le.Z,{count:l.count,extent:y}})()}queryObjectIds(e,t){var a=this;return(0,b.Z)(function*(){const o=fe.Z.from(e);let i;if("link-chart"===a.parentCompositeLayer.type&&a._cachedQueryEngine)i=a._cachedQueryEngine;else{const s=yield a.parentCompositeLayer.dataManager.getData(o,a,t);i=a.loadQueryEngine(s)}return i.executeQueryForIds(o.toJSON(),t?.signal)})()}loadQueryEngine(e){const t=new kn.Z({geometryType:ge.M.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),a=new Gn.q({fieldsIndex:this.fieldsIndex.toJSON(),geometryType:ge.M.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:this.spatialReference.toJSON(),timeInfo:null,featureStore:t});return a.featureStore.addMany(e),a}refreshCachedQueryEngine(){var e=this;return(0,b.Z)(function*(){const t=yield e.parentCompositeLayer.dataManager.getData(new fe.Z({where:"1=1",outFields:[N]}),e);e._cachedQueryEngine=e.loadQueryEngine(t)})()}_setupQueryObjects(e,t){var a=this;return(0,b.Z)(function*(){const o=fe.Z.from(e),i=o.geometry;let s;if(i&&!i.spatialReference?.isWGS84&&(yield(0,_e.initializeProjection)(i.spatialReference,Ce.Zn),o.geometry=(0,_e.project)(i instanceof we.Z||i instanceof ie.Z?i:i.extent,Ce.Zn)),"link-chart"===a.parentCompositeLayer.type&&a._cachedQueryEngine)s=a._cachedQueryEngine;else{const l=yield a.parentCompositeLayer.dataManager.getData(o,a,t);s=a.loadQueryEngine(l)}return{resolvedQuery:o,queryEngine:s}})()}};(0,p._)([(0,d.Cb)()],P.prototype,"capabilities",void 0),(0,p._)([(0,d.Cb)({readOnly:!0})],P.prototype,"defaultPopupTemplate",null),(0,p._)([(0,d.Cb)()],P.prototype,"definitionExpression",void 0),(0,p._)([(0,d.Cb)()],P.prototype,"displayField",void 0),(0,p._)([(0,d.Cb)()],P.prototype,"elevationInfo",void 0),(0,p._)([(0,d.Cb)()],P.prototype,"geometryType",void 0),(0,p._)([(0,d.Cb)()],P.prototype,"geometryFieldName",void 0),(0,p._)([(0,d.Cb)()],P.prototype,"graphType",void 0),(0,p._)([(0,d.Cb)()],P.prototype,"hasM",void 0),(0,p._)([(0,d.Cb)()],P.prototype,"hasZ",void 0),(0,p._)([(0,d.Cb)()],P.prototype,"labelsVisible",void 0),(0,p._)([(0,d.Cb)()],P.prototype,"labelingInfo",void 0),(0,p._)([(0,d.Cb)()],P.prototype,"objectIdField",void 0),(0,p._)([(0,d.Cb)()],P.prototype,"objectType",void 0),(0,p._)([(0,d.Cb)()],P.prototype,"parentCompositeLayer",void 0),(0,p._)([(0,d.Cb)({type:Ln.Z,json:{name:"popupInfo",write:!0}})],P.prototype,"popupTemplate",void 0),(0,p._)([(0,d.Cb)({types:In.A,json:{write:{target:"layerDefinition.drawingInfo.renderer"}}})],P.prototype,"renderer",null),(0,p._)([(0,d.Cb)()],P.prototype,"source",void 0),(0,p._)([(0,d.Cb)({json:{read:!1}})],P.prototype,"type",void 0),P=(0,p._)([(0,G.j)("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],P);const Zt=P;let Ot,D=null;var q,At,Qt,Ut,zt,Ht,Wt,Gr,Dr;function be(e,t,a,o,i,s){const l=a.length,y=i.length,m=Float64Array.BYTES_PER_ELEMENT,u=Uint32Array.BYTES_PER_ELEMENT,f=Uint8Array.BYTES_PER_ELEMENT,w=D._malloc(15+l*(f+2*m)+y*(2*u));try{const C=w+16-w%16,M=C+l*m,_=M+l*m,j=_+y*u,L=j+y*u,F=()=>[D.HEAPF64.subarray(C>>3,(C>>3)+l),D.HEAPF64.subarray(M>>3,(M>>3)+l),D.HEAPU32.subarray(_>>2,(_>>2)+y),D.HEAPU32.subarray(j>>2,(j>>2)+y),D.HEAPU8.subarray(L,L+l)],[S,g,R,v,c]=F();S.set(a),g.set(o),R.set(i),v.set(s),c.set(t);const k=e(l,L,C,M,y,_,j),[E,Q,A,W,H]=F();return a.set(E),o.set(Q),i.set(A),s.set(W),t.set(H),k}finally{D._free(w)}}!function(e){e[e.None=0]="None",e[e.IsMovable=1]="IsMovable",e[e.IsGeographic=2]="IsGeographic",e[e.IsRoot=4]="IsRoot"}(q||(q={})),function(e){e.getMinIdealEdgeLength=function t(){return D.getMinIdealEdgeLength()},e.apply=function a(o,i,s,l,y,m=2,u=1,f=-1){return be((T,I,w,C,M,_,j)=>D.applyForceDirectedLayout(T,I,w,C,M,_,j,m,u,f),o,i,s,l,y)}}(At||(At={})),function(e){e.apply=function t(a,o,i,s,l,y=2,m=1,u=-1){return be((f,T,I,w,C,M,_)=>D.applyCommunityLayout(f,T,I,w,C,M,_,y,m,u),a,o,i,s,l)}}(Qt||(Qt={})),function(e){e.apply=function t(a,o,i,s,l){return be(D.applySimpleLayout,a,o,i,s,l)}}(Ut||(Ut={})),function(e){e.apply=function t(a,o,i,s,l){return be(D.applyHierarchicalLayout,a,o,i,s,l)}}(zt||(zt={})),function(e){e.apply=function t(a,o,i,s,l){return be(D.applyRadialTreeLayout,a,o,i,s,l)}}(Ht||(Ht={})),function(e){e.apply=function t(a,o,i,s,l){return be(D.applySmartTreeLayout,a,o,i,s,l)}}(Wt||(Wt={})),function(e){e[e.Undirected=0]="Undirected",e[e.Directed=1]="Directed",e[e.Reversed=2]="Reversed"}(Gr||(Gr={})),function(e){e[e.ByCC_Raw=0]="ByCC_Raw",e[e.ByCC_NormalizeGlobally=1]="ByCC_NormalizeGlobally",e[e.ByCC_NormalizeByCC=2]="ByCC_NormalizeByCC"}(Dr||(Dr={}));let z=class extends((0,xr.h)((0,vr.M)(Ge.Z))){constructor(e){if(super(e),this.dataPreloadedInLocalCache=!1,this.defaultLinkChartConfig=null,this._currentLinkChartConfig={layoutMode:"RADIAL_TREE",xScaleFactor:1,yScaleFactor:1},this._graphTypeLookup=new Map,this.knowledgeGraph=null,this.layers=new de.Z,this.linkChartDiagramLookup=new Map,this.linkChartExtent=new Le.Z({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7}),this.linkChartGeohashLookup=new Map,this.memberEntityTypes=null,this.memberRelationshipTypes=null,this.sublayerIdsCache=new Map,this.tables=new de.Z,this.type="link-chart",this._originalInclusionList=e.inclusionModeDefinition,e.dataPreloadedInLocalCache&&!e.inclusionModeDefinition)throw new x.Z("knowledge-graph:linkchart-layer-constructor","If creating a link chart composite layer and configured that data is already loaded in the cache, you must specify an inclusion list so the Composite Layer knows what records belong to it")}normalizeCtorArgs(e){return{url:e.url,title:e.title,dataPreloadedInLocalCache:e.dataPreloadedInLocalCache,defaultLinkChartConfig:e.defaultLinkChartConfig}}_initializeLayerProperties(e){if(!this.title&&this.url){const s=this.url.split("/");this.title=s[s.length-2]}const t=new Set;let a=[],o=[];if(e.inclusionModeDefinition&&(!e.inclusionModeDefinition.namedTypeDefinitions||e.inclusionModeDefinition.namedTypeDefinitions.size<1))throw new x.Z("knowledge-graph:composite-layer-constructor","If an explicit inclusion definition is defined, at least one namedTypeDefinition must also be defined");e.knowledgeGraph.dataModel.entityTypes?.forEach(s=>{s.name&&this._graphTypeLookup.set(s.name,s)}),e.knowledgeGraph.dataModel.relationshipTypes?.forEach(s=>{s.name&&this._graphTypeLookup.set(s.name,s)}),e.inclusionModeDefinition?.generateAllSublayers?(a=e.knowledgeGraph.dataModel.entityTypes??[],o=e.knowledgeGraph.dataModel.relationshipTypes??[]):e.inclusionModeDefinition?.namedTypeDefinitions&&e.inclusionModeDefinition?.namedTypeDefinitions.size>0?e.inclusionModeDefinition?.namedTypeDefinitions.forEach((s,l)=>{if(!this._graphTypeLookup.get(l))return re.Z.getLogger(this).warn(`A named type, ${l}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(l);this._graphTypeLookup.get(l)instanceof Je||"strictOrigin"in this._graphTypeLookup.get(l)?t.has(l)||(t.add(l),o.push(this._graphTypeLookup.get(l))):this._graphTypeLookup.get(l)instanceof Ke||"properties"in this._graphTypeLookup.get(l)?t.has(l)||(t.add(l),a.push(this._graphTypeLookup.get(l))):(re.Z.getLogger(this).warn(`A named type, ${l}, was in the inclusion list that wasn't properly modeled and will be removed`),e.inclusionModeDefinition?.namedTypeDefinitions.delete(l))}):(a=e.knowledgeGraph.dataModel.entityTypes??[],o=e.knowledgeGraph.dataModel.relationshipTypes??[]);const i=new V({knowledgeGraph:e.knowledgeGraph,inclusionModeDefinition:e.inclusionModeDefinition});this.knowledgeGraph=e.knowledgeGraph,this.memberEntityTypes=a,this.memberRelationshipTypes=o,this.dataManager=i}load(e){var t=this;return this.addResolvingPromise(new Promise(a=>{(function gn(e){return wt.apply(this,arguments)})(this.url).then(o=>{this._initializeLayerProperties({knowledgeGraph:o,inclusionModeDefinition:this._originalInclusionList}),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.size||(this.dataManager.inclusionModeDefinition={generateAllSublayers:!1,namedTypeDefinitions:new Map},this.dataManager.knowledgeGraph.dataModel.entityTypes?.forEach(i=>{i.name&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.set(i.name,{useAllData:!0})}),this.dataManager.knowledgeGraph.dataModel.relationshipTypes?.forEach(i=>{i.name&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.set(i.name,{useAllData:!0})})),this.dataPreloadedInLocalCache?(this.loadLayerAssumingLocalCache(),this.dataManager.inclusionModeDefinition&&(this.dataManager.inclusionModeDefinition.generateAllSublayers=!1),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach(i=>{i.useAllData=!1,i.members?.forEach(s=>{let l;l=s.linkChartLocation instanceof Jt.Z?s.linkChartLocation:s.linkChartLocation?(0,Y.GH)(s.linkChartLocation):null,this.linkChartDiagramLookup.set(s.id,l),this.linkChartGeohashLookup.set(s.id,l&&2===l.coords.length&&0===l.lengths.length?(0,J.fC)(l.coords[1],l.coords[0],12):"")}),this.addResolvingPromise(this._initializeDiagram().then((0,b.Z)(function*(){t.layers.forEach(function(){var s=(0,b.Z)(function*(l){yield l.refreshCachedQueryEngine()});return function(l){return s.apply(this,arguments)}}()),t.tables.forEach(function(){var s=(0,b.Z)(function*(l){yield l.refreshCachedQueryEngine()});return function(l){return s.apply(this,arguments)}}())})))})):this.addResolvingPromise(this.dataManager.refreshCacheContent(void 0,!1,"GEOGRAPHIC"===this.defaultLinkChartConfig?.layoutMode,!0).then((0,b.Z)(function*(){(0,$e.k_)(e);const s=[],l=[];t.loadLayerAssumingLocalCache(),t.dataManager.inclusionModeDefinition&&(t.dataManager.inclusionModeDefinition.generateAllSublayers=!1,t.dataManager.inclusionModeDefinition.namedTypeDefinitions.forEach(y=>{y.useAllData=!1})),yield t._initializeDiagram(),t.layers.forEach(y=>{l.push(y.refreshCachedQueryEngine()),s.push(new Promise(m=>{y.on("layerview-create",()=>{m(null)})}))}),t.tables.forEach(y=>{l.push(y.refreshCachedQueryEngine())}),yield Promise.all(l)}))),a(null)})})),Promise.resolve(this)}addRecords(e,t){var a=this;return(0,b.Z)(function*(){let o=[];t?.cascadeAddRelationshipEndNodes&&a.dataManager.knowledgeGraph.dataModel&&(o=yield function Mn(e,t){return Ft.apply(this,arguments)}(e,a.dataManager.knowledgeGraph));const i=e.concat(o).filter(s=>!a.sublayerIdsCache.get(s.typeName)?.has(s.id));yield a._handleNewRecords(i)})()}removeRecords(e,{cascadeRemoveRelationships:t=!0,recalculateLayout:a=!1}={cascadeRemoveRelationships:!0,recalculateLayout:!1}){var o=this;return(0,b.Z)(function*(){let i=[];for(const l of e)!1===o.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.get(l.typeName)?.useAllData&&o.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.get(l.typeName)?.members?.has(l.id)&&i.push(l);if(t){const l=new Set,y=[];for(const m of i)if(o.dataManager.nodeConnectionsLookup.has(m.id))for(const u of o.dataManager.nodeConnectionsLookup.get(m.id))l.add(u);for(const m of l)o.dataManager.memberIdTypeLookup.has(m)&&y.push({id:m,typeName:o.dataManager.memberIdTypeLookup.get(m)});i=i.concat(y)}o.dataManager.removeFromLayer(i);for(const l of i)o.sublayerIdsCache.get(l.typeName)?.delete(l.id),o.linkChartDiagramLookup.delete(l.id);a&&(yield o.calculateLinkChartLayout(o._currentLinkChartConfig.layoutMode,{xScaleFactor:o._currentLinkChartConfig.xScaleFactor,yScaleFactor:o._currentLinkChartConfig.xScaleFactor}));const s=[];return o.layers.forEach(l=>{s.push(l.refreshCachedQueryEngine())}),yield Promise.all(s),o._refreshNamedTypes(),i})()}expand(e){var t=this;return(0,b.Z)(function*(){const a=yield t.dataManager.getConnectedRecordIds(e),o=a.filter(i=>!t.sublayerIdsCache.get(i.typeName)?.has(i.id));return yield t._handleNewRecords(a),{records:o}})()}loadLayerAssumingLocalCache(){this.memberRelationshipTypes.forEach(e=>{const t=new Zt({objectType:e,parentCompositeLayer:this,graphType:"relationship",title:e.name});t.geometryType?this.layers.push(t):this.tables.push(t),this.dataManager.sublayerCaches.has(e.name)||this.dataManager.sublayerCaches.set(e.name,new Map)}),this.memberEntityTypes.forEach(e=>{const t=new Zt({objectType:e,parentCompositeLayer:this,graphType:"entity",title:e.name});t.geometryType?this.layers.push(t):this.tables.push(t),this.dataManager.sublayerCaches.has(e.name)||this.dataManager.sublayerCaches.set(e.name,new Map)}),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach((e,t)=>{const a=((e,t,a)=>(e.has(t)||e.set(t,new Set),e.get(t)))(this.sublayerIdsCache,t);e.members?.forEach(o=>{if(a.add(o.id),o.linkChartLocation)if(o.linkChartLocation instanceof Jt.Z)this.linkChartDiagramLookup.set(o.id,o.linkChartLocation),this.linkChartGeohashLookup.set(o.id,2===o.linkChartLocation.coords.length&&0===o.linkChartLocation.lengths.length?(0,J.fC)(o.linkChartLocation.coords[1],o.linkChartLocation.coords[0],12):"");else{const i=(0,Y.GH)(o.linkChartLocation);this.linkChartDiagramLookup.set(o.id,o.linkChartLocation?i:null),this.linkChartGeohashLookup.set(o.id,"x"in o.linkChartLocation&&"y"in o.linkChartLocation?(0,J.fC)(o.linkChartLocation.x,o.linkChartLocation.y,12):"")}})})}calculateLinkChartLayout(e="RADIAL_TREE",t){var a=this;return(0,b.Z)(function*(){const o=[],i=[];a.dataManager.sublayerCaches.forEach((c,k)=>{a.dataManager.entityTypeNames.has(k)?c.forEach(E=>{o.push({typeName:k,feature:E})}):a.dataManager.relationshipTypeNames.has(k)&&c.forEach(E=>{i.push({typeName:k,feature:E})})}),a.linkChartDiagramLookup=new Map;const s=new Map,l=new Map,y=new Map,m=new Map,u=new Uint8Array(o.length),f=new Float64Array(o.length),T=new Float64Array(o.length),I=new Uint32Array(i.length),w=new Uint32Array(i.length),C=[],_=t?.xScaleFactor??1,j=t?.yScaleFactor??1,L=new Le.Z({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7});let F,S="FORCE_DIRECTED",g=0,R=0;switch(S="GEOGRAPHIC"===e?"FORCE_DIRECTED":e,S){case"FORCE_DIRECTED":F=At.apply;break;case"COMMUNITY":F=Qt.apply;break;case"HIERARCHICAL":F=zt.apply;break;case"RADIAL_TREE":F=Ht.apply;break;case"SMART_TREE":F=Wt.apply;break;default:F=Ut.apply}o.forEach(({typeName:c,feature:k})=>{if(t?.lockedNodeLocations?.has(k.attributes[N])){u[g]="GEOGRAPHIC"===e&&a.dataManager.geographicLookup.has(c)?q.IsGeographic:q.None;const E=t.lockedNodeLocations.get(k.attributes[N]);f[g]=E.x,T[g]=E.y}else if("GEOGRAPHIC"===e&&a.dataManager.geographicLookup.has(c)){u[g]=q.IsGeographic;let E=null;const Q=k.attributes[a.dataManager.geographicLookup.get(c).name];switch(a.dataManager.geographicLookup.get(c)?.geometryType){case"esriGeometryPoint":f[g]=Q?.x,T[g]=Q?.y;break;case"esriGeometryPolygon":E=Q?.centroid,null!=E?.x&&null!=E?.y?(f[g]=E.x,T[g]=E.y):u[g]=q.IsMovable;break;case"esriGeometryPolyline":case"esriGeometryMultipoint":E=Q?.extent?.center,null!=E?.x&&null!=E?.y?(f[g]=E.x,T[g]=E.y):u[g]=q.IsMovable;break;default:u[g]=q.IsMovable}(null==f[g]||null==T[g]||Number.isNaN(f[g])||Number.isNaN(T[g]))&&(u[g]=q.IsMovable,f[g]=0,T[g]=0)}else u[g]=q.IsMovable,f[g]=0,T[g]=0;m.set(k.attributes[N],g),C[g]={feature:k,typeName:c},g++});let v=!1;if(i.forEach(c=>{const k=m.get(c.feature.attributes[Ie]),E=m.get(c.feature.attributes[jt]);void 0!==k&&void 0!==E?(I[R]=k,w[R]=E,R++):(v=!0,a.linkChartDiagramLookup.set(c.feature.attributes[Ie],null),a.linkChartGeohashLookup.set(c.feature.attributes[Ie],null))}),v&&re.Z.getLogger(a).warn("A relationship is a member of this layer that has either origin or destination entity nodes that are not members. The diagram geometry will be set to null"),yield function On(){return Ot||(Ot=h.e(183).then(h.bind(h,30183)).then(e=>e.l).then(({default:e})=>e({locateFile:t=>(0,Ve.V)(`esri/libs/linkchartlayout/${t}`)})).then(e=>{!function An(e){D=e}(e)}),Ot)}(),!F(u,f,T,I,w))throw new x.Z("knowledge-graph:layout-failed","Attempting to arrange the records in the specified layout failed");for(let c=0;c<C.length;c++){if(u[c]===q.IsMovable&&(f[c]=f[c]*_,T[c]=T[c]*j),T[c]>84.9999&&(T[c]=84.9999),T[c]<-84.9999&&(T[c]=-84.9999),f[c]>179.9999&&(f[c]=179.9999),f[c]<-179.9999&&(f[c]=-179.9999),C[c].feature.attributes[O]=new Ee.Z(f[c],T[c]),s.has(C[c].typeName))s.get(C[c].typeName)?.set(C[c].feature.attributes[N],C[c].feature);else{const E=new Map;E.set(C[c].feature.attributes[N],C[c].feature),s.set(C[c].typeName,E)}y.set(C[c].feature.attributes[N],C[c].feature);const k=(0,Y.GH)(C[c].feature.attributes[O]);a.linkChartDiagramLookup.set(C[c].feature.attributes[N],C[c].feature.attributes[O]?k:null),a.linkChartGeohashLookup.set(C[c].feature.attributes[N],(0,J.fC)(C[c].feature.attributes[O].y,C[c].feature.attributes[O].x,12)),C[c].feature.attributes[O].x<L.xmin&&(L.xmin=C[c].feature.attributes[O].x),C[c].feature.attributes[O].x>L.xmax&&(L.xmax=C[c].feature.attributes[O].x),C[c].feature.attributes[O].y<L.ymin&&(L.ymin=C[c].feature.attributes[O].y),C[c].feature.attributes[O].y>L.ymax&&(L.ymax=C[c].feature.attributes[O].y)}return a.linkChartExtent.xmin=L.xmin,a.linkChartExtent.xmax=L.xmax,a.linkChartExtent.ymin=L.ymin,a.linkChartExtent.ymax=L.ymax,i.forEach(c=>{const k=C[m.get(c.feature.attributes[Ie])]?.feature.attributes[O],E=C[m.get(c.feature.attributes[jt])]?.feature.attributes[O];if(!k||!E)return;const Q=new ie.Z({paths:[[k.x,k.y],[E.x,E.y]]});if(c.feature.attributes[O]=Q,l.has(c.typeName))l.get(c.typeName)?.set(c.feature.attributes[N],c.feature);else{const W=new Map;W.set(c.feature.attributes[N],c.feature),l.set(c.typeName,W)}y.set(c.feature.attributes[N],c.feature);const A=(0,Y.GH)(c.feature.attributes[O]);a.linkChartDiagramLookup.set(c.feature.attributes[N],c.feature.attributes[O]?A:null),a.linkChartGeohashLookup.set(c.feature.attributes[N],"")}),a._currentLinkChartConfig={layoutMode:e,xScaleFactor:_,yScaleFactor:j},{nodes:s,links:l,idMap:y}})()}applyNewLinkChartLayout(e="RADIAL_TREE",t){var a=this;return(0,b.Z)(function*(){const o=[];yield a.calculateLinkChartLayout(e,t),a.layers.forEach(i=>{o.push(i.refreshCachedQueryEngine())}),yield Promise.all(o),a._refreshNamedTypes()})()}getCurrentNodeLocations(){const e=new Map;return this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.forEach(t=>{t?.members?.forEach(a=>{const o=a.linkChartLocation;let i;o&&(i="x"in o?{x:o.x,y:o.y}:{x:o.coords[0],y:o.coords[1]},e.set(a.id,new Ee.Z({x:i.x,y:i.y})))})}),e}synchronizeInclusionListWithCache(){var e=this;return(0,b.Z)(function*(){return new Promise(t=>{e.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach((a,o)=>{if(a.useAllData=!1,a.members&&a.members.size>0){if(!e.dataManager.sublayerCaches.get(o))return;const i=new Set(Array.from(e.dataManager.sublayerCaches.get(o).keys()));Array.from(a.members.keys()).filter(s=>!i.has(s)).forEach(s=>{a.members?.delete(s)})}}),t()})})()}refreshLinkChartCache(e){var t=this;return(0,b.Z)(function*(){yield t.dataManager.refreshCacheContent(e);const a=[];t.layers.forEach(o=>{a.push(o.refreshCachedQueryEngine())}),yield Promise.all(a),t._refreshNamedTypes()})()}_handleNewRecords(e){var t=this;return(0,b.Z)(function*(){const a=[];t.dataManager.addToLayer(e);for(const o of e)t.sublayerIdsCache.has(o.typeName)||(t.sublayerIdsCache.set(o.typeName,new Set),a.push(o.typeName)),t.sublayerIdsCache.get(o.typeName).add(o.id);for(const o of a)if(t._graphTypeLookup.has(o)){const i=t._graphTypeLookup.get(o),s="endPoints"in i?"relationship":"entity",l=new Zt({objectType:i,parentCompositeLayer:t,graphType:s,title:o});"entity"===s?t.dataManager.entityTypeNames.add(o):t.dataManager.relationshipTypeNames.add(o),l.geometryType?t.layers.push(l):t.tables.push(l),t.dataManager.sublayerCaches.set(o,new Map)}yield t.dataManager.refreshCacheContent(e.map(o=>o.id)),yield t.applyNewLinkChartLayout(t._currentLinkChartConfig.layoutMode,{xScaleFactor:t._currentLinkChartConfig.xScaleFactor,yScaleFactor:t._currentLinkChartConfig.xScaleFactor})})()}_initializeDiagram(){var e=this;return(0,b.Z)(function*(){e.defaultLinkChartConfig?e.defaultLinkChartConfig.doNotRecalculateLayout?(e.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.forEach(t=>{t?.members?.forEach(a=>{const o=a.linkChartLocation;let i;const s=a.id;if(!o)return;i="x"in o?{x:o.x,y:o.y}:{x:o.coords[0],y:o.coords[1]};const l=(0,Y.GH)(i);e.linkChartDiagramLookup.set(s,l),e.linkChartGeohashLookup.set(s,(0,J.fC)(i.x,i.y,12)),e.linkChartExtent.xmin>i.x&&(e.linkChartExtent.xmin=i.x),e.linkChartExtent.xmax<i.x&&(e.linkChartExtent.xmax=i.x),e.linkChartExtent.ymin>i.y&&(e.linkChartExtent.ymin=i.y),e.linkChartExtent.ymax<i.y&&(e.linkChartExtent.ymax=i.y)})}),e.memberRelationshipTypes.forEach(t=>{t.name&&e.dataManager.sublayerCaches.get(t.name)?.forEach(a=>{const o=e.linkChartDiagramLookup.get(a.attributes[Ie]),i=e.linkChartDiagramLookup.get(a.attributes[jt]);if(o&&i){const s=(0,Y.GH)(new ie.Z({paths:[[o.coords[0],o.coords[1]],[i.coords[0],i.coords[1]]]}));e.linkChartDiagramLookup.set(a.attributes[N],s)}else e.linkChartDiagramLookup.set(a.attributes[N],null);e.linkChartGeohashLookup.set(a.attributes[N],"")})})):yield e.calculateLinkChartLayout(e.defaultLinkChartConfig.layoutMode,{xScaleFactor:e.defaultLinkChartConfig.xScaleFactor,yScaleFactor:e.defaultLinkChartConfig.yScaleFactor,lockedNodeLocations:e.getCurrentNodeLocations()}):yield e.calculateLinkChartLayout("RADIAL_TREE",{lockedNodeLocations:e.getCurrentNodeLocations()})})()}_refreshNamedTypes(){for(const e of this.layers)e.emit("refresh",{dataChanged:!0});for(const e of this.tables)e.emit("refresh",{dataChanged:!0})}};(0,p._)([(0,d.Cb)()],z.prototype,"dataPreloadedInLocalCache",void 0),(0,p._)([(0,d.Cb)()],z.prototype,"defaultLinkChartConfig",void 0),(0,p._)([(0,d.Cb)()],z.prototype,"dataManager",void 0),(0,p._)([(0,d.Cb)()],z.prototype,"knowledgeGraph",void 0),(0,p._)([(0,d.Cb)()],z.prototype,"layers",void 0),(0,p._)([(0,d.Cb)()],z.prototype,"linkChartDiagramLookup",void 0),(0,p._)([(0,d.Cb)()],z.prototype,"linkChartExtent",void 0),(0,p._)([(0,d.Cb)()],z.prototype,"linkChartGeohashLookup",void 0),(0,p._)([(0,d.Cb)()],z.prototype,"memberEntityTypes",void 0),(0,p._)([(0,d.Cb)()],z.prototype,"memberRelationshipTypes",void 0),(0,p._)([(0,d.Cb)()],z.prototype,"sublayerIdsCache",void 0),(0,p._)([(0,d.Cb)()],z.prototype,"tables",void 0),(0,p._)([(0,d.Cb)({json:{read:!1}})],z.prototype,"type",void 0),z=(0,p._)([(0,G.j)("esri.layers.LinkChartLayer")],z);const Un=z},60324:(Sr,ke,h)=>{h.d(ke,{Dm:()=>d,Hq:()=>Yt,MS:()=>Kt,bU:()=>x});var b=h(14007),p=h(34222),$t=h(85559),de=h(19579);function x(B){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===B||"esriGeometryMultipoint"===B?de.I4:"esriGeometryPolyline"===B?de.ET:de.lF}}}const re=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let $e=1;function d(B,G){if((0,b.Z)("esri-csp-restrictions"))return()=>({[G]:null,...B});try{let J=`this.${G} = null;`;for(const Y in B)J+=`this${re.test(Y)?`.${Y}`:`["${Y}"]`} = ${JSON.stringify(B[Y])};`;const Ge=new Function(`\n      return class AttributesClass$${$e++} {\n        constructor() {\n          ${J};\n        }\n      }\n    `)();return()=>new Ge}catch{return()=>({[G]:null,...B})}}function Yt(B={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,p.d9)(B)}}]}function Kt(B,G){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:B},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:G,supportsDelete:G,supportsEditing:G,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:G,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:$t.g,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:G,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}}}]);