"use strict";(self.webpackChunkangular_17_test=self.webpackChunkangular_17_test||[]).push([[6469],{90295:(rt,K,o)=>{o.d(K,{Z:()=>I});class I{constructor(E){this.size=0,this._start=0,this.maxSize=E,this._buffer=new Array(E)}get entries(){return this._buffer}enqueue(E){if(this.size===this.maxSize){const w=this._buffer[this._start];return this._buffer[this._start]=E,this._start=(this._start+1)%this.maxSize,w}return this._buffer[(this._start+this.size++)%this.maxSize]=E,null}dequeue(){if(0===this.size)return null;const E=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,E}peek(){return 0===this.size?null:this._buffer[this._start]}find(E){if(0===this.size)return null;for(const w of this._buffer)if(null!=w&&E(w))return w;return null}clear(E){let w=this.dequeue();for(;null!=w;)E&&E(w),w=this.dequeue()}}},40485:(rt,K,o)=>{o.d(K,{Z:()=>b});var E,P,I=o(14007),v=o(51479);(P=E||(E={}))[P.varint=0]="varint",P[P.fixed64=1]="fixed64",P[P.delimited=2]="delimited",P[P.fixed32=5]="fixed32",P[P.unknown=99]="unknown";const w=4294967296,A=new TextDecoder("utf-8"),C=(0,I.Z)("safari")||(0,I.Z)("ios")?6:(0,I.Z)("ff")?12:32;class b{constructor(a,e,c=0,l=(a?a.byteLength:0)){this._tag=0,this._dataType=E.unknown,this._init(a,e,c,l)}_init(a,e,c,l){this._data=a,this._dataView=e,this._pos=c,this._end=l}asUnsafe(){return this}clone(){return new b(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(a){this._pos=a}nextTag(a){for(;;){if(this._pos===this._end)return!1;const e=this._decodeVarint();if(this._tag=e>>3,this._dataType=7&e,!a||a===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const a=this._decodeVarint();return this._tag=a>>3,this._dataType=7&a,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let a=4294967295;return a=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?a:(a=(a|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?a:(a=(a|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?a:(a=(a|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?a:(a=(a|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?a:void 0))))}getUInt64(){return this._decodeVarint()}getSInt32(){const a=this.getUInt32();if(void 0!==a)return a>>>1^-(1&a)|0}getSInt64(){return this._decodeSVarint()}getBool(){const a=0!==this._data[this._pos];return this._skip(1),a}getEnum(){return this._decodeVarint()}getFixed64(){const a=this._dataView,e=this._pos,c=a.getUint32(e,!0)+a.getUint32(e+4,!0)*w;return this._skip(8),c}getSFixed64(){const a=this._dataView,e=this._pos,c=a.getUint32(e,!0)+a.getInt32(e+4,!0)*w;return this._skip(8),c}getDouble(){const a=this._dataView.getFloat64(this._pos,!0);return this._skip(8),a}getFixed32(){const a=this._dataView.getUint32(this._pos,!0);return this._skip(4),a}getSFixed32(){const a=this._dataView.getInt32(this._pos,!0);return this._skip(4),a}getFloat(){const a=this._dataView.getFloat32(this._pos,!0);return this._skip(4),a}getString(){const a=this._getLength(),e=this._pos,c=this._toString(this._data,e,e+a);return this._skip(a),c}getBytes(){const a=this._getLength(),e=this._pos,c=this._toBytes(this._data,e,e+a);return this._skip(a),c}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(a,e,c,l){const m=this.getMessage(),D=a(m,e,c,l);return m.release(),D}processMessage(a){const e=this.getMessage(),c=a(e);return e.release(),c}getMessage(){const a=this._getLength(),e=b.pool.acquire();return e._init(this._data,this._dataView,this._pos,this._pos+a),this._skip(a),e}release(){b.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case E.varint:this._decodeVarint();break;case E.fixed64:this._skip(8);break;case E.delimited:this._skip(this._getLength());break;case E.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(a){this._skip(a)}_skip(a){if(this._pos+a>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=a}_decodeVarint(){const a=this._data;let e=this._pos,c=0,l=0;if(this._end-e>=10)do{if(l=a[e++],c|=127&l,0==(128&l)||(l=a[e++],c|=(127&l)<<7,0==(128&l))||(l=a[e++],c|=(127&l)<<14,0==(128&l))||(l=a[e++],c|=(127&l)<<21,0==(128&l))||(l=a[e++],c+=268435456*(127&l),0==(128&l))||(l=a[e++],c+=34359738368*(127&l),0==(128&l))||(l=a[e++],c+=4398046511104*(127&l),0==(128&l))||(l=a[e++],c+=562949953421312*(127&l),0==(128&l))||(l=a[e++],c+=72057594037927940*(127&l),0==(128&l))||(l=a[e++],c+=0x8000000000000000*(127&l),0==(128&l)))break;throw new Error("Varint too long!")}while(0);else{let m=1;for(;e!==this._end&&(l=a[e],0!=(128&l));)++e,c+=(127&l)*m,m*=128;if(e===this._end)throw new Error("Varint overrun!");++e,c+=l*m}return this._pos=e,c}_decodeSVarint(){const a=this._data;let e,c=0,l=0;const m=1&a[this._pos];if(l=a[this._pos++],c|=127&l,0==(128&l)||(l=a[this._pos++],c|=(127&l)<<7,0==(128&l))||(l=a[this._pos++],c|=(127&l)<<14,0==(128&l))||(l=a[this._pos++],c|=(127&l)<<21,0==(128&l))||(l=a[this._pos++],c+=268435456*(127&l),0==(128&l))||(l=a[this._pos++],c+=34359738368*(127&l),0==(128&l))||(l=a[this._pos++],c+=4398046511104*(127&l),0==(128&l)))return m?-(c+1)/2:c/2;if(e=BigInt(c),l=a[this._pos++],e+=0x2000000000000n*BigInt(127&l),0==(128&l)||(l=a[this._pos++],e+=0x100000000000000n*BigInt(127&l),0==(128&l))||(l=a[this._pos++],e+=0x8000000000000000n*BigInt(127&l),0==(128&l)))return Number(m?-(e+1n)/2n:e/2n);throw new Error("Varint too long!")}_getLength(){if(this._dataType!==E.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(a,e,c){if((c=Math.min(this._end,c))-e>C){const D=a.subarray(e,c);return A.decode(D)}let l="",m="";for(let D=e;D<c;++D){const V=a[D];128&V?m+="%"+V.toString(16):(l+=decodeURIComponent(m)+String.fromCharCode(V),m="")}return m.length&&(l+=decodeURIComponent(m)),l}_toBytes(a,e,c){return c=Math.min(this._end,c),new Uint8Array(a.buffer,e,c-e)}}b.pool=new v.Z(b,void 0,P=>{P._data=null,P._dataView=null})},9922:(rt,K,o)=>{function I(v,E,w,A){let C=null,b=1e3;"number"==typeof E?(b=E,A=w):(C=E??null,b=w);let P,a=0;const e=()=>{a=0,v.apply(A,P)},c=(...l)=>{C&&C.apply(A,l),P=l,b?a||(a=setTimeout(e,b)):e()};return c.remove=()=>{a&&(clearTimeout(a),a=0)},c.forceUpdate=()=>{a&&(clearTimeout(a),e())},c.hasPendingUpdates=()=>!!a,c}o.d(K,{P:()=>I})},37127:(rt,K,o)=>{o.d(K,{$7:()=>l,$e:()=>A,E0:()=>e,N5:()=>c,lW:()=>C});var I=o(15861),E=(o(14007),o(57964)),w=o(6785);function A(m){const D=e(m);return null!=D?D.toDataURL():""}function C(m){return b.apply(this,arguments)}function b(){return b=(0,I.Z)(function*(m){const D=e(m);if(null==D)throw new E.Z("imageToArrayBuffer","Unsupported image type");const V=yield function P(m){return a.apply(this,arguments)}(m),T=yield new Promise(X=>D.toBlob(X,V));if(!T)throw new E.Z("imageToArrayBuffer","Failed to encode image");return{data:yield T.arrayBuffer(),type:V}}),b.apply(this,arguments)}function a(){return(a=(0,I.Z)(function*(m){if(!(m instanceof HTMLImageElement))return"image/png";const D=m.src;if((0,w.HK)(D)){const V=(0,w.sJ)(D);return"image/jpeg"===V?.mediaType?V.mediaType:"image/png"}return/\.png$/i.test(D)?"image/png":/\.(jpg|jpeg)$/i.test(D)?"image/jpeg":"image/png"})).apply(this,arguments)}function e(m){if(m instanceof HTMLCanvasElement)return m;if(m instanceof HTMLVideoElement)return null;const D=document.createElement("canvas");D.width=m.width,D.height=m.height;const V=D.getContext("2d");return m instanceof HTMLImageElement?V.drawImage(m,0,0,m.width,m.height):m instanceof ImageData&&V.putImageData(m,0,0),D}function c(m){const D=[],V=new Uint8Array(m);for(let T=0;T<V.length;T++)D.push(String.fromCharCode(V[T]));return"data:application/octet-stream;base64,"+btoa(D.join(""))}function l(m){if(m.byteLength<8)return!1;const D=new Uint8Array(m);return 137===D[0]&&80===D[1]&&78===D[2]&&71===D[3]&&13===D[4]&&10===D[5]&&26===D[6]&&10===D[7]}},29340:(rt,K,o)=>{o.d(K,{Z:()=>P});var I=o(55117),v=o(84176),E=o(52793),w=o(43818),A=o(43248),C=o(25896);class P{constructor(e){this._resourceManager=e,this._lazyRasterizationCanvas=null}dispose(){this._lazyRasterizationCanvas=null}get _rasterizationCanvas(){return null==this._lazyRasterizationCanvas&&(this._lazyRasterizationCanvas=document.createElement("canvas"),this._lazyRasterizationCanvas.getContext("2d",{willReadFrequently:!0})),this._lazyRasterizationCanvas}rasterizeJSONResource(e,c,l){if("simple-fill"===e.type||"esriSFS"===e.type){const[z,O,G]=(0,E.Y)(this._rasterizationCanvas,e.style,c);return{size:[O,G],image:new Uint32Array(z.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0,rasterizationScale:(0,I.fp)(Math.ceil(c))}}if("simple-line"===e.type||"esriSLS"===e.type||"line"===e.type&&e.dashTemplate){let z,O;if("simple-line"===e.type||"esriSLS"===e.type)switch(z=(0,v.U1)(e.style,e.cap),e.cap){case"butt":O="Butt";break;case"square":O="Square";break;default:O="Round"}else z=e.dashTemplate,O=e.cim.capStyle;const[G,J,Q]=(0,E.m)(z,O);return{size:[J,Q],image:new Uint32Array(G.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}let m,D=null,V=null,T=1;if("simple-marker"===e.type||"esriSMS"===e.type||"line-marker"===e.type?(m=v.B$.fromSimpleMarker(e),V=(0,A.Fp)(m)):e.cim&&"CIMHatchFill"===e.cim.type?(m=v.B$.fromCIMHatchFill(e.cim,c),D=new w.Z(m.frame.xmin,-m.frame.ymax,m.frame.xmax-m.frame.xmin,m.frame.ymax-m.frame.ymin),T=c):e.cim.markerPlacement&&"CIMMarkerPlacementInsidePolygon"===e.cim.markerPlacement.type?(m=v.B$.fromCIMInsidePolygon(e.cim),D=new w.Z(m.frame.xmin,-m.frame.ymax,m.frame.xmax-m.frame.xmin,m.frame.ymax-m.frame.ymin)):(m=e.cim,e.avoidSDFRasterization||(V=(0,A.Fp)(m))),V&&!l){const[z,O,G]=(0,A.RL)(V);return z?{size:[O,G],image:new Uint32Array(z.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0,rasterizationScale:T}:null}const[X,x,S,U,N]=v.B$.rasterize(this._rasterizationCanvas,m,D,this._resourceManager,!l);return X?{size:[x,S],image:new Uint32Array(X.buffer),sdf:!1,simplePattern:!1,anchorX:U,anchorY:N}:null}rasterizeImageResource(e,c,l,m){this._rasterizationCanvas.width=e,this._rasterizationCanvas.height=c;const D=this._rasterizationCanvas.getContext("2d");l instanceof ImageData?D.putImageData(l,0,0):(l.setAttribute("width",`${e}px`),l.setAttribute("height",`${c}px`),D.drawImage(l,0,0,e,c));const V=D.getImageData(0,0,e,c),T=new Uint8Array(V.data);if(m)for(const z of m)if(z&&z.oldColor&&4===z.oldColor.length&&z.newColor&&4===z.newColor.length){const[O,G,J,Q]=z.oldColor,[ot,R,H,j]=z.newColor;if(O===ot&&G===R&&J===H&&Q===j)continue;for(let Z=0;Z<T.length;Z+=4)O===T[Z]&&G===T[Z+1]&&J===T[Z+2]&&Q===T[Z+3]&&(T[Z]=ot,T[Z+1]=R,T[Z+2]=H,T[Z+3]=j)}let X;for(let z=0;z<T.length;z+=4)X=T[z+3]/255,T[z]=T[z]*X,T[z+1]=T[z+1]*X,T[z+2]=T[z+2]*X;let x=T,S=e,U=c;const N=512;if(S>=N||U>=N){const z=S/U;z>1?(S=N,U=Math.round(N/z)):(U=N,S=Math.round(N*z)),x=new Uint8Array(4*S*U);const O=new Uint8ClampedArray(x.buffer);(0,C.TT)(T,e,c,O,S,U,!1)}return{size:[S,U],image:new Uint32Array(x.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}},52793:(rt,K,o)=>{o.d(K,{Y:()=>w,m:()=>A});var I=o(11462),v=o(55117);const E=C=>"vertical"===C||"horizontal"===C||"cross"===C||"esriSFSCross"===C||"esriSFSVertical"===C||"esriSFSHorizontal"===C;function w(C,b,P){const a=(0,v.fp)(Math.ceil(P)),e=E(b)?8*a:16*a,c=2*a;C.width=e,C.height=e;const l=C.getContext("2d");l.strokeStyle="#FFFFFF",l.lineWidth=a,l.beginPath(),"vertical"!==b&&"cross"!==b&&"esriSFSCross"!==b&&"esriSFSVertical"!==b||(l.moveTo(e/2,-c),l.lineTo(e/2,e+c)),"horizontal"!==b&&"cross"!==b&&"esriSFSCross"!==b&&"esriSFSHorizontal"!==b||(l.moveTo(-c,e/2),l.lineTo(e+c,e/2)),"forward-diagonal"!==b&&"diagonal-cross"!==b&&"esriSFSDiagonalCross"!==b&&"esriSFSForwardDiagonal"!==b||(l.moveTo(-c,-c),l.lineTo(e+c,e+c),l.moveTo(e-c,-c),l.lineTo(e+c,c),l.moveTo(-c,e-c),l.lineTo(c,e+c)),"backward-diagonal"!==b&&"diagonal-cross"!==b&&"esriSFSBackwardDiagonal"!==b&&"esriSFSDiagonalCross"!==b||(l.moveTo(e+c,-c),l.lineTo(-c,e+c),l.moveTo(c,-c),l.lineTo(-c,c),l.moveTo(e+c,e-c),l.lineTo(e-c,e+c)),l.stroke();const m=l.getImageData(0,0,C.width,C.height),D=new Uint8Array(m.data);let V;for(let T=0;T<D.length;T+=4)V=D[T+3]/255,D[T]=D[T]*V,D[T+1]=D[T+1]*V,D[T+2]=D[T+2]*V;return[D,C.width,C.height]}function A(C,b){const P="Butt"===b,a="Square"===b,e=!P&&!a;C.length%2==1&&(C=[...C,...C]);const c=15.5;let m=0;for(const O of C)m+=O;const D=Math.round(m*c),V=new Float32Array(31*D),T=7.75;let X=0,x=0,S=.5,U=!0;for(const O of C){for(X=x,x+=O*c;S<=x;){let G=.5;for(;G<31;){const J=(G-.5)*D+S-.5,Q=e?(G-c)*(G-c):Math.abs(G-c);V[J]=U?P?Math.max(Math.max(X+T-S,Q),Math.max(S-x+T,Q)):Q:e?Math.min((S-X)*(S-X)+Q,(S-x)*(S-x)+Q):a?Math.min(Math.max(S-X,Q),Math.max(x-S,Q)):Math.min(Math.max(S-X+T,Q),Math.max(x+T-S,Q)),G++}S++}U=!U}const N=V.length,z=new Uint8Array(4*N);for(let O=0;O<N;++O){const G=(e?Math.sqrt(V[O]):V[O])/c;(0,I.I)(G,z,4*O)}return[z,D,31]}},47403:(rt,K,o)=>{o.d(K,{Q:()=>Q});var I=o(50484),v=o(73514),w=(o(57964),o(14007)),C=(o(4703),o(9922)),b=o(80543),e=(o(1535),o(57678),o(10141)),c=o(99657),l=o(55117),m=o(84249);class S{constructor(R,H,j){this._debugMap=new Map,this._width=R*j,this._height=H*j,this._pixelRatio=j;const Z=Math.ceil(this._width/1),Y=Math.ceil(this._height/1);this._cols=Z,this._rows=Y,this._cells=m.p.create(Z*Y)}insertMetrics(R){const H=this._hasCollision(R);return 0===H&&this._markMetrics(R),H}getCellId(R,H){return R+H*this._cols}has(R){return this._cells.has(R)}hasRange(R,H){return this._cells.hasRange(R,H)}set(R){this._cells.set(R)}setRange(R,H){this._cells.setRange(R,H)}_collide(R,H,j,Z){const Y=R-j/2,$=H-Z/2,q=Y+j,it=$+Z;if(q<0||it<0||Y>this._width||$>this._height)return 1;const pt=(0,l.uZ)(Math.floor(Y/1),0,this._cols),at=(0,l.uZ)(Math.floor($/1),0,this._rows),ft=(0,l.uZ)(Math.ceil(q/1),0,this._cols),lt=(0,l.uZ)(Math.ceil(it/1),0,this._rows);for(let gt=at;gt<=lt;gt++)for(let tt=pt;tt<=ft;tt++){const yt=this.getCellId(tt,gt);if(this.has(yt))return 2}return 0}_mark(R,H,j,Z,Y){const $=R-j/2,q=H-Z/2,it=$+j,pt=q+Z,at=(0,l.uZ)(Math.floor($/1),0,this._cols),ft=(0,l.uZ)(Math.floor(q/1),0,this._rows),lt=(0,l.uZ)(Math.ceil(it/1),0,this._cols),gt=(0,l.uZ)(Math.ceil(pt/1),0,this._rows);for(let tt=ft;tt<=gt;tt++)for(let yt=at;yt<=lt;yt++){const g=this.getCellId(yt,tt);this._debugMap.set(g,Y),this.set(g)}return!1}_hasCollision(R){const H=R.id;let j=0,Z=0;R.save();do{const Y=R.boundsCount;j+=Y;for(let $=0;$<Y;$++){const q=R.boundsComputedAnchorX($),it=R.boundsComputedAnchorY($),pt=(R.boundsWidth($)+2)*this._pixelRatio,at=(R.boundsHeight($)+2)*this._pixelRatio;switch(this._collide(q,it,pt,at)){case 2:return 2;case 1:Z++}}}while(R.peekId()===H&&R.next());return R.restore(),j===Z?1:0}_markMetrics(R){const H=R.id;R.save();do{const j=R.boundsCount;for(let Z=0;Z<j;Z++){const Y=R.boundsComputedAnchorX(Z),$=R.boundsComputedAnchorY(Z),q=(R.boundsWidth(Z)+2)*this._pixelRatio,it=(R.boundsHeight(Z)+2)*this._pixelRatio;this._mark(Y,$,q,it,R.id)}}while(R.peekId()===H&&R.next());R.restore()}}const N=255;function O(ot,R){const H=[];ot.forEachTile(j=>H.push(j)),H.sort((j,Z)=>j.instanceId-Z.instanceId),H.forEach(j=>{null!=j.labelMetrics&&j.isReady&&R(j,j.labelMetrics.getCursor())})}class G{run(R,H,j){const Z=[];for(let Y=R.length-1;Y>=0;Y--){const $=R[Y];$.labelingCollisionInfos&&Z.push(...$.labelingCollisionInfos)}this._transformMetrics(Z),this._runCollision(Z,H,j)}_runCollision(R,H,j){const[Z,Y]=H.state.size,$=new S(Z,Y,H.pixelRatio);for(const{tileRenderer:q,deconflictionEnabled:it,visible:pt}of R){const at=q.featuresView.attributeView;it?pt?(this._prepare(q),this._collideVisible($,q,j),this._collideInvisible($,q)):O(q,(ft,lt)=>{for(;lt.nextId();)at.setLabelMinZoom(lt.id,N)}):O(q,(ft,lt)=>{for(;lt.nextId();)at.setLabelMinZoom(lt.id,0),pt&&$.insertMetrics(lt)})}}_isFiltered(R,H,j){const Z=H.getFilterFlags(R);return!((!j.hasFilter||Z&c.g3)&&(null==j.featureEffect||j.featureEffect.excludedLabelsVisible||Z&c.kU))}_prepare(R){const H=R.featuresView.attributeView,j=new Set;O(R,(Z,Y)=>{for(;Y.nextId();)if(!j.has(Y.id)){if(j.add(Y.id),this._isFiltered(Y.id,H,R.layerView)){H.setLabelMinZoom(Y.id,254);continue}0!==H.getLabelMinZoom(Y.id)?H.setLabelMinZoom(Y.id,N):H.setLabelMinZoom(Y.id,0)}})}_collideVisible(R,H,j){const Z=H.featuresView.attributeView,Y=new Set;O(H,($,q)=>{for(;q.nextId();)if(!Y.has(q.id))if($.key.level===j){if(0===Z.getLabelMinZoom(q.id))switch(R.insertMetrics(q)){case 1:break;case 2:Z.setLabelMinZoom(q.id,254),Y.add(q.id);break;case 0:Z.setLabelMinZoom(q.id,0),Y.add(q.id)}}else Z.setLabelMinZoom(q.id,254)})}_collideInvisible(R,H){const j=H.featuresView.attributeView,Z=new Set;O(H,(Y,$)=>{for(;$.nextId();)if(!Z.has($.id)&&j.getLabelMinZoom($.id)===N)switch(R.insertMetrics($)){case 1:break;case 2:j.setLabelMinZoom($.id,N),Z.add($.id);break;case 0:j.setLabelMinZoom($.id,0),Z.add($.id)}})}_transformMetrics(R){for(const{tileRenderer:H,geometryType:j,vvEvaluators:Z}of R)O(H,(Y,$)=>{const q=H.featuresView.attributeView,it=Y.transforms.labelMat2d;it[4]=Math.round(it[4]),it[5]=Math.round(it[5]);const pt="polyline"===j;for(;$.next();){const at=$.boundsCount,ft=$.anchorX,lt=$.anchorY;let gt=$.size;const tt=Z[0];if(null!=tt){const k=tt(q.getVVSize($.id));gt=isNaN(k)||null==k||k===1/0?gt:k}const yt=$.directionX*(gt/2),g=$.directionY*(gt/2);for(let k=0;k<at;k++){let ht=ft,ut=$.anchorY;if(pt){let vt=ht+$.boundsX(k)+yt,dt=ut+$.boundsY(k)+g;vt=it[0]*vt+it[2]*dt+it[4],dt=it[1]*vt+it[3]*dt+it[5],$.setBoundsComputedAnchorX(k,Math.floor(vt)),$.setBoundsComputedAnchorY(k,Math.floor(dt))}else{ht=it[0]*ft+it[2]*lt+it[4],ut=it[1]*ft+it[3]*lt+it[5];const vt=ht+$.boundsX(k)+yt,dt=ut+$.boundsY(k)+g;$.setBoundsComputedAnchorX(k,vt),$.setBoundsComputedAnchorY(k,dt)}}}})}}let Q=class extends v.Z{constructor(ot){super(ot),this.collisionEngine=new G,this.lastUpdateId=-1,this.updateRequested=!1,this.view=null,this._applyVisibilityPass=(0,C.P)(R=>{const H=this.view;if(H)try{const j=H.featuresTilingScheme.getClosestInfoForScale(R.state.scale).level;this.collisionEngine.run(H.allLayerViews.items,R,j)}catch{}},32,this),this.addHandles(this._applyVisibilityPass)}get updating(){return(0,w.Z)("esri-2d-log-updating")&&console.log(`Updating LabelManager ${this.updateRequested}:\n-> updateRequested: ${this.updateRequested}`),this.updateRequested}update(ot){this._applyVisibilityPass(ot)}viewChange(){this.requestUpdate()}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view?.requestUpdate())}processUpdate(ot){this.updateRequested&&(this.updateRequested=!1,this.update(ot))}};(0,I._)([(0,b.Cb)()],Q.prototype,"updateRequested",void 0),(0,I._)([(0,b.Cb)()],Q.prototype,"updating",null),(0,I._)([(0,b.Cb)()],Q.prototype,"view",void 0),Q=(0,I._)([(0,e.j)("esri.views.2d.LabelManager")],Q)},17866:(rt,K,o)=>{var I,v,E,w;o.d(K,{Fr:()=>E,_K:()=>v,al:()=>I}),(w=I||(I={}))[w.FILL=1]="FILL",w[w.LINE=2]="LINE",w[w.SYMBOL=3]="SYMBOL",w[w.CIRCLE=4]="CIRCLE",function(w){w[w.BACKGROUND=0]="BACKGROUND",w[w.FILL=1]="FILL",w[w.OUTLINE=2]="OUTLINE",w[w.LINE=3]="LINE",w[w.ICON=4]="ICON",w[w.CIRCLE=5]="CIRCLE",w[w.TEXT=6]="TEXT",w[w.TILEINFO=7]="TILEINFO"}(v||(v={})),function(w){w[w.PAINTER_CHANGED=0]="PAINTER_CHANGED",w[w.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",w[w.LAYER_CHANGED=2]="LAYER_CHANGED",w[w.LAYER_REMOVED=3]="LAYER_REMOVED",w[w.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(E||(E={}))},38550:(rt,K,o)=>{o.d(K,{w:()=>A});const I={background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform lowp sampler2D u_texture;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main() {\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = u_opacity * color;\n#else\ngl_FragColor = u_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","background.vert":"precision mediump float;\nattribute vec2 a_pos;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\nuniform mediump vec4 u_tlbr;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\n#endif\nvoid main() {\ngl_Position = vec4((u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0)).xy, u_depth, 1.0);\n#ifdef PATTERN\nv_tileTextureCoord = (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\nv_tlbr             = u_tlbr / u_mosaicSize.xyxy;\n#endif\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n}"},circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float dist = length(v_offset);\nmediump float alpha = smoothstep(0.0, -v_blur, dist - 1.0);\nlowp float color_mix_ratio = v_stroke_width < 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\ngl_FragColor = alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","circle.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_circleTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_stroke_color = stroke_color * stroke_opacity;\nv_stroke_width = stroke_width;\nv_radius = radius;\nv_blur = max(blur, u_antialiasingWidth / (radius + stroke_width));\nmediump vec2 offset = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\nv_offset = offset;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos * 0.5, 1.0) + u_displayMat3 * vec3((v_radius + v_stroke_width) * offset + u_circleTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = fract(v_tileTextureCoord);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = v_color[3] * color;\n#else\ngl_FragColor = v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","fill.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_fillTranslation;\n#ifdef PATTERN\n#include <util/util.glsl>\nuniform mediump vec2 u_mosaicSize;\nuniform mediump float u_patternFactor;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n#ifdef PATTERN\nfloat patternWidth = nextPOT(tlbr.z - tlbr.x);\nfloat patternHeight = nextPOT(tlbr.w - tlbr.y);\nfloat scaleX = 1.0 / (patternWidth * u_patternFactor);\nfloat scaleY = 1.0 / (patternHeight * u_patternFactor);\nmat3 patterMat = mat3(scaleX, 0.0,    0.0,\n0.0,    -scaleY, 0.0,\n0.0,    0.0,    1.0);\nv_tileTextureCoord = (patterMat * vec3(a_pos, 1.0)).xy;\nv_tlbr             = tlbr / u_mosaicSize.xyxy;\n#endif\nvec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump flaot v_halo_width;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\n#include <util/encoding.glsl>\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\nlowp vec4 fillPixelColor = v_color;\nfloat d = rgba2float(texture2D(u_texture, v_tex)) - 0.5;\nconst float softEdgeRatio = 0.248062016;\nfloat size = max(v_size.x, v_size.y);\nfloat dist = d * softEdgeRatio * size;\nfillPixelColor *= clamp(0.5 - dist, 0.0, 1.0);\nif (v_halo_width > 0.25) {\nlowp vec4 outlinePixelColor = u_outlineColor;\nconst float outlineLimitRatio = (16.0 / 86.0);\nfloat clampedOutlineSize = softEdgeRatio * min(v_halo_width, outlineLimitRatio * max(v_size.x, v_size.y));\noutlinePixelColor *= clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\ngl_FragColor = v_opacity * mixColors(fillPixelColor, outlinePixelColor);\n}\nelse {\ngl_FragColor = v_opacity * fillPixelColor;\n}\n#else\nlowp vec4 texColor = texture2D(u_texture, v_tex);\ngl_FragColor = v_opacity * texColor;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump float v_halo_width;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_iconTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION = 1.0 / 8.0;\nconst float C_256_TO_RAD = 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD = 3.14159265359 / 180.0;\nconst float tileCoordRatio = 1.0 / 8.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nv_color = color;\nv_opacity = opacity;\n#ifdef SDF\nv_halo_width = halo_width;\n#endif\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_opacity *= interpolatedOpacity;\nmediump float a_angle         = a_levelInfo[1];\nmediump float a_minLevel      = a_levelInfo[2];\nmediump float a_maxLevel      = a_levelInfo[3];\nmediump vec2 a_tex            = a_texAngleRange.xy;\nmediump float delta_z = 0.0;\nmediump float rotated = mod(a_angle + u_mapRotation, 256.0);\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_opacity, 0.0);\nvec2 offset = C_OFFSET_PRECISION * a_vertexOffset;\nv_size = abs(offset);\n#ifdef SDF\noffset = (120.0 / 86.0) * offset;\n#endif\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayViewMat3 * vec3(size * offset, 0.0) + u_displayMat3 * vec3(u_iconTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_tex = a_tex.xy / u_mosaicSize;\n}"},line:{"line.frag":"precision lowp float;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#if defined (PATTERN) || defined(SDF)\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\nuniform sampler2D u_texture;\nuniform mediump float u_antialiasing;\n#endif\n#ifdef SDF\n#include <util/encoding.glsl>\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float fragDist = length(v_normal) * v_lineHalfWidth;\nlowp float alpha = clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\nmediump float relativeTexX = fract(v_accumulatedDistance / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY = 0.5 + v_normal.y * v_lineHalfWidth / (v_patternSize.y * v_widthRatio);\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color = texture2D(u_texture, texCoord);\ngl_FragColor = alpha * v_color[3] * color;\n#elif defined(SDF)\nmediump float relativeTexX = fract((v_accumulatedDistance * 0.5) / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY =  0.5 + 0.25 * v_normal.y;\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d = rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist = d * (v_lineHalfWidth + u_antialiasing / 2.0);\ngl_FragColor = alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n#else\ngl_FragColor = alpha * v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","line.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_extrude_offset;\nattribute vec4 a_dir_normal;\nattribute vec2 a_accumulatedDistance;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump float u_zoomFactor;\nuniform mediump vec2 u_lineTranslation;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale = 1.0 / 31.0;\nconst mediump float tileCoordRatio = 8.0;\n#if defined (SDF)\nconst mediump float sdfPatternHalfWidth = 15.5;\n#endif\n#if defined (PATTERN) || defined(SDF)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_blur = blur + u_antialiasing;\nv_normal = a_dir_normal.zw * scale;\n#if defined (PATTERN) || defined(SDF)\nv_tlbr          = tlbr / u_mosaicSize.xyxy;\nv_patternSize   = vec2(tlbr.z - tlbr.x, tlbr.y - tlbr.w);\n#if defined (PATTERN)\nv_widthRatio = width / v_patternSize.y;\n#else\nv_widthRatio = width / sdfPatternHalfWidth / 2.0;\n#endif\n#endif\nv_lineHalfWidth = (width + u_antialiasing) * 0.5;\nmediump vec2 dir = a_dir_normal.xy * scale;\nmediump vec2 offset_ = a_extrude_offset.zw * scale * offset;\nmediump vec2 dist = v_lineHalfWidth * scale * a_extrude_offset.xy;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos + offset_ * tileCoordRatio / u_zoomFactor, 1.0) + u_displayViewMat3 * vec3(dist, 0.0) + u_displayMat3 * vec3(u_lineTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n#if defined (PATTERN) || defined(SDF)\nv_accumulatedDistance = a_accumulatedDistance.x * u_zoomFactor / tileCoordRatio + dot(dir, dist + offset_);\n#endif\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n}"},outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist = abs(v_normal.y);\nlowp float alpha = smoothstep(1.0, 0.0, dist);\ngl_FragColor = alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_fillTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale = 1.0 / 15.0;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_normal = a_xnormal;\nmediump vec2 dist = u_outline_width * scale * a_offset;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(dist + u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},text:{"text.frag":"uniform lowp sampler2D u_texture;\nvarying lowp vec2 v_tex;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist = texture2D(u_texture, v_tex).a;\nmediump float alpha = smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist);\ngl_FragColor = alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_textTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying lowp vec2 v_tex;\nconst float offsetPrecision = 1.0 / 8.0;\nconst mediump float edgePos = 0.75;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nconst float sdfFontScale = 1.0 / 24.0;\nconst float sdfPixel = 3.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nif (u_halo > 0.5)\n{\nv_color = halo_color * opacity;\nhalo_width *= sdfPixel;\nhalo_blur *= sdfPixel;\n}\nelse\n{\nv_color = color * opacity;\nhalo_width = 0.0;\nhalo_blur = 0.0;\n}\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_color *= interpolatedOpacity;\nmediump float a_angle       = a_levelInfo[1];\nmediump float a_minLevel    = a_levelInfo[2];\nmediump float a_maxLevel    = a_levelInfo[3];\nmediump vec2 a_tex          = a_texAngleRange.xy;\nmediump float a_visMinAngle    = a_texAngleRange.z;\nmediump float a_visMaxAngle    = a_texAngleRange.w;\nmediump float delta_z = 0.0;\nmediump float angle = mod(a_angle + u_mapRotation, 256.0);\nif (a_visMinAngle < a_visMaxAngle)\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) + (1.0 - step(a_visMinAngle, angle)));\n}\nelse\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) * (1.0 - step(a_visMinAngle, angle)));\n}\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_color[3], 0.0);\nv_tex = a_tex.xy / u_mosaicSize;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_edgeDistance = edgePos - halo_width / size;\nv_edgeWidth = (u_antialiasingWidth + halo_blur) / size;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + sdfFontScale * u_displayViewMat3 * vec3(offsetPrecision * size * a_vertexOffset, 0.0) + u_displayMat3 * vec3(u_textTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n}"},util:{"encoding.glsl":"const vec4 rgba2float_factors = vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}","util.glsl":"float nextPOT(in float x) {\nreturn pow(2.0, ceil(log2(abs(x))));\n}"}},w=new(o(52190).B)(function E(C){let b=I;return C.split("/").forEach(P=>{b&&(b=b[P])}),b});function A(C){return w.resolveIncludes(C)}},2902:(rt,K,o)=>{o.d(K,{Q:()=>b,g:()=>A});var I=o(14007),v=o(51172),E=o(28798);const w=(0,I.Z)("esri-2d-log-allocations");class A{constructor(a,e){this._array=a,this._pool=e}get array(){return this._array}get length(){return this._array.length}static create(a,e){const c=e.acquire(a);return new A(c,e)}expand(a){const e=this._pool.acquire(a);e.set(this._array),this._pool.release(this._array),this._array=e}destroy(){this._pool.release(this._array)}set(a,e){this._array.set(a._array,e)}slice(){const a=this._pool.acquire(this._array.byteLength);return a.set(this._array),new A(a,this._pool)}}class C{constructor(){this._data=new ArrayBuffer(C.BYTE_LENGTH),this._freeList=new E.m({start:0,end:this._data.byteLength})}static get BYTE_LENGTH(){return 64e6}get buffer(){return this._data}allocate(a){const e=this._freeList.firstFit(a);return null==e?null:new Uint32Array(this._data,e,a/Uint32Array.BYTES_PER_ELEMENT)}free(a){this._freeList.free(a.byteOffset,a.byteLength)}}class b{constructor(){this._bytesAllocated=0,this._pages=[],this._pagesByBuffer=new Map,this._addPage()}destroy(){this._pages=[],this._pagesByBuffer=null}get _bytesTotal(){return this._pages.length*C.BYTE_LENGTH}acquire(a){if(this._bytesAllocated+=a,w&&console.log(`Allocating ${a}, (${this._bytesAllocated} / ${this._bytesTotal})`),a>C.BYTE_LENGTH)return new Uint32Array(a/Uint32Array.BYTES_PER_ELEMENT);for(const c of this._pages){const l=c.allocate(a);if(null!=l)return l}const e=this._addPage().allocate(a);return(0,v.O3)(e,"Expected to allocate page"),e}release(a){this._bytesAllocated-=a.byteLength,w&&console.log(`Freeing ${a.byteLength}, (${this._bytesAllocated} / ${this._bytesTotal})`);const e=this._pagesByBuffer.get(a.buffer);e&&e.free(a)}_addPage(){const a=new C;return this._pages.push(a),this._pagesByBuffer.set(a.buffer,a),a}}},7081:(rt,K,o)=>{o.d(K,{Q:()=>C});var I=o(90295),v=o(88278),E=o(14007),w=o(13646);const A=(0,E.Z)("esri-2d-profiler");class C{constructor(P,a){if(this._events=new v.Z,this._entries=new Map,this._timings=new I.Z(10),this._currentContainer=null,this._currentPass=null,this._currentBrush=null,this._currentSummary=null,!A)return;this._ext=(0,w.mO)(P.gl,{}),this._debugOutput=a;const e=P.gl;if(!this.enableCommandLogging)return;let c;for(c in e)if("function"==typeof e[c]){const l=e[c],m=c.includes("draw");e[c]=(...D)=>(this._events.emit("command",{container:this._currentContainer,pass:this._currentPass,brush:this._currentBrush,method:c,args:D,isDrawCommand:m}),this._currentSummary&&(this._currentSummary.commands++,m&&this._currentSummary.drawCommands++),l.apply(e,D))}}get enableCommandLogging(){return!("object"==typeof A&&A.disableCommands)}recordContainerStart(P){A&&(this._currentContainer=P)}recordContainerEnd(){A&&(this._currentContainer=null)}recordPassStart(P){A&&(this._currentPass=P,this._initSummary())}recordPassEnd(){A&&(this._currentPass=null,this._emitSummary())}recordBrushStart(P){A&&(this._currentBrush=P)}recordBrushEnd(){A&&(this._currentBrush=null)}recordStart(P){if(A&&null!=this._ext){if(this._entries.has(P)){const e=this._entries.get(P),c=this._ext.resultAvailable(e.query),l=this._ext.disjoint();if(c&&!l){const m=this._ext.getResult(e.query)/1e6;let D=0;if(null!=this._timings.enqueue(m)){const X=this._timings.entries,x=X.length;let S=0;for(const U of X)S+=U;D=S/x}const V=m.toFixed(2),T=D?D.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed(`Frame report for ${P}, ${V} ms (${T} last 10 avg)\n${e.commandsLen} Commands (${e.drawCommands} draw)`),console.log("RenderPass breakdown: "),console.table(e.summaries),console.log("Commands: ",e.commands),console.groupEnd()):console.log(`Frame report for ${P}, ${V} ms (${T} last 10 avg)`),this._debugOutput.innerHTML=`${V} (${T})`}for(const m of e.handles)m.remove();this._ext.deleteQuery(e.query),this._entries.delete(P)}const a={name:P,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(a.handles.push(this._events.on("command",e=>{a.commandsLen++,a.commands.push(e),e.isDrawCommand&&a.drawCommands++})),a.handles.push(this._events.on("summary",e=>{a.summaries.push(e)}))),this._ext.beginTimeElapsed(a.query),this._entries.set(P,a)}}recordEnd(P){A&&null!=this._ext&&this._entries.has(P)&&this._ext.endTimeElapsed()}_initSummary(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})}_emitSummary(){this.enableCommandLogging&&this._currentSummary&&this._events.emit("summary",this._currentSummary)}}},68359:(rt,K,o)=>{o.d(K,{Z:()=>et});var I=o(15861),v=o(11931),E=o(66476),w=o(19939),A=o(57964),C=o(56123),b=o(14007),P=o(4703),a=o(55117),e=o(79412),c=o(55768),l=o(6785),m=o(46033),D=o(7077),V=o(29340),T=o(99657),X=o(43101),x=o(46117);class S{constructor(t,s){this._width=0,this._height=0,this._free=[],this._width=t,this._height=s,this._free.push(new x.Z(0,0,t,s))}get width(){return this._width}get height(){return this._height}allocate(t,s){if(t>this._width||s>this._height)return new x.Z;let i=null,d=-1;for(let _=0;_<this._free.length;++_){const h=this._free[_];t<=h.width&&s<=h.height&&(null===i||h.y<=i.y&&h.x<=i.x)&&(i=h,d=_)}return null===i?new x.Z:(this._free.splice(d,1),i.width<i.height?(i.width>t&&this._free.push(new x.Z(i.x+t,i.y,i.width-t,s)),i.height>s&&this._free.push(new x.Z(i.x,i.y+s,i.width,i.height-s))):(i.width>t&&this._free.push(new x.Z(i.x+t,i.y,i.width-t,i.height)),i.height>s&&this._free.push(new x.Z(i.x,i.y+s,t,i.height-s))),new x.Z(i.x,i.y,t,s))}release(t){for(let s=0;s<this._free.length;++s){const i=this._free[s];if(i.y===t.y&&i.height===t.height&&i.x+i.width===t.x)i.width+=t.width;else if(i.x===t.x&&i.width===t.width&&i.y+i.height===t.y)i.height+=t.height;else if(t.y===i.y&&t.height===i.height&&t.x+t.width===i.x)i.x=t.x,i.width+=t.width;else{if(t.x!==i.x||t.width!==i.width||t.y+t.height!==i.y)continue;i.y=t.y,i.height+=t.height}this._free.splice(s,1),this.release(t)}this._free.push(t)}}var U=o(39237),N=o(17091),z=o(22784);const G=L=>Math.floor(L/256);class R{constructor(t,s,i){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphCache={},this._textures=[],this._rangePromises=new Map,this._preloadCache={},this.width=t,this.height=s,this._glyphSource=i,this._binPack=new S(t-4,s-4),this._glyphData.push(new Uint8Array(t*s)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyphs()}dispose(){this._binPack=null;for(const t of this._textures)t&&t.dispose();this._textures.length=0,this._glyphData.length=0}_initDecorationGlyphs(){const t=[117,149,181,207,207,181,149,117],s=[],i=[];for(let h=0;h<t.length;h++){const y=t[h];for(let W=0;W<11;W++){const B=h>=3&&h<5&&W>=3&&W<8?255:0;s.push(y),i.push(B)}}const d={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(s)},_={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(i)};this._recordGlyph(d),this._recordGlyph(_)}getGlyphItems(t,s,i){var d=this;return(0,I.Z)(function*(){const _=d._getGlyphCache(t);return yield d._fetchRanges(t,s,i),s.map(h=>d._getMosaicItem(_,t,h))})()}bind(t,s,i,d){const _=this._getTexture(t,i);_.setSamplingMode(s),this._dirties[i]&&(_.setData(this._glyphData[i]),this._dirties[i]=!1),t.bindTexture(_,d)}preloadASCIIGlyphCache(t){const s=this._preloadCache[t];if(null!=s)return s;const i=this._glyphSource.preloadASCIIRange(t).then(()=>{const d=this._getGlyphCache(t);for(let _=0;_<256;_++)this._getMosaicItem(d,t,_)});return this._preloadCache[t]=i,i}_getGlyphCache(t){return this._glyphCache[t]||(this._glyphCache[t]={}),this._glyphCache[t]}_getTexture(t,s){if(!this._textures[s]){const i=new z.X;i.pixelFormat=U.VI.ALPHA,i.wrapMode=U.e8.CLAMP_TO_EDGE,i.width=this.width,i.height=this.height,this._textures[s]=new N.x(t,i,new Uint8Array(this.width*this.height))}return this._textures[s]}_invalidate(){this._dirties[this._currentPage]=!0}_fetchRanges(t,s,i){var d=this;return(0,I.Z)(function*(){const _=function J(L){const t=new Set;for(const s of L)t.add(G(s));return t}(s),h=[];_.forEach(y=>{h.push(d._fetchRange(t,y,i))}),yield Promise.all(h)})()}_fetchRange(t,s,i){var d=this;return(0,I.Z)(function*(){if(!(s>256))return function Q(L,t,s){return L.has(t)||L.set(t,s().then(()=>{L.delete(t)}).catch(i=>{L.delete(t),(0,e.H9)(i)})),L.get(t)}(d._rangePromises,t+s,()=>d._glyphSource.getRange(t,s,i))})()}_getMosaicItem(t,s,i){if(!t[i]){const d=this._glyphSource.getGlyph(s,i);if(!d?.metrics)return L=i,{rect:new x.Z(0,0,0,0),page:0,metrics:{left:0,width:0,height:0,advance:0,top:0},code:L,sdf:!0};const _=this._recordGlyph(d);t[i]={rect:_,page:this._currentPage,metrics:d.metrics,code:i,sdf:!0},this._invalidate()}var L;return t[i]}_recordGlyph(t){const s=t.metrics;let i;if(0===s.width)i=new x.Z(0,0,0,0);else{const _=s.width+6,h=s.height+6;i=this._binPack.allocate(_,h),i.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyphs(),this._binPack=new S(this.width-4,this.height-4),i=this._binPack.allocate(_,h));const y=this._glyphData[this._currentPage],W=t.bitmap;let B,st;if(W)for(let ct=0;ct<h;ct++){B=_*ct,st=this.width*(i.y+ct)+i.x;for(let nt=0;nt<_;nt++)y[st+nt]=W[B+nt]}(0,b.Z)("esri-glyph-debug")&&this._showDebugPage(y)}return i}_showDebugPage(t){const s=document.createElement("canvas"),i=s.getContext("2d"),d=new ImageData(this.width,this.height),_=d.data;s.width=this.width,s.height=this.height,s.style.border="1px solid black";for(let h=0;h<t.length;++h)_[4*h]=t[h],_[4*h+1]=0,_[4*h+2]=0,_[4*h+3]=255;i.putImageData(d,0,0),document.body.appendChild(s)}}var H=o(40485);class j{constructor(t){for(this._metrics=[],this._bitmaps=[];t.next();)switch(t.tag()){case 1:{const s=t.getMessage();for(;s.next();)switch(s.tag()){case 3:{const i=s.getMessage();let d,_,h,y,W,B,st;for(;i.next();)switch(i.tag()){case 1:d=i.getUInt32();break;case 2:_=i.getBytes();break;case 3:h=i.getUInt32();break;case 4:y=i.getUInt32();break;case 5:W=i.getSInt32();break;case 6:B=i.getSInt32();break;case 7:st=i.getUInt32();break;default:i.skip()}i.release(),d&&(this._metrics[d]={width:h,height:y,left:W,top:B,advance:st},this._bitmaps[d]=_);break}default:s.skip()}s.release();break}default:t.skip()}}getMetrics(t){return this._metrics[t]}getBitmap(t){return this._bitmaps[t]}}class Z{constructor(){this._ranges=[]}getRange(t){return this._ranges[t]}addRange(t,s){this._ranges[t]=s}}class Y{constructor(t){this._glyphInfo={},this._baseURL=t}getRange(t,s,i){const d=this._getFontStack(t);if(d.getRange(s))return Promise.resolve();const _=256*s,h=_+255,y=this._baseURL.replace("{fontstack}",t).replace("{range}",_+"-"+h);return(0,E.Z)(y,{responseType:"array-buffer",...i}).then(W=>{d.addRange(s,new j(new H.Z(new Uint8Array(W.data),new DataView(W.data))))})}preloadASCIIRange(t){var s=this;return(0,I.Z)(function*(){const i=s._getFontStack(t),h=s._baseURL.replace("{fontstack}",t).replace("{range}","0-255"),y=yield(0,E.Z)(h,{responseType:"array-buffer"}),W=new j(new H.Z(new Uint8Array(y.data),new DataView(y.data)));for(let B=0;B<=255;B++)i.getRange(B)||i.addRange(B,W)})()}getGlyph(t,s){const i=this._getFontStack(t);if(!i)return;const d=Math.floor(s/256),_=i.getRange(d);return _?{metrics:_.getMetrics(s),bitmap:_.getBitmap(s)}:void 0}_getFontStack(t){let s=this._glyphInfo[t];return s||(s=this._glyphInfo[t]=new Z),s}}var $=o(11462);const q=1e20;class it{constructor(t){this._svg=null,this.size=t;const s=document.createElement("canvas");s.width=s.height=t,this._context=s.getContext("2d",{willReadFrequently:!1}),this._gridOuter=new Float64Array(t*t),this._gridInner=new Float64Array(t*t),this._f=new Float64Array(t),this._d=new Float64Array(t),this._z=new Float64Array(t+1),this._v=new Int16Array(t)}dispose(){this._context=this._gridOuter=this._gridInner=this._f=this._d=this._z=this._v=null,this._svg&&(document.body.removeChild(this._svg),this._svg=null)}draw(t,s,i,d=31){this._initSVG();const _=this.createSVGString(t,s);return new Promise((h,y)=>{const W=new Image;W.src="data:image/svg+xml; charset=utf8, "+encodeURIComponent(_),W.onload=()=>{W.onload=null,this._context.clearRect(0,0,this.size,this.size),this._context.drawImage(W,0,0,this.size,this.size);const st=this._context.getImageData(0,0,this.size,this.size),ct=new Uint8Array(this.size*this.size*4);for(let nt=0;nt<this.size*this.size;nt++){const _t=st.data[4*nt+3]/255;this._gridOuter[nt]=1===_t?0:0===_t?q:Math.max(0,.5-_t)**2,this._gridInner[nt]=1===_t?q:0===_t?0:Math.max(0,_t-.5)**2}this._edt(this._gridOuter,this.size,this.size),this._edt(this._gridInner,this.size,this.size);for(let nt=0;nt<this.size*this.size;nt++)(0,$.I)(.5-(this._gridOuter[nt]-this._gridInner[nt])/(2*d),ct,4*nt);h(ct)};const B=i?.signal;B&&(0,e.fu)(B,()=>y((0,e.zE)()))})}_initSVG(){if(!this._svg){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("style","position: absolute;"),t.setAttribute("width","0"),t.setAttribute("height","0"),t.setAttribute("aria-hidden","true"),t.setAttribute("role","presentation"),document.body.appendChild(t),this._svg=t}return this._svg}createSVGString(t,s){const i=this._initSVG(),d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d",t),i.appendChild(d);const _=d.getBBox(),h=_.width/_.height,y=this.size/2;let W,B,st;h>1?(W=y/_.width,B=this.size/4,st=y-y*(1/h)/2):(W=y/_.height,B=y-y*h/2,st=this.size/4),d.setAttribute("style",`transform: matrix(${W}, 0, 0, ${W}, ${-_.x*W+B}, ${-_.y*W+st})`),d.setAttribute("stroke-width",""+.5/W);const _t=`<svg style="fill:${s?"red":"none"}; stroke:${s?"none":"red"}" height="${this.size}" width="${this.size}" xmlns="http://www.w3.org/2000/svg">${i.innerHTML}</svg>`;return i.removeChild(d),_t}_edt(t,s,i){const d=this._f,_=this._d,h=this._v,y=this._z;for(let W=0;W<s;W++){for(let B=0;B<i;B++)d[B]=t[B*s+W];this._edt1d(d,_,h,y,i);for(let B=0;B<i;B++)t[B*s+W]=_[B]}for(let W=0;W<i;W++){for(let B=0;B<s;B++)d[B]=t[W*s+B];this._edt1d(d,_,h,y,s);for(let B=0;B<s;B++)t[W*s+B]=Math.sqrt(_[B])}}_edt1d(t,s,i,d,_){i[0]=0,d[0]=-q,d[1]=+q;for(let h=1,y=0;h<_;h++){let W=(t[h]+h*h-(t[i[y]]+i[y]*i[y]))/(2*h-2*i[y]);for(;W<=d[y];)y--,W=(t[h]+h*h-(t[i[y]]+i[y]*i[y]))/(2*h-2*i[y]);y++,i[y]=h,d[y]=W,d[y+1]=+q}for(let h=0,y=0;h<_;h++){for(;d[y+1]<h;)y++;s[h]=(h-i[y])*(h-i[y])+t[i[y]]}}}var pt=o(69425);function at(L){return L&&"static"===L.type}class ft{constructor(t,s,i=0){this._mosaicPages=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects=new Map,this._spriteCopyQueue=[],this.pixelRatio=1,(t<=0||s<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=t,this._pageHeight=s,i>0&&(this._maxItemSize=i),this.pixelRatio=window.devicePixelRatio||1,this._binPack=new S(this._pageWidth,this._pageHeight);const d=Math.floor(this._pageWidth),_=Math.floor(this._pageHeight);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(d*_)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0})}getWidth(t){return t>=this._mosaicPages.length?-1:this._mosaicPages[t].size[0]}getHeight(t){return t>=this._mosaicPages.length?-1:this._mosaicPages[t].size[1]}getPageTexture(t){return t<this._mosaicPages.length?this._mosaicPages[t].texture:null}has(t){return this._mosaicRects.has(t)}get itemCount(){return this._mosaicRects.size}getSpriteItem(t){return this._mosaicRects.get(t)}addSpriteItem(t,s,i,d,_,h,y=1){if(this._mosaicRects.has(t))return this._mosaicRects.get(t);let W,B,st;if(at(i)?[W,B,st]=this._allocateImage(s[0],s[1]):(W=new x.Z(0,0,s[0],s[1]),B=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:i,size:[s[0]+2*T.s4,s[1]+2*T.s4],dirty:!0,texture:void 0})),W.width<=0||W.height<=0)return null;const ct={rect:W,width:s[0],height:s[1],sdf:_,simplePattern:h,pixelRatio:y,page:B};return this._mosaicRects.set(t,ct),at(i)&&((0,b.Z)("esri-mosaic-debug")&&this._showDebugSprite(s,i.data),this._copy({rect:W,spriteSize:s,spriteData:i.data,page:B,pageSize:st,repeat:d,sdf:_})),ct}hasItemsToProcess(){return 0!==this._spriteCopyQueue.length}processNextItem(){const t=this._spriteCopyQueue.pop();t&&this._copy(t)}getSpriteItems(t){const s={};for(const i of t)s[i]=this.getSpriteItem(i);return s}getMosaicItemPosition(t){const s=this.getSpriteItem(t),i=s?.rect;if(!i)return null;i.width=s.width,i.height=s.height;const h=T.s4,y=this._mosaicPages[s.page].size;return{size:[s.width,s.height],tl:[(i.x+h)/y[0],(i.y+h)/y[1]],br:[(i.x+h+s.width)/y[0],(i.y+h+s.height)/y[1]],page:s.page}}bind(t,s,i=0,d=0){const _=this._mosaicPages[i],h=_.mosaicsData;let y=_.texture;y||(y=function gt(L,t){const s=new z.X;return s.width=t[0],s.height=t[1],s.wrapMode=U.e8.CLAMP_TO_EDGE,new N.x(L,s,null)}(t,_.size),_.texture=y),y.setSamplingMode(s),at(h)?(t.bindTexture(y,d),_.dirty&&(y.setData(new Uint8Array(h.data.buffer)),y.generateMipmap(),(0,b.Z)("esri-mosaic-debug")&&this._showDebugPage(i))):(h.data.bindFrame(t,y,d),y.generateMipmap()),_.dirty=!1}dispose(){this._binPack=null;for(const t of this._mosaicPages){const s=t.texture;s&&s.dispose();const i=t.mosaicsData;at(i)||i.data.destroy()}this._mosaicPages=null,this._mosaicRects.clear()}static _copyBits(t,s,i,d,_,h,y,W,B,st,ct){let nt=d*s+i,_t=W*h+y;if(ct){_t-=h;for(let mt=-1;mt<=st;mt++,nt=((mt+st)%st+d)*s+i,_t+=h)for(let wt=-1;wt<=B;wt++)_[_t+wt]=t[nt+(wt+B)%B]}else for(let mt=0;mt<st;mt++){for(let wt=0;wt<B;wt++)_[_t+wt]=t[nt+wt];nt+=s,_t+=h}}_copy(t){if(t.page>=this._mosaicPages.length)return;const s=this._mosaicPages[t.page],i=s.mosaicsData;if(!at(s.mosaicsData))throw new A.Z("mapview-invalid-resource","unsuitable data type!");const d=t.spriteData,_=i.data;_&&d||console.error("Source or target images are uninitialized!"),ft._copyBits(d,t.spriteSize[0],0,0,_,t.pageSize[0],t.rect.x+T.s4,t.rect.y+T.s4,t.spriteSize[0],t.spriteSize[1],t.repeat),s.dirty=!0}_allocateImage(t,s){t+=2*T.s4,s+=2*T.s4;const i=Math.max(t,s);if(this._maxItemSize&&this._maxItemSize<i){const _=2**Math.ceil((0,pt.k3)(t)),h=2**Math.ceil((0,pt.k3)(s)),y=new x.Z(0,0,t,s);return this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(_*h)},size:[_,h],dirty:!0,texture:void 0}),[y,this._mosaicPages.length-1,[_,h]]}const d=this._binPack.allocate(t,s);if(d.width<=0){const _=this._mosaicPages[this._currentPage];return!_.dirty&&at(_.mosaicsData)&&(_.mosaicsData.data=null),this._currentPage=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(this._pageWidth*this._pageHeight)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0}),this._binPack=new S(this._pageWidth,this._pageHeight),this._allocateImage(t,s)}return[d,this._currentPage,[this._pageWidth,this._pageHeight]]}_showDebugSprite([t,s],i){const d=document.createElement("canvas");d.width=t,d.height=s,d.setAttribute("style",`position: absolute; top: ${4+204*lt++}px; right: 208px; width: 200px; height: 200px; border: 1px solid black;`);const _=d.getContext("2d"),h=new ImageData(t,s);h.data.set(new Uint8Array(i.buffer)),_.putImageData(h,0,0),document.body.appendChild(d)}_showDebugPage(t){const s=this._mosaicPages[t],{size:[i,d],mosaicsData:_}=s;if(!at(_))return void console.error("Could not show sprite mosaic debug for non-static resource");const h=`mosaicDebugPage${t}`,y=document.getElementById(h)??document.createElement("canvas");y.id=h,y.width=i,y.height=d,y.setAttribute("style",`position: absolute; top: ${4+204*t}px; right: 4px; width: 200px; height: 200px; border: 1px solid black;`);const W=y.getContext("2d"),B=new ImageData(i,d);B.data.set(new Uint8Array(_.data.buffer)),W.putImageData(B,0,0),document.body.appendChild(y)}}let lt=0;var tt=o(32196),yt=o(23306);class g{constructor(t,s,i,d){this._animation=t,this._frameData=null,this.frameCount=this._animation.frameDurations.length,this.width=this._animation.width,this.height=this._animation.height,this._playHandle=(0,yt.hY)(this._animation,i,d,h=>{this._frameData=h,s.requestRender()})}destroy(){this._playHandle.remove()}bindFrame(t,s,i){t.bindTexture(s,i);const d=this._frameData;null!=d&&(s.updateData(0,T.s4,T.s4,"width"in d?d.width:d.codedWidth,"height"in d?d.height:d.codedHeight,d),this._frameData=null)}}var k=o(8027),ut=o(89178);const vt=(0,D.c)(),dt="arial-unicode-ms-regular",bt=P.Z.getLogger("esri.views.2d.engine.webgl.TextureManager");function p(L){const t=Math.round((0,c.F2)(L)*window.devicePixelRatio);return t*(t>=128?2:4)}function r(L,t){return Math.min(L,p(t))}function f(L,t){if(!L||!t)return{width:0,height:0};const s=L/t;if(s>1){const d=p(L);return{width:d,height:d/s}}const i=p(t);return{width:i*s,height:i}}const M=(L,t,s)=>bt.error(new A.Z(L,t,s));class F{static fromMosaic(t,s){return new F(t,s.page,s.sdf)}constructor(t,s,i){this.mosaicType=t,this.page=s,this.sdf=i}}class et{constructor(t,s,i){var d;this._requestRender=t,this.resourceManager=s,this._allowNonPowerOfTwo=i,this._invalidFontsMap=new Map,this._sdfConverter=new it(T.qu),this._bindingInfos=new Array,this._hashToBindingIndex=new Map,this._ongoingRasterizations=new Map,this._imageRequestQueue=new ut.e({concurrency:10,process:(d=(0,I.Z)(function*(_,h){(0,e.k_)(h);try{return yield(0,E.Z)(_,{responseType:"image",signal:h})}catch(y){throw(0,e.D_)(y)?y:new A.Z("mapview-invalid-resource",`Could not fetch requested resource at ${_}`,y)}}),function(h,y){return d.apply(this,arguments)})}),this._spriteMosaic=new ft(2048,2048,500),this._glyphSource=new Y(`${v.default.fontsUrl}/{fontstack}/{range}.pbf`),this._glyphMosaic=new R(1024,1024,this._glyphSource),this._rasterizer=new V.Z(s)}dispose(){this._spriteMosaic.dispose(),this._glyphMosaic.dispose(),this._rasterizer.dispose(),this._sdfConverter.dispose(),this._spriteMosaic=null,this._glyphMosaic=null,this._sdfConverter=null,this._hashToBindingIndex.clear(),this._hashToBindingIndex=null,this._bindingInfos=null,this._ongoingRasterizations.clear(),this._ongoingRasterizations=null,this._imageRequestQueue.clear(),this._imageRequestQueue=null}get sprites(){return this._spriteMosaic}get glyphs(){return this._glyphMosaic}rasterizeItem(t,s,i,d){var _=this;return(0,I.Z)(function*(){if(null==t)return M("mapview-null-resource","Unable to rasterize null resource"),null;switch(t.type){case"text":case"esriTS":{const h=yield _._rasterizeText(t,i,d);return h.forEach(y=>_._setTextureBinding(X.Un.GLYPH,y)),{glyphMosaicItems:h}}default:{if((0,tt.Ll)(t))return M("mapview-invalid-type",`MapView does not support symbol type: ${t.type}`,t),null;const h=yield _._rasterizeSpriteSymbol(t,s,d);return(0,k.ok)(h)&&h&&_._setTextureBinding(X.Un.SPRITE,h),{spriteMosaicItem:h}}}})()}bindTextures(t,s,i,d=!1){if(0===i.textureBinding)return;const _=this._bindingInfos[i.textureBinding-1],h=_.page,y=d?U.cw.LINEAR_MIPMAP_LINEAR:U.cw.LINEAR;switch(_.mosaicType){case X.Un.SPRITE:{const W=this.sprites.getWidth(h),B=this.sprites.getHeight(h),st=(0,m.s)(vt,W,B);return this._spriteMosaic.bind(t,y,h,T.Kt),s.setUniform1i("u_texture",T.Kt),void s.setUniform2fv("u_mosaicSize",st)}case X.Un.GLYPH:{const st=(0,m.s)(vt,this.glyphs.width,this.glyphs.height);return this._glyphMosaic.bind(t,y,h,T.wJ),s.setUniform1i("u_texture",T.wJ),void s.setUniform2fv("u_mosaicSize",st)}default:bt.error("mapview-texture-manager",`Cannot handle unknown type ${_.mosaicType}`)}}_hashMosaic(t,s){return 1|t<<1|(s.sdf?1:0)<<2|s.page<<3}_setTextureBinding(t,s){const i=this._hashMosaic(t,s);if(!this._hashToBindingIndex.has(i)){const d=F.fromMosaic(t,s);this._hashToBindingIndex.set(i,this._bindingInfos.length+1),this._bindingInfos.push(d)}s.textureBinding=this._hashToBindingIndex.get(i)}_rasterizeText(t,s,i){var d=this;return(0,I.Z)(function*(){let _,h;if("cim"in t)_=t.fontName,h=t.text;else{const B=t;_=(0,C.Yc)(B.font),h=B.text}const y=d._invalidFontsMap.has(_),W=s||(0,tt.Jq)((0,w.E)(h)[0]);try{const B=y?dt:_;return(0,b.Z)("esri-2d-stabilize-glyphs")&&(yield d._glyphMosaic.preloadASCIIGlyphCache(B)),yield d._glyphMosaic.getGlyphItems(B,W,i)}catch{return M("mapview-invalid-resource",`Couldn't find font ${_}. Falling back to Arial Unicode MS Regular`),d._invalidFontsMap.set(_,!0),d._glyphMosaic.getGlyphItems(dt,W,i)}})()}_rasterizeSpriteSymbol(t,s,i){var d=this;return(0,I.Z)(function*(){if((0,tt.Gg)(t))return;const _=function ht(L){switch(L.type){case"esriSMS":return`${L.style}.${L.path}`;case"esriSLS":return`${L.style}.${L.cap}`;case"esriSFS":return`${L.style}`;case"esriPFS":case"esriPMS":return L.imageData?`${L.imageData}${L.width}${L.height}`:`${L.url}${L.width}${L.height}`;default:return"mosaicHash"in L?L.mosaicHash:JSON.stringify(L)}}(t);if(d._spriteMosaic.has(_))return d._spriteMosaic.getSpriteItem(_);if((0,tt.sG)(t)||(0,tt.HX)(t)&&!(0,tt.yP)(t))return d._handleAsyncResource(_,t,i);const y=d._rasterizer.rasterizeJSONResource(t,T.FM);if(y){const{size:W,image:B,sdf:st,simplePattern:ct,rasterizationScale:nt}=y;return d._addItemToMosaic(_,W,{type:"static",data:B},(0,tt.js)(t),st,ct,nt)}return new A.Z("TextureManager","unrecognized or null rasterized image")})()}_handleAsyncResource(t,s,i){var d=this;return(0,I.Z)(function*(){if(d._ongoingRasterizations.has(t))return d._ongoingRasterizations.get(t);let _;_=(0,tt.sG)(s)?d._handleSVG(s,t,i):d._handleImage(s,t,i),d._ongoingRasterizations.set(t,_);try{yield _,d._ongoingRasterizations.delete(t)}catch{d._ongoingRasterizations.delete(t)}return _})()}_handleSVG(t,s,i){var d=this;return(0,I.Z)(function*(){const _=[T.qu,T.qu],h=!("cim"in t)||t.cim.asFill,y=yield d._sdfConverter.draw(t.path,h,i);return d._addItemToMosaic(s,_,{type:"static",data:new Uint32Array(y.buffer)},!1,!0,!0)})()}_handleGIFOrPNG(t,s,i){var d=this;return(0,I.Z)(function*(){const _=(0,tt.Gr)(t);yield d.resourceManager.fetchResource(_,i);let h=d.resourceManager.getResource(_);if(null==h)return new A.Z("mapview-invalid-resource",`Could not fetch requested resource at ${_}.`);let y=h.width,W=h.height;if(h instanceof HTMLImageElement){"esriPMS"===t.type&&(y=Math.round(r(h.width,(0,tt.Ub)(t))),W=Math.round(h.height*(y/h.width)));const nt="cim"in t?t.cim.colorSubstitutions:void 0,{size:_t,sdf:mt,image:wt}=d._rasterizer.rasterizeImageResource(y,W,h,nt);return d._addItemToMosaic(s,_t,{type:"static",data:wt},(0,tt.js)(t),mt,!1)}d._allowNonPowerOfTwo||(y=(0,a.fp)(h.width+2*T.s4)-2*T.s4,W=(0,a.fp)(h.height+2*T.s4)-2*T.s4),y===h.width&&W===h.height||(h=(0,yt.SI)(h,y,W));const ct=new g(h,d._requestRender,t.animatedSymbolProperties||{},t.objectId);return d._addItemToMosaic(s,[ct.width,ct.height],{type:"animated",data:ct},(0,tt.js)(t),!1,!1)})()}_handleImage(t,s,i){var d=this;return(0,I.Z)(function*(){if((0,tt.DQ)(t)||(0,tt.iw)(t))return d._handleGIFOrPNG(t,s,i);const _=(0,tt.Gr)(t);try{let h;const y=d.resourceManager.getResource(_);if(null!=y&&y instanceof HTMLImageElement)h=y;else{const{data:mt}=yield d._imageRequestQueue.push(_,{...i});h=mt}if((0,l.zd)(_))if("width"in t&&"height"in t){const{width:mt,height:wt}=f(t.width,t.height);h.width=mt,h.height=wt}else if("cim"in t){const mt=t.cim,{width:wt,height:xt}=f(mt.width??mt.scaleX*mt.size,mt.size);h.width=wt,h.height=xt}if(!h.width||!h.height)return null;let W=h.width,B=h.height;"esriPMS"===t.type&&(W=Math.round(r(h.width,(0,tt.Ub)(t))),B=Math.round(h.height*(W/h.width)));const st="cim"in t?t.cim.colorSubstitutions:void 0,{size:ct,sdf:nt,image:_t}=d._rasterizer.rasterizeImageResource(W,B,h,st);return d._addItemToMosaic(s,ct,{type:"static",data:_t},(0,tt.js)(t),nt,!1)}catch(h){if(!(0,e.D_)(h))return new A.Z("mapview-invalid-resource",`Could not fetch requested resource at ${_}. ${h.message}`)}})()}_addItemToMosaic(t,s,i,d,_,h,y){return this._spriteMosaic.addSpriteItem(t,s,i,d,_,h,y)}}},23306:(rt,K,o)=>{o.d(K,{SI:()=>X,hY:()=>m});var I=o(1258),v=o(95854),E=o(37127),w=o(11196),A=o(46988);function e(x,S){const{width:U,height:N,getFrame:z}=x,O=x.frameDurations.slice(),G=O.pop();return O.push((0,v.HA)(G+S)),{frameCount:x.frameCount,duration:x.duration+S,frameDurations:O,getFrame:z,width:U,height:N}}class c{constructor(S,U,N,z){this._animation=S,this._repeatType=N,this._onFrameData=z,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];let O=0;for(;U>O;)O+=this.timeToFrame,this.nextFrame();const G=this._animation.getFrame(this._currentFrame);this._onFrameData(G)}nextFrame(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case w.of.None:this._currentFrame-=this._direction;break;case w.of.Loop:this._currentFrame=0;break;case w.of.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case w.of.None:this._currentFrame-=this._direction;break;case w.of.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case w.of.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];const S=this._animation.getFrame(this._currentFrame);this._onFrameData(S)}}function m(x,S,U,N){const z=null==S.playAnimation||S.playAnimation,O=function l(x,S,U,N){let z,{repeatType:O}=S;if(null==O&&(O=w.of.Loop),!0===S.reverseAnimation&&(x=function b(x){const{width:S,height:U}=x,N=x.frameDurations.reverse();return{frameCount:x.frameCount,duration:x.duration,frameDurations:N,getFrame:O=>x.getFrame(x.frameDurations.length-1-O),width:S,height:U}}(x)),null!=S.duration&&(x=function P(x,S){const{width:U,height:N,getFrame:z}=x,O=S/x.duration,G=x.frameDurations.map(J=>(0,v.HA)(J*O));return{frameCount:x.frameCount,duration:x.duration,frameDurations:G,getFrame:z,width:U,height:N}}(x,(0,v.HA)(1e3*S.duration))),null!=S.repeatDelay){const G=1e3*S.repeatDelay;O===w.of.Loop?x=e(x,(0,v.HA)(G)):O===w.of.Oscillate&&(x=function a(x,S){const{width:U,height:N,getFrame:z}=x,O=x.frameDurations.slice(),G=O.shift();return O.unshift((0,v.HA)(G+S)),{frameCount:x.frameCount,duration:x.duration+S,frameDurations:O,getFrame:z,width:U,height:N}}(e(x,(0,v.HA)(G/2)),(0,v.HA)(G/2)))}if(null!=S.startTimeOffset)z=(0,v.HA)(1e3*S.startTimeOffset);else if(null!=S.randomizeStartTime){const G=(0,A.$)(U),ot=(0,A.f)(G,null!=S.randomizeStartSeed?S.randomizeStartSeed:82749913);z=(0,v.HA)(ot*function C(x){return(0,v.HA)(x.frameDurations.reduce((S,U)=>S+U,0))}(x))}else z=(0,v.HA)(0);return new c(x,z,O,N)}(x,S,U,N);let G,J=O.timeToFrame;return function Q(){G=z?setTimeout(()=>{O.nextFrame(),J=O.timeToFrame,Q()},J):void 0}(),(0,I.kB)(()=>z&&clearTimeout(G))}let D,V;function X(x,S,U){const{canvas:N,ctx:z}=function T(){return D??=document.createElement("canvas"),V??=D.getContext("2d"),{canvas:D,ctx:V}}();N.width=S,N.height=U;const O=[],G=x.frameDurations.length;for(let J=0;J<G;J++){const Q=x.getFrame(J);z.clearRect(0,0,S,U),Q instanceof ImageData?z.drawImage((0,E.E0)(Q),0,0,S,U):z.drawImage(Q,0,0,S,U),O.push(z.getImageData(0,0,S,U))}return{width:S,height:U,frameDurations:x.frameDurations,getFrame:J=>O[J],frameCount:x.frameCount,duration:x.duration}}},56064:(rt,K,o)=>{o.d(K,{k:()=>D});var I=o(57964),v=o(4703),E=o(51172),w=o(43101),A=o(43106),C=o(61362);const P=V=>`#define ${(V=>V.replace("-","_").toUpperCase())(V)}\n`;function a(V){return{attributes:new Map([["a_pos",0],["a_tex",1]]),shaders:{vertexShader:P(V)+(0,C.w)("blend/blend.vert"),fragmentShader:P(V)+(0,C.w)("blend/blend.frag")}}}var e=o(39237),c=o(17091),l=o(22784);const m=v.Z.getLogger("esri.views.2d.engine.webgl.effects.blendEffects.BlendEffect");class D{constructor(){this._size=[0,0]}dispose(T){this._backBufferTexture=(0,E.M2)(this._backBufferTexture),this._quad=(0,E.M2)(this._quad)}draw(T,X,x,S,U){const{context:N,drawPhase:z}=T;if(this._setupShader(N),S&&"normal"!==S&&z!==w.jx.LABEL)return void this._drawBlended(T,X,x,S,U);const O=a("normal"),G=N.programCache.acquire(O.shaders.vertexShader,O.shaders.fragmentShader,O.attributes);if(!G)return void m.error(new I.Z("mapview-BlendEffect",'Error creating shader program for blend mode "normal"'));N.useProgram(G),X.setSamplingMode(x),N.bindTexture(X,0),G.setUniform1i("u_layerTexture",0),G.setUniform1f("u_opacity",U),N.setBlendingEnabled(!0),N.setBlendFunction(e.zi.ONE,e.zi.ONE_MINUS_SRC_ALPHA);const J=this._quad;J.draw(),J.unbind(),G.dispose()}_drawBlended(T,X,x,S,U){const{context:N,state:z,pixelRatio:O,inFadeTransition:G}=T,{size:J}=z,Q=N.getBoundFramebufferObject();let ot,R;null!=Q?(ot=Q.width,R=Q.height):(ot=Math.round(O*J[0]),R=Math.round(O*J[1])),this._createOrResizeTexture(T,ot,R);const H=this._backBufferTexture;Q.copyToTexture(0,0,ot,R,0,0,H),N.setStencilTestEnabled(!1),N.setStencilWriteMask(0),N.setBlendingEnabled(!0),N.setDepthTestEnabled(!1),N.setDepthWriteEnabled(!1);const j=a(S),Z=N.programCache.acquire(j.shaders.vertexShader,j.shaders.fragmentShader,j.attributes);if(!Z)return void m.error(new I.Z("mapview-BlendEffect",`Error creating shader program for blend mode ${S}`));N.useProgram(Z),H.setSamplingMode(x),N.bindTexture(H,0),Z.setUniform1i("u_backbufferTexture",0),X.setSamplingMode(x),N.bindTexture(X,1),Z.setUniform1i("u_layerTexture",1),Z.setUniform1f("u_opacity",U),Z.setUniform1f("u_inFadeOpacity",G?1:0),N.setBlendFunction(e.zi.ONE,e.zi.ZERO);const Y=this._quad;Y.draw(),Y.unbind(),Z.dispose(),N.setBlendFunction(e.zi.ONE,e.zi.ONE_MINUS_SRC_ALPHA)}_setupShader(T){this._quad||(this._quad=new A.Z(T,[-1,-1,1,-1,-1,1,1,1]))}_createOrResizeTexture(T,X,x){const{context:S}=T;if(null===this._backBufferTexture||X!==this._size[0]||x!==this._size[1]){if(this._backBufferTexture)this._backBufferTexture.resize(X,x);else{const U=new l.X;U.internalFormat=e.VI.RGBA,U.wrapMode=e.e8.CLAMP_TO_EDGE,U.width=X,U.height=x,this._backBufferTexture=new c.x(S,U)}this._size[0]=X,this._size[1]=x}}}},59319:(rt,K,o)=>{o.d(K,{Q:()=>v});var I=o(61362);const v={shaders:{vertexShader:(0,I.w)("bitBlit/bitBlit.vert"),fragmentShader:(0,I.w)("bitBlit/bitBlit.frag")},attributes:new Map([["a_pos",0],["a_tex",1]])}},8735:(rt,K,o)=>{o.d(K,{C:()=>v,y:()=>E});var I=o(61362);const v={shaders:{vertexShader:(0,I.w)("highlight/textured.vert"),fragmentShader:(0,I.w)("highlight/highlight.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])},E={shaders:{vertexShader:(0,I.w)("highlight/textured.vert"),fragmentShader:(0,I.w)("highlight/blur.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])}},6016:(rt,K,o)=>{o.d(K,{F:()=>w,c:()=>E});var I=o(61362),v=o(82003);const E={shaders:{vertexShader:(0,I.w)("magnifier/magnifier.vert"),fragmentShader:(0,I.w)("magnifier/magnifier.frag")},attributes:new Map([["a_pos",0]])};function w(A){return(0,v.H)(A,E)}},23783:(rt,K,o)=>{o.d(K,{H:()=>v});var I=o(61362);const v={shaders:{vertexShader:(0,I.w)("stencil/stencil.vert"),fragmentShader:(0,I.w)("stencil/stencil.frag")},attributes:new Map([["a_pos",0]])}},46266:(rt,K,o)=>{o.d(K,{Z:()=>bt});var I=o(15861),v=o(50484),E=o(78570),w=o(73514),A=o(51172),C=o(80543),e=(o(1535),o(57678),o(14007),o(10141)),c=o(85039),l=o(31898),m=o(55768),D=o(77192);const V="esri-zoom-box",T={container:`${V}__container`,overlay:`${V}__overlay`,background:`${V}__overlay-background`,box:`${V}__outline`};let x=class extends w.Z{constructor(p){super(p),this._container=null,this._overlay=null,this._backgroundShape=null,this._boxShape=null,this._box={x:0,y:0,width:0,height:0},this._rafId=null,this._redraw=this._redraw.bind(this)}destroy(){this.view=null}set view(p){this.removeAllHandles(),this._destroyOverlay(),this._set("view",p),p&&this.addHandles([p.on("drag",["Shift"],r=>this._handleDrag(r,1),D.f.INTERNAL),p.on("drag",["Shift","Ctrl"],r=>this._handleDrag(r,-1),D.f.INTERNAL)])}_start(){this._createContainer(),this._createOverlay(),this.navigation.begin()}_update(p,r,f,M){this._box.x=p,this._box.y=r,this._box.width=f,this._box.height=M,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}_end(p,r,f,M,F){const et=this.view,L=et.toMap((0,m.vW)(p+.5*f,r+.5*M));let t=Math.max(f/et.width,M/et.height);-1===F&&(t=1/t),this._destroyOverlay(),this.navigation.end(),et.goTo({center:L,scale:et.scale*t})}_updateBox(p,r,f,M){const F=this._boxShape;F.setAttributeNS(null,"x",""+p),F.setAttributeNS(null,"y",""+r),F.setAttributeNS(null,"width",""+f),F.setAttributeNS(null,"height",""+M),F.setAttributeNS(null,"class",T.box)}_updateBackground(p,r,f,M){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(p,r,f,M,this.view.width,this.view.height))}_createContainer(){const p=document.createElement("div");p.className=T.container,this.view.root.appendChild(p),this._container=p}_createOverlay(){const p=this.view.width,r=this.view.height,f=document.createElementNS("http://www.w3.org/2000/svg","path");f.setAttributeNS(null,"d","M 0 0 L "+p+" 0 L "+p+" "+r+" L 0 "+r+" Z"),f.setAttributeNS(null,"class",T.background);const M=document.createElementNS("http://www.w3.org/2000/svg","rect"),F=document.createElementNS("http://www.w3.org/2000/svg","svg");F.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),F.setAttributeNS(null,"class",T.overlay),F.appendChild(f),F.appendChild(M),this._container.appendChild(F),this._backgroundShape=f,this._boxShape=M,this._overlay=F}_destroyOverlay(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null}_toSVGPath(p,r,f,M,F,et){const L=p+f,t=r+M;return"M 0 0 L "+F+" 0 L "+F+" "+et+" L 0 "+et+" ZM "+p+" "+r+" L "+p+" "+t+" L "+L+" "+t+" L "+L+" "+r+" Z"}_handleDrag(p,r){const f=p.x,M=p.y,F=p.origin.x,et=p.origin.y;let L,t,s,i;switch(f>F?(L=F,s=f-F):(L=f,s=F-f),M>et?(t=et,i=M-et):(t=M,i=et-M),p.action){case"start":this._start();break;case"update":this._update(L,t,s,i);break;case"end":this._end(L,t,s,i,r)}p.stopPropagation()}_redraw(){if(!this._rafId||(this._rafId=null,!this._overlay))return;const{x:p,y:r,width:f,height:M}=this._box;this._updateBox(p,r,f,M),this._updateBackground(p,r,f,M),this._rafId=requestAnimationFrame(this._redraw)}};(0,v._)([(0,C.Cb)()],x.prototype,"navigation",void 0),(0,v._)([(0,C.Cb)()],x.prototype,"view",null),x=(0,v._)([(0,e.j)("esri.views.2d.navigation.ZoomBox")],x);const S=x;o(2189);var N=o(77675),z=o(43589),O=o(8554);class G{constructor(r){this._gain=r,this.lastValue=void 0,this.filteredDelta=void 0}update(r){if(this.hasLastValue()){const f=this.computeDelta(r);this._updateDelta(f)}this.lastValue=r}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return void 0!==this.lastValue}hasFilteredDelta(){return void 0!==this.filteredDelta}computeDelta(r){return void 0===this.lastValue?NaN:r-this.lastValue}_updateDelta(r){this.filteredDelta=void 0!==this.filteredDelta?(1-this._gain)*this.filteredDelta+this._gain*r:r}}class J{constructor(r,f,M){this._initialVelocity=r,this._stopVelocity=f,this._friction=M,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(r){return r>this.duration}get friction(){return this._friction}value(r){return this.valueFromInitialVelocity(this._initialVelocity,r)}valueDelta(r,f){const M=this.value(r);return this.value(r+f)-M}valueFromInitialVelocity(r,f){f=Math.min(f,this.duration);const M=1-this.friction;return r*(M**f-1)/Math.log(M)}}class Q extends J{constructor(r,f,M,F,et){super(r,f,M),this._sceneVelocity=F,this.direction=et}value(r){return super.valueFromInitialVelocity(this._sceneVelocity,r)}}class ot{constructor(r=300,f=12,M=.84){this._minimumInitialVelocity=r,this._stopVelocity=f,this._friction=M,this.enabled=!0,this._time=new G(.6),this._screen=[new G(.4),new G(.4)],this._scene=[new G(.6),new G(.6),new G(.6)],this._tmpDirection=(0,O.c)()}add(r,f,M){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(M)<.015)return;this._screen[0].update(r[0]),this._screen[1].update(r[1]),this._scene[0].update(f[0]),this._scene[1].update(f[1]),this._scene[2].update(f[2]),this._time.update(M)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const r=this._screen[0].filteredDelta,f=this._screen[1].filteredDelta,M=null==r||null==f?0:Math.sqrt(r*r+f*f),F=this._time.filteredDelta,et=null==F||null==M?0:M/F;return Math.abs(et)<this._minimumInitialVelocity?null:this.createMomentum(et,this._stopVelocity,this._friction)}createMomentum(r,f,M){(0,z.s)(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const F=(0,z.l)(this._tmpDirection);F>0&&(0,z.i)(this._tmpDirection,this._tmpDirection,1/F);const et=this._time.filteredDelta;return new Q(r,f,M,null==et?0:F/et,this._tmpDirection)}}let R=class extends w.Z{constructor(p){super(p),this.animationTime=0,this.momentumEstimator=new ot(500,6,.92),this.momentum=null,this.tmpMomentum=(0,O.c)(),this.momentumFinished=!1,this.viewpoint=new E.Z({targetGeometry:new c.Z,scale:0,rotation:0}),this._previousDrag=null,(0,N.gx)(()=>this.momentumFinished,()=>this.navigation.stop())}begin(p,r){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(r),this._previousDrag=r}update(p,r){this.addToEstimator(r);let f=r.center.x,M=r.center.y;const F=this._previousDrag;f=F?F.center.x-f:-f,M=F?M-F.center.y:M,p.viewpoint=(0,l.Rx)(this.viewpoint,p.viewpoint,[f||0,M||0]),this._previousDrag=r}end(p,r){this.addToEstimator(r),this.momentum=p.navigation.momentumEnabled?this.momentumEstimator.evaluateMomentum():null,this.animationTime=0,this.momentum&&this.onAnimationUpdate(p),this._previousDrag=null,this.navigation.end()}addToEstimator(p){const r=p.center.x,f=p.center.y,M=(0,m.s1)(-r,f),F=(0,O.f)(-r,f,0);this.momentumEstimator.add(M,F,.001*p.timestamp)}onAnimationUpdate(p){this.navigation.animationManager?.animateContinous(p.viewpoint,(r,f)=>{const{momentum:M,animationTime:F,tmpMomentum:et}=this,L=.001*f;if(!(this.momentumFinished=!M||M.isFinished(F))){const t=M.valueDelta(F,L);(0,z.i)(et,M.direction,t),(0,l.Rx)(r,r,et),p.constraints.constrainByGeometry(r)}this.animationTime+=L})}stopMomentumNavigation(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())}};(0,v._)([(0,C.Cb)()],R.prototype,"momentumFinished",void 0),(0,v._)([(0,C.Cb)()],R.prototype,"viewpoint",void 0),(0,v._)([(0,C.Cb)()],R.prototype,"navigation",void 0),R=(0,v._)([(0,e.j)("esri.views.2d.navigation.actions.Pan")],R);const H=R;var j=o(46033),Z=o(51675),Y=o(55117);class ${constructor(r=2.5,f=.01,M=.95,F=12){this._minimumInitialVelocity=r,this._stopVelocity=f,this._friction=M,this._maxVelocity=F,this.enabled=!0,this.value=new G(.8),this.time=new G(.3)}add(r,f){if(this.enabled&&null!=f){if(this.time.hasLastValue()){if(this.time.computeDelta(f)<.01)return;if(this.value.hasFilteredDelta()){const M=this.value.computeDelta(r);this.value.filteredDelta*M<0&&this.value.reset()}}this.time.update(f),this.value.update(r)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let r=this.value.filteredDelta/this.time.filteredDelta;return r=(0,Y.uZ)(r,-this._maxVelocity,this._maxVelocity),Math.abs(r)<this._minimumInitialVelocity?null:this.createMomentum(r,this._stopVelocity,this._friction)}createMomentum(r,f,M){return new J(r,f,M)}}class q extends ${constructor(r=3,f=.01,M=.95,F=12){super(r,f,M,F)}add(r,f){const M=this.value.lastValue;if(null!=M){let F=r-M;for(;F>Math.PI;)F-=2*Math.PI;for(;F<-Math.PI;)F+=2*Math.PI;r=M+F}super.add(r,f)}}class it extends J{constructor(r,f,M){super(r,f,M)}value(r){const f=super.value(r);return Math.exp(f)}valueDelta(r,f){const M=super.value(r),F=super.value(r+f)-M;return Math.exp(F)}}class pt extends ${constructor(r=2.5,f=.01,M=.95,F=12){super(r,f,M,F)}add(r,f){super.add(Math.log(r),f)}createMomentum(r,f,M){return new it(r,f,M)}}let at=class extends w.Z{constructor(p){super(p),this._animationTime=0,this._momentumFinished=!1,this._previousAngle=0,this._previousRadius=0,this._previousCenter=null,this._rotationMomentumEstimator=new q(.6,.15,.95),this._rotationDirection=1,this._startAngle=0,this._startRadius=0,this._updateTimestamp=null,this._zoomDirection=1,this._zoomMomentumEstimator=new pt,this._zoomOnly=null,this.zoomMomentum=null,this.rotateMomentum=null,this.viewpoint=new E.Z({targetGeometry:new c.Z,scale:0,rotation:0}),this.addHandles((0,N.gx)(()=>this._momentumFinished,()=>this.navigation.stop()))}begin(p,r){this.navigation.begin(),this._rotationMomentumEstimator.reset(),this._zoomMomentumEstimator.reset(),this._zoomOnly=null,this._previousAngle=this._startAngle=r.angle,this._previousRadius=this._startRadius=r.radius,this._previousCenter=r.center,this._updateTimestamp=null,p.constraints.rotationEnabled&&this.addToRotateEstimator(0,r.timestamp),this.addToZoomEstimator(r,1)}update(p,r){null===this._updateTimestamp&&(this._updateTimestamp=r.timestamp);const f=r.angle,M=r.radius,F=r.center,et=Math.abs(180*(f-this._startAngle)/Math.PI),L=Math.abs(M-this._startRadius),t=this._startRadius/M;if(this._previousRadius&&this._previousCenter){const s=M/this._previousRadius;let i=180*(f-this._previousAngle)/Math.PI;this._rotationDirection=i>=0?1:-1,this._zoomDirection=s>=1?1:-1,p.constraints.rotationEnabled?(null===this._zoomOnly&&r.timestamp-this._updateTimestamp>200&&(this._zoomOnly=L-et>0),null===this._zoomOnly||this._zoomOnly?i=0:this.addToRotateEstimator(f-this._startAngle,r.timestamp)):i=0,this.addToZoomEstimator(r,t),this.navigation.setViewpoint([F.x,F.y],1/s,i,[this._previousCenter.x-F.x,F.y-this._previousCenter.y])}this._previousAngle=f,this._previousRadius=M,this._previousCenter=F}end(p){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=0,(this.rotateMomentum||this.zoomMomentum)&&this.onAnimationUpdate(p),this.navigation.end()}addToRotateEstimator(p,r){this._rotationMomentumEstimator.add(p,.001*r)}addToZoomEstimator(p,r){this._zoomMomentumEstimator.add(r,.001*p.timestamp)}canZoomIn(p){const f=p.constraints.effectiveMaxScale;return 0===f||p.scale>f}canZoomOut(p){const f=p.constraints.effectiveMinScale;return 0===f||p.scale<f}onAnimationUpdate(p){this.navigation.animationManager?.animateContinous(p.viewpoint,(r,f)=>{const M=!this.canZoomIn(p)&&this._zoomDirection>1||!this.canZoomOut(p)&&this._zoomDirection<1,F=!this.rotateMomentum||this.rotateMomentum.isFinished(this._animationTime),et=M||!this.zoomMomentum||this.zoomMomentum.isFinished(this._animationTime),L=.001*f;if(this._momentumFinished=F&&et,!this._momentumFinished){const t=this.rotateMomentum?Math.abs(this.rotateMomentum.valueDelta(this._animationTime,L))*this._rotationDirection*180/Math.PI:0;let s=this.zoomMomentum?Math.abs(this.zoomMomentum.valueDelta(this._animationTime,L)):1;const i=(0,Z.a)(),d=(0,Z.a)();if(this._previousCenter){(0,j.s)(i,this._previousCenter.x,this._previousCenter.y),(0,l.Dq)(d,p.size,p.padding),(0,j.i)(i,i,d);const{constraints:_,scale:h}=p,y=h*s;s<1&&!_.canZoomInTo(y)?(s=h/_.effectiveMaxScale,this.zoomMomentum=null,this.rotateMomentum=null):s>1&&!_.canZoomOutTo(y)&&(s=h/_.effectiveMinScale,this.zoomMomentum=null,this.rotateMomentum=null),(0,l.UZ)(r,p.viewpoint,s,t,i,p.size),p.constraints.constrainByGeometry(r)}}this._animationTime+=L})}stopMomentumNavigation(){(this.rotateMomentum||this.zoomMomentum)&&(this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop())}};(0,v._)([(0,C.Cb)()],at.prototype,"_momentumFinished",void 0),(0,v._)([(0,C.Cb)()],at.prototype,"viewpoint",void 0),(0,v._)([(0,C.Cb)()],at.prototype,"navigation",void 0),at=(0,v._)([(0,e.j)("esri.views.2d.navigation.actions.Pinch")],at);const ft=at,lt=(0,Z.a)(),gt=(0,Z.a)();let tt=class extends w.Z{constructor(p){super(p),this._previousCenter=(0,Z.a)(),this.viewpoint=new E.Z({targetGeometry:new c.Z,scale:0,rotation:0})}begin(p,r){this.navigation.begin(),(0,j.s)(this._previousCenter,r.center.x,r.center.y)}update(p,r){const{state:{size:f,padding:M}}=p;(0,j.s)(lt,r.center.x,r.center.y),(0,l.ni)(gt,f,M),p.viewpoint=(0,l.$H)(this.viewpoint,p.state.paddedViewState.viewpoint,(0,l.dI)(gt,this._previousCenter,lt)),(0,j.j)(this._previousCenter,lt)}end(){this.navigation.end()}};(0,v._)([(0,C.Cb)()],tt.prototype,"viewpoint",void 0),(0,v._)([(0,C.Cb)()],tt.prototype,"navigation",void 0),tt=(0,v._)([(0,e.j)("esri.views.2d.actions.Rotate")],tt);const yt=tt,g=10,ht=new E.Z({targetGeometry:new c.Z}),ut=[0,0];let dt=class extends w.Z{constructor(p){super(p),this._endTimer=null,this._lastEventTimestamp=null,this.animationManager=null,this.interacting=!1}initialize(){this.pan=new H({navigation:this}),this.rotate=new yt({navigation:this}),this.pinch=new ft({navigation:this}),this.zoomBox=new S({view:this.view,navigation:this})}destroy(){this.pan=(0,A.SC)(this.pan),this.rotate=(0,A.SC)(this.rotate),this.pinch=(0,A.SC)(this.pinch),this.zoomBox=(0,A.SC)(this.zoomBox),this.animationManager=null}begin(){this._set("interacting",!0)}end(){this._lastEventTimestamp=performance.now(),this._startTimer(250)}zoom(p,r=this._getDefaultAnchor()){var f=this;return(0,I.Z)(function*(){if(f.stop(),f.begin(),f.view.constraints.snapToZoom&&f.view.constraints.effectiveLODs)return p<1?f.zoomIn(r):f.zoomOut(r);f.setViewpoint(r,p,0,[0,0])})()}zoomIn(p){var r=this;return(0,I.Z)(function*(){const f=r.view,M=f.constraints.snapToNextScale(f.scale);return r._zoomToScale(M,p)})()}zoomOut(p){var r=this;return(0,I.Z)(function*(){const f=r.view,M=f.constraints.snapToPreviousScale(f.scale);return r._zoomToScale(M,p)})()}setViewpoint(p,r,f,M){this.begin(),this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,p,r,f,M),this.end()}setViewpointImmediate(p,r=0,f=[0,0],M=this._getDefaultAnchor()){this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,M,p,r,f)}continousRotateClockwise(){const p=this.view.viewpoint;this.animationManager?.animateContinous(p,r=>{(0,l.$H)(r,r,-1)})}continousRotateCounterclockwise(){const p=this.view.viewpoint;this.animationManager?.animateContinous(p,r=>{(0,l.$H)(r,r,1)})}resetRotation(){this.view.constraints.rotationEnabled&&(this.view.rotation=0)}continousPanLeft(){this._continuousPan([-g,0])}continousPanRight(){this._continuousPan([g,0])}continousPanUp(){this._continuousPan([0,g])}continousPanDown(){this._continuousPan([0,-g])}continuousPanVector({x:p,y:r}){this._continuousPan([p*g,r*g])}stop(){this.pan.stopMomentumNavigation(),this.animationManager?.stop(),this.end(),null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))}_continuousPan(p){const r=this.view.viewpoint;this.animationManager?.animateContinous(r,f=>{(0,l.Rx)(f,f,p),this.view.constraints.constrainByGeometry(f)})}_startTimer(p){return null!==this._endTimer||(this._endTimer=setTimeout(()=>{this._endTimer=null;const r=performance.now()-(this._lastEventTimestamp??0);r<250?this._endTimer=this._startTimer(r):this._set("interacting",!1)},p)),this._endTimer}_getDefaultAnchor(){const{size:p,padding:{left:r,right:f,top:M,bottom:F}}=this.view;return ut[0]=.5*(p[0]-f+r),ut[1]=.5*(p[1]-F+M),ut}_zoomToScale(p,r=this._getDefaultAnchor()){var f=this;return(0,I.Z)(function*(){const{view:M}=f,{constraints:F,scale:et,viewpoint:L,size:t,padding:s}=M,i=F.canZoomInTo(p),d=F.canZoomOutTo(p);if(!(p<et&&!i||p>et&&!d))return(0,l.gG)(ht,L,p/et,0,r,t,s),F.constrainByGeometry(ht),M.goTo(ht,{animate:!0,pickClosestTarget:!1})})()}_scaleRotateTranslateViewpoint(p,r,f,M,F){const{view:et}=this,{size:L,padding:t,constraints:s,scale:i,viewpoint:d}=et,_=i*f,h=s.canZoomInTo(_),y=s.canZoomOutTo(_);return(f<1&&!h||f>1&&!y)&&(f=1),(0,l.Rx)(d,d,F),(0,l.gG)(p,d,f,M,r,L,t),s.constrainByGeometry(p)}};(0,v._)([(0,C.Cb)()],dt.prototype,"animationManager",void 0),(0,v._)([(0,C.Cb)({type:Boolean,readOnly:!0})],dt.prototype,"interacting",void 0),(0,v._)([(0,C.Cb)()],dt.prototype,"pan",void 0),(0,v._)([(0,C.Cb)()],dt.prototype,"pinch",void 0),(0,v._)([(0,C.Cb)()],dt.prototype,"rotate",void 0),(0,v._)([(0,C.Cb)()],dt.prototype,"view",void 0),(0,v._)([(0,C.Cb)()],dt.prototype,"zoomBox",void 0),dt=(0,v._)([(0,e.j)("esri.views.2d.navigation.MapViewNavigation")],dt);const bt=dt},53299:(rt,K,o)=>{o.d(K,{H:()=>E,K:()=>v});const v=class I{};function E(w,...A){let C="";for(let b=0;b<A.length;b++)C+=w[b]+A[b];return C+=w[w.length-1],C}var w;(w=E||(E={})).int=function A(b){return Math.round(b).toString()},w.float=function C(b){return b.toPrecision(8)}},63298:(rt,K,o)=>{o.d(K,{Bh:()=>l,IB:()=>C,j7:()=>b,je:()=>c,ve:()=>a,wu:()=>w});var I=o(59171),v=o(39237),E=o(89877);const w=(0,E.wK)(v.zi.SRC_ALPHA,v.zi.ONE,v.zi.ONE_MINUS_SRC_ALPHA,v.zi.ONE_MINUS_SRC_ALPHA),A=(0,E.if)(v.zi.ONE,v.zi.ONE),C=(0,E.if)(v.zi.ZERO,v.zi.ONE_MINUS_SRC_ALPHA);function b(m){return m===I.A.FrontFace?null:m===I.A.Alpha?C:A}const a=5e5,e={factor:-1,units:-2};function c(m){return m?e:null}function l(m,D=v.wb.LESS){return m===I.A.NONE||m===I.A.FrontFace?D:v.wb.LEQUAL}},59171:(rt,K,o)=>{var I,v;o.d(K,{A:()=>I}),(v=I||(I={}))[v.Color=0]="Color",v[v.Alpha=1]="Alpha",v[v.FrontFace=2]="FrontFace",v[v.NONE=3]="NONE",v[v.COUNT=4]="COUNT"},15182:(rt,K,o)=>{var I,v,E,w,A,C,b,P,a,e;o.d(K,{Gv:()=>v,Iq:()=>P,JJ:()=>b,Rw:()=>w,Ti:()=>a,V_:()=>C,Vr:()=>I,hU:()=>A}),(e=I||(I={}))[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.COUNT=3]="COUNT",function(e){e[e.Less=0]="Less",e[e.Lequal=1]="Lequal",e[e.COUNT=2]="COUNT"}(v||(v={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.UPDATE=1]="UPDATE"}(E||(E={})),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(w||(w={})),function(e){e[e.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",e[e.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(A||(A={})),function(e){e[e.Highlight=0]="Highlight",e[e.MaskOccludee=1]="MaskOccludee",e[e.COUNT=2]="COUNT"}(C||(C={})),function(e){e[e.Blend=0]="Blend",e[e.Opaque=1]="Opaque",e[e.Mask=2]="Mask",e[e.MaskBlend=3]="MaskBlend",e[e.COUNT=4]="COUNT"}(b||(b={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(P||(P={})),function(e){e.DDS_ENCODING="image/vnd-ms.dds",e.KTX2_ENCODING="image/ktx2",e.BASIS_ENCODING="image/x.basis"}(a||(a={}))},89437:(rt,K,o)=>{o.d(K,{G:()=>v});var I=o(51172);class v{constructor(){this._result=!1}dispose(){this._program=(0,I.M2)(this._program)}get result(){return null!=this._program&&(this._result=this._test(this._program),this.dispose()),this._result}}},13646:(rt,K,o)=>{o.d(K,{mO:()=>w});var I=o(50906);class v{constructor(C,b,P,a,e,c,l,m,D){this.createQuery=C,this.deleteQuery=b,this.resultAvailable=P,this.getResult=a,this.disjoint=e,this.beginTimeElapsed=c,this.endTimeElapsed=l,this.createTimestamp=m,this.timestampBits=D}}let E=!1;function w(A,C){if(C.disjointTimerQuery)return null;let b=A.getExtension("EXT_disjoint_timer_query_webgl2");return b&&(0,I.Z)(A)?new v(()=>A.createQuery(),P=>{A.deleteQuery(P),E=!1},P=>A.getQueryParameter(P,A.QUERY_RESULT_AVAILABLE),P=>A.getQueryParameter(P,A.QUERY_RESULT),()=>A.getParameter(b.GPU_DISJOINT_EXT),P=>{E||(E=!0,A.beginQuery(b.TIME_ELAPSED_EXT,P))},()=>{A.endQuery(b.TIME_ELAPSED_EXT),E=!1},P=>b.queryCounterEXT(P,b.TIMESTAMP_EXT),()=>A.getQuery(b.TIMESTAMP_EXT,b.QUERY_COUNTER_BITS_EXT)):(b=A.getExtension("EXT_disjoint_timer_query"),b?new v(()=>b.createQueryEXT(),P=>{b.deleteQueryEXT(P),E=!1},P=>b.getQueryObjectEXT(P,b.QUERY_RESULT_AVAILABLE_EXT),P=>b.getQueryObjectEXT(P,b.QUERY_RESULT_EXT),()=>A.getParameter(b.GPU_DISJOINT_EXT),P=>{E||(E=!0,b.beginQueryEXT(b.TIME_ELAPSED_EXT,P))},()=>{b.endQueryEXT(b.TIME_ELAPSED_EXT),E=!1},P=>b.queryCounterEXT(P,b.TIMESTAMP_EXT),()=>b.getQueryEXT(b.TIMESTAMP_EXT,b.QUERY_COUNTER_BITS_EXT)):null)}},89877:(rt,K,o)=>{o.d(K,{BK:()=>a,LZ:()=>P,if:()=>E,jp:()=>yt,sm:()=>S,wK:()=>w,zp:()=>b});var I=o(15182),v=o(39237);function E(g,k,ht=v.db.ADD,ut=[0,0,0,0]){return{srcRgb:g,srcAlpha:g,dstRgb:k,dstAlpha:k,opRgb:ht,opAlpha:ht,color:{r:ut[0],g:ut[1],b:ut[2],a:ut[3]}}}function w(g,k,ht,ut,vt=v.db.ADD,dt=v.db.ADD,bt=[0,0,0,0]){return{srcRgb:g,srcAlpha:k,dstRgb:ht,dstAlpha:ut,opRgb:vt,opAlpha:dt,color:{r:bt[0],g:bt[1],b:bt[2],a:bt[3]}}}const A={face:v.LR.BACK,mode:v.Wf.CCW},C={face:v.LR.FRONT,mode:v.Wf.CCW},b=g=>g===I.Vr.Back?A:g===I.Vr.Front?C:null,P={zNear:0,zFar:1},a={r:!0,g:!0,b:!0,a:!0};function e(g){return z.intern(g)}function c(g){return G.intern(g)}function l(g){return Q.intern(g)}function m(g){return R.intern(g)}function D(g){return j.intern(g)}function V(g){return Y.intern(g)}function T(g){return q.intern(g)}function X(g){return pt.intern(g)}function x(g){return ft.intern(g)}function S(g){return gt.intern(g)}class U{constructor(k,ht){this._makeKey=k,this._makeRef=ht,this._interns=new Map}intern(k){if(!k)return null;const ht=this._makeKey(k),ut=this._interns;return ut.has(ht)||ut.set(ht,this._makeRef(k)),ut.get(ht)??null}}function N(g){return"["+g.join(",")+"]"}const z=new U(O,g=>({__tag:"Blending",...g}));function O(g){return g?N([g.srcRgb,g.srcAlpha,g.dstRgb,g.dstAlpha,g.opRgb,g.opAlpha,g.color.r,g.color.g,g.color.b,g.color.a]):null}const G=new U(J,g=>({__tag:"Culling",...g}));function J(g){return g?N([g.face,g.mode]):null}const Q=new U(ot,g=>({__tag:"PolygonOffset",...g}));function ot(g){return g?N([g.factor,g.units]):null}const R=new U(H,g=>({__tag:"DepthTest",...g}));function H(g){return g?N([g.func]):null}const j=new U(Z,g=>({__tag:"StencilTest",...g}));function Z(g){return g?N([g.function.func,g.function.ref,g.function.mask,g.operation.fail,g.operation.zFail,g.operation.zPass]):null}const Y=new U($,g=>({__tag:"DepthWrite",...g}));function $(g){return g?N([g.zNear,g.zFar]):null}const q=new U(it,g=>({__tag:"ColorWrite",...g}));function it(g){return g?N([g.r,g.g,g.b,g.a]):null}const pt=new U(at,g=>({__tag:"StencilWrite",...g}));function at(g){return g?N([g.mask]):null}const ft=new U(lt,g=>({__tag:"DrawBuffers",...g}));function lt(g){return g?N(g.buffers):null}const gt=new U(function tt(g){return g?N([O(g.blending),J(g.culling),ot(g.polygonOffset),H(g.depthTest),Z(g.stencilTest),$(g.depthWrite),it(g.colorWrite),at(g.stencilWrite),lt(g.drawBuffers)]):null},g=>({blending:e(g.blending),culling:c(g.culling),polygonOffset:l(g.polygonOffset),depthTest:m(g.depthTest),stencilTest:D(g.stencilTest),depthWrite:V(g.depthWrite),colorWrite:T(g.colorWrite),stencilWrite:X(g.stencilWrite),drawBuffers:x(g.drawBuffers)}));class yt{constructor(k){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=k}setPipeline(k){(this._pipelineInvalid||k!==this._pipeline)&&(this._setBlending(k.blending),this._setCulling(k.culling),this._setPolygonOffset(k.polygonOffset),this._setDepthTest(k.depthTest),this._setStencilTest(k.stencilTest),this._setDepthWrite(k.depthWrite),this._setColorWrite(k.colorWrite),this._setStencilWrite(k.stencilWrite),this._setDrawBuffers(k.drawBuffers),this._pipeline=k),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(k){this._blending=this._setSubState(k,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(k){this._culling=this._setSubState(k,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(k){this._polygonOffset=this._setSubState(k,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(k){this._depthTest=this._setSubState(k,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(k){this._stencilTest=this._setSubState(k,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(k){this._depthWrite=this._setSubState(k,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(k){this._colorWrite=this._setSubState(k,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(k){this._stencilWrite=this._setSubState(k,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(k){this._drawBuffers=this._setSubState(k,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(k,ht,ut,vt){return(ut||k!==ht)&&(vt(k),this._pipelineInvalid=!0),k}}},90771:(rt,K,o)=>{o.d(K,{d:()=>a});var I=o(40176),v=o(39853),E=o(39237),w=o(83018),A=o(17091),C=o(22784),b=o(46682),P=o(89437);class a extends P.G{constructor(l){super(),this._rctx=l,this._program=l.programCache.acquire("\n    precision highp float;\n\n    attribute vec2 a_pos;\n    varying vec2 v_uv;\n\n    void main() {\n      v_uv = a_pos;\n      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n    precision highp float;\n\n    varying vec2 v_uv;\n\n    uniform sampler2D u_texture;\n\n    void main() {\n      gl_FragColor = texture2D(u_texture, v_uv);\n    }\n    ",new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(l){const m=this._rctx;if(!m.gl)return l.dispose(),!0;const D=new C.X(1);D.wrapMode=E.e8.CLAMP_TO_EDGE,D.samplingMode=E.cw.NEAREST;const V=new w.X(m,D),T=v.f.createVertex(m,E.l1.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),X=new b.U(m,new Map([["a_pos",0]]),I.cD,{geometry:T}),x=new C.X;x.samplingMode=E.cw.LINEAR,x.wrapMode=E.e8.CLAMP_TO_EDGE;const S=new A.x(m,x,e);m.useProgram(l),m.bindTexture(S,0),l.setUniform1i("u_texture",0);const U=m.getBoundFramebufferObject(),{x:N,y:z,width:O,height:G}=m.getViewport();m.bindFramebuffer(V),m.setViewport(0,0,1,1),m.setClearColor(0,0,0,0),m.setBlendingEnabled(!1),m.clearSafe(E.lk.COLOR_BUFFER_BIT),m.bindVAO(X),m.drawArrays(E.MX.TRIANGLE_STRIP,0,4);const J=new Uint8Array(4);return V.readPixels(0,0,1,1,E.VI.RGBA,E.Br.UNSIGNED_BYTE,J),X.dispose(),V.dispose(),S.dispose(),m.setViewport(N,z,O,G),m.bindFramebuffer(U),255!==J[0]}}const e=new Image;e.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",e.width=5,e.height=5,e.decode()}}]);