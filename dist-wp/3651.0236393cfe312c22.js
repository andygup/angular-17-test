"use strict";(self.webpackChunkangular_17_test=self.webpackChunkangular_17_test||[]).push([[3651],{38737:(Ft,We,C)=>{var B,_;C.d(We,{Y:()=>B}),(_=B||(B={}))[_.KILOBYTES=1024]="KILOBYTES",_[_.MEGABYTES=1048576]="MEGABYTES",_[_.GIGABYTES=1073741824]="GIGABYTES"},70794:(Ft,We,C)=>{C.d(We,{EX:()=>Re,Y3:()=>He,_Y:()=>ae,sJ:()=>G,xr:()=>pe});var B=C(66599);function $(E){return"h"in E&&"s"in E&&"v"in E}function A(E){return"l"in E&&"a"in E&&"b"in E}function ee(E){return"l"in E&&"c"in E&&"h"in E}C(70993),C(79516);const De=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],ne=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function se(E,I){const L=[];let S,Z;if(E[0].length!==I.length)throw new Error("dimensions do not match");const W=E.length,X=E[0].length;let te=0;for(S=0;S<W;S++){for(te=0,Z=0;Z<X;Z++)te+=E[S][Z]*I[Z];L.push(te)}return L}function be(E){const I=[E.r/255,E.g/255,E.b/255].map(S=>S<=.04045?S/12.92:((S+.055)/1.055)**2.4),L=se(De,I);return{x:100*L[0],y:100*L[1],z:100*L[2]}}function $e(E){const I=se(ne,[E.x/100,E.y/100,E.z/100]).map(L=>Math.min(1,Math.max(L<=.0031308?12.92*L:1.055*L**.4166666666666667-.055,0)));return{r:Math.round(255*I[0]),g:Math.round(255*I[1]),b:Math.round(255*I[2])}}function je(E){const I=[E.x/95.047,E.y/100,E.z/108.883].map(L=>L>.008856451679035631?L**.3333333333333333:7.787037037037035*L+.13793103448275862);return{l:116*I[1]-16,a:500*(I[0]-I[1]),b:200*(I[1]-I[2])}}function j(E){const I=E.l,L=[(I+16)/116+E.a/500,(I+16)/116,(I+16)/116-E.b/200].map(S=>S>6/29?S**3:3*(6/29)**2*(S-4/29));return{x:95.047*L[0],y:100*L[1],z:108.883*L[2]}}function pe(E){return function Pe(E){return"r"in E&&"g"in E&&"b"in E}(E)?E:ee(E)?function oe(E){return $e(j(function Y(E){const L=E.c,S=E.h;return{l:E.l,a:L*Math.cos(S),b:L*Math.sin(S)}}(E)))}(E):A(E)?function K(E){return $e(j(E))}(E):function Ve(E){return"x"in E&&"y"in E&&"z"in E}(E)?$e(E):$(E)?function q(E){const I=(E.h+360)%360/60,S=E.v/100*255,Z=S*(E.s/100),W=Z*(1-Math.abs(I%2-1));let X;switch(Math.floor(I)){case 0:X={r:Z,g:W,b:0};break;case 1:X={r:W,g:Z,b:0};break;case 2:X={r:0,g:Z,b:W};break;case 3:X={r:0,g:W,b:Z};break;case 4:X={r:W,g:0,b:Z};break;case 5:case 6:X={r:Z,g:0,b:W};break;default:X={r:0,g:0,b:0}}return X.r=Math.round(X.r+S-Z),X.g=Math.round(X.g+S-Z),X.b=Math.round(X.b+S-Z),X}(E):E}function ae(E){return $(E)?E:function le(E){const I=E.r,L=E.g,S=E.b,Z=Math.max(I,L,S),W=Z-Math.min(I,L,S);let X=Z,te=0===W?0:Z===I?(L-S)/W%6:Z===L?(S-I)/W+2:(I-L)/W+4,ye=0===W?0:W/X;return te<0&&(te+=6),te*=60,ye*=100,X*=100/255,{h:te,s:ye,v:X}}(pe(E))}function He(E){return A(E)?E:function D(E){return je(be(E))}(pe(E))}function G(E){return ee(E)?E:function Q(E){return function N(E){const I=E.l,L=E.a,S=E.b,Z=Math.sqrt(L*L+S*S);let W=Math.atan2(S,L);return W=W>0?W:W+2*Math.PI,{l:I,c:Z,h:W}}(je(be(E)))}(pe(E))}function Re(E,I){const{r:L,g:S,b:Z}=I?.ignoreAlpha?E:function he(E){let{r:I,g:L,b:S,a:Z}=E;return Z<1&&(I=Math.round(Z*I+255*(1-Z)),L=Math.round(Z*L+255*(1-Z)),S=Math.round(Z*S+255*(1-Z))),new B.Z({r:I,g:L,b:S})}(E);return.2126*L+.7152*S+.0722*Z}var Ie,E;(E=Ie||(Ie={}))[E.Low=160]="Low",E[E.High=225]="High"},9922:(Ft,We,C)=>{function B(_,xe,Pe,$){let A=null,ee=1e3;"number"==typeof xe?(ee=xe,$=Pe):(A=xe??null,ee=Pe);let Ve,De=0;const ne=()=>{De=0,_.apply($,Ve)},se=(...be)=>{A&&A.apply($,be),Ve=be,ee?De||(De=setTimeout(ne,ee)):ne()};return se.remove=()=>{De&&(clearTimeout(De),De=0)},se.forceUpdate=()=>{De&&(clearTimeout(De),ne())},se.hasPendingUpdates=()=>!!De,se}C.d(We,{P:()=>B})},46708:(Ft,We,C)=>{C.d(We,{F:()=>Ve,e:()=>A});var B=C(15861),_=C(15462),xe=C(82784),Pe=C(93792),$=C(91866);function A(ne,se,be){return ee.apply(this,arguments)}function ee(){return(ee=(0,B.Z)(function*(ne,se,be){const $e=yield Ve(ne,se,be);return Pe.Z.fromJSON($e)})).apply(this,arguments)}function Ve(ne,se,be){return De.apply(this,arguments)}function De(){return(De=(0,B.Z)(function*(ne,se,be){const $e=(0,_.en)(ne),je={...be},j=$.Z.from(se),{data:N}=yield(0,xe.JT)($e,j,j.sourceSpatialReference,je);return N})).apply(this,arguments)}},85596:(Ft,We,C)=>{C.d(We,{Z:()=>$e});var ne,B=C(50484),_=C(89317),xe=C(80543),Pe=C(1535),ee=(C(57678),C(14007),C(10141));const se={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let be=ne=class extends _.wq{constructor(je){super(je),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:je}=this,j=function Ve(je){const{exifInfo:j,exifName:N,tagName:Y}=je;if(!j||!N||!Y)return null;const D=j.find(K=>K.name===N);return D?function De(je){const{tagName:j,tags:N}=je;return N&&j&&N.find(D=>D.name===j)?.value||null}({tagName:Y,tags:D.tags}):null}({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:je});return se[j]||null}clone(){return new ne({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};(0,B._)([(0,xe.Cb)({type:String})],be.prototype,"contentType",void 0),(0,B._)([(0,xe.Cb)()],be.prototype,"exifInfo",void 0),(0,B._)([(0,xe.Cb)({readOnly:!0})],be.prototype,"orientationInfo",null),(0,B._)([(0,xe.Cb)({type:Pe.z8})],be.prototype,"id",void 0),(0,B._)([(0,xe.Cb)({type:String})],be.prototype,"globalId",void 0),(0,B._)([(0,xe.Cb)({type:String})],be.prototype,"keywords",void 0),(0,B._)([(0,xe.Cb)({type:String})],be.prototype,"name",void 0),(0,B._)([(0,xe.Cb)({json:{read:!1}})],be.prototype,"parentGlobalId",void 0),(0,B._)([(0,xe.Cb)({json:{read:!1}})],be.prototype,"parentObjectId",void 0),(0,B._)([(0,xe.Cb)({type:Pe.z8})],be.prototype,"size",void 0),(0,B._)([(0,xe.Cb)({json:{read:!1}})],be.prototype,"url",void 0),be=ne=(0,B._)([(0,ee.j)("esri.layers.support.AttachmentInfo")],be);const $e=be},43157:(Ft,We,C)=>{C.d(We,{$8:()=>He,a8:()=>je});var B=C(94678),_=C(85295),$=(C(4978),C(63335),C(764));function je(G){return(0,_.y2)(G)||(0,_.UQ)(G)||(0,_.ig)(G)}function He(G,ge){const{format:he,timeZoneOptions:Re,fieldType:Ie}=ge??{};let Ke,Ye;if(Re&&({timeZone:Ke,timeZoneName:Ye}=(0,$.Np)(Re.layerTimeZone,Re.datesInUnknownTimezone,Re.viewTimeZone,(0,B.Ze)(he||"short-date-short-time"),Ie)),"string"==typeof G&&isNaN(Date.parse("time-only"===Ie?`1970-01-01T${G}Z`:G)))return G;switch(Ie){case"date-only":{const ke=(0,B.Ze)(he||"short-date");return"string"==typeof G?(0,B.o8)(G,{...ke}):(0,B.p6)(G,{...ke,timeZone:$.pt})}case"time-only":{const ke=(0,B.Ze)(he||"short-time");return"string"==typeof G?(0,B.LJ)(G,ke):(0,B.p6)(G,{...ke,timeZone:$.pt})}case"timestamp-offset":{if(!Ke&&"string"==typeof G&&new Date(G).toISOString()!==G)return G;const ke=he||Re?(0,B.Ze)(he||"short-date-short-time"):void 0,Pt=ke?{...ke,timeZone:Ke,timeZoneName:Ye}:void 0;return"string"==typeof G?(0,B.i$)(G,Pt):(0,B.p6)(G,Pt)}default:{const ke=he||Re?(0,B.Ze)(he||"short-date-short-time"):void 0;return(0,B.p6)("string"==typeof G?new Date(G):G,ke?{...ke,timeZone:Ke,timeZoneName:Ye}:void 0)}}}},64063:(Ft,We,C)=>{C.r(We),C.d(We,{getPatternDescriptor:()=>He,getSizeFromOptions:()=>ke,getSymbolLayerFill:()=>ae,previewSymbol3D:()=>E});var B=C(15861),_=C(98930),xe=C(70794),$=(C(14007),C(57964)),A=C(4703),ee=C(55768),Ve=C(1010),De=C(81218),ne=C(85497),se=C(86336),be=C(36232),$e=C(62616),je=C(76945);const j=se.b_.size,N=se.b_.maxSize,Y=se.b_.maxOutlineSize,D=se.b_.lineWidth,K=se.b_.tallSymbolWidth;function Q(I){const L=I.outline,S=null!=I.material?I.material.color:null,Z=null!=S?S.toHex():null;if(null==L||"pattern"in L&&null!=L.pattern&&"style"===L.pattern.type&&"none"===L.pattern.style)return"fill"===I.type&&"#ffffff"===Z?{color:"#bdc3c7",width:.75}:null;const W=(0,ee.F2)(L.size)||0;return{color:"rgba("+(null!=L.color?L.color.toRgba():"255,255,255,1")+")",width:Math.min(W,Y),style:"pattern"in L&&null!=L.pattern&&"style"===L.pattern.type?(0,Ve.Sp)(L.pattern.style):null,join:"butt",cap:"patternCap"in L?L.patternCap:"butt"}}function le(){return(le=(0,B.Z)(function*(I,L){if(I.thumbnail?.url)return I.thumbnail.url;if("icon"===L.type&&L?.resource?.href)return(0,$e.nf)(L);const S=(0,_.V)("esri/images/Legend/legend3dsymboldefault.png");if(I.styleOrigin&&(I.styleOrigin.styleName||I.styleOrigin.styleUrl)){const Z=yield(0,je.resolveWebStyleSymbol)(I.styleOrigin,{portal:I.styleOrigin.portal},"webRef").catch(()=>null);if(Z&&"thumbnail"in Z&&Z.thumbnail?.url)return Z.thumbnail.url}return S})).apply(this,arguments)}function q(I,L=1){const S=I.a,Z=(0,xe._Y)(I),W=Z.h,X=Z.s/L,te=100-(100-Z.v)/L,{r:ye,g:Ce,b:ve}=(0,xe.xr)({h:W,s:X,v:te});return[ye,Ce,ve,S]}function pe(I){return"water"===I.type?null==I.color?null:I.color:null==I.material?.color?null:I.material.color}function ae(I,L=0){const S=pe(I);if(!S){if("fill"===I.type)return null;const X=(0,se.uH)(Ve.Ne.r,L);return[X,X,X,100]}const Z=S.toRgba();for(let W=0;W<3;W++)Z[W]=(0,se.uH)(Z[W],L);return Z}function He(I,L){return G.apply(this,arguments)}function G(){return(G=(0,B.Z)(function*(I,L){const S=I.style;return"none"===S?null:{type:"pattern",x:0,y:0,src:yield(0,Ve.Od)((0,_.V)(`esri/symbols/patterns/${S}.png`),L.toCss(!0)),width:5,height:5}})).apply(this,arguments)}function ge(I){return I.outline?Q(I):{color:"rgba(0, 0, 0, 1)",width:1.5}}function he(I,L){const S=pe(I);if(!S)return null;let Z="rgba(";return Z+=(0,se.uH)(S.r,L)+",",Z+=(0,se.uH)(S.g,L)+",",Z+=(0,se.uH)(S.b,L)+",",Z+S.a+");"}function Re(I,L){const S=he(I,L);return S?"pattern"in I&&null!=I.pattern&&"style"===I.pattern.type&&"none"===I.pattern.style?null:{color:S,width:Math.min(I.size?(0,ee.F2)(I.size):.75,Y),style:"pattern"in I&&null!=I.pattern&&"style"===I.pattern.type?(0,Ve.Sp)(I.pattern.style):null,cap:"cap"in I?I.cap:null,join:"join"in I?"miter"===I.join?(0,ee.F2)(2):I.join:null}:{}}function Ie(I,L,S){const Z=null!=S?.75*S:0;return{type:"linear",x1:Z?.25*Z:0,y1:Z?.5*Z:0,x2:Z||4,y2:Z?.5*Z:4,colors:[{color:I,offset:0},{color:L,offset:1}]}}function ke(I){const L="number"==typeof I?.size?I?.size:null;return L?(0,ee.F2)(L):null}function Zt(){return Zt=(0,B.Z)(function*(I,L){const S=ke(L),Z=L?.maxSize?(0,ee.F2)(L.maxSize):null,W=L?.disableUpsampling??!1,X=I.symbolLayers,te=[];let ye=0,Ce=0;const ve=X.at(-1);let Ee;ve&&"icon"===ve.type&&(Ee=ve.size&&(0,ee.F2)(ve.size)),X.forEach(Fe=>{if("icon"!==Fe.type&&"object"!==Fe.type)return;const Oe="icon"===Fe.type?Fe.size&&(0,ee.F2)(Fe.size):0,Ue=S||Oe?Math.ceil(Math.min(S||Oe,Z||N)):j;if(Fe?.resource?.href){const fe=function oe(I,L){return le.apply(this,arguments)}(I,Fe).then(me=>{const Te=Fe?.material?.color,Qe=function Pt(I){return"icon"===I.type?"multiply":"tint"}(Fe);return(0,be.rG)(me,Ue,Te,Qe,W)}).then(me=>{const Te=me.width,Qe=me.height;return ye=Math.max(ye,Te),Ce=Math.max(Ce,Qe),[{shape:{type:"image",x:0,y:0,width:Te,height:Qe,src:me.url},fill:null,stroke:null}]});te.push(fe)}else{let fe=Ue;"icon"===Fe.type&&Ee&&S&&(fe=Ue*(Oe/Ee));const me="tall"===L?.symbolConfig||L?.symbolConfig?.isTall||"object"===Fe.type&&function Ke(I){const L=I.depth,S=I.height,Z=I.width;return 0!==Z&&0!==L&&0!==S&&Z===L&&null!=Z&&null!=S&&Z<S}(Fe);ye=Math.max(ye,me?K:fe),Ce=Math.max(Ce,fe),te.push(Promise.resolve(function Ye(I,L,S){const Z=[];if(!I)return Z;switch(I.type){case"icon":{const te=L,ye=L;switch(I.resource&&I.resource.primitive||De.S){case"circle":Z.push({shape:{type:"circle",cx:0,cy:0,r:.5*L},fill:ae(I,0),stroke:Q(I)});break;case"square":Z.push({shape:{type:"path",path:[{command:"M",values:[0,ye]},{command:"L",values:[0,0]},{command:"L",values:[te,0]},{command:"L",values:[te,ye]},{command:"Z",values:[]}]},fill:ae(I,0),stroke:Q(I)});break;case"triangle":Z.push({shape:{type:"path",path:[{command:"M",values:[0,ye]},{command:"L",values:[.5*te,0]},{command:"L",values:[te,ye]},{command:"Z",values:[]}]},fill:ae(I,0),stroke:Q(I)});break;case"cross":Z.push({shape:{type:"path",path:[{command:"M",values:[.5*te,0]},{command:"L",values:[.5*te,ye]},{command:"M",values:[0,.5*ye]},{command:"L",values:[te,.5*ye]}]},stroke:ge(I)});break;case"x":Z.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[te,ye]},{command:"M",values:[te,0]},{command:"L",values:[0,ye]}]},stroke:ge(I)});break;case"kite":Z.push({shape:{type:"path",path:[{command:"M",values:[0,.5*ye]},{command:"L",values:[.5*te,0]},{command:"L",values:[te,.5*ye]},{command:"L",values:[.5*te,ye]},{command:"Z",values:[]}]},fill:ae(I,0),stroke:Q(I)})}break}case"object":switch(I.resource&&I.resource.primitive||ne.S){case"cone":{const W=Ie(ae(I,0),ae(I,-.6),S?K:L),X=(0,se.TE)(L,S);Z.push({shape:X[0],fill:W},{shape:X[1],fill:W});break}case"inverted-cone":{const W=ae(I,0),X=Ie(W,ae(I,-.6),L),te=(0,se.DY)(L);Z.push({shape:te[0],fill:X},{shape:te[1],fill:W});break}case"cube":{const W=(0,se.Pc)(L,S);Z.push({shape:W[0],fill:ae(I,0)},{shape:W[1],fill:ae(I,-.3)},{shape:W[2],fill:ae(I,-.5)});break}case"cylinder":{const W=Ie(ae(I,0),ae(I,-.6),S?K:L),X=(0,se.EB)(L,S);Z.push({shape:X[0],fill:W},{shape:X[1],fill:W},{shape:X[2],fill:ae(I,0)});break}case"diamond":{const W=(0,se.XX)(L);Z.push({shape:W[0],fill:ae(I,-.3)},{shape:W[1],fill:ae(I,0)},{shape:W[2],fill:ae(I,-.3)},{shape:W[3],fill:ae(I,-.7)});break}case"sphere":{const W=Ie(ae(I,0),ae(I,-.6));W.x1=0,W.y1=0,W.x2=.25*L,W.y2=.25*L,Z.push({shape:{type:"circle",cx:0,cy:0,r:.5*L},fill:W});break}case"tetrahedron":{const W=(0,se.tp)(L);Z.push({shape:W[0],fill:ae(I,-.3)},{shape:W[1],fill:ae(I,0)},{shape:W[2],fill:ae(I,-.6)});break}}}return Z}(Fe,fe,me)))}});const Xe=yield Promise.allSettled(te),ce=[];return Xe.forEach(Fe=>{"fulfilled"===Fe.status?ce.push(Fe.value):Fe.reason&&A.Z.getLogger("esri.symbols.support.previewSymbol3D").warn("error while building swatchInfo!",Fe.reason)}),(0,be.wh)(ce,[ye,Ce],{node:L?.node,scale:!1,opacity:L?.opacity,ariaLabel:L?.ariaLabel})}),Zt.apply(this,arguments)}function O(){return(O=(0,B.Z)(function*(I,L){const S="mesh-3d"===I.type,Z=I.symbolLayers,W=ke(L),X=L?.maxSize?(0,ee.F2)(L.maxSize):null,te=W||j,ye=[];let Ce=0,ve=0,Ee=!1;for(let Xe=0;Xe<Z.length;Xe++){const ce=Z.at(Xe),Fe=[];if(!S||"fill"===ce.type){switch(ce.type){case"fill":{const Oe=Math.min(te,X||N);if(Ce=Math.max(Ce,Oe),ve=Math.max(ve,Oe),Ee=!0,S){const Ue=se.JZ.meshSymbol3DFill,fe=he(ce,-.4),me=fe?{color:fe,width:1,join:"round"}:{};Fe.push({shape:Ue[0],fill:ae(ce,0),stroke:me},{shape:Ue[1],fill:ae(ce,-.2),stroke:me},{shape:Ue[2],fill:ae(ce,-.6),stroke:me})}else{let Ue=ae(ce,0);const fe="pattern"in ce?ce.pattern:null,me=Q(ce),Te=pe(ce);null!=fe&&"style"===fe.type&&"solid"!==fe.style&&Te&&(Ue=yield He(fe,Te)),Fe.push({shape:se.JZ.fill[0],fill:Ue,stroke:me})}break}case"line":{const Oe=Re(ce,0);if(null==Oe)break;const Ue={stroke:Oe,shape:se.JZ.fill[0]};Ce=Math.max(Ce,j),ve=Math.max(ve,j),Fe.push(Ue);break}case"extrude":{const Oe={join:"round",width:1,...Re(ce,-.4)},Ue=ae(ce,0),fe=ae(ce,-.2),me=Math.min(te,X||N),Te=(0,se.EV)(me);Oe.width=1,Fe.push({shape:Te[0],fill:fe,stroke:Oe},{shape:Te[1],fill:fe,stroke:Oe},{shape:Te[2],fill:Ue,stroke:Oe});const at=.7*j+.5*me;Ce=Math.max(Ce,j),ve=Math.max(ve,at);break}case"water":{const Oe=pe(ce),Ue=q(Oe),fe=q(Oe,2),me=q(Oe,3),Te=(0,se.ht)();Ee=!0,Fe.push({shape:Te[0],fill:Ue},{shape:Te[1],fill:fe},{shape:Te[2],fill:me});const Qe=Math.min(te,X||N);Ce=Math.max(Ce,Qe),ve=Math.max(ve,Qe);break}}ye.push(Fe)}}return(0,be.wh)(ye,[Ce,ve],{node:L?.node,scale:Ee,opacity:L?.opacity,ariaLabel:L?.ariaLabel})})).apply(this,arguments)}function E(I,L){if(0===I.symbolLayers.length)return Promise.reject(new $.Z("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(I.type){case"point-3d":return function ti(I,L){return Zt.apply(this,arguments)}(I,L);case"line-3d":return function ii(I,L){const S=I.symbolLayers,Z=[],W=(0,$e.YW)(I),X=ke(L),te=(L?.maxSize?(0,ee.F2)(L.maxSize):null)||Y;let ye,Ce=0,ve=0;return S.forEach((Ee,Xe)=>{if(!Ee||"line"!==Ee.type&&"path"!==Ee.type)return;const ce=[];switch(Ee.type){case"line":{const Fe=Re(Ee,0);if(null==Fe)break;const Oe=Fe?.width||0;0===Xe&&(ye=Oe);const Ue=Math.min(X||Oe,te),fe=0===Xe?Ue:X?Ue*(Oe/ye):Ue,me=fe>D/2?2*fe:D;ve=Math.max(ve,fe),Ce=Math.max(Ce,me),Fe.width=fe,ce.push({shape:{type:"path",path:[{command:"M",values:[0,.5*ve]},{command:"L",values:[Ce,.5*ve]}]},stroke:Fe});break}case"path":{const Fe=Math.min(X||j,te),Oe=ae(Ee,0),Ue=ae(Ee,-.2),fe=he(Ee,-.4),me=fe?{color:fe,width:1}:{};if("quad"===Ee.profile){const Te=Ee.width,Qe=Ee.height,at=(0,se.eb)(Te&&Qe?Te/Qe:1,0===Qe,0===Te),lt={...me,join:"bevel"};ce.push({shape:at[0],fill:Ue,stroke:lt},{shape:at[1],fill:Ue,stroke:lt},{shape:at[2],fill:Oe,stroke:lt})}else ce.push({shape:se.JZ.pathSymbol3DLayer[0],fill:Ue,stroke:me},{shape:se.JZ.pathSymbol3DLayer[1],fill:Oe,stroke:me});ve=Math.max(ve,Fe),Ce=ve}}Z.push(ce)}),Promise.resolve((0,be.wh)(Z,[Ce,ve],{node:L?.node,scale:W,opacity:L?.opacity,ariaLabel:L?.ariaLabel}))}(I,L);case"polygon-3d":case"mesh-3d":return function ni(I,L){return O.apply(this,arguments)}(I,L)}return Promise.reject(new $.Z("symbolPreview: swatchInfo3D","symbol not supported."))}},86336:(Ft,We,C)=>{C.d(We,{DY:()=>ne,EB:()=>Ve,EV:()=>$,JZ:()=>xe,Pc:()=>ee,TE:()=>De,XX:()=>se,b_:()=>_,dc:()=>je,eb:()=>Pe,ht:()=>A,tp:()=>be,uH:()=>$e});var _,j,B=C(66599);(j=_||(_={}))[j.size=22]="size",j[j.lineWidth=50]="lineWidth",j[j.maxSize=120]="maxSize",j[j.maxOutlineSize=80]="maxOutlineSize",j[j.tallSymbolWidth=20]="tallSymbolWidth";const xe={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],squareFill:[{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"}],meshSymbol3DFill:[{type:"path",path:"M -10,-8 L 6,0 L 6,6 L -10,6 L -10,-8 Z"},{type:"path",path:"M -10,-8 L -7,-10 L 9,-2 L 6,0 L -10,-8 Z"},{type:"path",path:"M 6,0 L 9,-2 L 9,4 L 6,6 L 6,0 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};function Pe(j,N,Y){const D=_.size;let K=D,Q=D;j<1?K*=.75:j>1&&(Q*=1.25);let q=D,pe=D;return N&&Y&&(K=Q=q=pe=0),[{type:"path",path:[{command:"M",values:[q,0]},{command:"L",values:[Y?q:.875*q,0]},{command:"L",values:[Y?K-.5*q:0,Q-.5*pe]},{command:"L",values:[K-.5*q,Q-.5*pe]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[q,0]},{command:"L",values:[q,N?0:.125*pe]},{command:"L",values:[K-.5*q,N?Q-.5*pe:pe]},{command:"L",values:[K-.5*q,Q-.5*pe]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[K-.5*q,Q-.5*pe]},{command:"L",values:[Y?K-.5*q:0,Q-.5*pe]},{command:"L",values:[Y?K-.5*q:0,N?Q-.5*pe:pe]},{command:"L",values:[K-.5*q,N?Q-.5*pe:pe]},{command:"Z",values:[]}]}]}function $(j){const N=_.size,Y=.5*j;return[{type:"path",path:[{command:"M",values:[0,.7*N*.5]},{command:"L",values:[.3*N,.7*N]},{command:"L",values:[.3*N,.7*N+Y]},{command:"L",values:[0,.7*N+Y-.7*N*.5]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*N,.7*N]},{command:"L",values:[.3*N,.7*N+Y]},{command:"L",values:[N,Y]},{command:"L",values:[N,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*N,0]},{command:"L",values:[N,0]},{command:"L",values:[.3*N,.7*N]},{command:"L",values:[0,.7*N*.5]},{command:"Z",values:[]}]}]}function A(){return[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}]}function ee(j,N){let Y=N?_.tallSymbolWidth:j;const K=N?4:6;Y-=Y<=_.size?.5*K:K;const le=N?.35*Y:.5*Y;return[{type:"path",path:[{command:"M",values:[.5*Y,0]},{command:"L",values:[Y,.5*le]},{command:"L",values:[.5*Y,le]},{command:"L",values:[0,.5*le]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*le]},{command:"L",values:[.5*Y,le]},{command:"L",values:[.5*Y,j]},{command:"L",values:[0,j-.5*le]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*Y,le]},{command:"L",values:[.5*Y,j]},{command:"L",values:[Y,j-.5*le]},{command:"L",values:[Y,.5*le]},{command:"Z",values:[]}]}]}function Ve(j,N){let Y=N?_.tallSymbolWidth:j;const K=N?4:6;Y-=Y<=_.size?.5*K:K;const Q=.5*Y,oe=.15*Y,q=j-oe;return[{type:"ellipse",cx:.5*Y,cy:q,rx:Q,ry:oe},{type:"path",path:[{command:"M",values:[0,oe]},{command:"L",values:[0,q]},{command:"L",values:[Y,q]},{command:"L",values:[Y,oe]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*Y,cy:oe,rx:Q,ry:oe}]}function De(j,N){let Y=N?_.tallSymbolWidth:j;const K=N?4:6;Y-=Y<=_.size?.5*K:K;const Q=.15*Y,oe=j-Q;return[{type:"ellipse",cx:.5*Y,cy:oe,rx:.5*Y,ry:Q},{type:"path",path:[{command:"M",values:[.5*Y,0]},{command:"L",values:[Y,oe]},{command:"L",values:[0,oe]},{command:"Z",values:[]}]}]}function ne(j){let N=j;N-=N<_.size?3:6;const K=.15*N;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[N,0]},{command:"L",values:[.5*N,j-K]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*N,cy:0,rx:.5*N,ry:K}]}function se(j){let N=j;const Y=j;N-=N<_.size?2:4;const oe=N,le=Y,q=Math.floor(j/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*oe,0]},{command:"L",values:[oe,.5*le-q]},{command:"L",values:[.45*oe-q,.5*le+q]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*oe,0]},{command:"L",values:[.45*oe-q,.5*le+q]},{command:"L",values:[0,.5*le-q]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*le-q]},{command:"L",values:[.45*oe-q,.5*le+q]},{command:"L",values:[.45*oe,Y]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*oe,Y]},{command:"L",values:[oe,.5*le-q]},{command:"L",values:[.45*oe-q,.5*le+q]},{command:"Z",values:[]}]}]}function be(j){let D=j;return D-=D<_.size?1:2,[{type:"path",path:[{command:"M",values:[.45*j,0]},{command:"L",values:[j,D]},{command:"L",values:[.45*j,.6*D]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*j,0]},{command:"L",values:[.45*j,.6*D]},{command:"L",values:[0,D]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,D]},{command:"L",values:[.45*j,.6*D]},{command:"L",values:[j,D]},{command:"Z",values:[]}]}]}function $e(j,N){return Math.round(Math.min(Math.max(j+255*N*.75,0),255))}function je(j,N){if(null==j)return new B.Z;if("type"in j&&("linear"===j.type||"pattern"===j.type))return j;const Y=new B.Z(j);return new B.Z([$e(Y.r,N),$e(Y.g,N),$e(Y.b,N),Y.a])}},36232:(Ft,We,C)=>{C.d(We,{rG:()=>Y,wh:()=>be});var B=C(26152),_=C(66476),xe=C(70794),Pe=C(57964),$=C(14007),ee=(C(33740),C(58242)),Ve=C(96936),De=C(62616);const ne=(0,ee.E)();function be(D,K,Q){const oe=Math.ceil(K[0]),le=Math.ceil(K[1]);if(!D.some(pe=>!!pe.length))return null;const q=Q?.node||document.createElement("div");return null!=Q.opacity&&(q.style.opacity=Q.opacity.toString()),null!=Q.effectView&&(q.style.filter=(0,De.wJ)(Q.effectView)),function se(D,K){ne.append(D,K),ne.detach(K)}(q,()=>(0,Ve.KB)(D,oe,le,Q)),q}function N(D,K,Q,oe,le){switch(le){case"multiply":D[K]*=Q[0],D[K+1]*=Q[1],D[K+2]*=Q[2],D[K+3]*=Q[3];break;default:{const q=(0,xe._Y)({r:D[K],g:D[K+1],b:D[K+2]});q.h=oe.h,q.s=oe.s,q.v=q.v/100*oe.v;const pe=(0,xe.xr)(q);D[K]=pe.r,D[K+1]=pe.g,D[K+2]=pe.b,D[K+3]*=Q[3];break}}}function Y(D,K,Q,oe,le){return function je(D,K,Q){return D?(0,_.Z)(D,{responseType:"image"}).then(oe=>{const le=oe.data,q=le.width,pe=le.height,ae=q/pe;let He=K;if(Q){const G=Math.max(q,pe);He=Math.min(He,G)}return{image:le,width:ae<=1?Math.ceil(He*ae):He,height:ae<=1?He:Math.ceil(He/ae)}}):Promise.reject(new Pe.Z("renderUtils: imageDataSize","href not provided."))}(D,K,le).then(q=>{const pe=q.width??K,ae=q.height??K;if(q.image&&function j(D,K){return!(!D||"ignore"===K||"multiply"===K&&255===D.r&&255===D.g&&255===D.b&&1===D.a)}(Q,oe)){let He=q.image.width,G=q.image.height;(0,$.Z)("edge")&&/\.svg$/i.test(D)&&(He-=1,G-=1);const ge=function $e(D,K){D=Math.ceil(D),K=Math.ceil(K);const Q=document.createElement("canvas");Q.width=D,Q.height=K,Q.style.width=D+"px",Q.style.height=K+"px";const oe=Q.getContext("2d");return oe.clearRect(0,0,D,K),oe}(pe,ae);ge.drawImage(q.image,0,0,He,G,0,0,pe,ae);const he=ge.getImageData(0,0,pe,ae),Re=[Q.r/255,Q.g/255,Q.b/255,Q.a],Ie=(0,xe._Y)(Q);for(let Ke=0;Ke<he.data.length;Ke+=4)N(he.data,Ke,Re,Ie,oe);ge.putImageData(he,0,0),D=ge.canvas.toDataURL("image/png")}else{const He=B.id?.findCredential(D);if(He?.token){const G=D.includes("?")?"&":"?";D=`${D}${G}token=${He.token}`}}return{url:D,width:pe,height:ae}}).catch(()=>({url:D,width:K,height:K}))}},96936:(Ft,We,C)=>{C.d(We,{KB:()=>ni});var B=C(66599),_=C(14007),xe=C(51172),Pe=C(89921),$=C(86662),ee=(C(40846),C(2485));const Ve="http://www.w3.org/2000/svg";let De=0,ne=0;const se=(0,_.Z)("android"),be=(0,_.Z)("chrome")||se&&se>=4?"auto":"optimizeLegibility",$e={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},je=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g;let j={},N={};const Y={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]},D=Math.PI;let K=1;function Q(O,E){const I=O*(D/180);return Math.abs(E*Math.sin(I))+Math.abs(E*Math.cos(I))}function oe(O){return O.map(E=>`${E.command} ${E.values.join(" ")}`).join(" ").trim()}function le(O,E,I,L){if(O){if("circle"===O.type)return(0,ee.u)("circle",{cx:O.cx,cy:O.cy,fill:E,"fill-rule":"evenodd",r:O.r,stroke:I.color,"stroke-dasharray":I.dashArray,"stroke-dashoffset":I.dashOffset,"stroke-linecap":I.cap,"stroke-linejoin":I.join,"stroke-miterlimit":"4","stroke-width":I.width});if("ellipse"===O.type)return(0,ee.u)("ellipse",{cx:O.cx,cy:O.cy,fill:E,"fill-rule":"evenodd",rx:O.rx,ry:O.ry,stroke:I.color,"stroke-dasharray":I.dashArray,"stroke-linecap":I.cap,"stroke-linejoin":I.join,"stroke-miterlimit":"4","stroke-width":I.width});if("rect"===O.type)return(0,ee.u)("rect",{fill:E,"fill-rule":"evenodd",height:O.height,stroke:I.color,"stroke-dasharray":I.dashArray,"stroke-linecap":I.cap,"stroke-linejoin":I.join,"stroke-miterlimit":"4","stroke-width":I.width,width:O.width,x:O.x,y:O.y});if("image"===O.type)return(0,ee.u)("image",{height:O.height,href:O.src,preserveAspectRatio:"none",width:O.width,x:O.x,y:O.y});if("path"===O.type){const S="string"!=typeof O.path?oe(O.path):O.path;return(0,ee.u)("path",{d:S,fill:E,"fill-rule":"evenodd",stroke:I.color,"stroke-dasharray":I.dashArray,"stroke-linecap":I.cap,"stroke-linejoin":I.join,"stroke-miterlimit":"4","stroke-width":I.width})}if("text"===O.type)return(0,xe.O3)(L),(0,ee.u)("text",{"dominant-baseline":L.dominantBaseline,fill:E,"fill-rule":"evenodd","font-family":L.font.family,"font-size":L.font.size,"font-style":L.font.style,"font-variant":L.font.variant,"font-weight":L.font.weight,kerning:L.kerning,rotate:L.rotate,stroke:I.color,"stroke-dasharray":I.dashArray,"stroke-linecap":I.cap,"stroke-linejoin":I.join,"stroke-miterlimit":"4","stroke-width":I.width,"text-anchor":L.align,"text-decoration":L.decoration,"text-rendering":be,x:O.x,y:O.y},O.text)}return null}function q(O){const E={fill:"none",pattern:null,linearGradient:null};if(O)if("type"in O&&"pattern"===O.type){const I="patternId-"+ ++De;E.fill=`url(#${I})`,E.pattern={id:I,x:O.x,y:O.y,width:O.width,height:O.height,image:{x:0,y:0,width:O.width,height:O.height,href:O.src}}}else if("type"in O&&"linear"===O.type){const I="linearGradientId-"+ ++ne;E.fill=`url(#${I})`,E.linearGradient={id:I,x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,stops:O.colors.map(L=>({offset:L.offset,color:L.color&&new B.Z(L.color).toString()}))}}else if(O){const I=new B.Z(O);E.fill=I.toString()}return E}function pe(O){const E={color:"none",width:1,cap:"butt",join:"4",dashArray:"none",dashOffset:"0"};if(O&&(null!=O.width&&(E.width=O.width),O.cap&&(E.cap=O.cap),O.join&&(E.join=O.join.toString()),O.color&&(E.color=new B.Z(O.color).toString()),O.dashArray&&(E.dashArray=O.dashArray),O.dashArray&&(E.dashOffset=O.dashoffset),O.style)){let I=null;if(O.style in Y&&(I=Y[O.style]),Array.isArray(I)){I=I.slice(0);const L=O.width??0;for(let S=0;S<I.length;++S)I[S]*=L;if("butt"!==O.cap){for(let S=0;S<I.length;S+=2)I[S]-=L,I[S]<1&&(I[S]=1);for(let S=1;S<I.length;S+=2)I[S]+=L}I=I.join(",")}E.dashArray=I}return E}function ae(O,E){const I={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};if(O){const L=O.alignBaseline,S="baseline"===L?"auto":"top"===L?"text-top":"bottom"===L?"hanging":L;I.align=O.align,I.dominantBaseline=S,I.decoration=O.decoration,I.kerning=O.kerning?"auto":"0",I.rotate=O.rotated?"90":"0",(0,xe.O3)(E),I.font.style=E.style||"normal",I.font.variant=E.variant||"normal",I.font.weight=E.weight||"normal",I.font.size=E.size&&E.size.toString()||"10pt",I.font.family=E.family||"serif"}return I}function He(O){const{pattern:E,linearGradient:I}=O;if(E)return(0,ee.u)("pattern",{height:E.height,id:E.id,patternUnits:"userSpaceOnUse",width:E.width,x:E.x,y:E.y},(0,ee.u)("image",{height:E.image.height,href:E.image.href,width:E.image.width,x:E.image.x,y:E.image.y}));if(I){const L=I.stops.map((S,Z)=>(0,ee.u)("stop",{key:`${Z}-stop`,offset:S.offset,"stop-color":S.color}));return(0,ee.u)("linearGradient",{gradientUnits:"userSpaceOnUse",id:I.id,x1:I.x1,x2:I.x2,y1:I.y1,y2:I.y2},L)}return null}function G(O,E){if(!O||0===O.length)return null;const I=[];for(const L of O){const{shape:S,fill:Z,stroke:W,font:X}=L,te=q(Z),ye=pe(W),Ce="text"===S.type?ae(S,X):null,ve=le(S,te.fill,ye,Ce);ve&&I.push(ve)}return(0,ee.u)("mask",{id:E,maskUnits:"userSpaceOnUse"},(0,ee.u)("g",null,I))}function ge(O,E,I){return(0,$.t)(O,(0,$.c)(O),[E,I])}function he(O,E,I,L,S){return(0,$.s)(O,(0,$.c)(O),[E,I]),O[4]=O[4]*E-L*E+L,O[5]=O[5]*I-S*I+S,O}function Ie(O,E){j&&"left"in j?(null!=j.left&&j.left>O&&(j.left=O),(null==j.right||j.right<O)&&(j.right=O),(null==j.top||j.top>E)&&(j.top=E),(null==j.bottom||j.bottom<E)&&(j.bottom=E)):j={left:O,bottom:E,right:O,top:E}}function Ke(O){const E=O.args,I=E.length;let L;switch(O.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(L=0;L<I;L+=2)Ie(E[L],E[L+1]);N.x=E[I-2],N.y=E[I-1];break;case"H":for(L=0;L<I;++L)Ie(E[L],N.y);N.x=E[I-1];break;case"V":for(L=0;L<I;++L)Ie(N.x,E[L]);N.y=E[I-1];break;case"m":{let S=0;for(("x"in N||(Ie(N.x=E[0],N.y=E[1]),S=2),L=S);L<I;L+=2)Ie(N.x+=E[L],N.y+=E[L+1]);break}case"l":case"t":for(L=0;L<I;L+=2)Ie(N.x+=E[L],N.y+=E[L+1]);break;case"h":for(L=0;L<I;++L)Ie(N.x+=E[L],N.y);break;case"v":for(L=0;L<I;++L)Ie(N.x,N.y+=E[L]);break;case"c":for(L=0;L<I;L+=6)Ie(N.x+E[L],N.y+E[L+1]),Ie(N.x+E[L+2],N.y+E[L+3]),Ie(N.x+=E[L+4],N.y+=E[L+5]);break;case"s":case"q":for(L=0;L<I;L+=4)Ie(N.x+E[L],N.y+E[L+1]),Ie(N.x+=E[L+2],N.y+=E[L+3]);break;case"A":for(L=0;L<I;L+=7)Ie(E[L+5],E[L+6]);N.x=E[I-2],N.y=E[I-1];break;case"a":for(L=0;L<I;L+=7)Ie(N.x+=E[L+5],N.y+=E[L+6])}}function Ye(O,E,I){const L=$e[O.toLowerCase()];let S;"number"==typeof L&&(L?E.length>=L&&(S={action:O,args:E.slice(0,E.length-E.length%L)},I.push(S),Ke(S)):(S={action:O,args:[]},I.push(S),Ke(S)))}function Pt(O){const E={x:0,y:0,width:0,height:0};if("circle"===O.type)E.x=O.cx-O.r,E.y=O.cy-O.r,E.width=2*O.r,E.height=2*O.r;else if("ellipse"===O.type)E.x=O.cx-O.rx,E.y=O.cy-O.ry,E.width=2*O.rx,E.height=2*O.ry;else if("image"===O.type||"rect"===O.type)E.x=O.x,E.y=O.y,E.width=O.width,E.height=O.height;else if("path"===O.type){const I=function ke(O){const E=("string"!=typeof O.path?oe(O.path):O.path).match(je),I=[];if(j={},N={},!E)return null;let L="",S=[];const Z=E.length;for(let X=0;X<Z;++X){const te=E[X],ye=parseFloat(te);isNaN(ye)?(L&&Ye(L,S,I),S=[],L=te):S.push(ye)}Ye(L,S,I);const W={x:0,y:0,width:0,height:0};return j&&"left"in j&&(W.x=j.left,W.y=j.top,W.width=j.right-j.left,W.height=j.bottom-j.top),W}(O);E.x=I.x,E.y=I.y,E.width=I.width,E.height=I.height}return E}function ti(O){const E={x:0,y:0,width:0,height:0};let I=null,L=Number.NEGATIVE_INFINITY,S=Number.NEGATIVE_INFINITY;for(const Z of O)I?(I.x=Math.min(I.x,Z.x),I.y=Math.min(I.y,Z.y),L=Math.max(L,Z.x+Z.width),S=Math.max(S,Z.y+Z.height)):(I=E,I.x=Z.x,I.y=Z.y,L=Z.x+Z.width,S=Z.y+Z.height);return I&&(I.width=L-I.x,I.height=S-I.y),I}function Zt(O,E,I,L,S,Z,W,X,te){let ye=(W&&Z?Q(Z,E):E)/2,Ce=(W&&Z?Q(Z,I):I)/2;if(te){const fe=te[0],me=te[1];ye=(W&&Z?Q(Z,fe):fe)/2,Ce=(W&&Z?Q(Z,me):me)/2}const ve=O.width+L,Ee=O.height+L,Xe=(0,Pe.c)(),ce=(0,Pe.c)();let Fe=!1;if(S&&0!==ve&&0!==Ee){const fe=E!==I?E/I:ve/Ee,me=E>I?E:I;let Te=1,Qe=1;isNaN(me)||(fe>1?(Te=me/ve,Qe=me/fe/Ee):(Qe=me/Ee,Te=me*fe/ve)),(0,$.m)(ce,ce,he(Xe,Te,Qe,ye,Ce)),Fe=!0}const Oe=O.x+(ve-L)/2,Ue=O.y+(Ee-L)/2;if((0,$.m)(ce,ce,ge(Xe,ye-Oe,Ce-Ue)),!Fe&&(ve>E||Ee>I)){const fe=ve/E>Ee/I,me=(fe?E:I)/(fe?ve:Ee);(0,$.m)(ce,ce,he(Xe,me,me,Oe,Ue))}return Z&&(0,$.m)(ce,ce,function Re(O,E,I,L){const S=E%360*Math.PI/180;(0,$.r)(O,(0,$.c)(O),S);const Z=Math.cos(S),W=Math.sin(S),X=O[4],te=O[5];return O[4]=X*Z-te*W+L*W-I*Z+I,O[5]=te*Z+X*W-I*W-L*Z+L,O}(Xe,Z,Oe,Ue)),X&&(0,$.m)(ce,ce,ge(Xe,X[0],X[1])),`matrix(${ce[0]},${ce[1]},${ce[2]},${ce[3]},${ce[4]},${ce[5]})`}function ni(O,E,I,L={}){const S=[],Z=[],W=++K,X=function ii(O,E,I){const L=O?.effects.find(ye=>"bloom"===ye.type);if(!L)return null;const{strength:S,radius:Z}=L,W=S>0?Z:0,X=(S+W)*E,te=4*S+1;return(0,ee.u)("filter",{filterUnits:"userSpaceOnUse",height:"300%",id:`bloom${I}`,width:"300%",x:"-100%",y:"-100%"},(0,ee.u)("feMorphology",{in:"SourceGraphic",operator:"dilate",radius:(S+.5*W)*(5**(E/100)*(.4+E/100)),result:"dilate"}),(0,ee.u)("feGaussianBlur",{in:"dilate",result:"blur",stdDeviation:X/25}),(0,ee.u)("feGaussianBlur",{in:"blur",result:"intensityBlur",stdDeviation:X/50}),(0,ee.u)("feComponentTransfer",{in:"SourceGraphic",result:"intensityBrightness"},(0,ee.u)("feFuncR",{slope:te,type:"linear"}),(0,ee.u)("feFuncG",{slope:te,type:"linear"}),(0,ee.u)("feFuncB",{slope:te,type:"linear"})),(0,ee.u)("feMerge",null,(0,ee.u)("feMergeNode",{in:"intensityBlur"}),(0,ee.u)("feMergeNode",{in:"intensityBrightness"}),(0,ee.u)("feGaussianBlur",{stdDeviation:S/10})))}(L.effectView,E,W);let te=null;if(X){const Ce=L.effectView?.effects.find(ce=>"bloom"===ce.type),ve=(Ce.strength?Ce.strength+Ce.radius/2:0)/3,Xe=I+I*ve;te=[Math.max(E+E*ve,10),Math.max(Xe,10)]}for(let Ce=0;Ce<O.length;Ce++){const ve=O[Ce],Ee=[],Xe=[];let ce=0,Fe=0,Oe=0;for(const me of ve){const{shape:Te,fill:Qe,stroke:at,font:lt,offset:si}=me;L.ignoreStrokeWidth||"text"===Te.type||(ce+=at?.width||0);const oi=q(Qe),Gt=pe(at),Vt="text"===Te.type?ae(Te,lt):null;S.push(He(oi)),Ee.push(le(Te,oi.fill,Gt,Vt)),Xe.push(Pt(Te)),si&&(Fe+=si[0],Oe+=si[1])}const Ue=Zt(ti(Xe),E,I,ce,L.scale??!1,L.rotation,L.useRotationSize??!1,[Fe,Oe],te);let fe=null;if(L.masking){const me=`mask-${Ce}`;S.push(G(L.masking[Ce],me)),fe=`url(#${me})`}Z.push(fe?(0,ee.u)("g",{mask:fe},(0,ee.u)("g",{transform:Ue},Ee)):(0,ee.u)("g",{transform:Ue},Ee))}return L.useRotationSize&&L.rotation&&(E=Q(L.rotation,E),I=Q(L.rotation,I)),X&&((0,xe.O3)(te),E=te[0],I=te[1]),(0,ee.u)("svg",{"aria-labelledby":L.ariaLabel,focusable:!1,height:I,role:"img",style:"display: block;",width:E,xmlns:Ve},X,(0,ee.u)("defs",null,S),X?(0,ee.u)("g",{filter:`url(#bloom${W})`},Z):Z)}},33651:(Ft,We,C)=>{C.r(We),C.d(We,{default:()=>tl});var B=C(15861),_=C(50484),xe=C(93300),Pe=C(4703),$=C(77675),A=C(80543),Ve=(C(1535),C(57678)),ne=(C(14007),C(10141)),se=C(99002),$e=(C(91531),C(83944)),je=C(90984),j=C(9922),N=C(73018),Y=C(53021),D=C(57964),K=C(38737),oe=(C(32017),C(55117)),le=C(49602);function G(g,y,v="arithmetic"){return{type:(0,le.UF)(y),value:g,unit:y,rotationType:v}}(function pe(g,y){(0,le.UF)(y)})(0,"meters"),function ae(g,y){(0,le.UF)(y)}(0,"square-meters"),G(0,"radians"),G(0,"degrees");var O=C(72578),E=C(37689);const Te=["B","kB","MB","GB","TB"];var at=C(35458),lt=C(73514),si=C(85596),oi=C(12768),Gt=C(94678),Vt=C(85295),uo=C(85971),vi=C(43157),kn=C(4978),ri=C(764);const Wn=Pe.Z.getLogger("esri.widgets.Feature.support.featureUtils"),ho=/href=(""|'')/gi,po=/(\{([^\{\r\n]+)\})/g,mo=/\'/g,Hn=/^\s*expression\//i,fo=/(\n)/gi,go=/[\u00A0-\u9999<>\&]/gim,yo=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,vo=/^(?:mailto:|tel:)/,Yn="relationships/",Gn=(0,Gt.Ze)("short-date-short-time");function Kn(g){if(null!=g)return(g.sourceLayer||g.layer)??void 0}function bi(g,y){return Ui.apply(this,arguments)}function Ui(){return(Ui=(0,B.Z)(function*(g,y){return"function"==typeof g?g(y):g})).apply(this,arguments)}function Qn(g=""){if(g)return!vo.test(g.trim().toLowerCase())}function Si(g){return!!g&&Hn.test(g)}function Xn(g,y){const v=function bo(g,y){if(!Si(y)||!g)return null;const v=y.replace(Hn,"").toLowerCase();let b=null;return g.some(w=>w.name.toLowerCase()===v&&(b=w,!0)),b}(y,g?.fieldName);return v?v.title||null:g?g.label||g.fieldName:null}function ai(g,y){const v=Zi(y,g);return v?v.name:g}function Zi(g,y){return g&&"function"==typeof g.getField&&y?g.getField(y)??null:null}function Jn(g){return`${g}`.trim()}function $t({attributes:g,globalAttributes:y,layer:v,text:b,expressionAttributes:w,fieldInfoMap:M}){return b?Vi({formattedAttributes:y,template:Ao(b,{...y,...w,...g},v),fieldInfoMap:M}):""}function Vi({formattedAttributes:g,template:y,fieldInfoMap:v}){return Jn(function Mo(g){return g.replaceAll(ho,"")}((0,O.gx)((0,O.gx)(y,b=>function wo(g,y){return`{${y.get(g.toLowerCase())?.fieldName||g}}`}(b,v)),g)))}function $i(g,y){return g.replaceAll(po,(v,b,w)=>{const M=Zi(y,w);return M?`{${M.name}}`:b})}function Ao(g,y,v){const b=$i(g,v);return b&&b.replaceAll(yo,(w,M,F)=>function Io(g,y,v){const b=(y=Jn(y))&&"{"!==y[0];return(0,O.gx)(g,function _o(g,y=!1){const v={...g};return Object.keys(v).forEach(b=>function Fo(g,y,v=!1){const b=y[g];if("string"==typeof b){const w="%27",M=(v?encodeURIComponent(b):b).replaceAll(mo,w);y[g]=M}}(b,v,y)),v}(v,b||!1))}(w,M||F,y))}function Di(g){return function Eo(g){return null!=g&&"object"==typeof g&&"fieldsIndex"in g&&"geometryType"in g&&"getField"in g&&"load"in g&&"loaded"in g&&"objectIdField"in g&&"spatialReference"in g&&"type"in g&&("feature"===g.type||"scene"===g.type)&&"when"in g}(g)&&function Lo(g){return null!=g&&"object"==typeof g&&"createQuery"in g&&"queryFeatureCount"in g&&"queryObjectIds"in g&&"queryRelatedFeatures"in g&&"queryRelatedFeaturesCount"in g&&"relationships"in g}(g)}function Ni(g,y,v,b){return g.trim().split(y).map(w=>(0,E.uf)(Number(w),(0,E.sh)(b))).join(v)}function qn(g,y){if(g?.length&&y)return g.find(v=>v.fieldName?.toLowerCase()===y.toLowerCase())}function es(g){const y=[];if(!g)return y;const{fieldInfos:v,content:b}=g;return v&&y.push(...v),b&&Array.isArray(b)&&b.forEach(w=>{if("fields"===w.type){const M=w?.fieldInfos;M&&y.push(...M)}}),y}function Bi(g){return g.replaceAll(go,y=>`&#${y.charCodeAt(0)};`)}function li(g){return"string"==typeof g?g.replaceAll(fo,'<br class="esri-text-new-line" />'):g}function ts(g){const{value:y,fieldName:v,fieldInfos:b,fieldInfoMap:w,layer:M,graphic:F,timeZone:x}=g;if(null==y)return"";const T=function Oo({fieldName:g,value:y,graphic:v,layer:b}){if(At(g)||!b||"function"!=typeof b.getFieldDomain)return null;const w=v&&b.getFieldDomain(g,{feature:v});return w&&"coded-value"===w.type?w.getName(y):null}({fieldName:v,value:y,graphic:F,layer:M});if(T)return T;const P=function Ro({fieldName:g,graphic:y,layer:v}){if(At(g)||!v||"function"!=typeof v.getFeatureType)return null;const{typeIdField:b}=v;if(!b||g!==b)return null;const w=v.getFeatureType(y);return w?w.name:null}({fieldName:v,graphic:F,layer:M});if(P)return P;if(w.get(v.toLowerCase()))return function To(g,y){const{fieldInfos:v,fieldName:b,preventPlacesFormatting:w,layer:M,timeZone:F}=y,x=qn(v,b),T=Zi(M,b);if(x&&!(0,Vt.Ec)(b)){const R=T?.type,V=x.format?.dateFormat;if("date"===R||"date-only"===R||"time-only"===R||"timestamp-offset"===R||V)return(0,vi.$8)(g,{format:V,fieldType:R,timeZoneOptions:{layerTimeZone:M&&"preferredTimeZone"in M?M.preferredTimeZone:null,viewTimeZone:F,datesInUnknownTimezone:!(!M||!("datesInUnknownTimezone"in M)||!M.datesInUnknownTimezone)}})}const P=x?.format;return"string"==typeof g&&(0,Vt.Ec)(b)&&P?function Po(g,y){return g=g.trim(),/\d{2}-\d{2}/.test(g)?g:g.includes(",")?Ni(g,",",", ",y):g.includes(";")?Ni(g,";","; ",y):g.includes(" ")?Ni(g," "," ",y):(0,E.uf)(Number(g),(0,E.sh)(y))}(g,P):"string"==typeof(g=function xo(g,y){if("string"==typeof g&&y&&null==y.dateFormat&&(null!=y.places||null!=y.digitSeparator)){const v=Number(g);if(!isNaN(v))return v}return g}(g,P))||null==g||null==P?li(g):(0,E.uf)(g,w?{...(0,E.sh)(P),minimumFractionDigits:0,maximumFractionDigits:20}:(0,E.sh)(P))}(y,{fieldInfos:b||Array.from(w.values()),fieldName:v,layer:M,timeZone:x});const R=M?.fieldsIndex?.get(v);return R&&((0,vi.a8)(R)||(0,Vt.sX)(R))?(0,vi.$8)(y,{fieldType:R.type,timeZoneOptions:{layerTimeZone:M&&"preferredTimeZone"in M?M.preferredTimeZone:null,viewTimeZone:x,datesInUnknownTimezone:!(!M||!("datesInUnknownTimezone"in M)||!M.datesInUnknownTimezone)}}):li(y)}function zi({fieldInfos:g,attributes:y,layer:v,graphic:b,fieldInfoMap:w,relatedInfos:M,timeZone:F}){const x={};return M?.forEach(T=>function Do({attributes:g,relatedInfo:y,fieldInfoMap:v,fieldInfos:b,layer:w,timeZone:M}){g&&y&&(y.relatedFeatures?.forEach(F=>ns({attributes:g,graphic:F,relatedInfo:y,fieldInfoMap:v,fieldInfos:b,layer:w,timeZone:M})),y.relatedStatsFeatures?.forEach(F=>ns({attributes:g,graphic:F,relatedInfo:y,fieldInfoMap:v,fieldInfos:b,layer:w,timeZone:M})))}({attributes:x,relatedInfo:T,fieldInfoMap:w,fieldInfos:g,layer:v,timeZone:F})),y&&Object.keys(y).forEach(T=>{x[T]=ts({fieldName:T,fieldInfos:g,fieldInfoMap:w,layer:v,value:y[T],graphic:b,timeZone:F})}),x}function is(g,y){return ji.apply(this,arguments)}function ji(){return(ji=(0,B.Z)(function*(g,y){const{layer:v,graphic:b,outFields:w,objectIds:M,returnGeometry:F,spatialReference:x}=g,T=M[0];if("number"!=typeof T&&"string"!=typeof T)return Wn.warn("Could not query required fields for the specified feature. The feature's ID is invalid.",{layer:v,graphic:b,objectId:T,requiredFields:w}),null;if(!(0,uo.S1)(v)?.operations?.supportsQuery)return Wn.warn("The specified layer cannot be queried. The following fields will not be available.",{layer:v,graphic:b,requiredFields:w,returnGeometry:F}),null;const P=v.createQuery();return P.objectIds=M,P.outFields=w?.length?w:[v.objectIdField],P.returnGeometry=!!F,P.returnZ=!!F,P.returnM=!!F,P.outSpatialReference=x,(yield v.queryFeatures(P,y)).features[0]})).apply(this,arguments)}function ki(){return(ki=(0,B.Z)(function*(g){if(!g.expressionInfos?.length)return!1;const y=yield(0,kn.LC)(),{arcadeUtils:{hasGeometryFunctions:v}}=y;return v(g)})).apply(this,arguments)}function Wi(){return Wi=(0,B.Z)(function*({graphic:g,popupTemplate:y,layer:v,spatialReference:b},w){if(!v||!y||("function"==typeof v.load&&(yield v.load(w)),!g.attributes))return;const M=g.attributes[v.objectIdField];if(null==M)return;const F=[M],x=yield y.getRequiredFields(v.fieldsIndex),T=(0,Vt.R9)(x,g),P=T?[]:x,R=y.returnGeometry||(yield function Zo(g){return ki.apply(this,arguments)}(y));if(T&&!R)return;const V=yield is({layer:v,graphic:g,outFields:P,objectIds:F,returnGeometry:R,spatialReference:b},w);V&&(V.geometry&&(g.geometry=V.geometry),V.attributes&&(g.attributes={...g.attributes,...V.attributes}))}),Wi.apply(this,arguments)}function At(g=""){return!!g&&g.includes(Yn)}function ns({attributes:g,graphic:y,relatedInfo:v,fieldInfos:b,fieldInfoMap:w,layer:M,timeZone:F}){g&&y&&v&&Object.keys(y.attributes).forEach(x=>{const T=function $o(g){return g?`${Yn}${g.layerId}/${g.fieldName}`:""}({layerId:v.relation.id.toString(),fieldName:x});g[T]=ts({fieldName:T,fieldInfos:b,fieldInfoMap:w,layer:M,value:y.attributes[x],graphic:y,timeZone:F})})}const ss=g=>{if(!g)return!1;const y=g.toUpperCase();return y.includes("CURRENT_TIMESTAMP")||y.includes("CURRENT_DATE")||y.includes("CURRENT_TIME")},os=({layer:g,method:y,query:v,definitionExpression:b})=>{if(!g.capabilities?.query?.supportsCacheHint||"attachments"===y)return;const w=null!=v.where?v.where:null,M=null!=v.geometry?v.geometry:null;ss(b)||ss(w)||"extent"===M?.type||"tile"===v.resultType||(v.cacheHint=!0)};function rs(g,y,v){const b="scene"===y.type&&y.associatedLayer?y.associatedLayer.url:y.url;return g.filter(Di).find(w=>w!==y&&w.url===b&&w.layerId===v.relatedTableId)}const as={editing:!1,operations:{add:!0,update:!0,delete:!0}},ls=$e.Z.ofType(si.Z);let ht=class extends lt.Z{constructor(g){super(g),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.capabilities={...as},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new ls,this.fileInfos=new $e.Z,this.graphic=null,this.mode="view",this.filesEnabled=!1,this.addHandles((0,$.YP)(()=>this.graphic,()=>this._graphicChanged(),$.nn))}destroy(){this._attachmentLayer=null,this.graphic=null}castCapabilities(g){return{...as,...g}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:g}=this;if(!g)return!1;const y=g.layer||g.sourceLayer;return y?.loaded&&"capabilities"in y&&y.capabilities&&"operations"in y.capabilities&&"supportsResizeAttachments"in y.capabilities.operations&&y.capabilities.operations.supportsResizeAttachments||!1}getAttachments(){var g=this;return(0,B.Z)(function*(){const{_attachmentLayer:y,attachmentInfos:v}=g;if(!y||"function"!=typeof y.queryAttachments)throw new D.Z("invalid-layer","getAttachments(): A valid layer is required.");const b=g._getObjectId(),w=new oi.Z({objectIds:[b],returnMetadata:!0}),M=[],F=y.queryAttachments(w).then(T=>T[b]||M).catch(()=>M);g._getAttachmentsPromise=F,g.notifyChange("state");const x=yield F;return v.removeAll(),x.length&&v.addMany(x),g._getAttachmentsPromise=null,g.notifyChange("state"),x})()}addAttachment(g,y=this.graphic){var v=this;return(0,B.Z)(function*(){const{_attachmentLayer:b,attachmentInfos:w,capabilities:M}=v;if(!y)throw new D.Z("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:y});if(!g)throw new D.Z("invalid-attachment","addAttachment(): An attachment is required.",{attachment:g});if(!M.operations?.add)throw new D.Z("invalid-capabilities","addAttachment(): add capabilities are required.");if(!b||"function"!=typeof b.addAttachment)throw new D.Z("invalid-layer","addAttachment(): A valid layer is required.");const F=b.addAttachment(y,g).then(T=>v._queryAttachment(T.objectId,y)),x=yield F;return w.add(x),x})()}deleteAttachment(g){var y=this;return(0,B.Z)(function*(){const{_attachmentLayer:v,attachmentInfos:b,graphic:w,capabilities:M}=y;if(!g)throw new D.Z("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:g});if(!M.operations?.delete)throw new D.Z("invalid-capabilities","deleteAttachment(): delete capabilities are required.");if(!v||"function"!=typeof v.deleteAttachments)throw new D.Z("invalid-layer","deleteAttachment(): A valid layer is required.");if(!w)throw new D.Z("invalid-graphic","deleteAttachment(): A graphic is required.");const F=v.deleteAttachments(w,[g.id]).then(()=>g),x=yield F;return b.remove(x),x})()}updateAttachment(g,y=this.activeAttachmentInfo){var v=this;return(0,B.Z)(function*(){const{_attachmentLayer:b,attachmentInfos:w,graphic:M,capabilities:F}=v;if(!g)throw new D.Z("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:g});if(!y)throw new D.Z("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:y});if(!F.operations?.update)throw new D.Z("invalid-capabilities","updateAttachment(): Update capabilities are required.");const x=w.indexOf(y);if(!b||"function"!=typeof b.updateAttachment)throw new D.Z("invalid-layer","updateAttachment(): A valid layer is required.");if(!M)throw new D.Z("invalid-graphic","updateAttachment(): A graphic is required.");const T=b.updateAttachment(M,y.id,g).then(R=>v._queryAttachment(R.objectId)),P=yield T;return w.splice(x,1,P),P})()}commitFiles(){var g=this;return(0,B.Z)(function*(){return yield Promise.all(g.fileInfos.items.map(y=>g.addAttachment(y.form))),g.fileInfos.removeAll(),g.getAttachments()})()}addFile(g,y){if(!g||!y)return null;const v={file:g,form:y};return this.fileInfos.add(v),v}updateFile(g,y,v=this.activeFileInfo){if(!g||!y||!v)return null;const b=this.fileInfos.indexOf(v);return b>-1&&this.fileInfos.splice(b,1,{file:g,form:y}),this.fileInfos.items[b]}deleteFile(g){const y=this.fileInfos.find(v=>v.file===g);return y?(this.fileInfos.remove(y),y):null}_queryAttachment(g,y){var v=this;return(0,B.Z)(function*(){const{_attachmentLayer:b}=v;if(!g||!b?.queryAttachments)throw new D.Z("invalid-attachment-id","Could not query attachment.");const w=v._getObjectId(y),M=new oi.Z({objectIds:[w],attachmentsWhere:`AttachmentId=${g}`,returnMetadata:!0});return b.queryAttachments(M).then(F=>F[w][0])})()}_getObjectId(g=this.graphic){return g?.getObjectId()??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:g}=this,y=Kn(g);this._attachmentLayer=y?"scene"===y.type&&null!=y.associatedLayer?y.associatedLayer:y:null}};(0,_._)([(0,A.Cb)()],ht.prototype,"capabilities",void 0),(0,_._)([(0,N.p)("capabilities")],ht.prototype,"castCapabilities",null),(0,_._)([(0,A.Cb)()],ht.prototype,"activeAttachmentInfo",void 0),(0,_._)([(0,A.Cb)()],ht.prototype,"activeFileInfo",void 0),(0,_._)([(0,A.Cb)({readOnly:!0,type:ls})],ht.prototype,"attachmentInfos",void 0),(0,_._)([(0,A.Cb)()],ht.prototype,"fileInfos",void 0),(0,_._)([(0,A.Cb)({type:at.Z})],ht.prototype,"graphic",void 0),(0,_._)([(0,A.Cb)()],ht.prototype,"mode",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],ht.prototype,"state",null),(0,_._)([(0,A.Cb)()],ht.prototype,"filesEnabled",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],ht.prototype,"supportsResizeAttachments",null),ht=(0,_._)([(0,ne.j)("esri.widgets.Attachments.AttachmentsViewModel")],ht);const Hi=ht;var jo=C(98930);function ds(g){const y=g.toLowerCase();return"image/bmp"===y||"image/emf"===y||"image/exif"===y||"image/gif"===y||"image/x-icon"===y||"image/jpeg"===y||"image/png"===y||"image/tiff"===y||"image/x-wmf"===y}var Kt=C(90643),we=C(89219),yt=C(70868),Mt=C(40846),pt=C(26440),U=C(2485);const us={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},Le="esri-attachments",de={base:Le,loaderContainer:`${Le}__loader-container`,loader:`${Le}__loader`,fadeIn:`${Le}--fade-in`,container:`${Le}__container`,containerList:`${Le}__container--list`,containerPreview:`${Le}__container--preview`,actions:`${Le}__actions`,deleteButton:`${Le}__delete-button`,addAttachmentButton:`${Le}__add-attachment-button`,errorMessage:`${Le}__error-message`,items:`${Le}__items`,item:`${Le}__item`,itemButton:`${Le}__item-button`,itemMask:`${Le}__item-mask`,itemMaskIcon:`${Le}__item-mask--icon`,itemImage:`${Le}__image`,itemImageResizable:`${Le}__image--resizable`,itemLabel:`${Le}__label`,itemFilename:`${Le}__filename`,itemChevronIcon:`${Le}__item-chevron-icon`,itemLink:`${Le}__item-link`,itemLinkOverlay:`${Le}__item-link-overlay`,itemLinkOverlayIcon:`${Le}__item-link-overlay-icon`,itemEditIcon:`${Le}__item-edit-icon`,itemAddIcon:`${Le}__item-add-icon`,itemAddButton:`${Le}__item-add-button`,formNode:`${Le}__form-node`,fileFieldset:`${Le}__file-fieldset`,fileLabel:`${Le}__file-label`,fileName:`${Le}__file-name`,fileInput:`${Le}__file-input`,metadata:`${Le}__metadata`,metadataFieldset:`${Le}__metadata-fieldset`,progressBar:`${Le}__progress-bar`},Yi=window.CSS;let st=class extends Y.Z{constructor(g,y){super(g,y),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements={...us},this._supportsImageOrientation=Yi&&Yi.supports&&Yi.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}normalizeCtorArgs(g){return g?.viewModel||(g={viewModel:new Hi,...g}),g}initialize(){this.addHandles([(0,$.on)(()=>this.viewModel?.attachmentInfos,"change",()=>this.scheduleRender()),(0,$.on)(()=>this.viewModel?.fileInfos,"change",()=>this.scheduleRender()),(0,$.YP)(()=>this.viewModel?.mode,()=>this._modeChanged(),$.nn)])}loadDependencies(){return(0,Kt.h)({icon:()=>C.e(4540).then(C.bind(C,24540))})}get capabilities(){return this.viewModel.capabilities}set capabilities(g){this.viewModel.capabilities=g}get effectiveDisplayType(){const{displayType:g}=this;return g&&"auto"!==g?g:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(g){this.viewModel.graphic=g}get label(){return this.messages?.widgetLabel??""}set label(g){this._overrideIfSome("label",g)}castVisibleElements(g){return{...us,...g}}addAttachment(){const{_addAttachmentForm:g,viewModel:y}=this;return this._set("submitting",!0),this._set("error",null),y.addAttachment(g).then(v=>(this._set("submitting",!1),this._set("error",null),y.mode="view",v)).catch(v=>{throw this._set("submitting",!1),this._set("error",new D.Z("attachments:add-attachment",this.messages.addErrorMessage,v)),v})}deleteAttachment(g){const{viewModel:y}=this;return this._set("submitting",!0),this._set("error",null),y.deleteAttachment(g).then(v=>(this._set("submitting",!1),this._set("error",null),y.mode="view",v)).catch(v=>{throw this._set("submitting",!1),this._set("error",new D.Z("attachments:delete-attachment",this.messages.deleteErrorMessage,v)),v})}updateAttachment(){const{viewModel:g}=this,{_updateAttachmentForm:y}=this;return this._set("submitting",!0),this._set("error",null),g.updateAttachment(y).then(v=>(this._set("submitting",!1),this._set("error",null),g.mode="view",v)).catch(v=>{throw this._set("submitting",!1),this._set("error",new D.Z("attachments:update-attachment",this.messages.updateErrorMessage,v)),v})}addFile(){const g=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",g}updateFile(){const{viewModel:g}=this,y=g.updateFile(this.selectedFile,this._updateAttachmentForm,g.activeFileInfo);return g.mode="view",y}deleteFile(g){const y=this.viewModel.deleteFile(g||this.viewModel.activeFileInfo?.file);return this.viewModel.mode="view",y}render(){const{submitting:g,viewModel:y}=this,{state:v}=y;return(0,U.u)("div",{class:this.classes(de.base,we.z.widget)},g?this._renderProgressBar():null,"loading"===v?this._renderLoading():this._renderAttachments(),this._renderErrorMessage())}_renderErrorMessage(){const{error:g,visibleElements:y}=this;return g&&y.errorMessage?(0,U.u)("div",{class:de.errorMessage,key:"error-message"},g.message):null}_renderAttachments(){const{activeFileInfo:g,mode:y,activeAttachmentInfo:v}=this.viewModel;return"add"===y?this._renderAddForm():"edit"===y?this._renderDetailsForm(v||g):this._renderAttachmentContainer()}_renderLoading(){return(0,U.u)("div",{class:de.loaderContainer,key:"loader"},(0,U.u)("div",{class:de.loader}))}_renderProgressBar(){return this.visibleElements.progressBar?(0,U.u)("div",{class:de.progressBar,key:"progress-bar"}):null}_renderAddForm(){const{submitting:g,selectedFile:y}=this,v=g||!y,b=this.visibleElements.cancelAddButton?(0,U.u)("button",{bind:this,class:this.classes(we.z.button,we.z.buttonTertiary,we.z.buttonSmall,we.z.buttonHalf,g&&we.z.buttonDisabled),disabled:g,onclick:this._cancelForm,type:"button"},this.messages.cancel):null,w=this.visibleElements.addSubmitButton?(0,U.u)("button",{class:this.classes(we.z.button,we.z.buttonSecondary,we.z.buttonSmall,we.z.buttonHalf,{[we.z.buttonDisabled]:v}),disabled:v,type:"submit"},this.messages.add):null,M=y?(0,U.u)("span",{class:de.fileName,key:"file-name"},y.name):null,F=(0,U.u)("form",{afterCreate:Mt.Yo,afterRemoved:Mt.pV,bind:this,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},(0,U.u)("fieldset",{class:de.fileFieldset},M,(0,U.u)("label",{class:this.classes(de.fileLabel,we.z.button,we.z.buttonSecondary)},y?this.messages.changeFile:this.messages.selectFile,(0,U.u)("input",{bind:this,class:de.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))),w,b);return(0,U.u)("div",{class:de.formNode,key:"add-form-container"},F)}_renderDetailsForm(g){const{visibleElements:y,viewModel:v,selectedFile:b,submitting:w}=this,{capabilities:M}=v,F=w||!b;let x,T,P,R;b?(x=b.type,T=b.name,P=b.size):g&&"file"in g?(x=g.file.type,T=g.file.name,P=g.file.size):g&&"contentType"in g&&(x=g.contentType,T=g.name,P=g.size,R=g.url);const V=M.editing&&M.operations?.delete&&y.deleteButton?(0,U.u)("button",{bind:this,class:this.classes(we.z.button,we.z.buttonSmall,we.z.buttonTertiary,de.deleteButton,{[we.z.buttonDisabled]:w}),disabled:w,key:"delete-button",onclick:re=>this._submitDeleteAttachment(re,g),type:"button"},this.messages.delete):void 0,z=M.editing&&M.operations?.update&&y.updateButton?(0,U.u)("button",{class:this.classes(we.z.button,we.z.buttonSmall,we.z.buttonThird,{[we.z.buttonDisabled]:F}),disabled:F,key:"update-button",type:"submit"},this.messages.update):void 0,k=this.visibleElements.cancelUpdateButton?(0,U.u)("button",{bind:this,class:this.classes(we.z.button,we.z.buttonSmall,we.z.buttonTertiary,we.z.buttonThird,{[we.z.buttonDisabled]:w}),disabled:w,key:"cancel-button",onclick:this._cancelForm,type:"button"},this.messages.cancel):void 0,H=M.editing&&M.operations?.update?(0,U.u)("fieldset",{class:de.fileFieldset,key:"file"},(0,U.u)("span",{class:de.fileName,key:"file-name"},T),(0,U.u)("label",{class:this.classes(de.fileLabel,we.z.button,we.z.buttonSecondary)},this.messages.changeFile,(0,U.u)("input",{bind:this,class:de.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))):void 0,J=(0,U.u)("fieldset",{class:de.metadataFieldset,key:"size"},(0,U.u)("label",null,function Qe(g,y){let v=0===(y=Math.round(y))?0:Math.floor(Math.log(y)/Math.log(K.Y.KILOBYTES));v=(0,oe.uZ)(v,0,Te.length-1);const b=(0,E.uf)(y/K.Y.KILOBYTES**v,{maximumFractionDigits:2});return(0,O.gx)(g.units.bytes[Te[v]],{fileSize:b})}(this.messagesUnits,P??0))),ie=(0,U.u)("fieldset",{class:de.metadataFieldset,key:"content-type"},(0,U.u)("label",null,x)),ue=null!=R?(0,U.u)("a",{class:de.itemLink,href:R,rel:"noreferrer",target:"_blank"},this._renderImageMask(g,400),(0,U.u)("div",{class:de.itemLinkOverlay},(0,U.u)("span",{class:de.itemLinkOverlayIcon},(0,U.u)("calcite-icon",{icon:"launch"})))):this._renderImageMask(g,400),_e=(0,U.u)("form",{afterCreate:Mt.Yo,afterRemoved:Mt.pV,bind:this,"data-node-ref":"_updateAttachmentForm",onsubmit:re=>this._submitUpdateAttachment(re,g)},(0,U.u)("div",{class:de.metadata},J,ie),H,(0,U.u)("div",{class:de.actions},V,k,z));return(0,U.u)("div",{class:de.formNode,key:"edit-form-container"},ue,_e)}_renderImageMask(g,y){return g?"file"in g?this._renderGenericImageMask(g.file.name,g.file.type):this._renderImageMaskForAttachment(g,y):null}_renderGenericImageMask(g,y){const{supportsResizeAttachments:v}=this.viewModel,b=function ko(g){const y=(0,jo.V)("esri/themes/base/images/files/");return g?"text/plain"===g?`${y}text-32.svg`:"application/pdf"===g?`${y}pdf-32.svg`:"text/csv"===g?`${y}csv-32.svg`:"application/gpx+xml"===g?`${y}gpx-32.svg`:"application/x-dwf"===g?`${y}cad-32.svg`:"application/postscript"===g||"application/json"===g||"text/xml"===g||"model/vrml"===g?`${y}code-32.svg`:"application/x-zip-compressed"===g||"application/x-7z-compressed"===g||"application/x-gzip"===g||"application/x-tar"===g||"application/x-gtar"===g||"application/x-bzip2"===g||"application/gzip"===g||"application/x-compress"===g||"application/x-apple-diskimage"===g||"application/x-rar-compressed"===g||"application/zip"===g?`${y}zip-32.svg`:g.includes("image/")?`${y}image-32.svg`:g.includes("audio/")?`${y}sound-32.svg`:g.includes("video/")?`${y}video-32.svg`:g.includes("msexcel")||g.includes("ms-excel")||g.includes("spreadsheetml")?`${y}excel-32.svg`:g.includes("msword")||g.includes("ms-word")||g.includes("wordprocessingml")?`${y}word-32.svg`:g.includes("powerpoint")||g.includes("presentationml")?`${y}report-32.svg`:`${y}generic-32.svg`:`${y}generic-32.svg`}(y),w={[de.itemImageResizable]:v};return(0,U.u)("div",{class:this.classes(de.itemMaskIcon,de.itemMask),key:b},(0,U.u)("img",{alt:g,class:this.classes(w,de.itemImage),src:b,title:g}))}_renderImageMaskForAttachment(g,y){const{supportsResizeAttachments:v}=this.viewModel;if(!g)return null;const{contentType:b,name:w,url:M}=g;if(!v||!ds(b))return this._renderGenericImageMask(w,b);const F=this._getCSSTransform(g),x=F?{transform:F,"image-orientation":"none"}:{},T=`${M}${M?.includes("?")?"&":"?"}w=${y}`,P={[de.itemImageResizable]:v};return(0,U.u)("div",{class:this.classes(de.itemMask),key:T},(0,U.u)("img",{alt:w,class:this.classes(P,de.itemImage),src:T,styles:x,title:w}))}_renderFile(g){const{file:y}=g;return(0,U.u)("li",{class:de.item,key:y},(0,U.u)("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:de.itemButton,key:"details-button",onclick:()=>this._startEditFile(g),title:this.messages.attachmentDetails,type:"button"},this._renderImageMask(g),(0,U.u)("label",{class:de.itemLabel},(0,U.u)("span",{class:de.itemFilename},y.name||this.messages.noTitle),(0,U.u)("span",{"aria-hidden":"true",class:this.classes(de.itemChevronIcon,(0,Mt.dZ)(this.container)?yt.W.left:yt.W.right)}))))}_renderAttachmentInfo({attachmentInfo:g,displayType:y}){const{viewModel:v,effectiveDisplayType:b}=this,{capabilities:w,supportsResizeAttachments:M}=v,{contentType:F,name:x,url:T}=g,P=this._renderImageMask(g,"list"===y?48:400),R=w.editing?(0,U.u)("span",{"aria-hidden":"true",class:this.classes(de.itemChevronIcon,(0,Mt.dZ)(this.container)?yt.W.left:yt.W.right)}):null,V=[P,"preview"===b&&M&&ds(F)?null:(0,U.u)("label",{class:de.itemLabel},(0,U.u)("span",{class:de.itemFilename},x||this.messages.noTitle),R)],z=w.editing?(0,U.u)("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:de.itemButton,"data-attachment-info-id":g.id,key:"details-button",onclick:()=>this._startEditAttachment(g),title:this.messages.attachmentDetails,type:"button"},V):(0,U.u)("a",{class:de.itemButton,href:T??void 0,key:"details-link",target:"_blank"},V);return(0,U.u)("li",{class:de.item,key:g},z)}_renderAttachmentContainer(){const{effectiveDisplayType:g,viewModel:y,visibleElements:v}=this,{attachmentInfos:b,capabilities:w,fileInfos:M}=y,F=!!b?.length,x=!!M?.length,T={[de.containerList]:"preview"!==g,[de.containerPreview]:"preview"===g},P=w.editing&&w.operations?.add&&v.addButton?(0,U.u)("button",{bind:this,class:this.classes(we.z.button,we.z.buttonTertiary,de.addAttachmentButton),onclick:()=>this._startAddAttachment(),type:"button"},(0,U.u)("span",{"aria-hidden":"true",class:this.classes(de.itemAddIcon,yt.W.plus)}),this.messages.add):void 0,R=F?(0,U.u)("ul",{class:de.items,key:"attachments-list"},b.toArray().map(k=>this._renderAttachmentInfo({attachmentInfo:k,displayType:g}))):void 0,V=x?(0,U.u)("ul",{class:de.items,key:"file-list"},M.toArray().map(k=>this._renderFile(k))):void 0,z=x||F?void 0:(0,U.u)("div",{class:we.z.empty},this.messages.noAttachments);return(0,U.u)("div",{class:this.classes(de.container,T),key:"attachments-container"},R,V,z,P)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(g){const y=g.target,v=y.files?.item(0);this._set("selectedFile",v)}_submitDeleteAttachment(g,y){g.preventDefault(),y&&("file"in y?this.deleteFile(y.file):y&&this.deleteAttachment(y))}_submitAddAttachment(g){g.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(g,y){g.preventDefault(),y&&"file"in y?this.updateFile():this.updateAttachment()}_startEditAttachment(g){const{viewModel:y}=this;y.activeFileInfo=null,y.activeAttachmentInfo=g,y.mode="edit"}_startEditFile(g){const{viewModel:y}=this;y.activeAttachmentInfo=null,y.activeFileInfo=g,y.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(g){g.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(g){const{orientationInfo:y}=g;return!this._supportsImageOrientation&&y?[y.rotation?`rotate(${y.rotation}deg)`:"",y.mirrored?"scaleX(-1)":""].join(" "):""}};(0,_._)([(0,A.Cb)()],st.prototype,"capabilities",null),(0,_._)([(0,A.Cb)()],st.prototype,"displayType",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],st.prototype,"effectiveDisplayType",null),(0,_._)([(0,A.Cb)()],st.prototype,"graphic",null),(0,_._)([(0,A.Cb)()],st.prototype,"label",null),(0,_._)([(0,A.Cb)(),(0,pt.H)("esri/widgets/Attachments/t9n/Attachments")],st.prototype,"messages",void 0),(0,_._)([(0,A.Cb)(),(0,pt.H)("esri/core/t9n/Units")],st.prototype,"messagesUnits",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],st.prototype,"selectedFile",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],st.prototype,"submitting",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],st.prototype,"error",void 0),(0,_._)([(0,A.Cb)({type:Hi})],st.prototype,"viewModel",void 0),(0,_._)([(0,A.Cb)()],st.prototype,"visibleElements",void 0),(0,_._)([(0,N.p)("visibleElements")],st.prototype,"castVisibleElements",null),st=(0,_._)([(0,ne.j)("esri.widgets.Attachments")],st);const Wo=st;let di=class extends Hi{constructor(g){super(g),this.description=null,this.title=null}};(0,_._)([(0,A.Cb)()],di.prototype,"description",void 0),(0,_._)([(0,A.Cb)()],di.prototype,"title",void 0),di=(0,_._)([(0,ne.j)("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],di);const Gi=di;var Ki=C(83022);const Qi="esri-feature-element-info",Xi={base:Qi,title:`${Qi}__title`,description:`${Qi}__description`};let Qt=class extends Y.Z{constructor(g,y){super(g,y),this.description=null,this.headingLevel=2,this.title=null}render(){return(0,U.u)("div",{class:Xi.base},this._renderTitle(),this._renderDescription())}_renderTitle(){const{title:g}=this;return g?(0,U.u)(Ki.X,{class:Xi.title,level:this.headingLevel},g):null}_renderDescription(){const{description:g}=this;return g?(0,U.u)("div",{class:Xi.description,key:"description"},g):null}};(0,_._)([(0,A.Cb)()],Qt.prototype,"description",void 0),(0,_._)([(0,A.Cb)()],Qt.prototype,"headingLevel",void 0),(0,_._)([(0,A.Cb)()],Qt.prototype,"title",void 0),Qt=(0,_._)([(0,ne.j)("esri.widgets.Feature.support.FeatureElementInfo")],Qt);const wi=Qt;let _t=class extends Y.Z{constructor(g,y){super(g,y),this._featureElementInfo=null,this.attachmentsWidget=new Wo,this.headingLevel=2,this.viewModel=new Gi}initialize(){this._featureElementInfo=new wi,this.addHandles([(0,$.YP)(()=>[this.viewModel?.description,this.viewModel?.title,this.headingLevel],()=>this._setupFeatureElementInfo(),$.nn),(0,$.YP)(()=>this.viewModel,g=>this.attachmentsWidget.viewModel=g,$.nn)])}destroy(){this.attachmentsWidget.viewModel=null,this.attachmentsWidget.destroy(),this._featureElementInfo?.destroy()}get description(){return this.viewModel.description}set description(g){this.viewModel.description=g}get displayType(){return this.attachmentsWidget.displayType}set displayType(g){this.attachmentsWidget.displayType=g}get graphic(){return this.viewModel.graphic}set graphic(g){this.viewModel.graphic=g}get title(){return this.viewModel.title}set title(g){this.viewModel.title=g}render(){const{attachmentsWidget:g}=this;return(0,U.u)("div",{class:"esri-feature-attachments"},this._featureElementInfo?.render(),g?.render())}_setupFeatureElementInfo(){const{description:g,title:y,headingLevel:v}=this;this._featureElementInfo?.set({description:g,title:y,headingLevel:v})}};(0,_._)([(0,A.Cb)({readOnly:!0})],_t.prototype,"attachmentsWidget",void 0),(0,_._)([(0,A.Cb)()],_t.prototype,"description",null),(0,_._)([(0,A.Cb)()],_t.prototype,"displayType",null),(0,_._)([(0,A.Cb)()],_t.prototype,"graphic",null),(0,_._)([(0,A.Cb)()],_t.prototype,"headingLevel",void 0),(0,_._)([(0,A.Cb)()],_t.prototype,"title",null),(0,_._)([(0,A.Cb)({type:Gi})],_t.prototype,"viewModel",void 0),_t=(0,_._)([(0,ne.j)("esri.widgets.Feature.FeatureAttachments")],_t);const Yo=_t;let Rt=class extends lt.Z{constructor(g){super(g),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.addHandles((0,$.YP)(()=>this.creator,y=>{this._destroyContent(),this._createContent(y)},$.nn))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:g,graphic:y,destroyer:v}=this;g&&y&&(bi(v,{graphic:y}).catch(()=>null),this._set("created",null))}_createContent(g){var y=this;return(0,B.Z)(function*(){const v=y.graphic;if(!v||!g)return;const b=bi(g,{graphic:v}).catch(()=>null);y._loadingPromise=b,y.notifyChange("state");const w=yield b;b===y._loadingPromise&&(y._loadingPromise=null,y.notifyChange("state"),y._set("created",w))})()}};(0,_._)([(0,A.Cb)({readOnly:!0})],Rt.prototype,"created",void 0),(0,_._)([(0,A.Cb)()],Rt.prototype,"creator",void 0),(0,_._)([(0,A.Cb)()],Rt.prototype,"destroyer",void 0),(0,_._)([(0,A.Cb)({type:at.Z})],Rt.prototype,"graphic",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],Rt.prototype,"state",null),Rt=(0,_._)([(0,ne.j)("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],Rt);const Mi=Rt;var Ji=C(36911);const qi="esri-feature-content",en={base:qi,loaderContainer:`${qi}__loader-container`,loader:`${qi}__loader`};let Xt=class extends Y.Z{constructor(g,y){super(g,y),this.viewModel=null,this._addTargetToAnchors=v=>{Array.from(v.querySelectorAll("a")).forEach(b=>{Qn(b.href)&&!b.hasAttribute("target")&&b.setAttribute("target","_blank")})}}get creator(){return this.viewModel?.creator}set creator(g){this.viewModel&&(this.viewModel.creator=g)}get graphic(){return this.viewModel?.graphic}set graphic(g){this.viewModel&&(this.viewModel.graphic=g)}render(){const g=this.viewModel?.state;return(0,U.u)("div",{class:en.base},"loading"===g?this._renderLoading():this._renderCreated())}_renderLoading(){return(0,U.u)("div",{class:en.loaderContainer,key:"loader"},(0,U.u)("div",{class:en.loader}))}_renderCreated(){const g=this.viewModel?.created;return g?g instanceof HTMLElement?(0,U.u)("div",{afterCreate:this._attachToNode,bind:g,key:g}):(0,Ji.Qd)(g)?(0,U.u)("div",{key:g},!g.destroyed&&g.render()):(0,U.u)("div",{afterCreate:this._addTargetToAnchors,innerHTML:g,key:g}):null}_attachToNode(g){g.appendChild(this)}};(0,_._)([(0,A.Cb)()],Xt.prototype,"creator",null),(0,_._)([(0,A.Cb)()],Xt.prototype,"graphic",null),(0,_._)([(0,A.Cb)({type:Mi})],Xt.prototype,"viewModel",void 0),Xt=(0,_._)([(0,ne.j)("esri.widgets.Feature.FeatureContent")],Xt);const Ci=Xt;var Go=C(59869),cs=C(42271);let xt=class extends lt.Z{constructor(g){super(g),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:g,fieldInfos:y}=this,v=[];return y?.forEach(b=>{if(b.hasOwnProperty("visible")&&!b.visible)return;const w=b.clone();w.label=Xn(w,g),v.push(w)}),v}};(0,_._)([(0,A.Cb)()],xt.prototype,"attributes",void 0),(0,_._)([(0,A.Cb)({type:[Go.Z]})],xt.prototype,"expressionInfos",void 0),(0,_._)([(0,A.Cb)()],xt.prototype,"description",void 0),(0,_._)([(0,A.Cb)({type:[cs.Z]})],xt.prototype,"fieldInfos",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],xt.prototype,"formattedFieldInfos",null),(0,_._)([(0,A.Cb)()],xt.prototype,"title",void 0),xt=(0,_._)([(0,ne.j)("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],xt);const Fi=xt,Ko=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];const _i="esri-feature-fields",Ii={base:_i,fieldHeader:`${_i}__field-header`,fieldData:`${_i}__field-data`,fieldDataDate:`${_i}__field-data--date`};let Ct=class extends Y.Z{constructor(g,y){super(g,y),this._featureElementInfo=null,this.viewModel=new Fi,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new wi,this.addHandles((0,$.YP)(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),$.nn))}destroy(){this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(g){this.viewModel.attributes=g}get description(){return this.viewModel.description}set description(g){this.viewModel.description=g}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(g){this.viewModel.expressionInfos=g}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(g){this.viewModel.fieldInfos=g}get title(){return this.viewModel.title}set title(g){this.viewModel.title=g}render(){return(0,U.u)("div",{class:Ii.base},this._featureElementInfo?.render(),this._renderFields())}_renderFieldInfo(g,y){const{attributes:v}=this.viewModel,b=g.fieldName,w=g.label||b,M=v?null==v[b]?"":v[b]:"",F=!(!g.format||!g.format.dateFormat),x="number"!=typeof M||F?function Xo(g,y){if("string"!=typeof y||!y)return y;const v=function Qo(g){let y=null;return Ko.some(v=>(v.pattern.test(g)&&(y=v),!!y)),y}(y);if(!v)return y;const b=y.match(v.pattern),M=(0,O.gx)((0,O.gx)(v.label,{messages:g,hierPart:b&&b[2]}),{appName:v.appName});return y.replace(v.pattern,`<a${v.target?` target="${v.target}"`:""} href="$1"${"_blank"===v.target?' rel="noreferrer"':""}>${M}</a>`)}(this.messagesURIUtils,M):this._forceLTR(M),T={[Ii.fieldDataDate]:F};return(0,U.u)("tr",{key:`fields-element-info-row-${b}-${y}`},(0,U.u)("th",{class:Ii.fieldHeader,innerHTML:w,key:`fields-element-info-row-header-${b}-${y}`}),(0,U.u)("td",{class:this.classes(Ii.fieldData,T),innerHTML:x,key:`fields-element-info-row-data-${b}-${y}`}))}_renderFields(){const{formattedFieldInfos:g}=this.viewModel;return g?.length?(0,U.u)("table",{class:we.z.table,summary:this.messages.fieldsSummary},(0,U.u)("tbody",null,g.map((y,v)=>this._renderFieldInfo(y,v)))):null}_setupFeatureElementInfo(){const{description:g,title:y}=this;this._featureElementInfo?.set({description:g,title:y})}_forceLTR(g){return`&lrm;${g}`}};(0,_._)([(0,A.Cb)()],Ct.prototype,"attributes",null),(0,_._)([(0,A.Cb)()],Ct.prototype,"description",null),(0,_._)([(0,A.Cb)()],Ct.prototype,"expressionInfos",null),(0,_._)([(0,A.Cb)()],Ct.prototype,"fieldInfos",null),(0,_._)([(0,A.Cb)()],Ct.prototype,"title",null),(0,_._)([(0,A.Cb)({type:Fi,nonNullable:!0})],Ct.prototype,"viewModel",void 0),(0,_._)([(0,A.Cb)(),(0,pt.H)("esri/widgets/Feature/t9n/Feature")],Ct.prototype,"messages",void 0),(0,_._)([(0,A.Cb)(),(0,pt.H)("esri/widgets/support/t9n/uriUtils")],Ct.prototype,"messagesURIUtils",void 0),Ct=(0,_._)([(0,ne.j)("esri.widgets.Feature.FeatureFields")],Ct);const hs=Ct;var qo=C(8611);const or={maximumFractionDigits:20};C(11892);var vt=C(62616),ms=C(66599);C(71950),C(66637);const ar="<",lr=">";const cr=new ms.Z([64,64,64]);function fs(g,y){const v=[],b=g.length-1;return 5===g.length?v.push(0,2,4):v.push(0,b),g.map((w,M)=>v.includes(M)?function dr(g,y,v,b){let w="";return 0===y?w=`${ar} `:y===v&&(w=`${lr} `),w+(b?(0,vi.$8)(g,b):function rr(g){return(0,E.uf)(g,or)}(g))}(w,M,b,y):null)}function hr(g,y,v){return sn.apply(this,arguments)}function sn(){return sn=(0,B.Z)(function*(g,y,v){let b=!1,w=[],M=[];if(g.stops){const P=g.stops;w=P.map(R=>R.value),b=P.some(R=>!!R.label),b&&(M=P.map(R=>R.label))}if(null==w[0]&&null==w[w.length-1])return null;const T=b?null:fs(w,v);return(yield Promise.all(w.map(function(){var P=(0,B.Z)(function*(R,V){return{value:R,color:"opacity"===g.type?yield pr(R,g,y):(yield Promise.resolve().then(C.bind(C,37157))).getColor(g,R),label:b?M[V]:T?.[V]??""}});return function(R,V){return P.apply(this,arguments)}}()))).reverse()}),sn.apply(this,arguments)}function pr(g,y,v){return on.apply(this,arguments)}function on(){return(on=(0,B.Z)(function*(g,y,v){const b=new ms.Z(v??cr),w=(yield Promise.resolve().then(C.bind(C,37157))).getOpacity(y,g);return null!=w&&(b.a=w),b})).apply(this,arguments)}var gr=C(61197);function ft(g,y,v){return rn.apply(this,arguments)}function rn(){return(rn=(0,B.Z)(function*(g,y,v){(0,qo.s1)(g,y,()=>[]).push(...v)})).apply(this,arguments)}function an(){return(an=(0,B.Z)(function*(g){const y=new Map;if(!g)return y;if("visualVariables"in g&&g.visualVariables){const v=g.visualVariables.filter(b=>"color"===b.type);for(const b of v){const w=((yield hr(b))??[]).map(M=>M.color);yield ft(y,b.field||b.valueExpression,w)}}if("heatmap"===g.type){const v=function yr(g){if(!g.colorStops)return[];const y=[...g.colorStops].filter(b=>b.color?.a>0);let v=y.length-1;if(y&&y[0]){const b=y[v];b&&1!==b.ratio&&(y.push(new gr.Z({ratio:1,color:b.color})),v++)}return y.map((b,w)=>{let M="";return 0===w?M=g.legendOptions?.minLabel||"low":w===v&&(M=g.legendOptions?.maxLabel||"high"),{color:b.color,label:M,ratio:b.ratio}}).reverse()}(g).map(b=>b.color);yield ft(y,g.field||g.valueExpression,v)}else if("pie-chart"===g.type){for(const v of g.attributes)yield ft(y,v.field||v.valueExpression,[v.color]);yield ft(y,"default",[g?.othersCategory?.color,(0,vt._h)(g.backgroundFillSymbol,null)])}else if("dot-density"===g.type){for(const v of g.attributes)yield ft(y,v.field||v.valueExpression,[v.color]);yield ft(y,"default",[g.backgroundColor])}else if("unique-value"===g.type)if("predominance"===g.authoringInfo?.type)for(const v of g.uniqueValueInfos??[])yield ft(y,v.value.toString(),[(0,vt._h)(v.symbol,null)]);else{const v=(g.uniqueValueInfos??[]).map(x=>(0,vt._h)(x.symbol,null)),{field:b,field2:w,field3:M,valueExpression:F}=g;(b||F)&&(yield ft(y,b||F,v)),w&&(yield ft(y,w,v)),M&&(yield ft(y,M,v))}else if("class-breaks"===g.type){const v=g.classBreakInfos.map(M=>(0,vt._h)(M.symbol,null)),{field:b,valueExpression:w}=g;yield ft(y,b??w,v)}else"simple"===g.type&&(yield ft(y,"default",[(0,vt._h)(g.symbol,null)]));return"defaultSymbol"in g&&g.defaultSymbol&&(yield ft(y,"default",[(0,vt._h)(g.defaultSymbol,null)])),y.forEach((v,b)=>{const w=(0,Ve.Tw)(v.filter(Boolean),(M,F)=>JSON.stringify(M)===JSON.stringify(F));y.set(b,w)}),y})).apply(this,arguments)}Pe.Z.getLogger("esri.renderers.support.utils"),(0,Gt.Ze)("short-date");var _r=C(17009),Ir=C(66476),it=C(79412),un=(C(46054),C(46708)),Ar=(C(11931),C(26152),C(6785),C(82921),C(33721),C(10842),C(26894),C(32184),C(12628),C(85039)),cn=(C(5391),C(64222),C(93566),C(40485),C(93792),C(91866)),hn=(C(2189),C(46556)),xr=(C(89047),C(91085));const vs=Pe.Z.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),bs=new Map;function Ai(g){if(!At(g))return null;const[y,v]=g.split("/").slice(1);return{layerId:y,fieldName:v}}function pn(){return(pn=(0,B.Z)(function*(g,y,v,b){const w=v.layerId.toString(),{layerInfo:M,relation:F,relatedFields:x,outStatistics:T,url:P,sourceSpatialReference:R}=y,V=function Zr(g){return g?(0,Ve.Tw)(g):void 0}(x),z=function Vr(g){return g?(0,Ve.Tw)(g,(y,v)=>JSON.stringify(y.toJSON())===JSON.stringify(v.toJSON())):void 0}(T);if(!M||!F)return null;const k=function Tr({originRelationship:g,relationships:y,layerId:v}){let b=null;return y&&y.some(w=>(`${w.relatedTableId}`===v&&w.id===g?.id&&(b=w),!!b)),b}({originRelationship:F,relationships:M.relationships,layerId:w});if(k?.relationshipTableId&&k.keyFieldInRelationshipTable){const J=(yield function Ur(g,y,v,b){const w=new hn.default;return w.outFields=["*"],w.relationshipId="number"==typeof y.id?y.id:parseInt(y.id,10),w.objectIds=[g.attributes[v.objectIdField]],v.queryRelatedFeatures?.(w,b)??Promise.resolve({})}(g,k,v,b))[g.attributes[v.objectIdField]];if(!J)return null;const ie=J.features.map(ue=>ue.attributes[M.objectIdField]);if(z?.length&&M.supportsStatistics){const ue=new cn.Z;ue.where=function Sr(g,y,v){let b=0;const w=[];for(;b<y.length;)w.push(`${g} IN (${y.slice(b,v+b)})`),b+=v;return w.join(" OR ")}(M.objectIdField,ie,1e3),ue.outFields=V,ue.outStatistics=z,ue.sourceSpatialReference=R;const _e={features:Promise.resolve(J),statsFeatures:(0,un.e)(P,ue)};return(0,it.as)(_e)}}const H=k?.keyField;if(H){const J=(0,Vt.H7)(function jr(g,y){if(null!=g){y=y.toLowerCase();for(const v of g)if(v&&v.name.toLowerCase()===y)return v}return null}(M.fields,H)),ie=function Pr(g,y){const v=y.toLowerCase();for(const b in g)if(b.toLowerCase()===v)return g[b];return null}(g.attributes,F.keyField),ue=J?`${H}=${ie}`:`${H}='${ie}'`,_e=(0,un.e)(P,new cn.Z({where:ue,outFields:V,sourceSpatialReference:R}),b),re=z?.length&&M.supportsStatistics?(0,un.e)(P,new cn.Z({where:ue,outFields:V,outStatistics:z,sourceSpatialReference:R}),b):null,Be={features:_e};return re&&(Be.statsFeatures=re),(0,it.as)(Be)}return null})).apply(this,arguments)}const ws={chartAnimation:!0};let Je=class extends lt.Z{constructor(g){super(g),this.abilities={...ws},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(g){return{...ws,...g}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(g){this._setContentElementMedia(g)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(g){const{formattedMediaInfoCount:y}=this;this.activeMediaInfoIndex=(g+y)%y}_pageContentElementMedia(g){const{activeMediaInfoIndex:y}=this;this._setContentElementMedia(y+g)}_formatMediaInfos(){const{mediaInfos:g,layer:y}=this,v=this.attributes??{},b=this.formattedAttributes??{},w=this.expressionAttributes??{},M=this.fieldInfoMap??new Map;return g?.map(F=>{const x=F?.clone();if(!x)return null;if(x.title=$t({attributes:v,fieldInfoMap:M,globalAttributes:b,expressionAttributes:w,layer:y,text:x.title}),x.caption=$t({attributes:v,fieldInfoMap:M,globalAttributes:b,expressionAttributes:w,layer:y,text:x.caption}),x.altText=$t({attributes:v,fieldInfoMap:M,globalAttributes:b,expressionAttributes:w,layer:y,text:x.altText}),"image"===x.type){const{value:T}=x;return this._setImageValue({value:T,formattedAttributes:b,layer:y}),x.value.sourceURL?x:void 0}if("pie-chart"===x.type||"line-chart"===x.type||"column-chart"===x.type||"bar-chart"===x.type){const{value:T}=x;return this._setChartValue({value:T,chartType:x.type,attributes:v,formattedAttributes:b,layer:y,expressionAttributes:w}),x}return null}).filter(Ve.pC)??[]}_setImageValue(g){const y=this.fieldInfoMap??new Map,{value:v,formattedAttributes:b,layer:w}=g,{linkURL:M,sourceURL:F}=v;if(F){const x=$i(F,w);v.sourceURL=Vi({formattedAttributes:b,template:x,fieldInfoMap:y})}if(M){const x=$i(M,w);v.linkURL=Vi({formattedAttributes:b,template:x,fieldInfoMap:y})}}_setChartValue(g){const{value:y,attributes:v,formattedAttributes:b,chartType:w,layer:M,expressionAttributes:F}=g,{popupTemplate:x,relatedInfos:T}=this,{fields:P,normalizeField:R}=y,V=M;if(y.fields=function Co(g,y){return g&&g.map(v=>ai(v,y))}(P,V),R&&(y.normalizeField=ai(R,V)),!P.some(k=>!!(null!=b[k]||At(k)&&T?.size)))return;const z=x?.fieldInfos??[];P.forEach((k,H)=>{const J=y.colors?.[H];if(At(k))return void(y.series=[...y.series,...this._getRelatedChartInfos({fieldInfos:z,fieldName:k,formattedAttributes:b,chartType:w,value:y,color:J})]);const ie=this._getChartOption({value:y,attributes:v,chartType:w,formattedAttributes:b,expressionAttributes:F,fieldName:k,fieldInfos:z,color:J});y.series.push(ie)})}_getRelatedChartInfos(g){const{fieldInfos:y,fieldName:v,formattedAttributes:b,chartType:w,value:M,color:F}=g,x=[],T=Ai(v),P=T&&this.relatedInfos?.get(T.layerId.toString());if(!P)return x;const{relatedFeatures:R,relation:V}=P;if(!V||!R)return x;const{cardinality:z}=V;return R.forEach(k=>{const{attributes:H}=k;H&&Object.keys(H).forEach(J=>{J===T.fieldName&&x.push(this._getChartOption({value:M,attributes:H,formattedAttributes:b,fieldName:v,chartType:w,relatedFieldName:J,hasMultipleRelatedFeatures:R?.length>1,fieldInfos:y,color:F}))})}),"one-to-many"===z||"many-to-many"===z?x:[x[0]]}_getTooltip({label:g,value:y,chartType:v}){return"pie-chart"===v?`${g}`:`${g}: ${y}`}_getChartOption(g){const{value:y,attributes:v,formattedAttributes:b,expressionAttributes:w,fieldName:M,relatedFieldName:F,fieldInfos:x,chartType:T,hasMultipleRelatedFeatures:P,color:R}=g,V=this.layer,z=this.fieldInfoMap??new Map,{normalizeField:k,tooltipField:H}=y,J=k?At(k)?v[Ai(k).fieldName]:v[k]:null,ie=Si(M)&&w&&void 0!==w[M]?w[M]:F&&void 0!==v[F]?v[F]:void 0!==v[M]?v[M]:b[M],ue=new _r.Z({fieldName:M,color:R,value:void 0===ie?null:ie&&J?ie/J:ie});if(At(M)){const rt=z.get(M.toLowerCase()),wt=H&&z.get(H.toLowerCase()),Pi=rt?.fieldName??M,yi=P&&H?Ai(H).fieldName:wt?.fieldName??H;return ue.tooltip=this._getTooltip({label:P&&yi?v[yi]:b[yi]??rt?.label??rt?.fieldName??F,value:P&&F?v[F]:b[Pi],chartType:T}),ue}const _e=qn(x,M),re=ai(M,V),Be=H&&void 0!==b[H]?b[H]:Xn(_e||new cs.Z({fieldName:re}),this.popupTemplate?.expressionInfos);return ue.tooltip=this._getTooltip({label:Be,value:b[re],chartType:T}),ue}};(0,_._)([(0,A.Cb)()],Je.prototype,"abilities",void 0),(0,_._)([(0,N.p)("abilities")],Je.prototype,"castAbilities",null),(0,_._)([(0,A.Cb)()],Je.prototype,"activeMediaInfoIndex",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],Je.prototype,"activeMediaInfo",null),(0,_._)([(0,A.Cb)()],Je.prototype,"attributes",void 0),(0,_._)([(0,A.Cb)()],Je.prototype,"description",void 0),(0,_._)([(0,A.Cb)()],Je.prototype,"fieldInfoMap",void 0),(0,_._)([(0,A.Cb)()],Je.prototype,"formattedAttributes",void 0),(0,_._)([(0,A.Cb)()],Je.prototype,"expressionAttributes",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],Je.prototype,"formattedMediaInfos",null),(0,_._)([(0,A.Cb)()],Je.prototype,"isAggregate",void 0),(0,_._)([(0,A.Cb)()],Je.prototype,"layer",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],Je.prototype,"formattedMediaInfoCount",null),(0,_._)([(0,A.Cb)()],Je.prototype,"mediaInfos",void 0),(0,_._)([(0,A.Cb)()],Je.prototype,"popupTemplate",void 0),(0,_._)([(0,A.Cb)()],Je.prototype,"relatedInfos",void 0),(0,_._)([(0,A.Cb)()],Je.prototype,"title",void 0),Je=(0,_._)([(0,ne.j)("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],Je);const Dt=Je;var kr=C(55774),It=C(36766);const qe="esri-feature-media",dt={base:qe,mediaContainer:`${qe}__container`,mediaItemContainer:`${qe}__item-container`,mediaItem:`${qe}__item`,mediaItemText:`${qe}__item-text`,mediaItemTitle:`${qe}__item-title`,mediaItemCaption:`${qe}__item-caption`,mediaNavigation:`${qe}__item-navigation`,mediaPagination:`${qe}__pagination`,mediaPaginationText:`${qe}__pagination-text`,mediaPrevious:`${qe}__previous`,mediaPreviousIconLTR:`${qe}__previous-icon`,mediaPreviousIconRTL:`${qe}__previous-icon--rtl`,mediaNext:`${qe}__next`,mediaNextIconLTR:`${qe}__next-icon`,mediaNextIconRTL:`${qe}__next-icon--rtl`,mediaChart:`${qe}__chart`,mediaPaginationButton:`${qe}__pagination-button`,mediaPaginationIcon:`${qe}__pagination-icon`,mediaChartRendered:`${qe}__chart--rendered`},Ot="category",hi="value";let ut=class extends Y.Z{constructor(g,y){var v;super(g,y),v=this,this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this._chartRootMap=new WeakMap,this.viewModel=new Dt,this.messages=null,this._disposeChart=b=>{this._chartRootMap.get(b)?.dispose(),this._chartRootMap.delete(b)},this._createChart=function(){var b=(0,B.Z)(function*(w){const{destroyed:M,viewModel:F}=v;if(M||!F||!w)return;const{createRoot:x}=yield Promise.all([C.e(1603),C.e(8592),C.e(1157)]).then(C.bind(C,21157)),T=yield x(w);v._chartRootMap.set(w,T),v._renderChart({mediaInfo:F.activeMediaInfo,root:T})});return function(w){return b.apply(this,arguments)}}()}initialize(){this._featureElementInfo=new wi,this.addHandles([(0,$.YP)(()=>[this.viewModel?.activeMediaInfo,this.viewModel?.activeMediaInfoIndex],()=>this._setupMediaRefreshTimer(),$.nn),(0,$.YP)(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),$.nn)])}loadDependencies(){return(0,Kt.h)({icon:()=>C.e(4540).then(C.bind(C,24540))})}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(g){this.viewModel.attributes=g}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(g){this.viewModel.activeMediaInfoIndex=g}get description(){return this.viewModel.description}set description(g){this.viewModel.description=g}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(g){this.viewModel.fieldInfoMap=g}get layer(){return this.viewModel.layer}set layer(g){this.viewModel.layer=g}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(g){this.viewModel.mediaInfos=g}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(g){this.viewModel.popupTemplate=g}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(g){this.viewModel.relatedInfos=g}get title(){return this.viewModel.title}set title(g){this.viewModel.title=g}render(){return(0,U.u)("div",{bind:this,class:dt.base,onkeyup:this._handleMediaKeyup},this._featureElementInfo?.render(),this._renderMedia())}_renderMedia(){const{formattedMediaInfoCount:g,activeMediaInfoIndex:y}=this.viewModel,v=this._renderMediaText();return g?(0,U.u)("div",{class:dt.mediaContainer,key:"media-element-container"},this._renderMediaInfo(),(0,U.u)("div",{class:dt.mediaNavigation},v,g>1?(0,U.u)("div",{class:dt.mediaPagination},this._renderMediaPageButton("previous"),(0,U.u)("span",{class:dt.mediaPaginationText},(0,It.n)(this.messages.pageText,{index:y+1,total:g})),this._renderMediaPageButton("next")):null)):null}_renderMediaText(){const{activeMediaInfo:g}=this.viewModel;if(!g)return null;const y=g&&g.title?(0,U.u)("div",{class:dt.mediaItemTitle,innerHTML:g.title,key:"media-title"}):null,v=g&&g.caption?(0,U.u)("div",{class:dt.mediaItemCaption,innerHTML:g.caption,key:"media-caption"}):null;return y||v?(0,U.u)("div",{class:dt.mediaItemText,key:"media-text"},y,v):null}_renderImageMediaInfo(g){const{_refreshIntervalInfo:y}=this,{activeMediaInfoIndex:v,formattedMediaInfoCount:b}=this.viewModel,{value:w,refreshInterval:M,altText:F,title:x,type:T}=g,{sourceURL:P,linkURL:R}=w,V=Qn(R??void 0)?"_blank":"_self",z="_blank"===V?"noreferrer":"",k=M?y:null,ie=(0,U.u)("img",{alt:F||x,key:`media-${T}-${v}-${b}-${k?k.timestamp:0}`,src:(k?k.sourceURL:P)??void 0});return(R?(0,U.u)("a",{href:R,rel:z,target:V,title:x},ie):null)??ie}_renderChartMediaInfo(g){const{activeMediaInfoIndex:y,formattedMediaInfoCount:v}=this.viewModel;return(0,U.u)("div",{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:dt.mediaChart,key:`media-${g.type}-${y}-${v}`})}_renderMediaInfoType(){const{activeMediaInfo:g}=this.viewModel;return g?"image"===g.type?this._renderImageMediaInfo(g):g.type.includes("chart")?this._renderChartMediaInfo(g):null:null}_renderMediaInfo(){const{activeMediaInfo:g}=this.viewModel;return g?(0,U.u)("div",{class:dt.mediaItemContainer,key:"media-container"},(0,U.u)("div",{class:dt.mediaItem,key:"media-item-container"},this._renderMediaInfoType())):null}_renderMediaPageButton(g){if(this.viewModel.formattedMediaInfoCount<2)return null;const y="previous"===g,v=y?this.messages.previous:this.messages.next;return(0,U.u)("button",{"aria-label":v,bind:this,class:dt.mediaPaginationButton,key:y?"media-previous":"media-next",onclick:y?this._previous:this._next,tabIndex:0,title:v,type:"button"},(0,U.u)("calcite-icon",{class:dt.mediaPaginationIcon,icon:y?"chevron-left":"chevron-right",scale:"s"}))}_setupFeatureElementInfo(){const{description:g,title:y}=this;this._featureElementInfo?.set({description:g,title:y})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){if(!this.viewModel)return;const{isAggregate:g,layer:y}=this.viewModel;return g&&y?.featureReduction&&"renderer"in y.featureReduction?y.featureReduction.renderer:y?.renderer}_getSeriesColors(g){return(0,B.Z)(function*(){const{colorAm5:y}=yield Promise.all([C.e(1603),C.e(8592),C.e(3576)]).then(C.bind(C,3576)),v=new Map;return g.forEach(b=>{b.color&&v.set(b,y(b.color.toCss(!0)))}),v})()}_getRendererColors(){var g=this;return(0,B.Z)(function*(){const{colorAm5:y}=yield Promise.all([C.e(1603),C.e(8592),C.e(3576)]).then(C.bind(C,3576)),v=new Map,b=g._getRenderer();if(!b)return v;const M=yield function wr(g){return an.apply(this,arguments)}(b);return M.delete("default"),Array.from(M.values()).every(F=>1===F?.length)&&Array.from(M.keys()).forEach(F=>{const x=M.get(F)?.[0]?.toCss(!0);x&&v.set(F,y(x))}),v})()}_handleMediaKeyup(g){const y=(0,je.kK)(g);"ArrowLeft"===y&&(g.stopPropagation(),this.viewModel.previous()),"ArrowRight"===y&&(g.stopPropagation(),this.viewModel.next())}_canAnimateChart(){return!!this.viewModel&&!!this.viewModel.abilities.chartAnimation&&!window.matchMedia("(prefers-reduced-motion: reduce)").matches}_getChartAnimationMS(){return this._canAnimateChart()?250:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?500:0}_renderChart(g){var y=this;return(0,B.Z)(function*(){const{root:v,mediaInfo:b}=g,{value:w,type:M}=b,{ResponsiveThemeAm5:F,DarkThemeAm5:x,AnimatedThemeAm5:T,ColorSetAm5:P,ThemeAm5:R,esriChartColorSet:V}=yield Promise.all([C.e(1603),C.e(8592),C.e(3576)]).then(C.bind(C,3576)),z=R.new(v);z.rule("ColorSet").set("colors",V),z.rule("ColorSet").set("reuse",!0);const k=[F.new(v),z];(0,kr.$o)()&&k.push(x.new(v)),y._canAnimateChart()&&k.push(T.new(v)),v.setThemes(k);const H=yield y._getRendererColors(),J=yield y._getSeriesColors(w.series),ie=P.new(v,{}),ue=J.get(w.series[0]),_e=ue?{lineSettings:{stroke:ue}}:void 0,re=w.series.map((Be,mt)=>{const rt=J.get(Be)||H.get(Be.fieldName)||ie.getIndex(mt);return{[Ot]:Be.tooltip,[hi]:Be.value,columnSettings:{fill:rt,stroke:rt},..._e}}).filter(Be=>"pie-chart"!==M||null!=Be.value&&Be.value>0);"pie-chart"===M?y._createPieChart(g,re):y._createXYChart(g,re)})()}_getDirection(){return(0,Mt.dZ)(this.container)?"rtl":"ltr"}_isInversed(){return!!(0,Mt.dZ)(this.container)}_customizeChartTooltip(g,y="horizontal"){var v=this;return(0,B.Z)(function*(){const{colorAm5:b}=yield Promise.all([C.e(1603),C.e(8592),C.e(3576)]).then(C.bind(C,3576));g.setAll({pointerOrientation:y}),g.get("background")?.setAll({stroke:b("rgba(50, 50, 50, 1)")}),g.label.setAll({direction:v._getDirection(),oversizedBehavior:"wrap",maxWidth:200})})()}_createPieChart(g,y){var v=this;return(0,B.Z)(function*(){const{TooltipAm5:b}=yield Promise.all([C.e(1603),C.e(8592),C.e(3576)]).then(C.bind(C,3576)),{PieChartAm5:w,PieSeriesAm5:M}=yield Promise.all([C.e(1603),C.e(4305),C.e(5498)]).then(C.bind(C,65498)),{mediaInfo:F,root:x}=g,{title:T}=F,V=x.container.children.push(w.new(x,{ariaLabel:F?.altText||F?.title||"",focusable:!0,paddingBottom:5,paddingTop:5,paddingLeft:5,paddingRight:5})),z="{category}: {valuePercentTotal.formatNumber('0.00')}%\n ({value})",k=b.new(x,{labelText:z}),H=V.series.push(M.new(x,{name:T,valueField:hi,categoryField:Ot,tooltip:k}));H.ticks.template.set("forceHidden",!0),H.labels.template.set("forceHidden",!0),H.slices.template.states.create("active",{shiftRadius:5}),v._customizeChartTooltip(k),H.slices.template.setAll({ariaLabel:z,focusable:!0,templateField:"columnSettings"}),H.data.setAll(y),H.appear(v._getChartSeriesAnimationMS()),V.appear(v._getChartAnimationMS()),V.root.dom.classList.toggle(dt.mediaChartRendered,!0)})()}_getMinSeriesValue(g){let y=0;return g.forEach(v=>y=Math.min(v.value,y)),y}_createColumnChart(g,y,v){var b=this;return(0,B.Z)(function*(){const{TooltipAm5:w,ScrollbarAm5:M}=yield Promise.all([C.e(1603),C.e(8592),C.e(3576)]).then(C.bind(C,3576)),{CategoryAxisAm5:F,AxisRendererXAm5:x,ValueAxisAm5:T,AxisRendererYAm5:P,ColumnSeriesAm5:R}=yield Promise.all([C.e(1603),C.e(4305),C.e(8592),C.e(2773)]).then(C.bind(C,62773)),{mediaInfo:V,root:z}=y,{value:k,title:H}=V;g.setAll({wheelX:"panX",wheelY:"zoomX"});const J=g.xAxes.push(F.new(z,{renderer:x.new(z,{inversed:b._isInversed()}),categoryField:Ot}));J.get("renderer").labels.template.setAll({forceHidden:!0});const ie=g.yAxes.push(T.new(z,{renderer:P.new(z,{inside:!1}),min:b._getMinSeriesValue(k.series)}));ie.get("renderer").labels.template.setAll({direction:b._getDirection()});const ue="{categoryX}",_e=w.new(z,{labelText:ue}),re=g.series.push(R.new(z,{name:H,xAxis:J,yAxis:ie,valueYField:hi,categoryXField:Ot,tooltip:_e}));b._customizeChartTooltip(_e),re.columns.template.setAll({ariaLabel:ue,focusable:!0,templateField:"columnSettings"}),k.series.length>15&&g.set("scrollbarX",M.new(z,{orientation:"horizontal"})),J.data.setAll(v),re.data.setAll(v),re.appear(b._getChartSeriesAnimationMS()),g.appear(b._getChartAnimationMS())})()}_createBarChart(g,y,v){var b=this;return(0,B.Z)(function*(){const{TooltipAm5:w,ScrollbarAm5:M}=yield Promise.all([C.e(1603),C.e(8592),C.e(3576)]).then(C.bind(C,3576)),{CategoryAxisAm5:F,AxisRendererXAm5:x,ValueAxisAm5:T,AxisRendererYAm5:P,ColumnSeriesAm5:R}=yield Promise.all([C.e(1603),C.e(4305),C.e(8592),C.e(2773)]).then(C.bind(C,62773)),{mediaInfo:V,root:z}=y,{value:k,title:H}=V;g.setAll({wheelX:"panY",wheelY:"zoomY"});const J=g.yAxes.push(F.new(z,{renderer:P.new(z,{inversed:!0}),categoryField:Ot}));J.get("renderer").labels.template.setAll({forceHidden:!0});const ie=g.xAxes.push(T.new(z,{renderer:x.new(z,{inside:!1,inversed:b._isInversed()}),min:b._getMinSeriesValue(k.series)}));ie.get("renderer").labels.template.setAll({direction:b._getDirection()});const ue="{categoryY}",_e=w.new(z,{labelText:ue}),re=g.series.push(R.new(z,{name:H,xAxis:ie,yAxis:J,valueXField:hi,categoryYField:Ot,tooltip:_e}));b._customizeChartTooltip(_e,"vertical"),re.columns.template.setAll({ariaLabel:ue,focusable:!0,templateField:"columnSettings"}),k.series.length>15&&g.set("scrollbarY",M.new(z,{orientation:"vertical"})),J.data.setAll(v),re.data.setAll(v),re.appear(b._getChartSeriesAnimationMS()),g.appear(b._getChartAnimationMS())})()}_createLineChart(g,y,v){var b=this;return(0,B.Z)(function*(){const{TooltipAm5:w,ScrollbarAm5:M}=yield Promise.all([C.e(1603),C.e(8592),C.e(3576)]).then(C.bind(C,3576)),{CategoryAxisAm5:F,AxisRendererXAm5:x,ValueAxisAm5:T,AxisRendererYAm5:P,LineSeriesAm5:R}=yield Promise.all([C.e(1603),C.e(4305),C.e(8592),C.e(2773)]).then(C.bind(C,62773)),{root:V,mediaInfo:z}=y,{value:k,title:H}=z;g.setAll({wheelX:"panX",wheelY:"zoomX"});const J=g.xAxes.push(F.new(V,{renderer:x.new(V,{inversed:b._isInversed()}),categoryField:Ot}));J.get("renderer").labels.template.setAll({forceHidden:!0});const ie=g.yAxes.push(T.new(V,{renderer:P.new(V,{inside:!1}),min:b._getMinSeriesValue(k.series)}));ie.get("renderer").labels.template.setAll({direction:b._getDirection()});const _e=v[0]?.lineSettings?.stroke,re=w.new(V,{getFillFromSprite:!_e,labelText:"{categoryX}"});_e&&re.get("background")?.setAll({fill:_e});const Be=g.series.push(R.new(V,{name:H,xAxis:J,yAxis:ie,valueYField:hi,categoryXField:Ot,tooltip:re}));Be.strokes.template.setAll({templateField:"lineSettings"}),b._customizeChartTooltip(re,"vertical"),k.series.length>15&&g.set("scrollbarX",M.new(V,{orientation:"horizontal"})),J.data.setAll(v),Be.data.setAll(v),Be.appear(b._getChartSeriesAnimationMS()),g.appear(b._getChartAnimationMS())})()}_createXYChart(g,y){var v=this;return(0,B.Z)(function*(){const{XYChartAm5:b,XYCursorAm5:w}=yield Promise.all([C.e(1603),C.e(4305),C.e(8592),C.e(2773)]).then(C.bind(C,62773)),{root:M,mediaInfo:F}=g,{type:x}=F,P=M.container.children.push(b.new(M,{ariaLabel:F?.altText||F?.title||"",focusable:!0,panX:!0,panY:!0}));P.set("cursor",w.new(M,{})),"column-chart"===x&&(yield v._createColumnChart(P,g,y)),"bar-chart"===x&&(yield v._createBarChart(P,g,y)),"line-chart"===x&&(yield v._createLineChart(P,g,y)),P.root.dom.classList.toggle(dt.mediaChartRendered,!0)})()}_clearMediaRefreshTimer(){const{_refreshTimer:g}=this;g&&(clearTimeout(g),this._refreshTimer=null)}_updateMediaInfoTimestamp(g){const y=Date.now();this._refreshIntervalInfo={timestamp:y,sourceURL:g&&this._getImageSource(g,y)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:g}=this.viewModel;g&&"image"===g.type&&g.refreshInterval&&this._setRefreshTimeout(g)}_setRefreshTimeout(g){const{refreshInterval:y,value:v}=g;if(!y)return;const b=6e4*y;this._updateMediaInfoTimestamp(v.sourceURL);const w=setInterval(()=>{this._updateMediaInfoTimestamp(v.sourceURL)},b);this._refreshTimer=w}_getImageSource(g,y){const v=g.includes("?")?"&":"?",[b,w=""]=g.split("#");return`${b}${v}timestamp=${y}${w?"#":""}${w}`}};(0,_._)([(0,A.Cb)()],ut.prototype,"_refreshIntervalInfo",void 0),(0,_._)([(0,A.Cb)()],ut.prototype,"attributes",null),(0,_._)([(0,A.Cb)()],ut.prototype,"activeMediaInfoIndex",null),(0,_._)([(0,A.Cb)()],ut.prototype,"description",null),(0,_._)([(0,A.Cb)()],ut.prototype,"fieldInfoMap",null),(0,_._)([(0,A.Cb)()],ut.prototype,"layer",null),(0,_._)([(0,A.Cb)()],ut.prototype,"mediaInfos",null),(0,_._)([(0,A.Cb)()],ut.prototype,"popupTemplate",null),(0,_._)([(0,A.Cb)()],ut.prototype,"relatedInfos",null),(0,_._)([(0,A.Cb)()],ut.prototype,"title",null),(0,_._)([(0,A.Cb)({type:Dt})],ut.prototype,"viewModel",void 0),(0,_._)([(0,A.Cb)(),(0,pt.H)("esri/widgets/Feature/t9n/Feature")],ut.prototype,"messages",void 0),ut=(0,_._)([(0,ne.j)("esri.widgets.Feature.FeatureMedia")],ut);const Ms=ut;C(20004),C(37462),C(52225),C(49497);var Kr=C(90629),Qr=C(57229),Cs=(C(98522),C(23002)),Xr=C(43573),Jr=C(90373);const qr=["$datastore","$map","$layer","$aggregatedfeatures"],ta=Pe.Z.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");function ia(g){return"string"==typeof g?li(Bi(g)):Array.isArray(g)?function na(g){return`<ul class="esri-widget__list">${g.map(y=>`<li>${"string"==typeof y?li(Bi(y)):y}</li>`).join("")}</ul>`}(g):"esri.arcade.Dictionary"===g?.declaredClass?function sa(g){return`<table class="esri-widget__table">${g.keys().map(y=>{const v=g.field(y);return`<tr><th>${y}</th><td>${"string"==typeof v?li(Bi(v)):v}</td></tr>`}).join("")}</table>`}(g):g}function Fs(){return Promise.all([C.e(3866),C.e(4025)]).then(C.bind(C,34025))}function aa(g){return fn.apply(this,arguments)}function fn(){return(fn=(0,B.Z)(function*({graphic:g,view:y}){const{isAggregate:v,layer:b}=g;if(!v||!b||"2d"!==y?.type)return[];const w=yield y.whenLayerView(b);if(!function ra(g){return"createQuery"in g&&"queryFeatures"in g}(w))return[];const M=w.createQuery(),F=g.getObjectId();M.aggregateIds=null!=F?[F]:[];const{features:x}=yield w.queryFeatures(M);return x})).apply(this,arguments)}function _s(g){return gn.apply(this,arguments)}function gn(){return(gn=(0,B.Z)(function*({expressionInfo:g,arcadeUtils:y,interceptor:v,spatialReference:b,map:w,graphic:M,view:F}){if(!g?.expression)return null;const x=y.createSyntaxTree(g.expression),T=qr.filter(k=>y.hasVariable(x,k)),[P]=yield Promise.all([aa({graphic:M,view:F}),y.loadScriptDependencies(x,!0,T)]),R=y.getViewInfo({spatialReference:b}),V=y.createExecContext(M,R,F?.timeZone);V.interceptor=v,V.useAsync=!0,function oa({aggregatedFeatures:g,arcadeUtils:y,featureSetVars:v,context:b,viewInfo:w,map:M,graphic:F,interceptor:x}){v.forEach(T=>{const P=T.toLowerCase(),R=w.sr;if("$map"===P&&(b.vars[P]=y.convertMapToFeatureSetCollection({map:M,spatialReference:R,interceptor:x})),"$layer"===P&&(b.vars[P]=y.convertFeatureLayerToFeatureSet({layer:F.sourceLayer,spatialReference:R,interceptor:x})),"$datastore"===P&&(b.vars[P]=y.convertServiceUrlToWorkspace({url:F.sourceLayer.url,spatialReference:R,interceptor:x})),"$aggregatedfeatures"===P){const z=F.layer,{fields:k,objectIdField:H,geometryType:J,spatialReference:ie,displayField:ue}=z,_e=new Jr.default({fields:k,objectIdField:H,geometryType:J,spatialReference:ie,displayField:ue,..."feature"===z.type?{templates:z.templates,typeIdField:z.typeIdField,types:z.types}:null,source:g});b.vars[P]=y.convertFeatureLayerToFeatureSet({layer:_e,spatialReference:ie,interceptor:x})}})}({aggregatedFeatures:P,arcadeUtils:y,featureSetVars:T,context:V,viewInfo:R,map:w,graphic:M,interceptor:v});const z=y.createFunction(x,V);return y.executeAsyncFunction(z,V).catch(k=>ta.error("arcade-execution-error",{error:k,graphic:M,expressionInfo:g}))})).apply(this,arguments)}function la(g){return yn.apply(this,arguments)}function yn(){return(yn=(0,B.Z)(function*({expressionInfos:g,spatialReference:y,graphic:v,interceptor:b,map:w,view:M}){if(!g?.length)return{};const F=yield Fs(),x={};for(const R of g)x[`expression/${R.name}`]=_s({expressionInfo:R,arcadeUtils:F,interceptor:b,spatialReference:y,map:w,graphic:v,view:M});const T=yield(0,it.as)(x),P={};for(const R in T)P[R]=ia(T[R].value);return P})).apply(this,arguments)}let gt=class extends lt.Z{constructor(g){var y;super(g),y=this,this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.view=null,this._cancelQuery=()=>{const{_abortController:v}=this;v&&v.abort(),this._abortController=null},this._createVM=()=>{const v=this.contentElement?.type;this.contentElementViewModel?.destroy();const b="fields"===v?new Fi:"media"===v?new Dt:"text"===v?new Mi:null;this._set("contentElementViewModel",b)},this._compile=(0,B.Z)(function*(){y._cancelQuery();const v=new AbortController;y._abortController=v,yield y._compileExpression(),y._abortController===v&&(y._abortController=null)}),this._compileThrottled=(0,j.P)(this._compile,1,this),this._compileExpression=(0,B.Z)(function*(){const{expressionInfo:v,graphic:b,interceptor:w,spatialReference:M,map:F,view:x,_abortController:T}=y;if(!(v&&b&&M&&F))return void y._set("contentElement",null);const P=yield Fs();if(T!==y._abortController)return;const R=yield _s({arcadeUtils:P,expressionInfo:v,graphic:b,interceptor:w,map:F,spatialReference:M,view:x});if(!R||"esri.arcade.Dictionary"!==R.declaredClass)return void y._set("contentElement",null);const V=yield R.castAsJsonAsync(T?.signal),z=V?.type,k="media"===z?Qr.Z.fromJSON(V):"text"===z?Cs.Z.fromJSON(V):"fields"===z?Kr.Z.fromJSON(V):null;y._set("contentElement",k)}),this.addHandles([(0,$.YP)(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),$.nn),(0,$.YP)(()=>[this.contentElement],()=>this._createVM(),$.nn)])}initialize(){this.addHandles(this._compileThrottled)}destroy(){this._cancelQuery(),this.contentElementViewModel?.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(g){this._override("spatialReference",g)}get state(){const{_abortController:g,contentElement:y,contentElementViewModel:v}=this;return g?"loading":y||v?"ready":"disabled"}get map(){return this.view?.map??null}set map(g){this._override("map",g)}};(0,_._)([(0,A.Cb)()],gt.prototype,"_abortController",void 0),(0,_._)([(0,A.Cb)({type:Xr.Z})],gt.prototype,"expressionInfo",void 0),(0,_._)([(0,A.Cb)({type:at.Z})],gt.prototype,"graphic",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],gt.prototype,"contentElement",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],gt.prototype,"contentElementViewModel",void 0),(0,_._)([(0,A.Cb)()],gt.prototype,"interceptor",void 0),(0,_._)([(0,A.Cb)()],gt.prototype,"spatialReference",null),(0,_._)([(0,A.Cb)({readOnly:!0})],gt.prototype,"state",null),(0,_._)([(0,A.Cb)()],gt.prototype,"map",null),(0,_._)([(0,A.Cb)()],gt.prototype,"view",void 0),gt=(0,_._)([(0,ne.j)("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],gt);const vn=gt,bn="esri-feature",wn={base:`${bn}-expression`,loadingSpinnerContainer:`${bn}__loading-container`,spinner:`${bn}__loading-spinner`};let xi=class extends Y.Z{constructor(g,y){super(g,y),this._contentWidget=null,this.viewModel=new vn}initialize(){this.addHandles((0,$.YP)(()=>this.viewModel?.contentElementViewModel,()=>this._setupExpressionWidget(),$.nn))}destroy(){this._destroyContentWidget()}render(){const{state:g}=this.viewModel;return(0,U.u)("div",{class:wn.base},"loading"===g?this._renderLoading():"disabled"===g?null:this._contentWidget?.render())}_renderLoading(){return(0,U.u)("div",{class:wn.loadingSpinnerContainer,key:"loading-container"},(0,U.u)("span",{class:this.classes(yt.W.loadingIndicator,we.z.rotating,wn.spinner)}))}_destroyContentWidget(){const{_contentWidget:g}=this;g&&(g.viewModel=null,g.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:g,contentElement:y}=this.viewModel,v=y?.type;this._destroyContentWidget();const b=g?"fields"===v?new hs({viewModel:g}):"media"===v?new Ms({viewModel:g}):"text"===v?new Ci({viewModel:g}):null:null;this._contentWidget=b,this.scheduleRender()}};(0,_._)([(0,A.Cb)({type:vn})],xi.prototype,"viewModel",void 0),xi=(0,_._)([(0,ne.j)("esri.widgets.Feature.FeatureExpression")],xi);const ua=xi;var Mn,ca=C(51172),ha=C(25387),Is=C(84373);C(480),C(73191),C(42534),(Mn||(Mn={})).TOO_SHORT="length-validation-error::too-short";const va=g=>{const y=[];if(g.formTemplate){const{description:v,title:b}=g.formTemplate;g.fields?.forEach(w=>{const M=b&&(0,O.pZ)(b,w.name),F=v&&(0,O.pZ)(v,w.name);(M||F)&&y.push(w.name)})}return y};let Se=class extends((0,ha.J)((0,Is.IG)(lt.Z))){constructor(g){var y;super(g),y=this,this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:v}=this;v&&v.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:v}=this;v&&v.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:v}=this;v&&v.abort(),this._queryPageAbortController=null},this._queryController=(0,B.Z)(function*(){y._cancelQuery();const v=new AbortController;y._queryAbortController=v,yield(0,it.R8)(y._query()),y._queryAbortController===v&&(y._queryAbortController=null)}),this._queryFeatureCountController=(0,B.Z)(function*(){y._loaded=!1,y._cancelQueryFeatureCount();const v=new AbortController;y._queryFeatureCountAbortController=v,yield(0,it.R8)(y._queryFeatureCount()),y._queryFeatureCountAbortController===v&&(y._queryFeatureCountAbortController=null),y._loaded=!0}),this._queryPageController=(0,B.Z)(function*(){const v=new AbortController;y._queryPageAbortController=v,yield(0,it.R8)(y._queryPage()),y._queryPageAbortController===v&&(y._queryPageAbortController=null)}),this._queryDebounced=(0,it.Ds)(this._queryController,100),this._queryFeatureCountDebounced=(0,it.Ds)(this._queryFeatureCountController,100),this._queryPageDebounced=(0,it.Ds)(this._queryPageController,100),this._query=(0,B.Z)(function*(){const{_queryAbortController:v,relatedFeatures:b}=y;y.featureCount&&(y._destroyRelatedFeatureViewModels(),y.featurePage=1,b.removeAll(),y.destroyed||b.addMany(y._sliceFeatures(yield y._queryRelatedFeatures({signal:v?.signal}))))}),this.addHandles([(0,$.YP)(()=>[this.displayCount,this.graphic,this.layer,this.layer?.loaded,this.map,this.orderByFields,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount],()=>this._queryDebounced(),$.nn),(0,$.YP)(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageDebounced()),(0,$.YP)(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery],()=>this._queryFeatureCountDebounced())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.removeAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(g){const{featuresPerPage:y,featureCount:v}=this,w=Math.ceil(v/y)||1;this._set("featurePage",Math.min(Math.max(g,1),w))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:g,relatedLayer:y}=this;return g&&y?.loaded?g.map(v=>{const b=v.clone();return b.field=ai(v.field,y),b}):g??[]}get supportsCacheHint(){return!!this.layer?.capabilities?.queryRelated?.supportsCacheHint}get canLoad(){return!!this.map&&"number"==typeof this.relationshipId&&"number"==typeof this.objectId}get canQuery(){const g=this.layer?.capabilities?.queryRelated;return!!(this.relatedLayer&&this.relationship&&"number"==typeof this.relationshipId&&"number"==typeof this.objectId&&g?.supportsCount&&g?.supportsPagination)}get itemDescriptionFieldName(){return this.orderByFieldsFixedCasing[0]?.field||null}set displayCount(g){this._set("displayCount",Math.min(Math.max(g,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){return(this.objectIdField&&this.graphic?.attributes?.[this.objectIdField])??null}get objectIdField(){return this.layer?.objectIdField||null}get relatedFeatures(){return this._get("relatedFeatures")||new $e.Z}get relatedLayer(){const{layer:g,map:y,relationship:v}=this;return g?.loaded&&y&&v?function zo(g,y,v){return g&&y&&v?rs(g.allLayers,y,v)||rs(g.allTables,y,v):null}(y,g,v)??null:null}get relationship(){const{relationshipId:g,layer:y}=this;return"number"==typeof g?y?.relationships?.find(({id:v})=>v===g)??null:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new $e.Z}get state(){const{_queryAbortController:g,_queryFeatureCountAbortController:y,_queryPageAbortController:v,canQuery:b,_loaded:w,canLoad:M}=this;return y||M&&!w?"loading":g||v?"querying":b?"ready":"disabled"}getRelatedFeatureByObjectId(g){return this.relatedFeatures.find(y=>y.getObjectId()===g)}_destroyRelatedFeatureViewModels(){this.relatedFeatureViewModels?.forEach(g=>!g.destroyed&&g.destroy()),this.relatedFeatureViewModels.removeAll()}_queryFeatureCount(){var g=this;return(0,B.Z)(function*(){const{layer:y,relatedLayer:v,relationshipId:b,objectId:w,_queryFeatureCountAbortController:M,canQuery:F,supportsCacheHint:x}=g;if(yield y?.load(),yield v?.load(),!F||!y||!v)return void g._set("featureCount",0);const T=v.createQuery(),P=new hn.default({cacheHint:x,relationshipId:b,returnGeometry:!1,objectIds:[w],where:T.where??void 0}),R=yield y.queryRelatedFeaturesCount(P,{signal:M?.signal});g._set("featureCount",R[w]||0)})()}_sliceFeatures(g){const{showAllEnabled:y,displayCount:v}=this;return y?g:v?g.slice(0,v):[]}_queryPage(){var g=this;return(0,B.Z)(function*(){const{relatedFeatures:y,featurePage:v,showAllEnabled:b,_queryPageAbortController:w,featureCount:M}=g;!b||v<2||!M||y.addMany(yield g._queryRelatedFeatures({signal:w?.signal}))})()}_queryRelatedFeatures(g){var y=this;return(0,B.Z)(function*(){const{orderByFieldsFixedCasing:v,showAllEnabled:b,featuresPerPage:w,displayCount:M,layer:F,relationshipId:x,featurePage:T,featureCount:P,relatedLayer:R,supportsCacheHint:V}=y,{canQuery:z,objectId:k}=y;if(!z||!F||!R)return[];const H=b?((T-1)*w+P)%P:0,J=b?w:M,ie=R.objectIdField,ue=[...v.map(wt=>wt.field),...va(R),ie].filter(Ve.pC),_e=v.map(wt=>`${wt.field} ${wt.order}`),re=R.createQuery(),Be=new hn.default({orderByFields:_e,start:H,num:J,outFields:ue,cacheHint:V,relationshipId:x,returnGeometry:!1,objectIds:[k],where:re.where??void 0}),mt=yield F.queryRelatedFeatures(Be,{signal:g?.signal}),rt=mt[k]?.features||[];return rt.forEach(wt=>{wt.sourceLayer=R,wt.layer=R}),rt})()}};(0,_._)([(0,A.Cb)()],Se.prototype,"_loaded",void 0),(0,_._)([(0,A.Cb)()],Se.prototype,"_queryAbortController",void 0),(0,_._)([(0,A.Cb)()],Se.prototype,"_queryPageAbortController",void 0),(0,_._)([(0,A.Cb)()],Se.prototype,"_queryFeatureCountAbortController",void 0),(0,_._)([(0,A.Cb)({value:1})],Se.prototype,"featurePage",null),(0,_._)([(0,A.Cb)()],Se.prototype,"featuresPerPage",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],Se.prototype,"orderByFieldsFixedCasing",null),(0,_._)([(0,A.Cb)({readOnly:!0})],Se.prototype,"supportsCacheHint",null),(0,_._)([(0,A.Cb)({readOnly:!0})],Se.prototype,"canLoad",null),(0,_._)([(0,A.Cb)({readOnly:!0})],Se.prototype,"canQuery",null),(0,_._)([(0,A.Cb)()],Se.prototype,"description",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],Se.prototype,"itemDescriptionFieldName",null),(0,_._)([(0,A.Cb)({value:3})],Se.prototype,"displayCount",null),(0,_._)([(0,A.Cb)({type:at.Z})],Se.prototype,"graphic",void 0),(0,_._)([(0,A.Cb)()],Se.prototype,"layer",void 0),(0,_._)([(0,A.Cb)()],Se.prototype,"map",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],Se.prototype,"objectId",null),(0,_._)([(0,A.Cb)({readOnly:!0})],Se.prototype,"objectIdField",null),(0,_._)([(0,A.Cb)()],Se.prototype,"orderByFields",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],Se.prototype,"relatedFeatures",null),(0,_._)([(0,A.Cb)({readOnly:!0})],Se.prototype,"relatedLayer",null),(0,_._)([(0,A.Cb)({readOnly:!0})],Se.prototype,"relationship",null),(0,_._)([(0,A.Cb)()],Se.prototype,"featureCount",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],Se.prototype,"relatedFeatureViewModels",null),(0,_._)([(0,A.Cb)()],Se.prototype,"relationshipId",void 0),(0,_._)([(0,A.Cb)()],Se.prototype,"showAllEnabled",void 0),(0,_._)([(0,A.Cb)()],Se.prototype,"state",null),(0,_._)([(0,A.Cb)()],Se.prototype,"title",void 0),(0,_._)([(0,A.Cb)()],Se.prototype,"getRelatedFeatureByObjectId",null),Se=(0,_._)([(0,ne.j)("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],Se);const Fn=Se,pi="esri-feature",mi=`${pi}-relationship`,Et={base:mi,listContainer:`${mi}__list`,listItem:`${mi}__list-item`,listItemHidden:`${mi}__list-item--hidden`,listContainerQuerying:`${mi}__list--querying`,featureObserver:`${pi}__feature-observer`,stickySpinnerContainer:`${pi}__sticky-loading-container`,loadingSpinnerContainer:`${pi}__loading-container`,spinner:`${pi}__loading-spinner`},Rs={title:!0,description:!0};let ct=class extends Y.Z{constructor(g,y){super(g,y),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([v])=>{v?.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.headingLevel=2,this.viewModel=new Fn,this.messages=null,this.messagesCommon=null,this.visibleElements={...Rs},this._increaseFeaturePage=()=>{const{state:v,showAllEnabled:b,relatedFeatures:w,featuresPerPage:M,featurePage:F}=this.viewModel;"ready"===v&&b&&w.length>=M*F&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new wi,this.addHandles([(0,$.YP)(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),$.nn),(0,$.YP)(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),(0,$.on)(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return(0,Kt.h)({icon:()=>C.e(4540).then(C.bind(C,24540)),list:()=>Promise.all([C.e(148),C.e(8592),C.e(6985)]).then(C.bind(C,66985)),"list-item":()=>Promise.all([C.e(148),C.e(5782),C.e(8592),C.e(9475)]).then(C.bind(C,99475)),notice:()=>Promise.all([C.e(148),C.e(2347)]).then(C.bind(C,72347))})}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=(0,ca.SC)(this._featureElementInfo)}get displayShowAllButton(){const{showAllEnabled:g,featureCount:y,displayCount:v,state:b}=this.viewModel;return!g&&!!y&&"ready"===b&&(y>v||0===v)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(g){this.viewModel.description=g}get featureCountDescription(){const{messages:g}=this,{featureCount:y}=this.viewModel;return(0,It.n)(g?.numberRecords,{number:y})}get title(){return this.viewModel.title}set title(g){this.viewModel.title=g}castVisibleElements(g){return{...Rs,...g}}render(){const{state:g}=this.viewModel;return(0,U.u)("div",{class:this.classes(Et.base,we.z.widget)},this._featureElementInfo?.render(),"loading"===g?this._renderLoading():"disabled"===g?this._renderRelationshipNotFound():this._renderRelatedFeatures())}_renderStickyLoading(){return"querying"===this.viewModel.state?(0,U.u)("div",{class:Et.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return(0,U.u)("span",{class:this.classes(yt.W.loadingIndicator,we.z.rotating,Et.spinner)})}_renderLoading(){return(0,U.u)("div",{class:Et.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderShowAllIconNode(){return(0,U.u)("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})}_renderChevronIconNode(){const g=(0,Mt.dZ)(this.container)?"chevron-left":"chevron-right";return(0,U.u)("calcite-icon",{icon:g,scale:"s",slot:"content-end"})}_renderRelatedFeature(g){const{itemDescriptionFieldName:y}=this.viewModel,v=g.title;return g.description=y&&g.formattedAttributes?.global[y],(0,U.u)("calcite-list-item",{class:this.classes(Et.listItem,{[Et.listItemHidden]:"loading"===g.state}),description:g.description??"",key:g.uid,label:v,onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:g})},this._renderChevronIconNode())}_renderShowAllListItem(){return this.displayShowAllButton?(0,U.u)("calcite-list-item",{description:this.featureCountDescription,key:"show-all-item",label:this.messages?.showAll,onCalciteListItemSelect:()=>this.emit("show-all-records")},this._renderShowAllIconNode()):null}_renderNoRelatedFeaturesMessage(){return(0,U.u)("calcite-notice",{icon:"information",key:"no-related-features-message",kind:"brand",open:!0,scale:"s",width:"full"},(0,U.u)("div",{slot:"message"},this.messages?.noRelatedFeatures))}_renderFeatureObserver(){return(0,U.u)("div",{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:Et.featureObserver,key:"feature-observer"})}_renderList(){const{relatedFeatureViewModels:g}=this.viewModel;return(0,U.u)("calcite-list",null,g.toArray().map(y=>this._renderRelatedFeature(y)),this._renderShowAllListItem())}_renderRelatedFeatures(){const{displayListItems:g}=this,{state:y}=this.viewModel;return(0,U.u)("div",{class:this.classes(Et.listContainer,{[Et.listContainerQuerying]:"querying"===y}),key:"list-container"},g?this._renderList():"ready"===y?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}_renderRelationshipNotFound(){return(0,U.u)("calcite-notice",{icon:"exclamation-mark-triangle",key:"relationship-not-found",kind:"danger",open:!0,scale:"s",width:"full"},(0,U.u)("div",{slot:"message"},this.messages?.relationshipNotFound))}_setupRelatedFeatureViewModels(){const{relatedFeatureViewModels:g}=this.viewModel,y="related-feature-viewmodels";this.removeHandles(y),g?.forEach(v=>{this.addHandles((0,$.YP)(()=>[v.title,v.state],()=>this.scheduleRender(),$.nn),y)}),this.scheduleRender()}_setupFeatureElementInfo(){const{headingLevel:g,visibleElements:y}=this,v=y.description&&this.description,b=y.title&&this.title;this._featureElementInfo?.set({description:v,title:b,headingLevel:g})}_handleRelatedFeatureObserverChange(){var g=this;return(0,B.Z)(function*(){g._unobserveRelatedFeatureObserver();const{state:y,showAllEnabled:v}=g.viewModel;yield(0,it.e4)(0),g._relatedFeatureIntersectionObserverNode&&"ready"===y&&v&&g._relatedFeatureIntersectionObserver.observe(g._relatedFeatureIntersectionObserverNode)})()}_relatedFeatureIntersectionObserverCreated(g){this._relatedFeatureIntersectionObserverNode=g}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};(0,_._)([(0,A.Cb)()],ct.prototype,"_relatedFeatureIntersectionObserverNode",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],ct.prototype,"displayShowAllButton",null),(0,_._)([(0,A.Cb)({readOnly:!0})],ct.prototype,"displayListItems",null),(0,_._)([(0,A.Cb)()],ct.prototype,"description",null),(0,_._)([(0,A.Cb)({readOnly:!0})],ct.prototype,"featureCountDescription",null),(0,_._)([(0,A.Cb)()],ct.prototype,"headingLevel",void 0),(0,_._)([(0,A.Cb)()],ct.prototype,"title",null),(0,_._)([(0,A.Cb)({type:Fn})],ct.prototype,"viewModel",void 0),(0,_._)([(0,A.Cb)(),(0,pt.H)("esri/widgets/Feature/t9n/Feature")],ct.prototype,"messages",void 0),(0,_._)([(0,A.Cb)(),(0,pt.H)("esri/t9n/common")],ct.prototype,"messagesCommon",void 0),(0,_._)([(0,A.Cb)()],ct.prototype,"visibleElements",void 0),(0,_._)([(0,N.p)("visibleElements")],ct.prototype,"castVisibleElements",null),ct=(0,_._)([(0,ne.j)("esri.widgets.Feature.FeatureRelationship")],ct);const Os=ct;var fi;const Us="content-view-models",Ss="relationship-view-models",Zs={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0};let ze=fi=class extends((0,Is.IG)(lt.Z)){constructor(g){super(g),this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=(0,j.P)(this._graphicChanged,1,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...Zs},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=y=>{const{abilities:v}=this;return"attachments"===y.type&&!!v.attachmentsContent||"custom"===y.type&&!!v.customContent||"fields"===y.type&&!!v.fieldsContent||"media"===y.type&&!!v.mediaContent||"text"===y.type&&!!v.textContent||"expression"===y.type&&!!v.expressionContent||"relationship"===y.type&&!!v.relationshipContent},this.addHandles((0,$.YP)(()=>[this.graphic,this._effectivePopupTemplate,this.abilities],()=>this._graphicChangedThrottled(),$.nn))}initialize(){this.addHandles(this._graphicChangedThrottled)}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return null!=this.graphic?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return function So(g,y){const v=new Map;return g&&g.forEach(b=>{const w=ai(b.fieldName,y);b.fieldName=w,v.set(w.toLowerCase(),b)}),v}(es(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return Kn(this.graphic)}castAbilities(g){return{...Zs,...g}}get isTable(){return this._sourceLayer?.isTable||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(g){this._set("graphic",g?g.clone():null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(g){this._override("spatialReference",g)}get map(){return this.view?.map||null}set map(g){this._override("map",g)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(g,y){const v=this.contentViewModels[g];v instanceof Dt&&v.setActiveMedia(y)}nextMedia(g){const y=this.contentViewModels[g];y instanceof Dt&&y.next()}previousMedia(g){const y=this.contentViewModels[g];y instanceof Dt&&y.previous()}updateGeometry(){var g=this;return(0,B.Z)(function*(){const{graphic:y,spatialReference:v,_sourceLayer:b}=g;yield b?.load();const w=b?.objectIdField;if(!w||!y||!b)return;const M=y?.attributes?.[w];if(null==M)return;const F=[M];if(!y.geometry){const x=yield is({layer:b,graphic:y,outFields:[],objectIds:F,returnGeometry:!0,spatialReference:v}),T=x?.geometry;T&&(y.geometry=T)}})()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}_graphicChanged(){var g=this;return(0,B.Z)(function*(){g._cancelFeatureQuery(),g._error=null,g._clear();const{graphic:y}=g;if(!y)return;const v=new AbortController;g._featureAbortController=v;try{yield g._queryFeature({signal:v.signal})}catch(b){(0,it.D_)(b)||(g._error=b,Pe.Z.getLogger(g).error("error","The popupTemplate could not be displayed for this feature.",{error:b,graphic:y,popupTemplate:g._effectivePopupTemplate}))}g._featureAbortController===v&&(g._featureAbortController=null)})()}_cancelFeatureQuery(){const{_featureAbortController:g}=this;g&&g.abort(),this._featureAbortController=null}_compileContentElement(g,y){return"attachments"===g.type?this._compileAttachments(g,y):"custom"===g.type?this._compileCustom(g,y):"fields"===g.type?this._compileFields(g,y):"media"===g.type?this._compileMedia(g,y):"text"===g.type?this._compileText(g,y):"expression"===g.type?this._compileExpression(g,y):"relationship"===g.type?this._compileRelationship(g,y):void 0}_compileContent(g){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(g)?g.filter(this._isAllowedContentType).map((y,v)=>this._compileContentElement(y,v)).filter(Ve.pC):"string"==typeof g?this._compileText(new Cs.Z({text:g}),0).text:g}_destroyContentViewModels(){this.removeHandles(Ss),this.removeHandles(Us),this.contentViewModels.forEach(g=>g&&!g.destroyed&&g.destroy()),this._set("contentViewModels",[])}_matchesFeature(g,y){const v=g?.graphic?.getObjectId(),b=y?.getObjectId();return null!=v&&null!=b&&v===b}_setRelatedFeaturesViewModels({relatedFeatureViewModels:g,relatedFeatures:y,map:v}){const{view:b,spatialReference:w}=this;y?.filter(Boolean).forEach(M=>{g.find(F=>this._matchesFeature(F,M))||g.add(new fi({abilities:{relationshipContent:!1},map:v,view:b,spatialReference:w,graphic:M}))}),g.forEach(M=>{y?.find(x=>this._matchesFeature(M,x))||g.remove(M)})}_setExpressionContentVM(g,y){const v=this.formattedAttributes,{contentElement:b,contentElementViewModel:w}=g,M=b?.type;w&&M&&("fields"===M&&(this._createFieldsFormattedAttributes({contentElement:b,contentElementIndex:y,formattedAttributes:v}),w.set(this._createFieldsVMParams(b,y))),"media"===M&&(this._createMediaFormattedAttributes({contentElement:b,contentElementIndex:y,formattedAttributes:v}),w.set(this._createMediaVMParams(b,y))),"text"===M&&w.set(this._createTextVMParams(b)))}_compileRelationship(g,y){const{displayCount:v,orderByFields:b,relationshipId:w,title:M,description:F}=g,{_sourceLayer:x,graphic:T,map:P}=this;if(!Di(x))return;const R=new Fn({displayCount:v,graphic:T,orderByFields:b,relationshipId:w,layer:x,map:P,...this._compileTitleAndDesc({title:M,description:F})});return this.contentViewModels[y]=R,this.addHandles((0,$.on)(()=>R.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(R)),Ss),g}_compileExpression(g,y){const{expressionInfo:v}=g,{graphic:b,map:w,spatialReference:M,view:F}=this,x=new vn({expressionInfo:v,graphic:b,interceptor:fi.interceptor,map:w,spatialReference:M,view:F});return this.contentViewModels[y]=x,this.addHandles((0,$.YP)(()=>x.contentElementViewModel,()=>this._setExpressionContentVM(x,y),$.nn),Us),g}_compileAttachments(g,y){const{graphic:v}=this,{description:b,title:w}=g;return this.contentViewModels[y]=new Gi({graphic:v,...this._compileTitleAndDesc({title:w,description:b})}),g}_compileCustom(g,y){const{graphic:v}=this,{creator:b,destroyer:w}=g;return this.contentViewModels[y]=new Mi({graphic:v,creator:b,destroyer:w}),g}_compileTitleAndDesc({title:g,description:y}){const{_fieldInfoMap:v,_sourceLayer:b,graphic:w,formattedAttributes:M}=this,F=w?.attributes,x=this._expressionAttributes,T=M.global;return{title:$t({attributes:F,fieldInfoMap:v,globalAttributes:T,expressionAttributes:x,layer:b,text:g}),description:$t({attributes:F,fieldInfoMap:v,globalAttributes:T,expressionAttributes:x,layer:b,text:y})}}_createFieldsVMParams(g,y){const v=this._effectivePopupTemplate,b=this.formattedAttributes,w={...b?.global,...b?.content[y]},M=g?.fieldInfos||v?.fieldInfos,F=M?.filter(({fieldName:R})=>Si(R)||At(R)||w.hasOwnProperty(R)),x=v?.expressionInfos,{description:T,title:P}=g;return{attributes:w,expressionInfos:x,fieldInfos:F,...this._compileTitleAndDesc({title:P,description:T})}}_compileFields(g,y){const v=g.clone(),b=new Fi(this._createFieldsVMParams(g,y));return this.contentViewModels[y]=b,v.fieldInfos=b.formattedFieldInfos.slice(0),v}_createMediaVMParams(g,y){const{abilities:v,graphic:b,_fieldInfoMap:w,_effectivePopupTemplate:M,relatedInfos:F,_sourceLayer:x,_expressionAttributes:T}=this,P=this.formattedAttributes,R=b?.attributes??{},{description:V,mediaInfos:z,title:k}=g;return{abilities:{chartAnimation:v.chartAnimation},activeMediaInfoIndex:g.activeMediaInfoIndex||0,attributes:R,isAggregate:b?.isAggregate,layer:x,fieldInfoMap:w,formattedAttributes:{...P?.global,...P?.content[y]},expressionAttributes:T,mediaInfos:z,popupTemplate:M,relatedInfos:F,...this._compileTitleAndDesc({title:k,description:V})}}_compileMedia(g,y){const v=g.clone(),b=new Dt(this._createMediaVMParams(g,y));return v.mediaInfos=b.formattedMediaInfos.slice(0),this.contentViewModels[y]=b,v}_createTextVMParams(g){const{graphic:y,_fieldInfoMap:v,_sourceLayer:b,_expressionAttributes:w}=this;return g&&g.text&&(g.text=$t({attributes:y?.attributes??{},fieldInfoMap:v,globalAttributes:this.formattedAttributes?.global??{},expressionAttributes:w,layer:b,text:g.text})),{graphic:y,creator:g.text}}_compileText(g,y){const v=g.clone();return this.contentViewModels[y]=new Mi(this._createTextVMParams(v)),v}_compileLastEditInfo(){const{_effectivePopupTemplate:g,_sourceLayer:y,graphic:v,view:b}=this;if(!g)return;const{lastEditInfoEnabled:w}=g,M=y?.editFieldsInfo;return w&&M?function Uo(g,y,v,b){const{creatorField:w,creationDateField:M,editorField:F,editDateField:x}=g;if(!y)return;const T=(0,ri.Np)(b&&"preferredTimeZone"in b?b.preferredTimeZone:null,!(!b||!("datesInUnknownTimezone"in b)||!b.datesInUnknownTimezone),v,Gn,"date"),P={...Gn,...T},R=y[x];if("number"==typeof R){const z=y[F];return{type:"edit",date:(0,Gt.p6)(R,P),user:z}}const V=y[M];if("number"==typeof V){const z=y[w];return{type:"create",date:(0,Gt.p6)(V,P),user:z}}return null}(M,v?.attributes,b?.timeZone??ri.By,y):void 0}_compileTitle(g){const{_fieldInfoMap:y,_sourceLayer:v,graphic:b,_expressionAttributes:w}=this;return $t({attributes:b?.attributes??{},fieldInfoMap:y,globalAttributes:this.formattedAttributes?.global??{},expressionAttributes:w,layer:v,text:g})}_getTitle(){var g=this;return(0,B.Z)(function*(){const{_effectivePopupTemplate:y,graphic:v}=g;if(!v)return null;const b=y?.title;return bi(b,{graphic:v})})()}_getContent(){var g=this;return(0,B.Z)(function*(){const{_effectivePopupTemplate:y,graphic:v}=g;if(!v)return null;const b=y?.content;return bi(b,{graphic:v})})()}_queryFeature(g){var y=this;return(0,B.Z)(function*(){const{_featureAbortController:v,_sourceLayer:b,graphic:w,_effectivePopupTemplate:M}=y,F=y.map,x=y.view,T=y.spatialReference;if(v!==y._featureAbortController||!w)return;yield function Vo(g,y){return Wi.apply(this,arguments)}({graphic:w,popupTemplate:M,layer:b,spatialReference:T},g);const{content:{value:P},title:{value:R}}=yield(0,it.as)({content:y._getContent(),title:y._getTitle()}),{expressionAttributes:{value:V}}=yield(0,it.as)({checkForRelatedFeatures:y._checkForRelatedFeatures(g),expressionAttributes:la({expressionInfos:M?.expressionInfos,spatialReference:T,graphic:w,map:F,interceptor:fi.interceptor,view:x})});v===y._featureAbortController&&w&&(y._expressionAttributes=V,y._graphicExpressionAttributes={...w.attributes,...V},y._set("formattedAttributes",y._createFormattedAttributes(P)),y._set("title",y._compileTitle(R)),y._set("lastEditInfo",y._compileLastEditInfo()||null),y._set("content",y._compileContent(P)||null))})()}_createMediaFormattedAttributes({contentElement:g,contentElementIndex:y,formattedAttributes:v}){const{_effectivePopupTemplate:b,graphic:w,relatedInfos:M,_sourceLayer:F,_fieldInfoMap:x,_graphicExpressionAttributes:T}=this;v.content[y]=zi({fieldInfos:b?.fieldInfos,graphic:w,attributes:{...T,...g.attributes},layer:F,fieldInfoMap:x,relatedInfos:M,timeZone:this.view?.timeZone??ri.By})}_createFieldsFormattedAttributes({contentElement:g,contentElementIndex:y,formattedAttributes:v}){if(g.fieldInfos){const{graphic:b,relatedInfos:w,_sourceLayer:M,_fieldInfoMap:F,_graphicExpressionAttributes:x}=this;v.content[y]=zi({fieldInfos:g.fieldInfos,graphic:b,attributes:{...x,...g.attributes},layer:M,fieldInfoMap:F,relatedInfos:w,timeZone:this.view?.timeZone??ri.By})}}_createFormattedAttributes(g){const{_effectivePopupTemplate:y,graphic:v,relatedInfos:b,_sourceLayer:w,_fieldInfoMap:M,_graphicExpressionAttributes:F}=this,x=y?.fieldInfos,T={global:zi({fieldInfos:x,graphic:v,attributes:F,layer:w,fieldInfoMap:M,relatedInfos:b,timeZone:this.view?.timeZone??ri.By}),content:[]};return Array.isArray(g)&&g.forEach((P,R)=>{"fields"===P.type&&this._createFieldsFormattedAttributes({contentElement:P,contentElementIndex:R,formattedAttributes:T}),"media"===P.type&&this._createMediaFormattedAttributes({contentElement:P,contentElementIndex:R,formattedAttributes:T})}),T}_checkForRelatedFeatures(g){const{graphic:y,_effectivePopupTemplate:v}=this;return this._queryRelatedInfos(y,es(v),g)}_queryRelatedInfos(g,y,v){var b=this;return(0,B.Z)(function*(){const{relatedInfos:w,_sourceLayer:M}=b;w.clear();const F=null!=M?.associatedLayer?yield M?.associatedLayer.load(v):M;if(!F||!g||!y.filter(R=>R&&At(R.fieldName))?.length)return;y.forEach(R=>b._configureRelatedInfo(R,F));const T=yield function Nr({relatedInfos:g,layer:y},v){const b={};return g.forEach((w,M)=>{const{relation:F}=w;if(!F){const V=new D.Z("relation-required","A relation is required on a layer to retrieve related records.");throw vs.error(V),V}const{relatedTableId:x}=F;if("number"!=typeof x){const V=new D.Z("A related table ID is required on a layer to retrieve related records.");throw vs.error(V),V}const T=`${y.url}/${x}`,P=bs.get(T),R=P??function Dr(g,y){return(0,Ir.Z)(g,{query:{f:"json"},signal:y?.signal})}(T);P||bs.set(T,R),b[M]=R}),(0,it.Hl)((0,it.as)(b),v)}({relatedInfos:w,layer:F},v);Object.keys(T).forEach(R=>{const V=w.get(R.toString()),z=T[R]?.value;V&&z&&(V.layerInfo=z.data)});const P=yield function Br({graphic:g,relatedInfos:y,layer:v},b){const w={};return y.forEach((M,F)=>{M.layerInfo&&(w[F]=function $r(g,y,v,b){return pn.apply(this,arguments)}(g,M,v,b))}),(0,it.as)(w)}({graphic:g,relatedInfos:w,layer:F},v);Object.keys(P).forEach(R=>{!function Or(g,y){if(!y||!g)return;const{features:v,statsFeatures:b}=g,w=v?.value;y.relatedFeatures=w?w.features:[];const M=b?.value;y.relatedStatsFeatures=M?M.features:[]}(P[R]?.value,w.get(R.toString()))})})()}_configureRelatedInfo(g,y){const{relatedInfos:v}=this,b=Ai(g.fieldName);if(!b)return;const{layerId:w,fieldName:M}=b;if(!w)return;const F=v.get(w.toString())||function Rr(g,y){const v=function Lr(g,y){if(!y.relationships)return null;let v=null;const{relationships:b}=y;return b.some(w=>w.id===parseInt(g,10)&&(v=w,!0)),v}(g,y);if(v)return{url:`${y.url}/${v.relatedTableId}`,sourceSpatialReference:y.spatialReference,relation:v,relatedFields:[],outStatistics:[]}}(w,y);F&&(function zr({relatedInfo:g,fieldName:y,fieldInfo:v}){if(g.relatedFields?.push(y),v.statisticType){const b=new xr.Z({statisticType:v.statisticType,onStatisticField:y,outStatisticFieldName:y});g.outStatistics?.push(b)}}({relatedInfo:F,fieldName:M,fieldInfo:g}),this.relatedInfos.set(w,F))}};ze.interceptor=new class ba{constructor(y,v){this.preLayerQueryCallback=y,this.preRequestCallback=v,this.preLayerQueryCallback||(this.preLayerQueryCallback=b=>{}),this.preRequestCallback||(this.preLayerQueryCallback=b=>{})}}(({query:g,layer:y,method:v})=>{os({layer:y,method:v,query:g,definitionExpression:`${y.definitionExpression} ${y.serviceDefinitionExpression}`})},({queryPayload:g,layer:y,method:v})=>{os({layer:y,method:v,query:g,definitionExpression:`${y.definitionExpression} ${y.serviceDefinitionExpression}`})}),(0,_._)([(0,A.Cb)()],ze.prototype,"_error",void 0),(0,_._)([(0,A.Cb)()],ze.prototype,"_featureAbortController",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],ze.prototype,"_effectivePopupTemplate",null),(0,_._)([(0,A.Cb)({readOnly:!0})],ze.prototype,"_fieldInfoMap",null),(0,_._)([(0,A.Cb)({readOnly:!0})],ze.prototype,"_sourceLayer",null),(0,_._)([(0,A.Cb)()],ze.prototype,"abilities",void 0),(0,_._)([(0,N.p)("abilities")],ze.prototype,"castAbilities",null),(0,_._)([(0,A.Cb)({readOnly:!0})],ze.prototype,"content",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],ze.prototype,"contentViewModels",void 0),(0,_._)([(0,A.Cb)()],ze.prototype,"description",void 0),(0,_._)([(0,A.Cb)({type:Boolean})],ze.prototype,"defaultPopupTemplateEnabled",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],ze.prototype,"isTable",null),(0,_._)([(0,A.Cb)({readOnly:!0})],ze.prototype,"state",null),(0,_._)([(0,A.Cb)({readOnly:!0})],ze.prototype,"formattedAttributes",void 0),(0,_._)([(0,A.Cb)({type:at.Z,value:null})],ze.prototype,"graphic",null),(0,_._)([(0,A.Cb)({readOnly:!0})],ze.prototype,"lastEditInfo",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],ze.prototype,"relatedInfos",void 0),(0,_._)([(0,A.Cb)()],ze.prototype,"spatialReference",null),(0,_._)([(0,A.Cb)({readOnly:!0})],ze.prototype,"title",void 0),(0,_._)([(0,A.Cb)()],ze.prototype,"map",null),(0,_._)([(0,A.Cb)({readOnly:!0})],ze.prototype,"waitingForContent",null),(0,_._)([(0,A.Cb)()],ze.prototype,"view",void 0),ze=fi=(0,_._)([(0,ne.j)("esri.widgets.FeatureViewModel")],ze);const _n=ze;var Ge=C(19399);const Vs=g=>{let y=class extends g{constructor(){super(...arguments),this.renderNodeContent=v=>(0,Ji.Qd)(v)&&!v.destroyed?(0,U.u)("div",{class:Ge.i.contentNode,key:v},v.render()):v instanceof HTMLElement?(0,U.u)("div",{afterCreate:this._attachToNode,bind:v,class:Ge.i.contentNode,key:v}):(0,Ji.o)(v)?(0,U.u)("div",{afterCreate:this._attachToNode,bind:v.domNode,class:Ge.i.contentNode,key:v}):null}_attachToNode(v){v.appendChild(this)}};return y=(0,_._)([(0,ne.j)("esri.widgets.Feature.ContentMixin")],y),y};var In;const $s={title:!0,content:!0,lastEditedInfo:!0},Ds="relationship-handles";let tt=In=class extends(Vs(Y.Z)){constructor(g,y){super(g,y),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.visibleElements={...$s},this.viewModel=new _n}initialize(){this.addHandles((0,$.YP)(()=>this.viewModel?.contentViewModels,()=>this._setupContentWidgets(),$.nn))}loadDependencies(){return(0,Kt.h)({notice:()=>Promise.all([C.e(148),C.e(2347)]).then(C.bind(C,72347))})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(g){this.viewModel.graphic=g}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(g){this.viewModel.defaultPopupTemplateEnabled=g}get isTable(){return this.viewModel.isTable}get label(){return this.messages?.widgetLabel??""}set label(g){this._overrideIfSome("label",g)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(g){this.viewModel.spatialReference=g}get title(){return this.viewModel.title}castVisibleElements(g){return{...$s,...g}}get map(){return this.viewModel.map}set map(g){this.viewModel.map=g}get view(){return this.viewModel.view}set view(g){this.viewModel.view=g}setActiveMedia(g,y){return this.viewModel.setActiveMedia(g,y)}nextMedia(g){return this.viewModel.nextMedia(g)}previousMedia(g){return this.viewModel.previousMedia(g)}render(){const{state:g}=this.viewModel,y=(0,U.u)("div",{class:Ge.i.container,key:"container"},this._renderTitle(),"error"===g?this._renderError():"loading"===g?this._renderLoading():this._renderContentContainer());return(0,U.u)("div",{class:this.classes(Ge.i.base,we.z.widget)},y)}_renderError(){const{messagesCommon:g,messages:y,visibleElements:v}=this;return(0,U.u)("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0,scale:"s"},v.title?(0,U.u)("div",{key:"error-title",slot:"title"},g.errorMessage):null,(0,U.u)("div",{key:"error-message",slot:"message"},y.loadingError))}_renderLoading(){return(0,U.u)("div",{class:Ge.i.loadingSpinnerContainer,key:"loading-container"},(0,U.u)("span",{class:this.classes(yt.W.loadingIndicator,we.z.rotating,Ge.i.spinner)}))}_renderContentContainer(){const{visibleElements:g}=this;return g.content?(0,U.u)("div",{class:Ge.i.main},[this._renderContent(),this._renderLastEditInfo()]):null}_renderTitle(){const{visibleElements:g,title:y}=this;return g.title?(0,U.u)(Ki.X,{class:Ge.i.title,innerHTML:y,level:this.headingLevel}):null}_renderContent(){const g=this.viewModel.content,y="content";if(!g)return null;if(Array.isArray(g))return g.length?(0,U.u)("div",{class:Ge.i.contentNode,key:`${y}-content-elements`},g.map(this._renderContentElement,this)):null;if("string"==typeof g){const v=this._contentWidgets[0];return!v||v.destroyed?null:(0,U.u)("div",{class:this.classes(Ge.i.contentNode,Ge.i.contentNodeText),key:`${y}-content`},v.render())}return this.renderNodeContent(g)}_renderContentElement(g,y){const{visibleElements:v}=this;if("boolean"!=typeof v.content&&!v.content?.[g.type])return null;switch(g.type){case"attachments":return this._renderAttachments(y);case"custom":return this._renderCustom(g,y);case"fields":return this._renderFields(y);case"media":return this._renderMedia(y);case"text":return this._renderText(g,y);case"expression":return this._renderExpression(y);case"relationship":return this._renderRelationship(y);default:return null}}_renderAttachments(g){const y=this._contentWidgets[g];if(!y||y.destroyed)return null;const{state:v,attachmentInfos:b}=y.viewModel;return"loading"===v||b.length>0?(0,U.u)("div",{class:this.classes(Ge.i.contentElement),key:this._buildKey("attachments-element",g)},y.render()):null}_renderRelationship(g){const y=this._contentWidgets[g];return y&&!y.destroyed&&this.flowItems?(0,U.u)("div",{class:Ge.i.contentElement,key:this._buildKey("relationship-element",g)},y.render()):null}_renderExpression(g){const y=this._contentWidgets[g];return!y||y.destroyed?null:(0,U.u)("div",{class:Ge.i.contentElement,key:this._buildKey("expression-element",g)},y.render())}_renderCustom(g,y){const{creator:v}=g,b=this._contentWidgets[y];return!b||b.destroyed?null:v?(0,U.u)("div",{class:Ge.i.contentElement,key:this._buildKey("custom-element",y)},b.render()):null}_renderFields(g){const y=this._contentWidgets[g];return!y||y.destroyed?null:(0,U.u)("div",{class:Ge.i.contentElement,key:this._buildKey("fields-element",g)},y.render())}_renderMedia(g){const y=this._contentWidgets[g];return!y||y.destroyed?null:(0,U.u)("div",{class:Ge.i.contentElement,key:this._buildKey("media-element",g)},y.render())}_renderLastEditInfo(){const{visibleElements:g,messages:y}=this,{lastEditInfo:v}=this.viewModel;if(!v||!g.lastEditedInfo)return null;const{date:b,user:w}=v,F=(0,It.n)("edit"===v.type?w?y.lastEditedByUser:y.lastEdited:w?y.lastCreatedByUser:y.lastCreated,{date:b,user:w});return(0,U.u)("div",{class:this.classes(Ge.i.lastEditedInfo,Ge.i.contentElement),key:"edit-info-element"},F)}_renderText(g,y){const b=this._contentWidgets[y];return!b||b.destroyed?null:g.text?(0,U.u)("div",{class:this.classes(Ge.i.contentElement,Ge.i.text),key:this._buildKey("text-element",y)},b.render()):null}_buildKey(g,...y){return`${g}__${this.viewModel?.graphic?.uid||"0"}-${y.join("-")}`}_destroyContentWidget(g){g&&(g.viewModel=null,!g.destroyed&&g.destroy())}_destroyContentWidgets(){this.removeHandles(Ds),this._contentWidgets.forEach(g=>this._destroyContentWidget(g)),this._contentWidgets=[]}_addFeatureRelationshipHandles(g){const{flowItems:y,visibleElements:v}=this;this.addHandles([(0,$.on)(()=>g,"select-record",({featureViewModel:b})=>{y&&(b.abilities={relationshipContent:!0},y.push(new In({flowItems:y,viewModel:b,visibleElements:v})))}),(0,$.on)(()=>g,"show-all-records",()=>{if(!y)return;const{viewModel:b}=g;b.showAllEnabled=!0;const w=new Os({visibleElements:{title:!1,description:!1},viewModel:b});this._addFeatureRelationshipHandles(w),y.push(w)})],Ds)}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:g,visibleElements:y}=this,v=this.viewModel?.content,{contentViewModels:b}=this.viewModel;if(Array.isArray(v))v.forEach((w,M)=>{if("attachments"===w.type&&(this._contentWidgets[M]=new Yo({displayType:w.displayType,headingLevel:y.title?g+1:g,viewModel:b[M]})),"fields"===w.type&&(this._contentWidgets[M]=new hs({viewModel:b[M]})),"media"===w.type&&(this._contentWidgets[M]=new Ms({viewModel:b[M]})),"text"===w.type&&(this._contentWidgets[M]=new Ci({viewModel:b[M]})),"custom"===w.type&&(this._contentWidgets[M]=new Ci({viewModel:b[M]})),"expression"===w.type&&(this._contentWidgets[M]=new ua({viewModel:b[M]})),"relationship"===w.type){const F=new Os({viewModel:b[M]});this._addFeatureRelationshipHandles(F),this._contentWidgets[M]=F}},this);else{const w=b[0];w&&!w.destroyed&&(this._contentWidgets[0]=new Ci({viewModel:w}))}this.scheduleRender()}};(0,_._)([(0,A.Cb)()],tt.prototype,"graphic",null),(0,_._)([(0,A.Cb)()],tt.prototype,"defaultPopupTemplateEnabled",null),(0,_._)([(0,A.Cb)()],tt.prototype,"flowItems",void 0),(0,_._)([(0,A.Cb)()],tt.prototype,"headingLevel",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],tt.prototype,"isTable",null),(0,_._)([(0,A.Cb)()],tt.prototype,"label",null),(0,_._)([(0,A.Cb)(),(0,pt.H)("esri/widgets/Feature/t9n/Feature")],tt.prototype,"messages",void 0),(0,_._)([(0,A.Cb)(),(0,pt.H)("esri/t9n/common")],tt.prototype,"messagesCommon",void 0),(0,_._)([(0,A.Cb)(),(0,pt.H)("esri/widgets/support/t9n/uriUtils")],tt.prototype,"messagesURIUtils",void 0),(0,_._)([(0,A.Cb)()],tt.prototype,"spatialReference",null),(0,_._)([(0,A.Cb)({readOnly:!0})],tt.prototype,"title",null),(0,_._)([(0,A.Cb)()],tt.prototype,"visibleElements",void 0),(0,_._)([(0,N.p)("visibleElements")],tt.prototype,"castVisibleElements",null),(0,_._)([(0,A.Cb)()],tt.prototype,"map",null),(0,_._)([(0,A.Cb)()],tt.prototype,"view",null),(0,_._)([(0,A.Cb)({type:_n})],tt.prototype,"viewModel",void 0),tt=In=(0,_._)([(0,ne.j)("esri.widgets.Feature")],tt);const Ma=tt;var Ca=C(88278);let Nt=class extends Ca.Z.EventedAccessor{constructor(g){super(g),this.location=null,this.screenLocationEnabled=!1,this.view=null,this.addHandles([(0,$.gx)(()=>{const y=this.screenLocationEnabled?this.view:null;return y?[y.size,"3d"===y.type?y.camera:y.viewpoint]:null},()=>this.notifyChange("screenLocation")),(0,$.YP)(()=>this.screenLocation,(y,v)=>{null!=y&&null!=v&&this.emit("view-change")})])}destroy(){this.view=null}get screenLocation(){const{location:g,view:y,screenLocationEnabled:v}=this;return v&&null!=g&&null!=y&&y.ready?y.toScreen(g):null}};(0,_._)([(0,A.Cb)()],Nt.prototype,"location",void 0),(0,_._)([(0,A.Cb)()],Nt.prototype,"screenLocation",null),(0,_._)([(0,A.Cb)()],Nt.prototype,"screenLocationEnabled",void 0),(0,_._)([(0,A.Cb)()],Nt.prototype,"view",void 0),Nt=(0,_._)([(0,ne.j)("esri.widgets.support.AnchorElementViewModel")],Nt);const Ns=Nt;let Li=class extends Ns{constructor(g){super(g),this.visible=!1}};(0,_._)([(0,A.Cb)()],Li.prototype,"visible",void 0),Li=(0,_._)([(0,ne.j)("esri.widgets.CompassViewModel")],Li);const Bs=Li,An="esri-spinner",xn_base=An,xn_spinnerStart=`${An}--start`,xn_spinnerFinish=`${An}--finish`;let Bt=class extends Y.Z{constructor(g,y){super(g,y),this._animationDelay=500,this._animationPromise=null,this.viewModel=new Bs}initialize(){this.addHandles((0,$.YP)(()=>this.visible,g=>this._visibleChange(g)))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(g){this.viewModel.location=g}get view(){return this.viewModel.view}set view(g){this.viewModel.view=g}get visible(){return this.viewModel.visible}set visible(g){this.viewModel.visible=g}show(g){const{location:y,promise:v}=g??{};y&&(this.viewModel.location=y),this.visible=!0,v&&v.catch(()=>{}).then(()=>this.hide())}hide(){this.visible=!1}render(){const{visible:g}=this,{screenLocation:y}=this.viewModel,v=!!y,M={[xn_spinnerStart]:g&&v,[xn_spinnerFinish]:!g&&v},F=this._getPositionStyles();return(0,U.u)("div",{class:this.classes(xn_base,M),styles:F})}_visibleChange(g){if(g)return void(this.viewModel.screenLocationEnabled=!0);const y=(0,it.e4)(this._animationDelay);this._animationPromise=y,y.catch(()=>{}).then(()=>{this._animationPromise===y&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:g,view:y}=this.viewModel;if(null==y||null==g)return{};const{padding:v}=y;return{left:g.x-v.left+"px",top:g.y-v.top+"px"}}};(0,_._)([(0,A.Cb)()],Bt.prototype,"location",null),(0,_._)([(0,A.Cb)()],Bt.prototype,"view",null),(0,_._)([(0,A.Cb)({type:Bs})],Bt.prototype,"viewModel",void 0),(0,_._)([(0,A.Cb)()],Bt.prototype,"visible",null),Bt=(0,_._)([(0,ne.j)("esri.widgets.Spinner")],Bt);const _a=Bt,ot="esri-features",nt={icon:`${ot}__icon`,actionImage:`${ot}__action-image`,base:ot,container:`${ot}__container`,contentContainer:`${ot}__content-container`,contentFeature:`${ot}__content-feature`,flowItemCollapsed:`${ot}__flow-item--collapsed`,header:`${ot}__header`,footer:`${ot}__footer`,featureMenuObserver:`${ot}__feature-menu-observer`,actionExit:`${ot}__action--exit`,loader:`${ot}__loader`,featuresHeading:`${ot}__heading`,paginationActionBar:`${ot}__pagination-action-bar`,paginationPrevious:`${ot}__pagination-previous`,paginationNext:`${ot}__pagination-next`};let zt=class extends Y.Z{constructor(g,y){super(g,y),this.messages=null,this.closed=!1,this.closable=!0,this._handleOpenRelatedFeature=v=>{this.emit("open-related-feature",{feature:v})}}loadDependencies(){return(0,Kt.h)({action:()=>Promise.all([C.e(148),C.e(5782),C.e(8507)]).then(C.bind(C,18507)),"flow-item":()=>Promise.all([C.e(148),C.e(5782),C.e(2805),C.e(4661),C.e(8592),C.e(6546)]).then(C.bind(C,66546))})}render(){const{flowItems:g}=this,y=g?.toArray();return(0,U.u)(U.D,null,y?.map(v=>this._renderRelatedRecordsFlowItem(v)))}_handleCloseClick(){this.emit("close")}_handleExitClick(){this.emit("exit")}_handleRelatedRecordsBackClick(){const g=this.flowItems?.pop();g&&("showAllEnabled"in g.viewModel&&(g.viewModel.showAllEnabled=!1),g&&(g.viewModel=null,g.destroy()))}_renderRelatedRecordsFlowItem(g){const{messages:y,closable:v,closed:b}=this,w="graphic"in g&&!g.isTable;return(0,U.u)("calcite-flow-item",{bind:this,closable:v,closed:b,description:this._getRelatedRecordsFlowItemDescription(g),heading:g.title??"",key:`flow-item-${g.viewModel.uid}`,onCalciteFlowItemBack:this._handleRelatedRecordsBackClick,onCalciteFlowItemClose:this._handleCloseClick},(0,U.u)("calcite-action",{appearance:"transparent",bind:this,class:nt.actionExit,icon:"move-up",key:"exit-related-records-action",label:y.exitRelatedRecords,onclick:this._handleExitClick,scale:"m",slot:"header-actions-start",text:y.exitRelatedRecords,title:y.exitRelatedRecords}),w?(0,U.u)("calcite-action",{appearance:"transparent",bind:this,icon:"zoom-to-object",key:"open-related-feature-action",label:y.selectFeature,onclick:()=>this._handleOpenRelatedFeature(g),scale:"m",slot:"header-actions-end",text:y.selectFeature,title:y.selectFeature}):null,(0,U.u)("div",{class:nt.container},g.render()))}_getRelatedRecordsFlowItemDescription(g){return"featureCountDescription"in g?g.featureCountDescription:g.viewModel.description??""}};(0,_._)([(0,A.Cb)()],zt.prototype,"flowItems",void 0),(0,_._)([(0,A.Cb)(),(0,pt.H)("esri/widgets/Features/t9n/Features")],zt.prototype,"messages",void 0),(0,_._)([(0,A.Cb)()],zt.prototype,"closed",void 0),(0,_._)([(0,A.Cb)()],zt.prototype,"closable",void 0),zt=(0,_._)([(0,ne.j)("esri.widgets.Features.FeaturesRelatedRecords")],zt);const Ia=zt;var jt=C(56295),Aa=C(19994);class xa{constructor(){this._set=new Set,this._observable=new Aa.s}get size(){return(0,jt.it)(this._observable),this._set.size}add(y){const v=this._set.size;return this._set.add(y),this._set.size!==v&&this._observable.notify(),this}clear(){this._set.size>0&&(this._set.clear(),this._observable.notify())}delete(y){const v=this._set.delete(y);return v&&this._observable.notify(),v}entries(){return(0,jt.it)(this._observable),this._set.entries()}forEach(y,v){(0,jt.it)(this._observable),this._set.forEach((b,w)=>y.call(v,b,w,this),v)}has(y){return(0,jt.it)(this._observable),this._set.has(y)}keys(){return(0,jt.it)(this._observable),this._set.keys()}values(){return(0,jt.it)(this._observable),this._set.values()}[Symbol.iterator](){return(0,jt.it)(this._observable),this._set[Symbol.iterator]()}get[Symbol.toStringTag](){return this._set[Symbol.toStringTag]}}var Ea=C(48230),zs=C(95060);function Ln(g){return g&&"opacity"in g?g.opacity*Ln(g.parent):1}function Tn(){return(Tn=(0,B.Z)(function*(g,y){if(!g)return;const v=g.sourceLayer,b=(null!=y&&y.useSourceLayer?v:g.layer)??v,w=Ln(b);if(null!=g.symbol&&(null==y||!0!==y.ignoreGraphicSymbol)){const re="web-style"===g.symbol.type?yield(0,vt.Q8)(g.symbol,{...y,cache:null!=y?y.webStyleCache:null}):g.symbol.clone();return(0,vt.tb)(re,null,w),re}const M=(null!=y?y.renderer:null)??(b&&"renderer"in b?b.renderer:null);let F=M&&"getSymbolAsync"in M?yield M.getSymbolAsync(g,y):null;if(!F)return;if(F="web-style"===F.type?yield F.fetchSymbol({...y,cache:null!=y?y.webStyleCache:null}):F.clone(),!M||!("visualVariables"in M)||!M.visualVariables?.length)return(0,vt.tb)(F,null,w),F;if("arcadeRequiredForVisualVariables"in M&&M.arcadeRequiredForVisualVariables&&null==y?.arcade){const re={...y};re.arcade=yield(0,kn.LC)(),y=re}const{getColor:x,getOpacity:T,getAllSizes:P,getRotationAngle:R}=yield Promise.resolve().then(C.bind(C,37157)),V=[],z=[],k=[],H=[];for(const re of M.visualVariables)switch(re.type){case"color":V.push(re);break;case"opacity":z.push(re);break;case"rotation":H.push(re);break;case"size":re.target||k.push(re)}const J=!!V.length&&V[V.length-1],ie=J?x(J,g,y):null,ue=!!z.length&&z[z.length-1];let _e=ue?T(ue,g,y):null;if(null!=w&&(_e=null!=_e?_e*w:w),(0,vt.tb)(F,ie,_e),k.length){const re=P(k,g,y);yield(0,vt.e3)(F,re)}for(const re of H)(0,vt.BR)(F,R(re,g,y),re.axis);return F})).apply(this,arguments)}function Gs(g){return g&&"function"==typeof g.highlight}C(1010),C(86336),C(36232),C(96936),C(34222),C(64063);var Da=C(72031),Ks=C(25917);const kt=$e.Z.ofType({key:"type",defaultKeyValue:"button",base:Da.Z,typeMap:{button:se.Z,toggle:Ks.Z}}),St=new se.Z({icon:"magnifying-glass-plus",id:"zoom-to-feature",title:"{messages.zoom}",className:yt.W.zoomInMagnifyingGlass}),Rn=new se.Z({icon:"trash",id:"remove-selected-feature",title:"{messages.remove}",className:yt.W.trash}),Wt=new se.Z({icon:"magnifying-glass-plus",id:"zoom-to-clustered-features",title:"{messages.zoom}",className:yt.W.zoomInMagnifyingGlass}),Lt=new Ks.Z({icon:"table",id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:yt.W.table,value:!1}),Ti=Pe.Z.getLogger("esri.widgets.Popup.PopupViewModel"),Ba=g=>{const{event:y,view:v,viewModel:b}=g,{action:w}=y;if(!w)return Promise.reject(new D.Z("trigger-action:missing-arguments","Event has no action"));const{disabled:M,id:F}=w;if(!F)return Promise.reject(new D.Z("trigger-action:invalid-action","action.id is missing"));if(M)return Promise.reject(new D.Z("trigger-action:invalid-action","Action is disabled"));if(F===St.id)return function ja(g){return Un.apply(this,arguments)}(b).catch(it.H9);if(F===Wt.id)return function ka(g){return Sn.apply(this,arguments)}(b);if(F===Lt.id)return b.browseClusterEnabled=!b.browseClusterEnabled,b.featureMenuOpen=b.browseClusterEnabled,Promise.resolve();if(F===Rn.id){b.visible=!1;const{selectedFeature:x}=b;if(!x)return Promise.reject(new D.Z(`trigger-action:${Rn.id}`,"selectedFeature is required",{selectedFeature:x}));const{sourceLayer:T}=x;return T?T.remove(x):v?.graphics.remove(x),Promise.resolve()}return Promise.resolve()};function Qs(g){const{selectedFeature:y,location:v,view:b}=g;return b?y??v??null:null}function Ht(g){return!!g&&g.isAggregate&&"cluster"===g.sourceLayer?.featureReduction?.type}function On(){return(On=(0,B.Z)(function*(g,y){if("3d"!==y?.type||!g||"esri.Graphic"!==g.declaredClass)return!0;const v=y.getViewForGraphic(g);if(v&&"whenGraphicBounds"in v){let b=null;try{b=yield v.whenGraphicBounds(g,{useViewElevation:!0})}catch{}return!b||!b.boundingBox||b.boundingBox[0]===b.boundingBox[3]&&b.boundingBox[1]===b.boundingBox[4]&&b.boundingBox[2]===b.boundingBox[5]}return!0})).apply(this,arguments)}function Un(){return Un=(0,B.Z)(function*(g){const{location:y,selectedFeature:v,view:b,zoomFactor:w}=g,M=Qs(g);if(!b||!M){const R=new D.Z("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:M,view:b});throw Ti.error(R),R}const F=b.scale/w,x=g.selectedFeature?.geometry,T=x??y,P=null!=T&&"point"===T.type&&(yield function za(g,y){return On.apply(this,arguments)}(v,b));St.active=!0,St.disabled=!0;try{yield g.zoomTo({target:{target:M,scale:P?F:void 0}})}catch{const V=new D.Z("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:v});Ti.error(V)}finally{St.active=!1,St.disabled=!1,g.zoomToLocation=null,P&&(g.location=T)}}),Un.apply(this,arguments)}function Sn(){return(Sn=(0,B.Z)(function*(g){const{selectedFeature:y,view:v}=g;if("2d"!==v?.type){const F=new D.Z("zoomToCluster:invalid-view","View must be 2d MapView.",{view:v});throw Ti.error(F),F}if(!y||!Ht(y)){const F=new D.Z("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:y});throw Ti.error(F),F}const[b,w]=yield $n(v,y);Wt.active=!0,Wt.disabled=!0;const{extent:M}=yield b.queryExtent(w);yield g.zoomTo({target:M}),Wt.active=!1,Wt.disabled=!1})).apply(this,arguments)}function Zn(){return(Zn=(0,B.Z)(function*(g){const{view:y,selectedFeature:v}=g;if(!y||!v)return;const[b,w]=yield $n(y,v),{extent:M}=yield b.queryExtent(w);g.selectedClusterBoundaryFeature.geometry=M,y.graphics.add(g.selectedClusterBoundaryFeature)})).apply(this,arguments)}function Vn(){return(Vn=(0,B.Z)(function*(g){const{selectedFeature:y,view:v}=g;if(!v||!y)return;const[b,w]=yield $n(v,y);Lt.active=!0,Lt.disabled=!0;const{features:M}=yield b.queryFeatures(w);Lt.active=!1,Lt.disabled=!1,Lt.value=!0,g?.open({features:[y].concat(M),featureMenuOpen:!0})})).apply(this,arguments)}function $n(g,y){return Dn.apply(this,arguments)}function Dn(){return(Dn=(0,B.Z)(function*(g,y){const v=yield g.whenLayerView(y.sourceLayer),b=v.createQuery(),w=y.getObjectId();return b.aggregateIds=null!=w?[w]:[],[v,b]})).apply(this,arguments)}function Xs(g){if(null==g)return null;switch(g.type){case"point":return g;case"extent":return g.center;case"polygon":return g.centroid;case"multipoint":case"polyline":return g.extent?.center;default:return null}}var Ga=C(42704),Ka=C(89481);let Me=class extends((0,Ga._)(Ns)){constructor(g){super(g),this._pendingPromises=new xa,this._fetchFeaturesController=null,this._highlightSelectedFeaturePromise=null,this._highlightActiveFeaturePromise=null,this._selectedClusterFeature=null,this.actions=new kt,this.activeFeature=null,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.defaultPopupTemplateEnabled=!1,this.featurePage=null,this.featuresPerPage=20,this.featureMenuOpen=!1,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new at.Z({symbol:new Ka.Z({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}initialize(){this.addHandles([this.on("view-change",()=>this._autoClose()),(0,$.YP)(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),(0,$.YP)(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),(0,$.YP)(()=>this.view?.animation?.state,g=>this._animationStateChange(g)),(0,$.YP)(()=>this.location,g=>this._locationChange(g)),(0,$.YP)(()=>this.selectedFeature,g=>this._selectedFeatureChange(g)),(0,$.YP)(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),(0,$.YP)(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),(0,$.YP)(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",g=>Ba({event:g,viewModel:this,view:this.view})),(0,$.gx)(()=>!this.waitingForResult,()=>this._waitingForResultChange(),$.Z_),(0,$.YP)(()=>[this.features,this.view?.map,this.view?.spatialReference],()=>this._updateFeatureVMs()),(0,$.YP)(()=>this.view?.scale,()=>this._viewScaleChange()),(0,$.gx)(()=>!this.visible,()=>this.browseClusterEnabled=!1),(0,$.YP)(()=>this.browseClusterEnabled,g=>g?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const g=this._get("allActions")||new kt;g.removeAll();const{actions:y,defaultActions:v,defaultPopupTemplateEnabled:b,includeDefaultActions:w,selectedFeature:M}=this,F=w?v.concat(y):y,x=M&&("function"==typeof M.getEffectivePopupTemplate&&M.getEffectivePopupTemplate(b)||M.popupTemplate),T=x?.actions;return(x?.overwriteActions?T:T?.concat(F)??F)?.filter(Boolean).forEach(R=>g.add(R)),g}get defaultActions(){const g=this._get("defaultActions")||new kt;return g.removeAll(),g.addMany(Ht(this.selectedFeature)?[Wt.clone(),Lt.clone()]:[St.clone()]),g}get featureCount(){return this.features.length}set features(g){const y=g||[];this._set("features",y);const{pendingPromisesCount:v,promiseCount:b,selectedFeatureIndex:w}=this,M=b&&y.length;M&&v&&-1===w?this.selectedFeatureIndex=0:M&&-1!==w||(this.selectedFeatureIndex=y.length?0:-1)}set location(g){let y=g;const v=this.view?.spatialReference?.isWebMercator;g?.spatialReference?.isWGS84&&v&&(y=(0,Ea.$)(g)),this._set("location",y)}get pendingPromisesCount(){return this._pendingPromises.size}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(g){this._pendingPromises.clear(),this.features=[],Array.isArray(g)&&g.length?(this._set("promises",g),(g=g.slice(0)).forEach(y=>{this._pendingPromises.add(y),y.then(w=>{this._pendingPromises.has(y)&&this._updateFeatures(w),this._updatePendingPromises(y)},()=>this._updatePendingPromises(y))})):this._set("promises",[])}get selectedFeature(){const{features:g,selectedFeatureIndex:y}=this;return-1===y?null:g[y]||null}get selectedFeatureIndex(){const g=this._get("selectedFeatureIndex");return"number"==typeof g?g:-1}set selectedFeatureIndex(g){const{featureCount:y}=this;g=isNaN(g)||g<-1||!y?-1:(g+y)%y,this.activeFeature=null,this._set("selectedFeatureIndex",g)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.view?.ready?"ready":"disabled"}get waitingForContents(){return this.featureViewModels.some(g=>g.waitingForContent)}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}centerAtLocation(){const{view:g}=this,y=Qs(this);return y&&g?this.callGoTo({target:{target:y,scale:g.scale}}):Promise.reject(new D.Z("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:y,view:g}))}zoomTo(g){return this.callGoTo(g)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(g,y){const{view:v}=this;if(!v||!g)throw new D.Z("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:g,view:v});return v.fetchPopupFeatures(g,{event:y?.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:y?.signal})}open(g){const y={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...g,visible:!0},{fetchFeatures:v}=y;delete y.fetchFeatures,v&&this._setFetchFeaturesPromises(y.location);const b=["actionsMenuOpen","collapsed"];for(const w of b)delete y[w];this.set(y)}triggerAction(g){const y=this.allActions.at(g);y&&!y.disabled&&this.emit("trigger-action",{action:y})}next(){return this.selectedFeatureIndex++,this}previous(){return this.selectedFeatureIndex--,this}disableClusterBrowsing(){(function Ya(g){Lt.value=!1;const y=g.features.filter(v=>Ht(v));y.length&&(g.features=y)})(this),this._clearBrowsedClusterGraphics()}enableClusterBrowsing(){var g=this;return(0,B.Z)(function*(){const{view:y,selectedFeature:v}=g;"2d"===y?.type?Ht(v)?(yield function Wa(g){return Zn.apply(this,arguments)}(g),yield function Ha(g){return Vn.apply(this,arguments)}(g)):Pe.Z.getLogger(g).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",v):Pe.Z.getLogger(g).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",v)})()}handleViewClick(g){this.autoOpenEnabled&&this._fetchFeaturesAndOpen(g)}_animationStateChange(g){this.zoomToLocation||(St.disabled="waiting-for-target"===g)}_clearBrowsedClusterGraphics(){const g=[this.selectedClusterBoundaryFeature,this._selectedClusterFeature].filter(Ve.pC);this.view?.graphics?.removeMany(g),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(Ht(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(g){const{selectedFeature:y,updateLocationEnabled:v}=this;v&&g&&(!y||y.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:g,featureCount:y,featurePage:v,featuresPerPage:b,featureViewModels:w}=this;if(null===v)return;const M=((v-1)*b+y)%y;w.slice(M,M+b).forEach((x,T)=>{x&&(x.graphic??=g[M+T])})}_selectedFeatureChange(g){var y=this;return(0,B.Z)(function*(){const{location:v,updateLocationEnabled:b,view:w}=y;if(g&&w){if(y.browseClusterEnabled)return y._selectedClusterFeature&&(w.graphics.remove(y._selectedClusterFeature),y._selectedClusterFeature=null),Ht(g)?void 0:(g.symbol=yield function $a(g,y){return Tn.apply(this,arguments)}(g),y._selectedClusterFeature=g,void w.graphics.add(y._selectedClusterFeature));if(!b&&v||!g.geometry){if(b&&!g.geometry){yield y.centerAtLocation();const M=w.center?.clone();M&&(y.location=M)}}else y.location=Xs(g.geometry)}})()}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(g){var y=this;return(0,B.Z)(function*(){const{clientOnlyGraphics:v,promisesPerLayerView:b}=yield y._fetchFeaturesWithController(y._getScreenPoint(g||y.location)),w=Promise.resolve(v),M=b.map(F=>F.promise);y.promises=[w,...M]})()}_destroyFeatureVMs(){this.featureViewModels.forEach(g=>g&&!g.destroyed&&g.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:g,features:y,featureViewModels:v,view:b}=this;if(Ht(g)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!y?.length)return;const w=v.slice(0),M=[];y.forEach((F,x)=>{if(!F)return;let T=null;if(w.some((P,R)=>(P&&P.graphic===F&&(T=P,w.splice(R,1)),!!T)),T)M[x]=T;else{const P=new _n({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:b?.spatialReference,graphic:F===g?F:null,map:b?.map,view:b});M[x]=P}}),w.forEach(F=>F&&!F.destroyed&&F.destroy()),this._set("featureViewModels",M)}_getScreenPoint(g){const{view:y}=this;return y&&g&&"function"==typeof y.toScreen?y.toScreen(g):null}_cancelFetchingFeatures(){const g=this._fetchFeaturesController;g&&g.abort(),this._fetchFeaturesController=null}_fetchFeaturesWithController(g,y){this._cancelFetchingFeatures();const v=new AbortController,{signal:b}=v;this._fetchFeaturesController=v;const w=this.fetchFeatures(g,{signal:b,event:y});return w.catch(()=>{}).then(()=>{this._fetchFeaturesController=null}),w}_fetchFeaturesAndOpen(g){var y=this;return(0,B.Z)(function*(){const{screenPoint:v,mapPoint:b}=g,{view:w}=y,{clientOnlyGraphics:M,promisesPerLayerView:F,location:x}=yield y._fetchFeaturesWithController(v,g),T=[Promise.resolve(M),...F.map(P=>P.promise)];w?.popup&&"open"in w.popup&&w.popup.open({location:x||b,promises:T})})()}_updatePendingPromises(g){g&&this._pendingPromises.has(g)&&this._pendingPromises.delete(g)}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getLayerView(g,y){return(0,B.Z)(function*(){return yield g.when(),g.whenLayerView(y)})()}_getHighlightLayer(g){const{layer:y,sourceLayer:v}=g;return v&&"layer"in v&&v.layer?v.layer:"map-notes"===v?.type||"subtype-group"===v?.type?v:y}_getHighlightTarget(g,y){const v="imagery"===y.type?void 0:"objectIdField"in y?y.objectIdField||"OBJECTID":null,b=g.attributes;return b&&v&&b[v]||g}_mapIncludesLayer(g){return!!this.view?.map?.allLayers?.includes(g)}_highlightActiveFeature(){var g=this;return(0,B.Z)(function*(){const y="highlight-active-feature";g.removeHandles(y);const{highlightEnabled:v,view:b,activeFeature:w,visible:M}=g;if(!(w&&b&&v&&M))return;const F=g._getHighlightLayer(w);if(!(F&&F instanceof zs.Z&&g._mapIncludesLayer(F)))return;const x=g._getLayerView(b,F);g._highlightActiveFeaturePromise=x;const T=yield x;if(!(T&&Gs(T)&&g._highlightActiveFeaturePromise===x&&g.activeFeature&&g.highlightEnabled))return;const P=T.highlight(g._getHighlightTarget(w,F));g.addHandles(P,y)})()}_highlightSelectedFeature(){var g=this;return(0,B.Z)(function*(){const y="highlight-selected-feature";g.removeHandles(y);const{selectedFeature:v,highlightEnabled:b,view:w,visible:M}=g;if(!(v&&w&&b&&M))return;const F=g._getHighlightLayer(v);if(!(F&&F instanceof zs.Z&&g._mapIncludesLayer(F)))return;const x=g._getLayerView(w,F);g._highlightSelectedFeaturePromise=x;const T=yield x;if(!(T&&Gs(T)&&g._highlightSelectedFeaturePromise===x&&g.selectedFeature&&g.highlightEnabled&&g.visible))return;const P=T.highlight(g._getHighlightTarget(v,F));g.addHandles(P,y)})()}_updateFeatures(g){const{features:y}=this;if(!g?.length)return;if(!y.length)return void(this.features=g);const v=g.filter(b=>!y.includes(b));this.features=y.concat(v)}};(0,_._)([(0,A.Cb)()],Me.prototype,"_fetchFeaturesController",void 0),(0,_._)([(0,A.Cb)({type:kt})],Me.prototype,"actions",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],Me.prototype,"active",null),(0,_._)([(0,A.Cb)()],Me.prototype,"activeFeature",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],Me.prototype,"allActions",null),(0,_._)([(0,A.Cb)()],Me.prototype,"autoCloseEnabled",void 0),(0,_._)([(0,A.Cb)()],Me.prototype,"autoOpenEnabled",void 0),(0,_._)([(0,A.Cb)()],Me.prototype,"browseClusterEnabled",void 0),(0,_._)([(0,A.Cb)()],Me.prototype,"content",void 0),(0,_._)([(0,A.Cb)({type:kt,readOnly:!0})],Me.prototype,"defaultActions",null),(0,_._)([(0,A.Cb)({type:Boolean})],Me.prototype,"defaultPopupTemplateEnabled",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],Me.prototype,"featureCount",null),(0,_._)([(0,A.Cb)()],Me.prototype,"featurePage",void 0),(0,_._)([(0,A.Cb)({value:[]})],Me.prototype,"features",null),(0,_._)([(0,A.Cb)()],Me.prototype,"featuresPerPage",void 0),(0,_._)([(0,A.Cb)()],Me.prototype,"featureMenuOpen",void 0),(0,_._)([(0,A.Cb)()],Me.prototype,"featureViewModelAbilities",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],Me.prototype,"featureViewModels",void 0),(0,_._)([(0,A.Cb)()],Me.prototype,"highlightEnabled",void 0),(0,_._)([(0,A.Cb)()],Me.prototype,"includeDefaultActions",void 0),(0,_._)([(0,A.Cb)({type:Ar.Z})],Me.prototype,"location",null),(0,_._)([(0,A.Cb)({readOnly:!0})],Me.prototype,"pendingPromisesCount",null),(0,_._)([(0,A.Cb)({readOnly:!0})],Me.prototype,"promiseCount",null),(0,_._)([(0,A.Cb)()],Me.prototype,"promises",null),(0,_._)([(0,A.Cb)({readOnly:!0})],Me.prototype,"selectedClusterBoundaryFeature",void 0),(0,_._)([(0,A.Cb)({value:null,readOnly:!0})],Me.prototype,"selectedFeature",null),(0,_._)([(0,A.Cb)({value:-1})],Me.prototype,"selectedFeatureIndex",null),(0,_._)([(0,A.Cb)({readOnly:!0})],Me.prototype,"selectedFeatureViewModel",null),(0,_._)([(0,A.Cb)({readOnly:!0})],Me.prototype,"state",null),(0,_._)([(0,A.Cb)()],Me.prototype,"title",void 0),(0,_._)([(0,A.Cb)()],Me.prototype,"updateLocationEnabled",void 0),(0,_._)([(0,A.Cb)()],Me.prototype,"view",void 0),(0,_._)([(0,A.Cb)()],Me.prototype,"visible",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],Me.prototype,"waitingForContents",null),(0,_._)([(0,A.Cb)({readOnly:!0})],Me.prototype,"waitingForResult",null),(0,_._)([(0,A.Cb)()],Me.prototype,"zoomFactor",void 0),(0,_._)([(0,A.Cb)()],Me.prototype,"zoomToLocation",void 0),(0,_._)([(0,A.Cb)()],Me.prototype,"centerAtLocation",null),Me=(0,_._)([(0,ne.j)("esri.widgets.Features.FeaturesViewModel")],Me);const Nn=Me;let Tt=class extends lt.Z{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!1,this.featureNavigation=!0,this.heading=!0,this.spinner=!0}};(0,_._)([(0,A.Cb)({type:Boolean,nonNullable:!0})],Tt.prototype,"actionBar",void 0),(0,_._)([(0,A.Cb)({type:Boolean,nonNullable:!0})],Tt.prototype,"closeButton",void 0),(0,_._)([(0,A.Cb)({type:Boolean,nonNullable:!0})],Tt.prototype,"collapseButton",void 0),(0,_._)([(0,A.Cb)({type:Boolean,nonNullable:!0})],Tt.prototype,"featureNavigation",void 0),(0,_._)([(0,A.Cb)({type:Boolean,nonNullable:!0})],Tt.prototype,"heading",void 0),(0,_._)([(0,A.Cb)({type:Boolean,nonNullable:!0})],Tt.prototype,"spinner",void 0),Tt=(0,_._)([(0,ne.j)("esri.widgets.Features.FeaturesVisibleElements")],Tt);const Js=Tt;var qs=C(92795);const eo="selected-index",to="features-spinner";let Ze=class extends(Vs(Y.Z)){constructor(g,y){var v;super(g,y),v=this,this._featureMenuIntersectionObserverCallback=([b])=>{b?.isIntersecting&&null!=this.viewModel.featurePage&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._featureMenuIntersectionObserverNode=null,this._focusOn=null,this._spinner=null,this._feature=null,this._relatedRecordsFlowItems=new $e.Z,this._relatedRecordsWidget=new Ia({flowItems:this._relatedRecordsFlowItems}),this._rootFlowItemNode=null,this._featureMenuViewportNode=null,this.collapsed=!1,this.icon=null,this.featureNavigationTop=!1,this.headerActions=new kt,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.responsiveActionsEnabled=!1,this.viewModel=new Nn,this.visibleElements=new Js,this._renderAction=(b,w)=>{const M=this._getActionTitle(b),{type:F,active:x,uid:T,disabled:P,indicator:R}=b;return b.visible?(0,U.u)("calcite-action",{active:"toggle"===F&&b.value,appearance:"solid",bind:this,"data-action-uid":T,disabled:P,icon:this._getActionIcon(b),indicator:R,key:`action-${w}`,loading:x,onclick:this._triggerAction,scale:"s",text:M,title:this._hideActionText?M:void 0},this._getFallbackIcon(b)):null},this._openFeatureMenu=()=>{this.featureMenuOpen=!0},this._previousFeature=()=>{this.viewModel.selectedFeatureIndex--},this._nextFeature=()=>{this.viewModel.selectedFeatureIndex++},this._handleFeatureMenuBack=()=>{this.featureMenuOpen&&(this._focusOn="root-flow-item",this.featureMenuOpen=!1)},this._focusFlowItemNode=b=>{this._focusOn===b&&requestAnimationFrame((0,B.Z)(function*(){switch(b){case"menu-flow-item":yield v._featureMenuViewportNode?.setFocus();break;case"root-flow-item":yield v._rootFlowItemNode?.setFocus()}v._focusOn=null}))},this._focusFlowItemNodeThrottled=(0,j.P)(this._focusFlowItemNode,50),this._displaySpinnerThrottled=(0,j.P)(()=>this._displaySpinner(),0),this._addSelectedFeatureIndexHandle(),this.addHandles([this._displaySpinnerThrottled,this._focusFlowItemNodeThrottled,(0,$.YP)(()=>this.viewModel?.active,()=>this._toggleScreenLocationEnabled()),(0,$.YP)(()=>this.viewModel?.active,b=>this._relatedRecordsWidget.closed=!b),(0,$.YP)(()=>this.visibleElements?.closeButton,b=>this._relatedRecordsWidget.closable=b),(0,$.YP)(()=>this.visibleElements?.spinner,b=>this._spinnerEnabledChange(b)),(0,$.YP)(()=>this.viewModel?.view,(b,w)=>this._viewChange(b,w)),(0,$.YP)(()=>this.viewModel?.view?.ready,(b,w)=>this._viewReadyChange(b??!1,w??!1)),(0,$.YP)(()=>[this.viewModel?.waitingForResult,this.viewModel?.location],()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),(0,$.YP)(()=>this.selectedFeatureWidget,()=>this._destroyRelatedRecordsFlowItemWidgets()),(0,$.YP)(()=>{const b=this.selectedFeatureWidget?.viewModel;return[b?.title,b?.state]},()=>this._setTitleFromFeatureWidget()),(0,$.YP)(()=>{const b=this.selectedFeatureWidget?.viewModel;return[b?.content,b?.state]},()=>this._setContentFromFeatureWidget()),(0,$.YP)(()=>this.viewModel?.featureViewModels,()=>this._featureMenuViewportScrollTop()),this._relatedRecordsWidget.on("close",()=>this.close()),this._relatedRecordsWidget.on("exit",()=>this._destroyRelatedRecordsFlowItemWidgets()),this._relatedRecordsWidget.on("open-related-feature",({feature:b})=>this._openRelatedFeature(b))])}loadDependencies(){return(0,Kt.h)({action:()=>Promise.all([C.e(148),C.e(5782),C.e(8507)]).then(C.bind(C,18507)),"action-bar":()=>Promise.all([C.e(148),C.e(5782),C.e(2805),C.e(4661),C.e(2888),C.e(9962)]).then(C.bind(C,69962)),"action-group":()=>Promise.all([C.e(148),C.e(5782),C.e(2805),C.e(4661),C.e(2888),C.e(3607)]).then(C.bind(C,43607)),button:()=>Promise.all([C.e(148),C.e(8592),C.e(8901)]).then(C.bind(C,38901)),flow:()=>C.e(3669).then(C.bind(C,13669)),"flow-item":()=>Promise.all([C.e(148),C.e(5782),C.e(2805),C.e(4661),C.e(8592),C.e(6546)]).then(C.bind(C,66546)),list:()=>Promise.all([C.e(148),C.e(8592),C.e(6985)]).then(C.bind(C,66985)),"list-item":()=>Promise.all([C.e(148),C.e(5782),C.e(8592),C.e(9475)]).then(C.bind(C,99475)),"list-item-group":()=>Promise.all([C.e(8592),C.e(3768)]).then(C.bind(C,23768)),loader:()=>C.e(5597).then(C.bind(C,55597))})}destroy(){this._destroyRelatedRecordsFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver?.disconnect(),this._relatedRecordsWidget?.destroy()}get _hideActionText(){if(!this.responsiveActionsEnabled)return!1;const g=this.view?.widthBreakpoint;return"xsmall"===g||"small"===g||"medium"===g}get _featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get _isCollapsed(){return this._collapseEnabled&&this.collapsed}get _collapseEnabled(){return this.visibleElements.collapseButton&&!!this.title&&!!this.content}get content(){return this.viewModel.content}set content(g){this.viewModel.content=g}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(g){this.viewModel.featureMenuOpen=g}get features(){return this.viewModel.features}set features(g){this.viewModel.features=g}get location(){return this.viewModel.location}set location(g){this.viewModel.location=g}get label(){return this.messages?.widgetLabel??""}set label(g){this._overrideIfSome("label",g)}get promises(){return this.viewModel.promises}set promises(g){this.viewModel.promises=g}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(g){this.viewModel.selectedFeatureIndex=g}get selectedFeatureWidget(){const{_feature:g,headingLevel:y,_relatedRecordsFlowItems:v}=this,{selectedFeatureViewModel:b}=this.viewModel,w={title:!1};return b?(g?(g.viewModel=b,g.visibleElements=w):this._feature=new Ma({flowItems:v,headingLevel:y+1,viewModel:b,visibleElements:w}),this._feature):null}get title(){return this.viewModel.title}set title(g){this.viewModel.title=g}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(g){this.viewModel.updateLocationEnabled=g}get view(){return this.viewModel.view}set view(g){this.viewModel.view=g}get visible(){return this.viewModel.visible}set visible(g){this.viewModel.visible=g}blur(){const{active:g}=this.viewModel;g?this._rootFlowItemNode?.blur():Pe.Z.getLogger(this).warn("Features can only be blurred when currently active.")}clear(){return this.viewModel.clear()}close(){this.viewModel.visible=!1}fetchFeatures(g,y){return this.viewModel.fetchFeatures(g,y)}focus(){const{active:g}=this.viewModel;g?this._setFocusOn():Pe.Z.getLogger(this).warn("Features can only be focused when currently active.")}next(){return this.viewModel.next()}open(g){this.removeHandles(eo),this.set({collapsed:g?.collapsed??!1}),this.viewModel.open(g),this.addHandles((0,$.gx)(()=>!this.viewModel.waitingForResult,()=>this._addSelectedFeatureIndexHandle(),{once:!0}))}previous(){return this.viewModel.previous()}triggerAction(g){return this.viewModel.triggerAction(g)}render(){return(0,U.u)("div",{bind:this,class:this.classes(nt.base,we.z.widget,we.z.panel),onkeydown:this._onMainKeydown},this._renderHeader(),this._renderContentContainer())}_renderFeatureNavigation(){return[this._renderPagination(),this._renderFeatureMenuButton()]}_renderHeader(){return!this.featureMenuOpen&&this.featureNavigationTop&&this._featureNavigationVisible?(0,U.u)("div",{class:nt.header,key:"header-actions"},this._renderFeatureNavigation()):null}_renderFooter(){return this.featureMenuOpen||this.featureNavigationTop||!this._featureNavigationVisible?null:(0,U.u)("div",{class:nt.footer,key:"footer-actions",slot:"footer"},this._renderFeatureNavigation())}_renderFeatureMenuButton(){const{messages:g,viewModel:y}=this,{featureCount:v,selectedFeatureIndex:b,pendingPromisesCount:w}=y;return(0,U.u)("calcite-action",{appearance:"solid",bind:this,icon:"list",key:"feature-menu-button",label:g.selectFeature,loading:w>0,onclick:this._openFeatureMenu,scale:"s",text:(0,It.n)(g.pageText,{index:(0,E.uf)(b+1),total:(0,E.uf)(v)}),textEnabled:!0,title:g.selectFeature})}_renderPagination(){const{previous:g,next:y}=this.messagesCommon.pagination;return(0,U.u)("calcite-action-bar",{class:nt.paginationActionBar,expandDisabled:!0,key:"pagination-action-bar",layout:"horizontal",overflowActionsDisabled:!0,scale:"s"},(0,U.u)("calcite-action-group",{scale:"s"},(0,U.u)("calcite-action",{appearance:"solid",class:nt.paginationPrevious,icon:"chevron-left",iconFlipRtl:!0,label:g,onclick:this._previousFeature,scale:"s",text:g,title:g}),(0,U.u)("calcite-action",{appearance:"solid",icon:"chevron-right",iconFlipRtl:!0,label:y,onclick:this._nextFeature,scale:"s",text:y,title:y})))}_renderFeatureMenuItem(g){const{selectedFeatureViewModel:y,featureViewModels:v}=this.viewModel,b=g===y,w=v.indexOf(g);return(0,U.u)("calcite-list-item",{bind:this,"data-feature-index":w,key:`feature-menu-item-${g.uid}`,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onmouseleave:this._removeActiveFeature,onmouseover:this._setActiveFeature,selected:b,onCalciteListItemSelect:this._selectFeature},(0,U.u)("span",{innerHTML:g.title||this.messagesCommon.untitled,slot:"content"}))}_groupResultsByLayer(){const{featureViewModels:g}=this.viewModel,y=new Map;return g.forEach(v=>{const b=v?.graphic;if(!b)return;const w=b.sourceLayer??b.layer,M=y.get(w)??[];y.set(w,[...M,v])}),y}_renderFeatureMenu(){const{featureViewModels:g}=this.viewModel,y=this._groupResultsByLayer();return g.length?(0,U.u)("calcite-list",{selectionAppearance:"icon",selectionMode:"single"},Array.from(y.keys()).map(v=>(0,U.u)("calcite-list-item-group",{heading:v?.title??this.messagesCommon.untitled,key:v?.uid||"untitled"},y.get(v)?.map(b=>this._renderFeatureMenuItem(b))))):null}_renderHeaderAction(g,y){return g.visible?(0,U.u)("calcite-action",{active:"toggle"===g.type&&g.value,appearance:"solid",bind:this,"data-action-uid":g.uid,disabled:g.disabled,icon:g.icon||"",indicator:g.indicator,key:`header-action-${y}`,loading:g.active,onclick:this._triggerHeaderAction,scale:"m",slot:"header-actions-end",text:g.title||"",title:g.title||""}):null}_renderHeaderActions(){return this.headerActions.map((g,y)=>this._renderHeaderAction(g,y)).toArray()}_renderContentFeature(){const{headingLevel:g,visibleElements:y,_isCollapsed:v,_collapseEnabled:b,featureNavigationTop:w}=this,{title:M,active:F}=this.viewModel,x=y.heading&&M?M:"";return(0,U.u)("calcite-flow-item",{afterCreate:this._storeRootFlowItemNode,afterUpdate:this._focusRootFlowItemNode,bind:this,class:this.classes({[nt.contentFeature]:!0,[nt.flowItemCollapsed]:v}),closable:y.closeButton,closed:!F,collapsed:v,collapseDirection:w?"down":"up",collapsible:b,headingLevel:g,key:"root-flow-item",onCalciteFlowItemClose:this.close,onCalciteFlowItemToggle:this._handleCollapseToggle},x?(0,U.u)(Ki.X,{class:this.classes(nt.featuresHeading,we.z.heading),innerHTML:x,key:"header-content",level:this.headingLevel,slot:"header-content"}):null,this._renderHeaderActions(),this._renderActionBar(),v?null:(0,U.u)("div",{class:this.classes(nt.container,nt.contentContainer)},this._renderContent()),this._renderFooter())}_renderFeatureMenuContainer(){const{viewModel:g,featureMenuOpen:y,messages:v,messagesCommon:b}=this,{active:w,featureViewModels:M,pendingPromisesCount:F}=g;return y?(0,U.u)("calcite-flow-item",{afterCreate:this._storeFeatureMenuFlowItemNode,afterUpdate:this._focusFeatureMenuFlowItemNode,bind:this,closable:!1,closed:!w,description:(0,It.n)(v.total,{total:M.length}),heading:v.selectFeature,key:"feature-menu",loading:g.waitingForContents,onCalciteFlowItemBack:this._handleFeatureMenuBack},F>0?(0,U.u)("calcite-loader",{class:nt.loader,inline:!0,key:"feature-menu-loader",label:b.loading,scale:"m",slot:"header-actions-end"}):null,(0,U.u)("div",{class:nt.container},this._renderFeatureMenu()),(0,U.u)("div",{afterCreate:this._featureMenuIntersectionObserverCreated,bind:this,class:nt.featureMenuObserver}),(0,U.u)("calcite-button",{appearance:"transparent",onclick:this._handleFeatureMenuBack,slot:"footer-actions",width:"full"},b.back)):null}_renderContentContainer(){return(0,U.u)("calcite-flow",{key:"content-container"},this._renderContentFeature(),this._renderFeatureMenuContainer(),this._relatedRecordsWidget.render())}_getIconStyles(g){return{"background-image":g?`url(${g})`:""}}_getActionImage(g){const{selectedFeature:y}=this,v=y?.attributes,{image:b}=g;return b&&v?(0,It.n)(b,v):b??""}_getFallbackIcon(g){const{className:y,icon:v}=g;if(v)return null;const b=this._getActionImage(g),w={[nt.icon]:!!y,[nt.actionImage]:!!b};return y&&(w[y]=!0),b||y?(0,U.u)("span",{"aria-hidden":"true",class:this.classes(nt.icon,w),key:"icon",styles:b?this._getIconStyles(b):{}}):null}_renderActionBar(){return!this._isCollapsed&&this.visibleElements.actionBar&&this.viewModel.allActions?.length?(0,U.u)("calcite-action-bar",{expandDisabled:!0,expanded:!this._hideActionText,key:"header-action-bar",scale:"s",slot:"action-bar"},(0,U.u)("calcite-action-group",{overlayPositioning:"fixed",scale:"s"},this._renderActions())):null}_renderActions(){return this.viewModel.allActions.toArray().map(this._renderAction)}_renderContent(){const g=this.viewModel?.content;return g?"string"==typeof g?(0,U.u)("div",{class:Ge.i.contentNode,innerHTML:g,key:g}):this.renderNodeContent(g):null}_setFocusOn(){this._focusOn=this.featureMenuOpen?"menu-flow-item":"root-flow-item",this.renderNow()}_handleCollapseToggle(){this.collapsed=!this.collapsed}_openRelatedFeature(g){var y=this;return(0,B.Z)(function*(){yield g.viewModel.updateGeometry();const v=g.graphic,b=v?.geometry;if(null==b||null==v)return;y._destroyRelatedRecordsFlowItemWidgets(),yield y.viewModel.zoomTo({target:b});const w=Xs(b);y.open({features:[v],location:w??void 0})})()}_focusRootFlowItemNode(){this._focusFlowItemNodeThrottled("root-flow-item")}_focusFeatureMenuFlowItemNode(){this._focusFlowItemNodeThrottled("menu-flow-item")}_storeRootFlowItemNode(g){this._rootFlowItemNode=g,this._focusFlowItemNodeThrottled("root-flow-item")}_storeFeatureMenuFlowItemNode(g){this._featureMenuViewportNode=g,this._focusFlowItemNodeThrottled("menu-flow-item")}_setActiveFeature(g){const{viewModel:y}=this,v=g.currentTarget["data-feature-index"];y.activeFeature=y.features?.[v]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_selectFeature(g){const y=g.currentTarget["data-feature-index"];isNaN(y)||(this.viewModel.selectedFeatureIndex=y),this._handleFeatureMenuBack()}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(g){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(g),this._featureMenuIntersectionObserverNode=g}_getActionIcon(g){return g.icon?g.icon:g.image||g.className?void 0:"question"}_getActionTitle(g){const{messages:y,selectedFeature:v,messagesCommon:b}=this,{id:w}=g,M=v?.attributes,F=g.title??"",x="zoom-to-feature"===w?(0,It.n)(F,{messages:y}):"remove-selected-feature"===w?(0,It.n)(F,{messages:b}):"zoom-to-clustered-features"===w||"browse-clustered-features"===w?(0,It.n)(F,{messages:y}):g.title;return x&&M?(0,It.n)(x,M):x??""}_onMainKeydown(g){const y=(0,je.kK)(g);"ArrowLeft"===y&&(g.stopPropagation(),this._handleFeatureMenuBack(),this.previous()),"ArrowRight"===y&&(g.stopPropagation(),this._handleFeatureMenuBack(),this.next())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&this._featureMenuViewportNode.scrollContentTo({top:0})}_setContentFromFeatureWidget(){const{selectedFeatureWidget:g}=this;g&&(this.viewModel.content=g)}_setTitleFromFeatureWidget(){const{selectedFeatureWidget:g,messagesCommon:y}=this,v=g?.viewModel;g&&(this.viewModel.title="error"===v?.state?y?.errorMessage:v?.title||"")}_addSelectedFeatureIndexHandle(){const g=(0,$.YP)(()=>this.viewModel?.selectedFeatureIndex,(y,v)=>this._selectedFeatureIndexUpdated(y,v));this.addHandles(g,eo)}_selectedFeatureIndexUpdated(g,y){const{featureCount:v}=this.viewModel;v&&g!==y&&-1!==g&&(this._destroyRelatedRecordsFlowItemWidgets(),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_triggerHeaderAction(g){const y=g.currentTarget;if(y.disabled)return;const v=y.dataset.actionUid,b=this.headerActions.find(({uid:w})=>w===v);b&&!b.disabled&&("toggle"===b?.type&&(b.value=!b.value),this.emit("trigger-header-action",{action:b}))}_triggerAction(g){const y=g.currentTarget;if(y.disabled)return;const v=y.dataset.actionUid,{allActions:b}=this.viewModel,w=b.findIndex(F=>F.uid===v),M=b.at(w);M&&"toggle"===M.type&&(M.value=!M.value),this.viewModel.triggerAction(w)}_createSpinner(g){g&&(this._spinner=new _a({view:g}),g.ui.add(this._spinner,{key:to,position:"manual",internal:!0}))}_wireUpView(g){this._destroySpinner(),g&&this.visibleElements?.spinner&&this._createSpinner(g)}_hideSpinner(){const{_spinner:g}=this;g&&(g.location=null,g.hide())}_viewReadyChange(g,y){g?this._wireUpView(this.viewModel?.view):y&&this.viewModel.clear()}_viewChange(g,y){g&&y&&this.viewModel.clear()}_destroySelectedFeatureWidget(){const{_feature:g}=this;g&&(g.viewModel=null,!g.destroyed&&g.destroy()),this._feature=null}_destroyRelatedRecordsFlowItemWidgets(){this._relatedRecordsFlowItems.removeAll().forEach(g=>{"showAllEnabled"in g.viewModel&&(g.viewModel.showAllEnabled=!1),g.viewModel=null,g.destroy()})}_toggleScreenLocationEnabled(){const{viewModel:g}=this;g&&(g.screenLocationEnabled=g.active)}_displaySpinner(){const{_spinner:g}=this;if(!g)return;const{location:y,waitingForResult:v}=this.viewModel;v&&y?g.show({location:y}):g.hide()}_destroySpinner(){const{_spinner:g,view:y}=this;g&&(y?.ui?.remove(g,to),g.destroy(),this._spinner=null)}_spinnerEnabledChange(g){this._destroySpinner(),g&&this._createSpinner(this.viewModel?.view)}};(0,_._)([(0,A.Cb)()],Ze.prototype,"_focusOn",void 0),(0,_._)([(0,A.Cb)()],Ze.prototype,"_relatedRecordsFlowItems",void 0),(0,_._)([(0,A.Cb)()],Ze.prototype,"_hideActionText",null),(0,_._)([(0,A.Cb)()],Ze.prototype,"_featureNavigationVisible",null),(0,_._)([(0,A.Cb)()],Ze.prototype,"_isCollapsed",null),(0,_._)([(0,A.Cb)()],Ze.prototype,"_collapseEnabled",null),(0,_._)([(0,A.Cb)()],Ze.prototype,"collapsed",void 0),(0,_._)([(0,A.Cb)()],Ze.prototype,"content",null),(0,_._)([(0,A.Cb)()],Ze.prototype,"icon",void 0),(0,_._)([(0,A.Cb)()],Ze.prototype,"featureMenuOpen",null),(0,_._)([(0,A.Cb)()],Ze.prototype,"featureNavigationTop",void 0),(0,_._)([(0,A.Cb)()],Ze.prototype,"features",null),(0,_._)([(0,A.Cb)({type:kt})],Ze.prototype,"headerActions",void 0),(0,_._)([(0,A.Cb)()],Ze.prototype,"headingLevel",void 0),(0,_._)([(0,A.Cb)()],Ze.prototype,"location",null),(0,_._)([(0,A.Cb)()],Ze.prototype,"label",null),(0,_._)([(0,A.Cb)(),(0,pt.H)("esri/widgets/Features/t9n/Features")],Ze.prototype,"messages",void 0),(0,_._)([(0,A.Cb)(),(0,pt.H)("esri/t9n/common")],Ze.prototype,"messagesCommon",void 0),(0,_._)([(0,A.Cb)()],Ze.prototype,"promises",null),(0,_._)([(0,A.Cb)()],Ze.prototype,"responsiveActionsEnabled",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],Ze.prototype,"selectedFeature",null),(0,_._)([(0,A.Cb)()],Ze.prototype,"selectedFeatureIndex",null),(0,_._)([(0,A.Cb)({readOnly:!0})],Ze.prototype,"selectedFeatureWidget",null),(0,_._)([(0,A.Cb)()],Ze.prototype,"title",null),(0,_._)([(0,A.Cb)()],Ze.prototype,"updateLocationEnabled",null),(0,_._)([(0,A.Cb)()],Ze.prototype,"view",null),(0,_._)([(0,A.Cb)({type:Nn}),(0,qs.s)(["triggerAction","trigger-action"])],Ze.prototype,"viewModel",void 0),(0,_._)([(0,A.Cb)({type:Js,nonNullable:!0})],Ze.prototype,"visibleElements",void 0),(0,_._)([(0,A.Cb)()],Ze.prototype,"visible",null),Ze=(0,_._)([(0,ne.j)("esri.widgets.Features")],Ze);const el=Ze,bt="esri-popup",Yt=`${bt}--is-docked`,et={base:bt,main:`${bt}__main-container`,shadow:`${bt}--shadow`,isDocked:Yt,isDockedTopLeft:`${Yt}-top-left`,isDockedTopCenter:`${Yt}-top-center`,isDockedTopRight:`${Yt}-top-right`,isDockedBottomLeft:`${Yt}-bottom-left`,isDockedBottomCenter:`${Yt}-bottom-center`,isDockedBottomRight:`${Yt}-bottom-right`,alignTopCenter:`${bt}--aligned-top-center`,alignBottomCenter:`${bt}--aligned-bottom-center`,alignTopLeft:`${bt}--aligned-top-left`,alignBottomLeft:`${bt}--aligned-bottom-left`,alignTopRight:`${bt}--aligned-top-right`,alignBottomRight:`${bt}--aligned-bottom-right`,pointer:`${bt}__pointer`,pointerDirection:`${bt}__pointer-direction`};let Bn=class extends Nn{constructor(g){super(g)}};Bn=(0,_._)([(0,ne.j)("esri.widgets.Popup.PopupViewModel")],Bn);const io=Bn;let gi=class extends lt.Z{constructor(){super(...arguments),this.closeButton=!0,this.featureNavigation=!0}};(0,_._)([(0,A.Cb)({type:Boolean,nonNullable:!0})],gi.prototype,"closeButton",void 0),(0,_._)([(0,A.Cb)({type:Boolean,nonNullable:!0})],gi.prototype,"featureNavigation",void 0),gi=(0,_._)([(0,ne.j)("esri.widgets.Features.PopupVisibleElements")],gi);const no=gi,so={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};let Ae=class extends Y.Z{constructor(g,y){super(g,y),this._dockAction=new se.Z({id:"popup-dock-action"}),this._featuresWidget=new el({responsiveActionsEnabled:!0}),this._containerNode=null,this._mainContainerNode=null,this._pointerOffsetInPx=16,this.alignment="auto",this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.headingLevel=2,this.maxInlineActions=3,this.messages=null,this.spinnerEnabled=!0,this.viewModel=new io,this.visibleElements=new no}initialize(){this.addHandles([(0,$.YP)(()=>[this.viewModel?.view?.widthBreakpoint,this.dockEnabled],()=>this._handleDockIcon(),{initial:!0}),(0,$.YP)(()=>[this.dockEnabled,this.messages?.undock,this.messages?.dock],()=>this._handleDockEnabled(),{initial:!0}),(0,$.YP)(()=>this.dockOptions,g=>{const{_dockAction:y}=this,v=this._featuresWidget.headerActions;v.remove(y),g.buttonEnabled&&v.add(y)},{initial:!0}),(0,$.YP)(()=>this.viewModel?.screenLocation,()=>this._positionContainer()),(0,$.YP)(()=>[this.viewModel?.active,this.dockEnabled],()=>this._toggleScreenLocationEnabled()),(0,$.YP)(()=>[this.viewModel?.screenLocation,this.viewModel?.view?.padding,this.viewModel?.view?.size,this.viewModel?.active,this.viewModel?.location,this.alignment],()=>this.reposition()),(0,$.YP)(()=>this.viewModel?.view?.size,(g,y)=>this._updateDockEnabledForViewSize(g,y)),(0,$.YP)(()=>this.viewModel?.view,(g,y)=>this._viewChange(g,y)),(0,$.YP)(()=>this.viewModel?.view?.ready,(g,y)=>this._viewReadyChange(g??!1,y??!1)),(0,$.YP)(()=>this.viewModel,()=>this._featuresWidget.viewModel=this.viewModel,{initial:!0}),(0,$.YP)(()=>this._featureNavigationTop,g=>this._featuresWidget.featureNavigationTop=g,{initial:!0}),(0,$.YP)(()=>this.headingLevel,g=>this._featuresWidget.headingLevel=g,{initial:!0}),(0,$.YP)(()=>this.collapseEnabled,g=>this._featuresWidget.visibleElements.collapseButton=g,{initial:!0}),(0,$.YP)(()=>this.collapsed,g=>this._featuresWidget.collapsed=g,{initial:!0}),(0,$.YP)(()=>this.visibleElements.closeButton,g=>this._featuresWidget.visibleElements.closeButton=!!g,{initial:!0}),(0,$.YP)(()=>this.spinnerEnabled,g=>this._featuresWidget.visibleElements.spinner=g,{initial:!0}),(0,$.YP)(()=>this.visibleElements.featureNavigation,g=>this._featuresWidget.visibleElements.featureNavigation=!!g,{initial:!0}),(0,$.on)(()=>this._featuresWidget,"trigger-header-action",g=>{g.action===this._dockAction&&(this.dockEnabled=!this.dockEnabled)})])}destroy(){this._dockAction.destroy(),this._featuresWidget?.destroy()}get _featureNavigationTop(){const{currentAlignment:g,currentDockPosition:y}=this;return"bottom-left"===g||"bottom-center"===g||"bottom-right"===g||"top-left"===y||"top-center"===y||"top-right"===y}get actions(){return this.viewModel.actions}set actions(g){this.viewModel.actions=g}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(g){this.viewModel.autoCloseEnabled=g}get autoOpenEnabled(){return(0,xe.Mr)(Pe.Z.getLogger(this),"autoOpenEnabled",{replacement:"MapView/SceneView.popupEnabled",version:"4.27"}),this.viewModel.autoOpenEnabled}set autoOpenEnabled(g){(0,xe.Mr)(Pe.Z.getLogger(this),"autoOpenEnabled",{replacement:"MapView/SceneView.popupEnabled",version:"4.27"}),this.viewModel.autoOpenEnabled=g}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(g){this.viewModel.defaultPopupTemplateEnabled=g}get content(){return this.viewModel.content}set content(g){this.viewModel.content=g}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||so}set dockOptions(g){const y={...so},v=this.viewModel?.view?.breakpoints,b={};v&&(b.width=v.xsmall,b.height=v.xsmall);const w={...y,...g},M={...y.breakpoint,...b},{breakpoint:F}=w;"object"==typeof F?w.breakpoint={...M,...F}:F&&(w.breakpoint=M),this._set("dockOptions",w),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(g){this.viewModel.featureMenuOpen=g}get features(){return this.viewModel.features}set features(g){this.viewModel.features=g}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(g){this.viewModel.goToOverride=g}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(g){this.viewModel.highlightEnabled=g}get location(){return this.viewModel.location}set location(g){this.viewModel.location=g}get label(){return this.messages?.widgetLabel??""}set label(g){this._overrideIfSome("label",g)}get promises(){return this.viewModel.promises}set promises(g){this.viewModel.promises=g}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(g){this.viewModel.selectedFeatureIndex=g}get selectedFeatureWidget(){return this._featuresWidget.selectedFeatureWidget}get title(){return this.viewModel.title}set title(g){this.viewModel.title=g}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(g){this.viewModel.updateLocationEnabled=g}get view(){return this.viewModel.view}set view(g){this.viewModel.view=g}get visible(){return this.viewModel.visible}set visible(g){this.viewModel.visible=g}blur(){const{active:g}=this.viewModel;g||Pe.Z.getLogger(this).warn("Popup can only be blurred when currently active."),this._featuresWidget.blur()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(g,y){return this.viewModel.fetchFeatures(g,y)}focus(){const{active:g}=this.viewModel;g||Pe.Z.getLogger(this).warn("Popup can only be focused when currently active."),this.renderNow(),this._featuresWidget.focus()}next(){return this.viewModel.next()}open(g){this.set({collapsed:!!g&&!!g.collapsed,featureMenuOpen:!!g&&!!g.featureMenuOpen}),this.viewModel.open(g),this._shouldFocus(g)}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(g){return this.viewModel.triggerAction(g)}render(){const{dockEnabled:g,currentAlignment:y,currentDockPosition:v}=this,{active:b}=this.viewModel,w=b&&g,M=b&&!g,F=this.selectedFeature?.layer?.title,x=this.selectedFeature?.layer?.id;return(0,U.u)("div",{afterCreate:this._positionContainer,afterUpdate:this._positionContainer,bind:this,class:this.classes(et.base,{[et.alignTopCenter]:"top-center"===y,[et.alignBottomCenter]:"bottom-center"===y,[et.alignTopLeft]:"top-left"===y,[et.alignBottomLeft]:"bottom-left"===y,[et.alignTopRight]:"top-right"===y,[et.alignBottomRight]:"bottom-right"===y,[et.isDocked]:w,[et.shadow]:M,[et.isDockedTopLeft]:"top-left"===v,[et.isDockedTopCenter]:"top-center"===v,[et.isDockedTopRight]:"top-right"===v,[et.isDockedBottomLeft]:"bottom-left"===v,[et.isDockedBottomCenter]:"bottom-center"===v,[et.isDockedBottomRight]:"bottom-right"===v}),"data-layer-id":x,"data-layer-title":F,role:"presentation"},b?[this._renderMainContainer(),this._renderPointer()]:null)}_renderPointer(){return this.dockEnabled?null:(0,U.u)("div",{class:et.pointer,key:"popup-pointer",role:"presentation"},(0,U.u)("div",{class:this.classes(et.pointerDirection,et.shadow)}))}_renderMainContainer(){const{dockEnabled:g}=this;return(0,U.u)("div",{afterCreate:this._setMainContainerNode,afterUpdate:this._setMainContainerNode,bind:this,class:this.classes(et.main,we.z.widget,{[et.shadow]:g})},this._featuresWidget.render())}_shouldFocus(g){var y=this;return(0,B.Z)(function*(){g?.shouldFocus&&(yield(0,$.N1)(()=>!0===y.viewModel?.active),y.focus())})()}_isOutsideView(g){const{popupHeight:y,popupWidth:v,screenLocation:b,side:w,view:M}=g;if(isNaN(v)||isNaN(y)||!M||!b)return!1;const F=M.padding;return"right"===w&&b.x+v/2>M.width-F.right||"left"===w&&b.x-v/2<F.left||"top"===w&&b.y-y<F.top||"bottom"===w&&b.y+y>M.height-F.bottom}_calculateAutoAlignment(g){if("auto"!==g)return g;const{_pointerOffsetInPx:y,_containerNode:v,_mainContainerNode:b,viewModel:w}=this,{screenLocation:M,view:F}=w;if(null==M||!F||!v)return"top-center";function x(re){return parseInt(re.replaceAll(/[^-\d\.]/g,""),10)}const T=b?window.getComputedStyle(b,null):null,P=T?x(T.getPropertyValue("max-height")):0,R=T?x(T.getPropertyValue("height")):0,{height:V,width:z}=v.getBoundingClientRect(),k=z+y,H=Math.max(V,P,R)+y,J=this._isOutsideView({popupHeight:H,popupWidth:k,screenLocation:M,side:"right",view:F}),ie=this._isOutsideView({popupHeight:H,popupWidth:k,screenLocation:M,side:"left",view:F}),ue=this._isOutsideView({popupHeight:H,popupWidth:k,screenLocation:M,side:"top",view:F}),_e=this._isOutsideView({popupHeight:H,popupWidth:k,screenLocation:M,side:"bottom",view:F});return ie?ue?"bottom-right":"top-right":J?ue?"bottom-left":"top-left":ue?_e?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(g){return"function"==typeof g?g.call(this):g}_getCurrentAlignment(){const{alignment:g,dockEnabled:y}=this;return y||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(g)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(g){const y=["left","right"];return(0,Mt.dZ)(this.container)&&y.reverse(),g?.replace(/leading/gi,y[0]).replaceAll(/trailing/gi,y[1])}_callDockPosition(g){return"function"==typeof g?g.call(this):g}_getDockPosition(){return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(this.dockOptions?.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_calculateAutoDockPosition(g){if("auto"!==g)return g;const y=this.viewModel?.view,v=(0,Mt.dZ)(this.container)?"top-left":"top-right";if(!y)return v;const b=y.padding||{left:0,right:0,top:0,bottom:0},w=y.width-b.left-b.right,{breakpoints:M}=y;return M&&w<=M.xsmall?"bottom-center":v}_getDockIcon(){const g=this._getDockPosition();if(this.dockEnabled)return"minimize";switch(g){case"top-left":case"bottom-left":return"dock-left";case"top-center":return"maximize";case"bottom-center":return"dock-bottom";default:return"dock-right"}}_handleDockIcon(){this._dockAction.icon=this._getDockIcon()}_handleDockEnabled(){this._dockAction.title=this.dockEnabled?this.messages?.undock:this.messages?.dock}_setMainContainerNode(g){this._mainContainerNode=g}_positionContainer(g=this._containerNode){if(g&&(this._containerNode=g),!this._containerNode)return;const{screenLocation:y}=this.viewModel,{width:v}=this._containerNode.getBoundingClientRect(),b=this._calculatePositionStyle(y,v);b&&Object.assign(this._containerNode.style,b)}_calculateFullWidth(g){const{currentAlignment:y,_pointerOffsetInPx:v}=this;return"top-left"===y||"bottom-left"===y||"top-right"===y||"bottom-right"===y?g+v:g}_calculateAlignmentPosition(g,y,v,b){const{currentAlignment:w,_pointerOffsetInPx:M}=this;if(!v)return;const{padding:F}=v,x=b/2,T=v.height-y,P=v.width-g;return"bottom-center"===w?{top:y+M-F.top,left:g-x-F.left}:"top-left"===w?{bottom:T+M-F.bottom,right:P+M-F.right}:"bottom-left"===w?{top:y+M-F.top,right:P+M-F.right}:"top-right"===w?{bottom:T+M-F.bottom,left:g+M-F.left}:"bottom-right"===w?{top:y+M-F.top,left:g+M-F.left}:"top-center"===w?{bottom:T+M-F.bottom,left:g-x-F.left}:void 0}_calculatePositionStyle(g,y){const{dockEnabled:v,view:b}=this;if(!b)return;if(v)return{left:"",top:"",right:"",bottom:""};if(null==g||!y)return;const w=this._calculateFullWidth(y),M=this._calculateAlignmentPosition(g.x,g.y,b,w);return M?{top:void 0!==M.top?`${M.top}px`:"auto",left:void 0!==M.left?`${M.left}px`:"auto",bottom:void 0!==M.bottom?`${M.bottom}px`:"auto",right:void 0!==M.right?`${M.right}px`:"auto"}:void 0}_viewChange(g,y){g&&y&&(this.close(),this.clear())}_viewReadyChange(g,y){g?this._wireUpView():y&&(this.close(),this.clear())}_wireUpView(){this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(g,y,v){const[b,w]=g,[M,F]=y,{width:x=0,height:T=0}=v??{};return b<=x&&M>x||b>x&&M<=x||w<=T&&F>T||w>T&&F<=T}_updateDockEnabledForViewSize(g,y){if(!g||!y)return;const v=this.viewModel?.view?.padding||{left:0,right:0,top:0,bottom:0},b=v.left+v.right,w=v.top+v.bottom,M=[],F=[];M[0]=g[0]-b,M[1]=g[1]-w,F[0]=y[0]-b,F[1]=y[1]-w;const{dockOptions:x}=this;this._dockingThresholdCrossed(M,F,x.breakpoint)&&this._setDockEnabledForViewSize(x),this._setCurrentDockPosition()}_toggleScreenLocationEnabled(){const{dockEnabled:g,viewModel:y}=this;y&&(y.screenLocationEnabled=y.active&&!g)}_shouldDockAtCurrentViewSize(g){const y=g.breakpoint,v=this.viewModel?.view?.ui;if(!v)return!1;const{width:b,height:w}=v;if(isNaN(b)||isNaN(w)||!y)return!1;const M=y.hasOwnProperty("width")&&b<=(y.width??0),F=y.hasOwnProperty("height")&&w<=(y.height??0);return M||F}_setDockEnabledForViewSize(g){g.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(g))}};(0,_._)([(0,A.Cb)({readOnly:!0})],Ae.prototype,"_featureNavigationTop",null),(0,_._)([(0,A.Cb)()],Ae.prototype,"actions",null),(0,_._)([(0,A.Cb)()],Ae.prototype,"alignment",void 0),(0,_._)([(0,A.Cb)()],Ae.prototype,"autoCloseEnabled",null),(0,_._)([(0,A.Cb)()],Ae.prototype,"autoOpenEnabled",null),(0,_._)([(0,A.Cb)()],Ae.prototype,"defaultPopupTemplateEnabled",null),(0,_._)([(0,A.Cb)()],Ae.prototype,"content",null),(0,_._)([(0,A.Cb)()],Ae.prototype,"collapsed",void 0),(0,_._)([(0,A.Cb)()],Ae.prototype,"collapseEnabled",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],Ae.prototype,"currentAlignment",null),(0,_._)([(0,A.Cb)({readOnly:!0})],Ae.prototype,"currentDockPosition",null),(0,_._)([(0,A.Cb)()],Ae.prototype,"dockOptions",null),(0,_._)([(0,A.Cb)()],Ae.prototype,"dockEnabled",void 0),(0,_._)([(0,A.Cb)({readOnly:!0})],Ae.prototype,"featureCount",null),(0,_._)([(0,A.Cb)()],Ae.prototype,"featureMenuOpen",null),(0,_._)([(0,A.Cb)()],Ae.prototype,"features",null),(0,_._)([(0,A.Cb)()],Ae.prototype,"goToOverride",null),(0,_._)([(0,A.Cb)()],Ae.prototype,"headingLevel",void 0),(0,_._)([(0,A.Cb)()],Ae.prototype,"highlightEnabled",null),(0,_._)([(0,A.Cb)()],Ae.prototype,"location",null),(0,_._)([(0,A.Cb)()],Ae.prototype,"label",null),(0,_._)([(0,A.Cb)()],Ae.prototype,"maxInlineActions",void 0),(0,_._)([(0,A.Cb)(),(0,pt.H)("esri/widgets/Popup/t9n/Popup")],Ae.prototype,"messages",void 0),(0,_._)([(0,A.Cb)()],Ae.prototype,"promises",null),(0,_._)([(0,A.Cb)({readOnly:!0})],Ae.prototype,"selectedFeature",null),(0,_._)([(0,A.Cb)()],Ae.prototype,"selectedFeatureIndex",null),(0,_._)([(0,A.Cb)({readOnly:!0})],Ae.prototype,"selectedFeatureWidget",null),(0,_._)([(0,A.Cb)()],Ae.prototype,"spinnerEnabled",void 0),(0,_._)([(0,A.Cb)()],Ae.prototype,"title",null),(0,_._)([(0,A.Cb)()],Ae.prototype,"updateLocationEnabled",null),(0,_._)([(0,A.Cb)()],Ae.prototype,"view",null),(0,_._)([(0,A.Cb)({type:io}),(0,qs.s)(["triggerAction","trigger-action"])],Ae.prototype,"viewModel",void 0),(0,_._)([(0,A.Cb)()],Ae.prototype,"visible",null),(0,_._)([(0,A.Cb)({type:no,nonNullable:!0})],Ae.prototype,"visibleElements",void 0),Ae=(0,_._)([(0,ne.j)("esri.widgets.Popup")],Ae);const tl=Ae}}]);