"use strict";(self.webpackChunkangular_17_test=self.webpackChunkangular_17_test||[]).push([[7192],{1865:(W,T,l)=>{function E(R){const C=R.layer;return"floorInfo"in C&&C.floorInfo?.floorField&&"floors"in R.view?N(R.view.floors,C.floorInfo.floorField):null}function a(R,C){return"floorInfo"in C&&C.floorInfo?.floorField?N(R,C.floorInfo.floorField):null}function N(R,C){if(!R?.length)return null;const O=R.filter(v=>""!==v).map(v=>`'${v}'`);return O.push("''"),`${C} IN (${O.join(",")}) OR ${C} IS NULL`}l.d(T,{c:()=>E,f:()=>a})},45859:(W,T,l)=>{l.d(T,{FN:()=>N,QV:()=>a,ac:()=>C});var E=l(60301);function a(O,v,I){return v.flatten(({sublayers:d})=>d).length!==O.length||!!O.some(d=>d.originIdOf("minScale")>I||d.originIdOf("maxScale")>I||d.originIdOf("renderer")>I||d.originIdOf("labelingInfo")>I||d.originIdOf("opacity")>I||d.originIdOf("labelsVisible")>I||d.originIdOf("source")>I)||!R(O,v)}function N(O,v,I){return!!O.some(m=>{const d=m.source;return!(!d||"map-layer"===d.type&&d.mapLayerId===m.id&&(null==d.gdbVersion||d.gdbVersion===I))||m.originIdOf("renderer")>E.s3.SERVICE||m.originIdOf("labelingInfo")>E.s3.SERVICE||m.originIdOf("opacity")>E.s3.SERVICE||m.originIdOf("labelsVisible")>E.s3.SERVICE})||!R(O,v)}function R(O,v){if(!O?.length||null==v)return!0;const I=v.slice().reverse().flatten(({sublayers:j})=>j&&j.toArray().reverse()).map(j=>j.id).toArray();if(O.length>I.length)return!1;let m=0;const d=I.length;for(const{id:j}of O){for(;m<d&&I[m]!==j;)m++;if(m>=d)return!1}return!0}function C(O){return!!O&&O.some(v=>null!=v.minScale||null!=v.layerDefinition?.minScale)}},64269:(W,T,l)=>{l.d(T,{VF:()=>G,Uf:()=>Ne});var E=l(15861),a=l(50484),N=l(35458),R=l(73514),C=l(57678),O=l(83944),v=l(57964),I=l(1258),m=l(14007),d=l(8611),j=l(79412),J=l(77675),z=l(49602),p=l(80543),Q=l(1535),$=l(10141),H=l(26894),D=l(40408),pe=l(85295),X=l(1865);function Y(r,e){return e?"xoffset"in e&&e.xoffset?Math.max(r,Math.abs(e.xoffset)):"yoffset"in e&&e.yoffset?Math.max(r,Math.abs(e.yoffset||0)):r:r}function ne(r,e){return"number"==typeof r?r:r?.stops?.length?function fe(r){let e=0,n=0;for(let i=0;i<r.length;i++){const o=r[i].size;"number"==typeof o&&(e+=o,n++)}return e/n}(r.stops):e}function ie(r){const e=r?.renderer,n=r?.event?.pointerType,i="touch"===n?9:6;if(!e)return i;const o="visualVariables"in e?function ce(r,e){if(!e)return r;const n=e.filter(u=>"size"===u.type).map(u=>{const{maxSize:S,minSize:y}=u;return(ne(S,r)+ne(y,r))/2});let i=0;const o=n.length;if(0===o)return r;for(let u=0;u<o;u++)i+=n[u];const s=Math.floor(i/o);return Math.max(s,r)}(i,e.visualVariables):i;if("simple"===e.type)return Y(o,e.symbol);if("unique-value"===e.type){let s=o;return e.uniqueValueInfos?.forEach(u=>{s=Y(s,u.symbol)}),s}if("class-breaks"===e.type){let s=o;return e.classBreakInfos.forEach(u=>{s=Y(s,u.symbol)}),s}return o}var de=l(66476),he=l(93566),k=l(15462),me=l(38955),oe=l(40637),ge=l(33721),ve=l(45859);var q,Se=l(2189),Ee=l(34411),se=l(89317),Oe=l(43814);let b=q=class extends se.wq{static from(r){return(0,Q.TJ)(q,r)}constructor(r){super(r),this.dpi=96,this.floors=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=null,this.height=400,this.layerIds=null,this.layerOption="top",this.mapExtent=null,this.maxAllowableOffset=null,this.returnFieldName=!0,this.returnGeometry=!1,this.returnM=!1,this.returnUnformattedValues=!0,this.returnZ=!1,this.spatialReference=null,this.sublayers=null,this.timeExtent=null,this.tolerance=null,this.width=400}};(0,a._)([(0,p.Cb)({type:Number,json:{write:!0}})],b.prototype,"dpi",void 0),(0,a._)([(0,p.Cb)()],b.prototype,"floors",void 0),(0,a._)([(0,p.Cb)({type:String,json:{write:!0}})],b.prototype,"gdbVersion",void 0),(0,a._)([(0,p.Cb)({types:Se.qM,json:{read:oe.im,write:!0}})],b.prototype,"geometry",void 0),(0,a._)([(0,p.Cb)({type:Number,json:{write:!0}})],b.prototype,"geometryPrecision",void 0),(0,a._)([(0,p.Cb)({type:Number,json:{write:!0}})],b.prototype,"height",void 0),(0,a._)([(0,p.Cb)({type:[Number],json:{write:!0}})],b.prototype,"layerIds",void 0),(0,a._)([(0,p.Cb)({type:["top","visible","all","popup"],json:{write:!0}})],b.prototype,"layerOption",void 0),(0,a._)([(0,p.Cb)({type:H.Z,json:{write:!0}})],b.prototype,"mapExtent",void 0),(0,a._)([(0,p.Cb)({type:Number,json:{write:!0}})],b.prototype,"maxAllowableOffset",void 0),(0,a._)([(0,p.Cb)({type:Boolean,json:{write:!0}})],b.prototype,"returnFieldName",void 0),(0,a._)([(0,p.Cb)({type:Boolean,json:{write:!0}})],b.prototype,"returnGeometry",void 0),(0,a._)([(0,p.Cb)({type:Boolean,json:{write:!0}})],b.prototype,"returnM",void 0),(0,a._)([(0,p.Cb)({type:Boolean,json:{write:!0}})],b.prototype,"returnUnformattedValues",void 0),(0,a._)([(0,p.Cb)({type:Boolean,json:{write:!0}})],b.prototype,"returnZ",void 0),(0,a._)([(0,p.Cb)({type:Oe.Z,json:{write:!0}})],b.prototype,"spatialReference",void 0),(0,a._)([(0,p.Cb)()],b.prototype,"sublayers",void 0),(0,a._)([(0,p.Cb)({type:Ee.Z,json:{write:!0}})],b.prototype,"timeExtent",void 0),(0,a._)([(0,p.Cb)({type:Number,json:{write:!0}})],b.prototype,"tolerance",void 0),(0,a._)([(0,p.Cb)({type:Number,json:{write:!0}})],b.prototype,"width",void 0),b=q=(0,a._)([(0,$.j)("esri.rest.support.IdentifyParameters")],b);const le=b;var we=l(62185),Re=l(7547),Ce=l(31709);let Z=class extends se.wq{constructor(r){super(r),this.displayFieldName=null,this.feature=null,this.layerId=null,this.layerName=null}readFeature(r,e){return N.Z.fromJSON({attributes:{...e.attributes},geometry:{...e.geometry}})}writeFeature(r,e){if(!r)return;const{attributes:n,geometry:i}=r;n&&(e.attributes={...n}),null!=i&&(e.geometry=i.toJSON(),e.geometryType=Ce.P.toJSON(i.type))}};(0,a._)([(0,p.Cb)({type:String,json:{write:!0}})],Z.prototype,"displayFieldName",void 0),(0,a._)([(0,p.Cb)({type:N.Z})],Z.prototype,"feature",void 0),(0,a._)([(0,we.r)("feature",["attributes","geometry"])],Z.prototype,"readFeature",null),(0,a._)([(0,Re.c)("feature")],Z.prototype,"writeFeature",null),(0,a._)([(0,p.Cb)({type:Number,json:{write:!0}})],Z.prototype,"layerId",void 0),(0,a._)([(0,p.Cb)({type:String,json:{write:!0}})],Z.prototype,"layerName",void 0),Z=(0,a._)([(0,$.j)("esri.rest.support.IdentifyResult")],Z);const Fe=Z;function _(){return(_=(0,E.Z)(function*(r,e,n){const i=(e=function Ue(r){return le.from(r)}(e)).geometry?[e.geometry]:[],o=(0,k.en)(r);return o.path+="/identify",(0,he.aX)(i).then(s=>{const u=function be(r,e){const{dpi:n,gdbVersion:i,geometry:o,geometryPrecision:s,height:u,layerOption:S,mapExtent:y,maxAllowableOffset:f,returnFieldName:h,returnGeometry:c,returnUnformattedValues:g,returnZ:w,spatialReference:x,timeExtent:M,tolerance:U,width:F}=r.toJSON(),{dynamicLayers:V,layerDefs:B,layerIds:L}=function xe(r){const{mapExtent:e,floors:n,width:i,sublayers:o,layerIds:s,layerOption:u,gdbVersion:S}=r,y=o?.find(x=>null!=x.layer)?.layer?.serviceSublayers,f="popup"===u,h={},c=(0,D.yZ)({extent:e,width:i,spatialReference:e?.spatialReference}),g=[],w=x=>{if(x.visible&&(0===c||(0===x.minScale||c<=x.minScale)&&(0===x.maxScale||c>=x.maxScale)))if(x.sublayers)x.sublayers.forEach(w);else{if(!1===s?.includes(x.id)||f&&(!x.popupTemplate||!x.popupEnabled))return;g.unshift(x)}};if(o?.forEach(w),o&&!g.length)h.layerIds=[];else{const x=(0,ve.FN)(g,y,S),M=g.map(U=>{const F=(0,X.f)(n,U);return U.toExportImageJSON(F)});if(x)h.dynamicLayers=JSON.stringify(M);else{if(o){let F=g.map(({id:V})=>V);s&&(F=F.filter(V=>s.includes(V))),h.layerIds=F}else s?.length&&(h.layerIds=s);const U=function Ie(r,e){const n=!!r?.length,i=e.filter(o=>null!=o.definitionExpression||n&&null!=o.floorInfo);return i.length?i.map(o=>{const s=(0,X.f)(r,o),u=(0,me._)(s,o.definitionExpression);return{id:o.id,definitionExpression:u??void 0}}):null}(n,g);if(null!=U&&U.length){const F={};for(const V of U)V.definitionExpression&&(F[V.id]=V.definitionExpression);Object.keys(F).length&&(h.layerDefs=JSON.stringify(F))}}}return h}(r),K=null!=e?.geometry?e.geometry:null,P={geometryPrecision:s,maxAllowableOffset:f,returnFieldName:h,returnGeometry:c,returnUnformattedValues:g,returnZ:w,tolerance:U},A=K&&K.toJSON()||o;P.imageDisplay=`${F},${u},${n}`,i&&(P.gdbVersion=i),A&&(delete A.spatialReference,P.geometry=JSON.stringify(A),P.geometryType=(0,oe.Ji)(A));const ye=x??A?.spatialReference??y?.spatialReference;if(ye&&(P.sr=(0,ge.B9)(ye)),P.time=M?[M.start,M.end].join(","):null,y){const{xmin:Le,ymin:De,xmax:Be,ymax:$e}=y;P.mapExtent=`${Le},${De},${Be},${$e}`}return B&&(P.layerDefs=B),V&&!B&&(P.dynamicLayers=V),P.layers="popup"===S?"visible":S,L&&!V&&(P.layers+=`:${L.join(",")}`),P}(e,{geometry:s?.[0]}),S=(0,k.cv)({...o.query,f:"json",...u}),y=(0,k.lA)(S,n);return(0,de.Z)(o.path,y).then(je).then(f=>function Ve(r,e){if(!e?.length)return r;const n=new Map;e.forEach(function i(o){n.set(o.id,o),o.sublayers&&o.sublayers.forEach(i)});for(const o of r.results)o.feature.sourceLayer=n.get(o.layerId);return r}(f,e.sublayers))})})).apply(this,arguments)}function je(r){const e=r.data;return e.results=e.results||[],e.exceededTransferLimit=!!e.exceededTransferLimit,e.results=e.results.map(n=>Fe.fromJSON(n)),e}var Me=l(4978),ae=l(35451),ue=l(96696);let ee=null;function Ne(r,e){return"tile"===e.type||"map-image"===e.type}let G=class extends R.Z{constructor(r){var e;super(r),e=this,this._featuresResolutions=new WeakMap,this.highlightGraphics=null,this.highlightGraphicUpdated=null,this.updateHighlightedFeatures=(0,j.Ds)(function(){var n=(0,E.Z)(function*(i){e.destroyed||e.updatingHandles.addPromise(e._updateHighlightedFeaturesGeometries(i).catch(()=>{}))});return function(i){return n.apply(this,arguments)}}())}initialize(){const r=e=>{this.updatingHandles.addPromise(this._updateHighlightedFeaturesSymbols(e).catch(()=>{})),this.updateHighlightedFeatures(this._highlightGeometriesResolution)};this.addHandles([(0,J.on)(()=>this.highlightGraphics,"change",e=>r(e.added),{onListenerAdd:e=>r(e)})])}fetchPopupFeatures(r,e){var n=this;return(0,E.Z)(function*(){const{layerView:{layer:i,view:{scale:o}}}=n;if(!r)throw new v.Z("fetchPopupFeatures:invalid-area","Nothing to fetch without area",{layer:i});const s=function Ze(r,e,n){const i=[];if(!r)return i;const o=s=>{if(s.visible&&(0===s.minScale||e<=s.minScale)&&(0===s.maxScale||e>=s.maxScale))if(s.sublayers)s.sublayers.forEach(o);else if(s.popupEnabled){const y=(0,ue.V5)(s,{...n,defaultPopupTemplateEnabled:!1});null!=y&&i.unshift({sublayer:s,popupTemplate:y})}};return r.map(o),i}(i.sublayers,o,e);if(!s.length)return[];const u=yield function Ge(r,e){return te.apply(this,arguments)}(i,s);if(!((i.capabilities?.operations?.supportsIdentify??1)&&i.version>=10.5||u))throw new v.Z("fetchPopupFeatures:not-supported","query operation is disabled for this service",{layer:i});return u?n._fetchPopupFeaturesUsingQueries(r,s,e):n._fetchPopupFeaturesUsingIdentify(r,s,e)})()}clearHighlights(){this.highlightGraphics?.removeAll()}highlight(r){const e=this.highlightGraphics;if(!e)return(0,I.kB)();let n=null;if(r instanceof N.Z?n=[r]:O.Z.isCollection(r)&&r.length>0?n=r.toArray():Array.isArray(r)&&r.length>0&&(n=r),n=n?.filter(C.pC),!n?.length)return(0,I.kB)();for(const i of n){const o=i.sourceLayer;null!=o&&"geometryType"in o&&"point"===o.geometryType&&(i.visible=!1)}return e.addMany(n),(0,I.kB)(()=>e.removeMany(n??[]))}_updateHighlightedFeaturesSymbols(r){var e=this;return(0,E.Z)(function*(){const{layerView:{view:n},highlightGraphics:i,highlightGraphicUpdated:o}=e;if(i&&o)for(const s of r){const u=s.sourceLayer&&"renderer"in s.sourceLayer&&s.sourceLayer.renderer;s.sourceLayer&&"geometryType"in s.sourceLayer&&"point"===s.sourceLayer.geometryType&&u&&"getSymbolAsync"in u&&u.getSymbolAsync(s).then(function(){var S=(0,E.Z)(function*(y){y||=new ae.Z;let f=null;const h="visualVariables"in u?u.visualVariables?.find(c=>"size"===c.type):void 0;h&&(ee||(ee=(yield Promise.resolve().then(l.bind(l,37157))).getSize),f=ee(h,s,{view:n.type,scale:n.scale,shape:"simple-marker"===y.type?y.style:null})),f||="width"in y&&"height"in y&&null!=y.width&&null!=y.height?Math.max(y.width,y.height):"size"in y?y.size:16,i.includes(s)&&(s.symbol=new ae.Z({style:"square",size:f,xoffset:"xoffset"in y?y.xoffset:0,yoffset:"yoffset"in y?y.yoffset:0}),o(s,"symbol"),s.visible=!0)});return function(y){return S.apply(this,arguments)}}())}})()}_updateHighlightedFeaturesGeometries(r){var e=this;return(0,E.Z)(function*(){const{layerView:{layer:n,view:i},highlightGraphics:o,highlightGraphicUpdated:s}=e;if(e._highlightGeometriesResolution=r,!s||!o?.length||!n.capabilities.operations.supportsQuery)return;const u=e._getTargetResolution(r),S=new Map;for(const h of o)(!e._featuresResolutions.has(h)||e._featuresResolutions.get(h)>u)&&(0,d.s1)(S,h.sourceLayer,()=>new Map).set(h.getObjectId(),h);const y=Array.from(S,([h,c])=>{const g=h.createQuery();return g.objectIds=[...c.keys()],g.outFields=[h.objectIdField],g.returnGeometry=!0,g.maxAllowableOffset=u,g.outSpatialReference=i.spatialReference,h.queryFeatures(g)}),f=yield Promise.all(y);if(!e.destroyed)for(const{features:h}of f)for(const c of h){const w=S.get(c.sourceLayer).get(c.getObjectId());w&&o.includes(w)&&(w.geometry=c.geometry,s(w,"geometry"),e._featuresResolutions.set(w,u))}})()}_getTargetResolution(r){const e=r*(0,z.c9)(this.layerView.view.spatialReference),n=e/16;return n<=10?0:r/e*n}_fetchPopupFeaturesUsingIdentify(r,e,n){var i=this;return(0,E.Z)(function*(){const o=yield i._createIdentifyParameters(r,e,n);if(null==o)return[];const{results:s}=yield function Pe(r,e,n){return _.apply(this,arguments)}(i.layerView.layer.parsedUrl,o);return s.map(u=>u.feature)})()}_createIdentifyParameters(r,e,n){var i=this;return(0,E.Z)(function*(){const{floors:o,layer:s,timeExtent:u,view:{spatialReference:S,scale:y}}=i.layerView,f=null!=n?n.event:null;if(!e.length)return null;yield Promise.all(e.map(({sublayer:M})=>M.load().catch(()=>{})));const h=Math.min((0,m.Z)("mapservice-popup-identify-max-tolerance"),s.allSublayers.reduce((M,U)=>U.renderer?ie({renderer:U.renderer,event:f}):M,2)),c=i.createFetchPopupFeaturesQueryGeometry(r,h),g=(0,D.dp)(y,S),w=Math.round(c.width/g),x=new H.Z({xmin:c.center.x-g*w,ymin:c.center.y-g*w,xmax:c.center.x+g*w,ymax:c.center.y+g*w,spatialReference:c.spatialReference});return new le({floors:o,gdbVersion:"gdbVersion"in s?s.gdbVersion:void 0,geometry:r,height:w,layerOption:"popup",mapExtent:x,returnGeometry:!0,spatialReference:S,sublayers:s.sublayers,timeExtent:u,tolerance:h,width:w})})()}_fetchPopupFeaturesUsingQueries(r,e,n){var i=this;return(0,E.Z)(function*(){const{layerView:{floors:o,timeExtent:s}}=i,u=null!=n?n.event:null,S=e.map(function(){var y=(0,E.Z)(function*({sublayer:f,popupTemplate:h}){if(yield f.load().catch(()=>{}),f.capabilities&&!f.capabilities.operations.supportsQuery)return[];const c=f.createQuery(),g=ie({renderer:f.renderer,event:u}),w=i.createFetchPopupFeaturesQueryGeometry(r,g),x=new Set,[M]=yield Promise.all([(0,ue.e7)(f,h),f.renderer?.collectRequiredFields(x,f.fieldsIndex)]);(0,pe.gd)(x,f.fieldsIndex,M);const U=Array.from(x).sort();if(c.geometry=w,c.outFields=U,c.timeExtent=s,o){const P=o.clone(),A=(0,X.f)(P,f);null!=A&&(c.where=c.where?`(${c.where}) AND (${A})`:A)}const F=i._getTargetResolution(w.width/g),V=yield function Ae(r){return r.expressionInfos?.length||Array.isArray(r.content)&&r.content.some(e=>"expression"===e.type)?(0,Me.LC)():Promise.resolve()}(h),B="point"===f.geometryType||V&&V.arcadeUtils.hasGeometryOperations(h);B||(c.maxAllowableOffset=F);let{features:L}=yield f.queryFeatures(c);const K=B?0:F;L=yield function Te(r,e){return re.apply(this,arguments)}(f,L);for(const P of L)i._featuresResolutions.set(P,K);return L});return function(f){return y.apply(this,arguments)}}());return(yield Promise.allSettled(S)).reduce((y,f)=>"fulfilled"===f.status?[...y,...f.value]:y,[]).filter(C.pC)})()}};function te(){return(te=(0,E.Z)(function*(r,e){if(r.capabilities?.operations?.supportsQuery)return!0;try{return yield Promise.any(e.map(({sublayer:n})=>n.load().then(()=>n.capabilities.operations.supportsQuery)))}catch{return!1}})).apply(this,arguments)}function re(){return(re=(0,E.Z)(function*(r,e){const n=r.renderer;return n&&"defaultSymbol"in n&&!n.defaultSymbol&&(e=n.valueExpression?yield Promise.all(e.map(i=>n.getSymbolAsync(i).then(o=>o?i:null))).then(i=>i.filter(o=>null!=o)):e.filter(i=>null!=n.getSymbol(i))),e})).apply(this,arguments)}(0,a._)([(0,p.Cb)({constructOnly:!0})],G.prototype,"createFetchPopupFeaturesQueryGeometry",void 0),(0,a._)([(0,p.Cb)({constructOnly:!0})],G.prototype,"layerView",void 0),(0,a._)([(0,p.Cb)({constructOnly:!0})],G.prototype,"highlightGraphics",void 0),(0,a._)([(0,p.Cb)({constructOnly:!0})],G.prototype,"highlightGraphicUpdated",void 0),(0,a._)([(0,p.Cb)({constructOnly:!0})],G.prototype,"updatingHandles",void 0),G=(0,a._)([(0,$.j)("esri.views.layers.support.MapService")],G)},9171:(W,T,l)=>{l.d(T,{K:()=>R}),l(2189);var a=l(49602),N=l(26894);function R(v,I,m,d=new N.Z){let j=0;if("2d"===m.type)j=I*(m.resolution??0);else if("3d"===m.type){const H=m.overlayPixelSizeInMapUnits(v),D=m.basemapSpatialReference;j=null==D||D.equals(m.spatialReference)?I*H:(0,a.c9)(D)/(0,a.c9)(m.spatialReference)}const J=v.x-j,z=v.y-j,p=v.x+j,Q=v.y+j,{spatialReference:$}=m;return d.xmin=Math.min(J,p),d.ymin=Math.min(z,Q),d.xmax=Math.max(J,p),d.ymax=Math.max(z,Q),d.spatialReference=$,d}new N.Z}}]);