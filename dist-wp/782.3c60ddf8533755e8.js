"use strict";(self.webpackChunkangular_17_test=self.webpackChunkangular_17_test||[]).push([[782,5251],{50782:(_,M,s)=>{s.r(M),s.d(M,{default:()=>G});var h=s(15861),d=s(50484),A=s(5603),g=s(30352),D=s(4703),P=s(3233),U=s(79412),c=s(77675),y=s(80543),C=(s(1535),s(57678),s(14007),s(49301)),x=s(62185),Z=s(10141),S=s(7547),T=s(60301),R=s(95060),B=s(19855),r=s(80099),t=s(70509),n=s(29717),o=s(79936),a=s(27835),b=s(41528),v=s(95140),O=s(16031);const f=Symbol("WebScene");var l=s(84735),F=s(46018),V=s(5538);let p=class extends((0,B.h)((0,n.M)((0,r.q)((0,t.I)((0,O.Q)((0,v.K)((0,P.R)(R.Z)))))))){constructor(e){var i;super(e),i=this,this.allLayers=new A.Z({getCollections:()=>[this.layers],getChildrenFunction:u=>"layers"in u?u.layers:null}),this.allTables=(0,b.a)(this),this.fullExtent=void 0,this.operationalLayerType="GroupLayer",this.spatialReference=void 0,this.type="group",this._debouncedSaveOperations=(0,U.Ds)(function(){var u=(0,h.Z)(function*(m,I,K){const{save:W,saveAs:w}=yield Promise.all([s.e(8592),s.e(1219)]).then(s.bind(s,90254));switch(m){case l.x.SAVE:return W(i,I);case l.x.SAVE_AS:return w(i,K,I)}});return function(m,I,K){return u.apply(this,arguments)}}())}initialize(){this._enforceVisibility(this.visibilityMode,this.visible),this.addHandles([(0,c.YP)(()=>{let e=this.parent;for(;e&&"parent"in e&&e.parent;)e=e.parent;return e&&f in e},e=>{const i="prevent-adding-tables";this.removeHandles(i),e&&(this.tables.removeAll(),this.addHandles((0,c.on)(()=>this.tables,"before-add",u=>{u.preventDefault(),D.Z.getLogger(this).errorOnce("tables","tables in group layers in a webscene are not supported. Please move the tables from the group layer to the webscene if you want to persist them.")}),i))},c.tX),(0,c.YP)(()=>this.visible,this._onVisibilityChange.bind(this),c.Z_)])}destroy(){this.allLayers.destroy(),this.allTables.destroy()}get sourceIsPortalItem(){return this.portalItem&&this.originIdOf("portalItem")===T.s3.USER}_writeLayers(e,i,u,m){const I=[];if(!e)return I;e.forEach(K=>{const W=(0,V.Nw)(K,m.webmap?m.webmap.getLayerJSONFromResourceInfo(K):null,m);W?.layerType&&I.push(W)}),i.layers=I}set portalItem(e){this._set("portalItem",e)}readPortalItem(e,i,u){const{itemId:m,layerType:I}=i;if("GroupLayer"===I&&m)return new a.default({id:m,portal:u?.portal})}writePortalItem(e,i){e?.id&&(i.itemId=e.id)}set visibilityMode(e){const i=this._get("visibilityMode")!==e;this._set("visibilityMode",e),i&&this._enforceVisibility(e,this.visible)}beforeSave(){var e=this;return(0,h.Z)(function*(){return(0,F.Pl)(e)})()}load(e){const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Group Layer","Scene Service"],layerModuleTypeMap:o.T},e).catch(u=>{if((0,U.r9)(u),this.sourceIsPortalItem)throw u});return this.addResolvingPromise(i),Promise.resolve(this)}loadAll(){var e=this;return(0,h.Z)(function*(){return(0,g.G)(e,i=>{i(e.layers,e.tables)})})()}save(e){var i=this;return(0,h.Z)(function*(){return i._debouncedSaveOperations(l.x.SAVE,e)})()}saveAs(e,i){var u=this;return(0,h.Z)(function*(){return u._debouncedSaveOperations(l.x.SAVE_AS,i,e)})()}layerAdded(e){e.visible&&"exclusive"===this.visibilityMode?this._turnOffOtherLayers(e):"inherited"===this.visibilityMode&&(e.visible=this.visible),this.hasHandles(e.uid)?console.error(`Layer readded to Grouplayer: uid=${e.uid}`):this.addHandles((0,c.YP)(()=>e.visible,i=>this._onChildVisibilityChange(e,i),c.Z_),e.uid)}layerRemoved(e){this.removeHandles(e.uid),this._enforceVisibility(this.visibilityMode,this.visible)}_turnOffOtherLayers(e){this.layers.forEach(i=>{i!==e&&(i.visible=!1)})}_enforceVisibility(e,i){if(!(0,C.vw)(this).initialized)return;const u=this.layers;let m=u.find(I=>I.visible);switch(e){case"exclusive":u.length&&!m&&(m=u.at(0),m.visible=!0),this._turnOffOtherLayers(m);break;case"inherited":u.forEach(I=>{I.visible=i})}}_onVisibilityChange(e){"inherited"===this.visibilityMode&&this.layers.forEach(i=>{i.visible=e})}_onChildVisibilityChange(e,i){switch(this.visibilityMode){case"exclusive":i?this._turnOffOtherLayers(e):this._isAnyLayerVisible()||(e.visible=!0);break;case"inherited":e.visible=this.visible}}_isAnyLayerVisible(){return this.layers.some(e=>e.visible)}};(0,d._)([(0,y.Cb)({readOnly:!0,dependsOn:[]})],p.prototype,"allLayers",void 0),(0,d._)([(0,y.Cb)({readOnly:!0})],p.prototype,"allTables",void 0),(0,d._)([(0,y.Cb)({json:{read:!0,write:!0}})],p.prototype,"blendMode",void 0),(0,d._)([(0,y.Cb)()],p.prototype,"fullExtent",void 0),(0,d._)([(0,y.Cb)({readOnly:!0})],p.prototype,"sourceIsPortalItem",null),(0,d._)([(0,y.Cb)({json:{read:!1,write:{ignoreOrigin:!0}}})],p.prototype,"layers",void 0),(0,d._)([(0,S.c)("layers")],p.prototype,"_writeLayers",null),(0,d._)([(0,y.Cb)({type:["GroupLayer"]})],p.prototype,"operationalLayerType",void 0),(0,d._)([(0,y.Cb)({json:{origins:{"web-map":{read:!1,write:{overridePolicy(e,i,u){return{enabled:"Group Layer"===e?.type&&u?.initiator!==this}}}},"web-scene":{read:!1,write:!1}}}})],p.prototype,"portalItem",null),(0,d._)([(0,x.r)("web-map","portalItem",["itemId"])],p.prototype,"readPortalItem",null),(0,d._)([(0,S.c)("web-map","portalItem",{itemId:{type:String}})],p.prototype,"writePortalItem",null),(0,d._)([(0,y.Cb)()],p.prototype,"spatialReference",void 0),(0,d._)([(0,y.Cb)({json:{read:!1},readOnly:!0,value:"group"})],p.prototype,"type",void 0),(0,d._)([(0,y.Cb)({type:["independent","inherited","exclusive"],value:"independent",json:{write:!0,origins:{"web-map":{type:["independent","exclusive"],write:(e,i,u)=>{"inherited"!==e&&(i[u]=e)}}}}})],p.prototype,"visibilityMode",null),p=(0,d._)([(0,Z.j)("esri.layers.GroupLayer")],p);const G=p},5251:(_,M,s)=>{s.r(M),s.d(M,{addOrUpdateResource:()=>U,contentToBlob:()=>S,fetchResources:()=>D,getSiblingOfSameType:()=>R,getSiblingOfSameTypeI:()=>B,removeAllResources:()=>j,removeResource:()=>y,splitPrefixFileNameAndExtension:()=>x});var h=s(15861),d=s(66476),A=s(57964),g=s(6785);function D(r){return P.apply(this,arguments)}function P(){return(P=(0,h.Z)(function*(r,t={},n){yield r.load(n);const o=(0,g.v_)(r.itemUrl,"resources"),{start:a=1,num:b=10,sortOrder:v="asc",sortField:O="created"}=t,f={query:{start:a,num:b,sortOrder:v,sortField:O,token:r.apiKey},signal:n?.signal},l=yield r.portal.request(o,f);return{total:l.total,nextStart:l.nextStart,resources:l.resources.map(({created:F,size:V,resource:p})=>({created:new Date(F),size:V,resource:r.resourceFromPath(p)}))}})).apply(this,arguments)}function U(r,t,n,o){return c.apply(this,arguments)}function c(){return(c=(0,h.Z)(function*(r,t,n,o){if(!r.hasPath())throw new A.Z(`portal-item-resource-${t}:invalid-path`,"Resource does not have a valid path");const a=r.portalItem;yield a.load(o);const b=(0,g.v_)(a.userItemUrl,"add"===t?"addResources":"updateResources"),[v,O]=C(r.path),f=new FormData;return v&&"."!==v&&f.append("resourcesPrefix",v),null!=o&&o.compress&&f.append("compress","true"),f.append("fileName",O),f.append("file",n,O),f.append("f","json"),o?.access&&f.append("access",o.access),yield a.portal.request(b,{method:"post",body:f,signal:o?.signal}),r})).apply(this,arguments)}function y(r,t,n){return E.apply(this,arguments)}function E(){return(E=(0,h.Z)(function*(r,t,n){if(!t.hasPath())throw new A.Z("portal-item-resources-remove:invalid-path","Resource does not have a valid path");yield r.load(n);const o=(0,g.v_)(r.userItemUrl,"removeResources");yield r.portal.request(o,{method:"post",query:{resource:t.path},signal:n?.signal}),t.portalItem=null})).apply(this,arguments)}function j(r,t){return L.apply(this,arguments)}function L(){return(L=(0,h.Z)(function*(r,t){yield r.load(t);const n=(0,g.v_)(r.userItemUrl,"removeResources");return r.portal.request(n,{method:"post",query:{deleteAll:!0},signal:t?.signal})})).apply(this,arguments)}function C(r){const t=r.lastIndexOf("/");return-1===t?[".",r]:[r.slice(0,t),r.slice(t+1)]}function x(r){const[t,n]=function Z(r){const t=(0,g.Ml)(r);return null==t?[r,""]:[r.slice(0,r.length-t.length-1),`.${t}`]}(r),[o,a]=C(t);return[o,a,n]}function S(r){return T.apply(this,arguments)}function T(){return(T=(0,h.Z)(function*(r){return"blob"===r.type?r.blob:"json"===r.type?new Blob([r.jsonString],{type:"application/json"}):(yield(0,d.Z)(r.url,{responseType:"blob"})).data})).apply(this,arguments)}function R(r,t){if(!r.hasPath())return null;const[n,,o]=x(r.path);return r.portalItem.resourceFromPath((0,g.v_)(n,t+o))}function B(r,t){if(!r.hasPath())return null;const[n,,o]=x(r.path);return r.portalItem.resourceFromPath((0,g.v_)(n,t+o))}},46018:(_,M,s)=>{s.d(M,{Hn:()=>U,Pl:()=>B,bx:()=>y});var h=s(15861),d=s(37636),A=s(57964),g=s(79412),D=s(19986),P=s(5251);function U(t,n){return c.apply(this,arguments)}function c(){return(c=(0,h.Z)(function*(t,n,o=null){const a=yield j(t,n,o);yield C(a,n,o)})).apply(this,arguments)}function y(t,n,o,a){return E.apply(this,arguments)}function E(){return(E=(0,h.Z)(function*(t,n,o,a,b=null){const v=yield j(o,a,b);yield t.update({data:n}),yield C(v,a,b)})).apply(this,arguments)}function j(t,n){return L.apply(this,arguments)}function L(){return(L=(0,h.Z)(function*(t,n,o=null){if(!n?.resources)return;const a=n.portalItem===t.portalItem?new Set(t.paths):new Set;t.paths.length=0,t.portalItem=n.portalItem;const b=new Set(n.resources.toKeep.map(l=>l.resource.path)),v=new Set,O=[];b.forEach(l=>{a.delete(l),t.paths.push(l)});for(const l of n.resources.toUpdate)if(a.delete(l.resource.path),b.has(l.resource.path)||v.has(l.resource.path)){const{resource:F,content:V,finish:p,error:G}=l,e=(0,P.getSiblingOfSameTypeI)(F,(0,D.DO)());t.paths.push(e.path),O.push(Z({resource:e,content:V,compress:l.compress,finish:p,error:G},o))}else t.paths.push(l.resource.path),O.push(T(l,o)),v.add(l.resource.path);for(const l of n.resources.toAdd)t.paths.push(l.resource.path),a.has(l.resource.path)?a.delete(l.resource.path):O.push(Z(l,o));if(0===O.length)return a;const f=yield(0,g.UO)(O);if((0,g.k_)(o),f.length>0)throw new A.Z("save:resources","Failed to save one or more resources",{errors:f});return a})).apply(this,arguments)}function C(t,n){return x.apply(this,arguments)}function x(){return(x=(0,h.Z)(function*(t,n,o=null){if(!t||!n.portalItem)return;const a=[];for(const b of t){const v=n.portalItem.resourceFromPath(b);a.push(v.portalItem.removeResource(v,o))}yield(0,g.as)(a)})).apply(this,arguments)}function Z(t,n){return S.apply(this,arguments)}function S(){return(S=(0,h.Z)(function*(t,n){const o={...n??{},compress:t.compress},a=yield(0,d.q6)(t.resource.portalItem.addResource(t.resource,yield(0,P.contentToBlob)(t.content),o));if(!0!==a.ok)throw t.error?.(a.error),a.error;t.finish?.(t.resource)})).apply(this,arguments)}function T(t,n){return R.apply(this,arguments)}function R(){return(R=(0,h.Z)(function*(t,n){const o=yield(0,d.q6)(t.resource.update(yield(0,P.contentToBlob)(t.content),n));if(!0!==o.ok)throw t.error?.(o.error),o.error;t.finish?.(t.resource)})).apply(this,arguments)}function B(t){return r.apply(this,arguments)}function r(){return(r=(0,h.Z)(function*(t){const n=[];for(const o of t.allLayers)if("beforeSave"in o&&"function"==typeof o.beforeSave){const a=o.beforeSave();a&&n.push(a)}yield Promise.allSettled(n)})).apply(this,arguments)}}}]);