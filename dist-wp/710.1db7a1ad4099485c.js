"use strict";(self.webpackChunkangular_17_test=self.webpackChunkangular_17_test||[]).push([[710],{32455:(ne,q,h)=>{h.d(q,{Z:()=>z});var S=h(15861);class z{constructor(){this.declaredRootClass="esri.arcade.featureSetCollection",this._layerById={},this._layerByName={}}add(O,A,M){this._layerById[A]=M,this._layerByName[O]=M}featureSetByName(O,A=!0,M=["*"]){var L=this;return(0,S.Z)(function*(){return void 0===L._layerByName[O]?null:L._layerByName[O]})()}featureSetById(O,A=!0,M=["*"]){var L=this;return(0,S.Z)(function*(){return void 0===L._layerById[O]?null:L._layerById[O]})()}castToText(O=!1){return"object, FeatureSetCollection"}}},20710:(ne,q,h)=>{h.r(q),h.d(q,{constructAssociationMetaDataFeatureSetFromUrl:()=>qe,constructFeatureSet:()=>re,constructFeatureSetFromPortalItem:()=>nt,constructFeatureSetFromRelationship:()=>Xe,constructFeatureSetFromUrl:()=>me,convertToFeatureSet:()=>rt,createFeatureSetCollectionFromMap:()=>et,createFeatureSetCollectionFromService:()=>tt,initialiseMetaDataCache:()=>Je});var S=h(15861),z=h(66476),Q=h(32455),O=h(89018),A=h(52034),M=h(35458),L=h(94511),b=h(11375),F=h(70930),x=h(95418),Z=h(58446),v=h(25677),m=h(76961),T=h(77023),N=h(80389),p=h(85904);class D{constructor(){this.field="",this.tofieldname="",this.typeofstat="MIN",this.workingexpr=null}clone(){const e=new D;return e.field=this.field,e.tofieldname=this.tofieldname,e.typeofstat=this.typeofstat,e.workingexpr=this.workingexpr,e}static parseStatField(e,t,r,n){const l=new D;l.field=e;const s=p.WhereClause.create(t,r,n),c=function E(w){if("function"===w.parseTree.type){if(0===w.parseTree.args.value.length)return{name:w.parseTree.name,expr:null};if(w.parseTree.args.value.length>1)throw new F.eS(F.f.MissingStatisticParameters);const e=p.WhereClause.create((0,T.XF)(w.parseTree.args.value[0],m.Bj.Standardised,w.parameters),w.fieldsIndex,w.timeZone);return{name:w.parseTree.name,expr:e}}return null}(s);if(null===c)throw new F.eS(F.f.UnsupportedSqlFunction,{function:""});const i=c.name.toUpperCase().trim();if("MIN"===i){if(l.typeofstat="MIN",l.workingexpr=c.expr,null===s)throw new F.eS(F.f.InvalidFunctionParameters,{function:"min"})}else if("MAX"===i){if(l.typeofstat="MAX",l.workingexpr=c.expr,null===s)throw new F.eS(F.f.InvalidFunctionParameters,{function:"max"})}else if("COUNT"===i)l.typeofstat="COUNT",l.workingexpr=c.expr;else if("STDEV"===i){if(l.typeofstat="STDDEV",l.workingexpr=c.expr,null===s)throw new F.eS(F.f.InvalidFunctionParameters,{function:"stdev"})}else if("SUM"===i){if(l.typeofstat="SUM",l.workingexpr=c.expr,null===s)throw new F.eS(F.f.InvalidFunctionParameters,{function:"sum"})}else if("MEAN"===i){if(l.typeofstat="AVG",l.workingexpr=c.expr,null===s)throw new F.eS(F.f.InvalidFunctionParameters,{function:i})}else if("AVG"===i){if(l.typeofstat="AVG",l.workingexpr=c.expr,null===s)throw new F.eS(F.f.InvalidFunctionParameters,{function:"avg"})}else{if("VAR"!==i)throw new F.eS(F.f.UnsupportedSqlFunction,{function:i});if(l.typeofstat="VAR",l.workingexpr=c.expr,null===s)throw new F.eS(F.f.InvalidFunctionParameters,{function:"var"})}return l}toStatisticsName(){switch(this.typeofstat.toUpperCase()){case"MIN":return"min";case"MAX":return"max";case"SUM":return"sum";case"COUNT":default:return"count";case"VAR":return"var";case"STDDEV":return"stddev";case"AVG":return"avg"}}}var I=h(19799),d=h(88781),y=h(80458),u=h(81429),g=h(43814),_=h(81247),j=h(40100);function k(w){if(!w)return"COUNT";switch(w.toLowerCase()){case"max":return"MAX";case"var":case"variance":return"VAR";case"avg":case"average":case"mean":return"AVG";case"min":return"MIN";case"sum":return"SUM";case"stdev":case"stddev":return"STDDEV";case"count":return"COUNT"}return"COUNT"}class K extends x.Z{constructor(e){super(e),this._decodedStatsfield=[],this._decodedGroupbyfield=[],this._candosimplegroupby=!0,this.phsyicalgroupbyfields=[],this.objectIdField="ROW__ID",this._internalObjectIdField="ROW__ID",this._adaptedFields=[],this.declaredClass="esri.arcade.featureset.actions.Aggregate",this._uniqueIds=1,this._maxQuery=10,this._maxProcessing=10,this._parent=e.parentfeatureset,this._config=e}isTable(){return!0}_getSet(e){var t=this;return(0,S.Z)(function*(){if(null===t._wset){const r=yield t._getFilteredSet("",null,null,null,e);return t._wset=r,t._wset}return t._wset})()}_isInFeatureSet(){return m.dj.InFeatureSet}_nextUniqueName(e){for(;1===e["T"+this._uniqueIds.toString()];)this._uniqueIds++;const t="T"+this._uniqueIds.toString();return e[t]=1,t}_convertToEsriFieldType(e){return e}_initialiseFeatureSet(){const e={};let t=!1,r=1;const n=this._parent?this._parent.getFieldsIndex():new j.Z([]);for(this.objectIdField="ROW__ID",this.globalIdField="";!1===t;){let s=!1;for(let c=0;c<this._config.groupbyfields.length;c++)if(this._config.groupbyfields[c].name.toLowerCase()===this.objectIdField.toLowerCase()){s=!0;break}if(!1===s)for(let c=0;c<this._config.statsfields.length;c++)if(this._config.statsfields[c].name.toLowerCase()===this.objectIdField.toLowerCase()){s=!0;break}!1===s?t=!0:(this.objectIdField="ROW__ID"+r.toString(),r++)}for(const s of this._config.statsfields){const c=new D;c.field=s.name,c.tofieldname=s.name,c.workingexpr=s.expression instanceof p.WhereClause?s.expression:p.WhereClause.create(s.expression,n,this.dateFieldsTimeZoneDefaultUTC),c.typeofstat=k(s.statistic),this._decodedStatsfield.push(c)}this._decodedGroupbyfield=[];for(const s of this._config.groupbyfields){const c={name:s.name,singlefield:null,tofieldname:s.name,expression:s.expression instanceof p.WhereClause?s.expression:p.WhereClause.create(s.expression,n,this.dateFieldsTimeZoneDefaultUTC),sqlType:null};this._decodedGroupbyfield.push(c)}if(null!==this._parent){this.geometryType=this._parent.geometryType,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField="";for(const s of this._parent.fields)e[s.name.toUpperCase()]=1;this.types=null}else this.geometryType=m.Qk.point,this.typeIdField="",this.types=null,this.spatialReference=new g.Z({wkid:4326});this.fields=[];const l=new D;l.field=this._nextUniqueName(e),l.tofieldname=this.objectIdField,l.workingexpr=p.WhereClause.create(this._parent.objectIdField,this._parent.getFieldsIndex(),this.dateFieldsTimeZoneDefaultUTC),l.typeofstat="MIN",this._decodedStatsfield.push(l);for(const s of this._decodedGroupbyfield){const c=new _.Z;if(s.name=this._nextUniqueName(e),c.name=s.tofieldname,c.alias=c.name,(0,T.y5)(s.expression)){const i=this._parent.getField((0,T.zR)(s.expression,m.Bj.Standardised));if(!i)throw new F.EN(F.H9.AggregationFieldNotFound);s.name=i.name,s.singlefield=i.name,this.phsyicalgroupbyfields.push(i.name),c.type=i.type,s.sqlType=i.type}else{c.type=this._convertToEsriFieldType((0,T.DT)(s.expression,this._parent.fields));const i=new _.Z;i.name=s.name,i.alias=i.name,this.phsyicalgroupbyfields.push(s.name),this._adaptedFields.push(new L.yN(i,s.expression)),this._candosimplegroupby=!1,s.sqlType=c.type}this.fields.push(c)}if(this._adaptedFields.length>0)for(const s of this._parent.fields)this._adaptedFields.push(new L.$X(s));for(let s=0;s<this._decodedStatsfield.length;s++){const c=new _.Z;let i=null;const f=this._decodedStatsfield[s];f.field=this._nextUniqueName(e),f.tofieldname===this.objectIdField&&(this._internalObjectIdField=f.field),c.name=f.tofieldname,c.alias=c.name;const C=null!==f.workingexpr&&(0,T.y5)(f.workingexpr)?(0,T.zR)(f.workingexpr,m.Bj.Standardised):"";switch(this._decodedStatsfield[s].typeofstat){case"SUM":if(""!==C){if(i=this._parent.getField(C),!i)throw new F.EN(F.H9.AggregationFieldNotFound);c.type=i.type}else c.type="double";break;case"MIN":case"MAX":if(""!==C){if(i=this._parent.getField(C),!i)throw new F.EN(F.H9.AggregationFieldNotFound);c.type=i.type}else c.type="double";break;case"COUNT":c.type="integer";break;case"STDDEV":case"VAR":case"AVG":if(""!==C&&(i=this._parent.getField(C),!i))throw new F.EN(F.H9.AggregationFieldNotFound);c.type="double"}this.fields.push(c)}}_canDoAggregates(){return(0,S.Z)(function*(){return!1})()}_getFeatures(e,t,r,n){var l=this;return(0,S.Z)(function*(){const s=l._maxQuery;return!0===l._checkIfNeedToExpandKnownPage(e,s)?(yield l._expandPagedSet(e,s,0,0,n),l._getFeatures(e,t,r,n)):"success"})()}_getFilteredSet(e,t,r,n,l){var s=this;return(0,S.Z)(function*(){if(""!==e)return new Z.Z([],[],!0,null);let c=null;const i={ordered:!1,nowhereclause:!1};if(yield s._ensureLoaded(),null!==r)for(let C=0;C<s._decodedStatsfield.length;C++)if(!0===(0,T.hq)(r,s._decodedStatsfield[C].tofieldname)){i.nowhereclause=!0,r=null;break}if(null!==n){i.ordered=!0;for(let C=0;C<s._decodedStatsfield.length;C++)if(!0===n.scanForField(s._decodedStatsfield[C].tofieldname)){n=null,i.ordered=!1;break}if(null!==n)for(const C of s._decodedGroupbyfield)if(null===C.singlefield&&!0===n.scanForField(C.tofieldname)){n=null,i.ordered=!1;break}}if(!1!==s._candosimplegroupby&&(yield s._parent._canDoAggregates(s.phsyicalgroupbyfields,s._decodedStatsfield,"",null,null))){let C=null;r&&(C=s._reformulateWhereClauseWithoutGroupByFields(r));let P=null;n&&(P=s._reformulateOrderClauseWithoutGroupByFields(n));const U=yield s._parent._getAggregatePagesDataSourceDefinition(s.phsyicalgroupbyfields,s._decodedStatsfield,"",null,C,P,s._internalObjectIdField);return s._checkCancelled(l),c=!0===i.nowhereclause?new Z.Z(U._candidates.slice(0).concat(U._known.slice(0)),[],!0===i.ordered&&U._ordered,s._clonePageDefinition(U.pagesDefinition)):new Z.Z(U._candidates.slice(0),U._known.slice(0),!0===i.ordered&&U._ordered,s._clonePageDefinition(U.pagesDefinition)),c}let f=s._parent;if(s._adaptedFields.length>0&&(f=new L.Xx({parentfeatureset:s._parent,adaptedFields:s._adaptedFields,extraFilter:null})),!0===i.nowhereclause)c=new Z.Z(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:s._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new b.Z({parentfeatureset:f,orderbyclause:new v.Z(s.phsyicalgroupbyfields.join(",")+","+s._parent.objectIdField+" ASC")})}});else{let C=f;if(null!==r){let P=null;r&&(P=s._reformulateWhereClauseWithoutGroupByFields(r)),C=new A.Z({parentfeatureset:C,whereclause:P})}c=new Z.Z(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:s._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new b.Z({parentfeatureset:C,orderbyclause:new v.Z(s.phsyicalgroupbyfields.join(",")+","+s._parent.objectIdField+" ASC")})}})}return c})()}_reformulateWhereClauseWithoutStatsFields(e){for(const t of this._decodedStatsfield)e=(0,T.bB)(e,t.tofieldname,(0,T.zR)(t.workingexpr,m.Bj.Standardised),this._parent.getFieldsIndex());return e}_reformulateWhereClauseWithoutGroupByFields(e){for(const t of this._decodedGroupbyfield)t.tofieldname!==t.name&&(e=(0,T.bB)(e,t.tofieldname,(0,T.zR)(t.expression,m.Bj.Standardised),this._parent.getFieldsIndex()));return e}_reformulateOrderClauseWithoutGroupByFields(e){const t=[];for(const r of this._decodedGroupbyfield)r.tofieldname!==r.name&&t.push({field:r.tofieldname,newfield:r.name});return t.length>0?e.replaceFields(t):e}_clonePageDefinition(e){return null===e?null:!0===e.aggregatefeaturesetpagedefinition?{aggregatefeaturesetpagedefinition:!0,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,internal:e.internal}:this._parent._clonePageDefinition(e)}_refineSetBlock(e,t,r){var n=this;return(0,S.Z)(function*(){return!0===n._checkIfNeedToExpandCandidatePage(e,n._maxQuery)?(yield n._expandPagedSet(e,n._maxQuery,0,0,r),n._refineSetBlock(e,t,r)):(n._checkCancelled(r),n._refineKnowns(e,t),e)})()}_expandPagedSet(e,t,r,n,l){return this._expandPagedSetFeatureSet(e,t,r,n,l)}_getPhysicalPage(e,t,r){var n=this;return(0,S.Z)(function*(){if(!0===e.pagesDefinition.aggregatefeaturesetpagedefinition)return n._sequentialGetPhysicalItem(e,e.pagesDefinition.resultRecordCount,r,[]);const l=yield n._getAgregagtePhysicalPage(e,t,r);for(const s of l){const c={geometry:s.geometry,attributes:{}},i={};for(const f in s.attributes)i[f.toLowerCase()]=s.attributes[f];for(const f of n._decodedGroupbyfield)c.attributes[f.tofieldname]=i[f.name.toLowerCase()];for(const f of n._decodedStatsfield)c.attributes[f.tofieldname]=i[f.field.toLowerCase()];n._featureCache[c.attributes[n.objectIdField]]=new M.Z(c)}return l.length})()}_sequentialGetPhysicalItem(e,t,r,n){return new Promise((l,s)=>{null===e.pagesDefinition.internal.iterator&&(e.pagesDefinition.internal.iterator=e.pagesDefinition.internal.subfeatureset.iterator(r)),!0===e.pagesDefinition.internal.fullyResolved||0===t?l(n.length):this._nextAggregateItem(e,t,r,n,c=>{l(null===c?n.length:this._sequentialGetPhysicalItem(e,t-=1,r,n))},s)})}_nextAggregateItem(e,t,r,n,l,s){try{(0,O.a1)(e.pagesDefinition.internal.iterator.next()).then(c=>{if(null===c)if(null!==e.pagesDefinition.internal.workingItem){const i=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);n.push(i),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(i.attributes[this.objectIdField]),e.pagesDefinition.internal.fullyResolved=!0,l(null)}else e.pagesDefinition.internal.fullyResolved=!0,l(null);else{const i=this._generateAggregateHash(c);if(null===e.pagesDefinition.internal.workingItem)e.pagesDefinition.internal.workingItem={features:[c],id:i};else{if(i!==e.pagesDefinition.internal.workingItem.id){const f=this._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);return n.push(f),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(f.attributes[this.objectIdField]),t-=1,e.pagesDefinition.internal.workingItem={features:[c],id:i},void l(f)}e.pagesDefinition.internal.workingItem.features.push(c)}this._nextAggregateItem(e,t,r,n,l,s)}},s)}catch(c){s(c)}}_calculateFieldStat(e,t,r){const n=[];for(let l=0;l<e.features.length;l++)if(null!==t.workingexpr){const s=t.workingexpr.calculateValue(e.features[l]);null!==s&&n.push(s instanceof d.u||s instanceof u.n?s.toNumber():s instanceof y.H?s.toMilliseconds():s)}else n.push(null);switch(t.typeofstat){case"MIN":r.attributes[t.tofieldname]=(0,N.tj)("min",n,-1);break;case"MAX":r.attributes[t.tofieldname]=(0,N.tj)("max",n,-1);break;case"SUM":r.attributes[t.tofieldname]=(0,N.tj)("sum",n,-1);break;case"COUNT":r.attributes[t.tofieldname]=n.length;break;case"VAR":r.attributes[t.tofieldname]=(0,N.tj)("var",n,-1);break;case"STDDEV":r.attributes[t.tofieldname]=(0,N.tj)("stddev",n,-1);break;case"AVG":r.attributes[t.tofieldname]=(0,N.tj)("avg",n,-1)}return!0}_calculateAndAppendAggregateItem(e){const t={attributes:{},geometry:null};for(const n of this._decodedGroupbyfield){const l=n.singlefield?e.features[0].attributes[n.singlefield]:p.WhereClause.convertValueToStorageFormat(n.expression.calculateValue(e.features[0]),n.sqlType);t.attributes[n.tofieldname]=l}for(const n of this._decodedStatsfield)this._calculateFieldStat(e,n,t);const r=[];for(let n=0;n<this._decodedStatsfield.length;n++)r.push(this._calculateFieldStat(e,this._decodedStatsfield[n],t));return this._featureCache[t.attributes[this.objectIdField]]=new M.Z({attributes:t.attributes,geometry:t.geometry}),t}_generateAggregateHash(e){let t="";for(const r of this._decodedGroupbyfield){const n=r.singlefield?e.attributes[r.singlefield]:r.expression.calculateValue(e);t+=null==n?":":":"+n.toString()}return(0,I.F)(t,I.M.String)}_stat(){return(0,S.Z)(function*(){return{calculated:!1}})()}getFeatureByObjectId(){return(0,S.Z)(function*(){return null})()}static registerAction(){x.Z._featuresetFunctions.groupby=function(e,t){return new K({parentfeatureset:this,groupbyfields:e,statsfields:t})}}}var W=h(15367),R=h(92224),B=h(26152),V=h(97973),oe=h(70430),ue=h(40637),ie=h(33721),te=h(90373),Pe=h(46663),Oe=h(57964),Ze=h(14007),Ae=h(79412),de=h(11642),Le=h(46054),he=h(46708),Ne=h(36026),je=h(93792),se=h(91866);function fe(){return fe=(0,S.Z)(function*(w,e,t,r){return function ke(w,e,t,r){return _e.apply(this,arguments)}(e,yield function Be(w,e,t,r){return pe.apply(this,arguments)}(w,e,t,r),t,r)}),fe.apply(this,arguments)}function pe(){return(pe=(0,S.Z)(function*(w,e,t,r){const n={...r},l=function Ge(w,e){let t=se.Z.from(w);t.sourceSpatialReference=t.sourceSpatialReference??e?.sourceSpatialReference??null,(e?.gdbVersion||e?.dynamicDataSource)&&(t=t===w?t.clone():t,t.gdbVersion=w.gdbVersion||e.gdbVersion,t.dynamicDataSource=w.dynamicDataSource?Le.n.from(w.dynamicDataSource):e.dynamicDataSource);const r=e?.infoFor3D;if(null!=r&&Te(w,r)){t=t===w?t.clone():t,t.formatOf3DObjects=null;const{supportedFormats:n,queryFormats:l}=r,s=(0,de.S0)("model/gltf-binary",n)??(0,de.Ow)("glb",n),c=(0,de.S0)("model/gltf+json",n)??(0,de.Ow)("gtlf",n);for(const i of l){if(i===s){t.formatOf3DObjects=i;break}i!==c||t.formatOf3DObjects||(t.formatOf3DObjects=i)}if(!t.formatOf3DObjects)throw new Oe.Z("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(null==t.outFields||!t.outFields.includes("*")){t=t===w?t.clone():t,null==t.outFields&&(t.outFields=[]);const{originX:i,originY:f,originZ:C,translationX:P,translationY:U,translationZ:G,scaleX:J,scaleY:X,scaleZ:Y,rotationX:ee,rotationY:H,rotationZ:le,rotationDeg:ae}=r.transformFieldRoles;t.outFields.push(i,f,C,P,U,G,J,X,Y,ee,H,le,ae)}}return t}(e,t),s=null!=e.outStatistics?.[0],c=(0,Ze.Z)("featurelayer-pbf-statistics"),i=!s||c;let f;if("pbf"===t?.format&&i)try{f=yield(0,Ne.t)(w,l,n)}catch(C){if("query:parsing-pbf"!==C.name)throw C;t.format="json"}return"json"!==t?.format&&i||(f=yield(0,he.F)(w,l,n)),function Ue(w,e){if(null!=w&&null!=e)for(const t of e){const r=w.get(t.name);r&&Object.assign(t,r.toJSON())}}(t?.fieldsIndex,f.fields),f})).apply(this,arguments)}function _e(){return(_e=(0,S.Z)(function*(w,e,t,r){const n=t?.infoFor3D;if(!Te(w,n)||null==n||!e.assetMaps||!e.features?.length)return je.Z.fromJSON(e);const{meshFeatureSetFromJSON:l}=yield(0,Ae.Hl)(Promise.all([h.e(1716),h.e(4612),h.e(2859),h.e(6215),h.e(8592),h.e(7045)]).then(h.bind(h,17045)),r);return l(w,n,e)})).apply(this,arguments)}function Te(w,e){return null!=e&&!0===w.returnGeometry&&"xyFootprint"!==w.multipatchOption&&!w.outStatistics}h(11931),h(57678),h(6785),h(85596),h(12768);var We=h(24859),Ke=(h(2189),h(93566),h(40485),h(49602),h(82921),h(61375)),Re=(h(10842),h(46556)),Ee=(h(89047),h(91085));class ce extends x.Z{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerDynamic",this._removeGeometry=!1,this._overrideFields=null,this.formulaCredential=null,this._pageJustIds=!1,this._requestStandardised=!1,this._useDefinitionExpression=!0,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return m.tI}end(){return this._layer}optimisePagingFeatureQueries(e){this._pageJustIds=e}get urlQueryPath(){return this._layer.parsedUrl.path||""}convertQueryToLruCacheKey(e){const t=this.urlQueryPath+","+(0,m.hd)(e.toJSON());return(0,I.F)(t,I.M.String)}loadImpl(){var e=this;return(0,S.Z)(function*(){return!0===e._layer.loaded?(e._initialiseFeatureSet(),e):(yield e._layer.load(),e._initialiseFeatureSet(),e)})()}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this.hasZ=!0===this._layer?.capabilities?.data?.supportsZ,this.hasM=!0===this._layer?.capabilities?.data?.supportsM,null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const e=[],t=[];for(const r of this.fields)if("oid"===r.type)e.push(r),t.push(r.name);else for(const n of this._overrideFields)if(n.toLowerCase()===r.name.toLowerCase()){e.push(r),t.push(r.name);break}this.fields=e,this._overrideFields=t}if(this._layer.source&&this._layer.source.sourceJSON){const e=this._layer.source.sourceJSON.currentVersion;!0===this._layer.source.sourceJSON.useStandardizedQueries?(this._databaseType=m.Bj.StandardisedNoInterval,null!=e&&e>=10.61&&(this._databaseType=m.Bj.Standardised)):null!=e&&(e>=10.5&&(this._databaseType=m.Bj.StandardisedNoInterval,this._requestStandardised=!0),e>=10.61&&(this._databaseType=m.Bj.Standardised))}this.objectIdField=this._layer.objectIdField;for(const e of this.fields)"global-id"===e.type&&(this.globalIdField=e.name);this._layer instanceof Pe.default?(this.typeIdField=this._layer.subtypeField??"",this.types=this._layer.subtypes):(this.typeIdField=this._layer.typeIdField??"",this.types=this._layer.types)}_isInFeatureSet(){return m.dj.InFeatureSet}_refineSetBlock(e){return(0,S.Z)(function*(){return e})()}_candidateIdTransform(e){return e}_getSet(e){var t=this;return(0,S.Z)(function*(){if(null===t._wset){yield t._ensureLoaded();const r=yield t._getFilteredSet("",null,null,null,e);return t._wset=r,r}return t._wset})()}_runDatabaseProbe(e){var t=this;return(0,S.Z)(function*(){yield t._ensureLoaded();const r=new se.Z;t.datesInUnknownTimezone&&(r.timeReferenceUnknownClient=!0),r.where=e.replace("OBJECTID",t._layer.objectIdField);try{return yield t._layer.queryObjectIds(r),!0}catch{return!1}})()}_canUsePagination(){return!(!this._layer.capabilities||!this._layer.capabilities.query||!0!==this._layer.capabilities.query.supportsPagination)}_cacheableFeatureSetSourceKey(){return this._layer.url}pbfSupportedForQuery(e){const t=this._layer?.capabilities?.query;return!e.outStatistics&&!0===t?.supportsFormatPBF&&!0===t?.supportsQuantizationEditMode}queryPBF(e){var t=this;return(0,S.Z)(function*(){return e.quantizationParameters={mode:"edit"},(yield function Me(w,e,t,r){return fe.apply(this,arguments)}(t._layer.parsedUrl,e,{format:"pbf"},{})).unquantize()})()}get gdbVersion(){return this._layer&&this._layer.capabilities&&this._layer.capabilities.data&&this._layer.capabilities.data.isVersioned?this._layer.gdbVersion||"SDE.DEFAULT":""}nativeCapabilities(){return{title:this._layer.title??"",source:this,canQueryRelated:!0,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:this._requestStandardised}}executeQuery(e,t){e.returnZ=this.hasZ,e.returnM=this.hasM;const r="execute"===t?he.e:"executeForCount"===t?We.P:Ke.G,n="execute"===t&&this.pbfSupportedForQuery(e);let l=null;if(this.recentlyUsedQueries){const s=this.convertQueryToLruCacheKey(e);l=this.recentlyUsedQueries.getFromCache(s),null===l&&(l=!0!==n?r(this._layer.parsedUrl.path,e):this.queryPBF(e),this.recentlyUsedQueries.addToCache(s,l),l=l.catch(c=>{throw this.recentlyUsedQueries?.removeFromCache(s),c}))}return this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:e,method:t}),null===l&&(l=!0!==n?r(this._layer.parsedUrl.path,e):this.queryPBF(e)),l}_getFilteredSet(e,t,r,n,l){var s=this;return(0,S.Z)(function*(){const c=yield s.databaseType();if(s.isTable()&&t&&null!==e&&""!==e)return new Z.Z([],[],!0,null);if(s._canUsePagination())return s._getFilteredSetUsingPaging(e,t,r,n,l);let i="",f=!1;null!==n&&s._layer.capabilities&&s._layer.capabilities.query&&!0===s._layer.capabilities.query.supportsOrderBy&&(i=n.constructClause(),f=!0);const C=new se.Z;s.datesInUnknownTimezone&&(C.timeReferenceUnknownClient=!0),C.where=null===r?null===t?"1=1":"":(0,T.zR)(r,c),s._requestStandardised&&(C.sqlFormat="standard"),C.spatialRelationship=s._makeRelationshipEnum(e),C.outSpatialReference=s.spatialReference,C.orderByFields=""!==i?i.split(","):null,C.geometry=null===t?null:t,C.relationParameter=s._makeRelationshipParam(e);let P=yield s.executeQuery(C,"executeForIds");return null===P&&(P=[]),s._checkCancelled(l),new Z.Z([],P,f,null)})()}_expandPagedSet(e,t,r,n,l){return this._expandPagedSetFeatureSet(e,t,r,n,l)}_getFilteredSetUsingPaging(e,t,r,n,l){var s=this;return(0,S.Z)(function*(){let c="",i=!1;null!==n&&s._layer.capabilities&&s._layer.capabilities.query&&!0===s._layer.capabilities.query.supportsOrderBy&&(c=n.constructClause(),i=!0);const f=yield s.databaseType();let C=null===r?null===t?"1=1":"":(0,T.zR)(r,f);s._layer.definitionExpression&&s._useDefinitionExpression&&(C=""!==C?"(("+s._layer.definitionExpression+") AND ("+C+"))":s._layer.definitionExpression);let P=s._maxQueryRate();const U=s._layer.capabilities?.query.maxRecordCount;null!=U&&U<P&&(P=U);let G=null;if(!0===s._pageJustIds)G=new Z.Z([],["GETPAGES"],i,{spatialRel:s._makeRelationshipEnum(e),relationParam:s._makeRelationshipParam(e),outFields:s._layer.objectIdField,resultRecordCount:P,resultOffset:0,geometry:null===t?null:t,where:C,orderByFields:c,returnGeometry:!1,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}});else{let J=!0;!0===s._removeGeometry&&(J=!1);const X=s._overrideFields??s._fieldsIncludingObjectId(["*"]);G=new Z.Z([],["GETPAGES"],i,{spatialRel:s._makeRelationshipEnum(e),relationParam:s._makeRelationshipParam(e),outFields:X.join(","),resultRecordCount:P,resultOffset:0,geometry:null===t?null:t,where:C,orderByFields:c,returnGeometry:J,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}return yield s._expandPagedSet(G,P,0,1,l),G})()}_clonePageDefinition(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}_getPhysicalPage(e,t,r){var n=this;return(0,S.Z)(function*(){const l=e.pagesDefinition.internal.lastRetrieved,s=l,c=e.pagesDefinition.internal.lastPage,i=new se.Z;n._requestStandardised&&(i.sqlFormat="standard"),n.datesInUnknownTimezone&&(i.timeReferenceUnknownClient=!0),i.spatialRelationship=e.pagesDefinition.spatialRel,i.relationParameter=e.pagesDefinition.relationParam,i.outFields=e.pagesDefinition.outFields.split(","),i.num=e.pagesDefinition.resultRecordCount,i.start=e.pagesDefinition.internal.lastPage,i.geometry=e.pagesDefinition.geometry,i.where=e.pagesDefinition.where,i.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,i.returnGeometry=e.pagesDefinition.returnGeometry,i.outSpatialReference=n.spatialReference;const f=yield n.executeQuery(i,"execute");if(n._checkCancelled(r),e.pagesDefinition.internal.lastPage!==c)return"done";const C=n._layer.objectIdField;for(let P=0;P<f.features.length;P++)e.pagesDefinition.internal.set[s+P]=f.features[P].attributes[C];if(!1===n._pageJustIds)for(let P=0;P<f.features.length;P++)n._featureCache[f.features[P].attributes[C]]=f.features[P];return(void 0===f.exceededTransferLimit&&f.features.length!==e.pagesDefinition.resultRecordCount||!1===f.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=l+f.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,"done"})()}_fieldsIncludingObjectId(e){if(null===e)return[this.objectIdField];const t=e.slice(0);if(t.includes("*"))return t;let r=!1;for(const n of t)if(n.toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t}_getFeatures(e,t,r,n){var l=this;return(0,S.Z)(function*(){const s=[];if(-1!==t&&void 0===l._featureCache[t]&&s.push(t),!0===l._checkIfNeedToExpandKnownPage(e,l._maxProcessingRate()))return yield l._expandPagedSet(e,l._maxProcessingRate(),0,0,n),l._getFeatures(e,t,r,n);let c=0;for(let P=e._lastFetchedIndex;P<e._known.length;P++){if(e._lastFetchedIndex+=1,c++,void 0===l._featureCache[e._known[P]]){let U=!1;if(null!=l._layer._mode){const G=l._layer._mode;if(void 0!==G._featureMap[e._known[P]]){const J=G._featureMap[e._known[P]];null!==J&&(U=!0,l._featureCache[e._known[P]]=J)}}if(!1===U&&(e._known[P]!==t&&s.push(e._known[P]),s.length>=l._maxProcessingRate()-1))break}if(c>=r&&0===s.length)break}if(0===s.length)return"success";const i=new se.Z;l._requestStandardised&&(i.sqlFormat="standard"),l.datesInUnknownTimezone&&(i.timeReferenceUnknownClient=!0),i.objectIds=s,i.outFields=l._overrideFields??l._fieldsIncludingObjectId(["*"]),i.returnGeometry=!0,!0===l._removeGeometry&&(i.returnGeometry=!1),i.outSpatialReference=l.spatialReference;const f=yield l.executeQuery(i,"execute");if(l._checkCancelled(n),void 0!==f.error)throw new F.EN(F.H9.RequestFailed,{reason:f.error});const C=l._layer.objectIdField;for(let P=0;P<f.features.length;P++)l._featureCache[f.features[P].attributes[C]]=f.features[P];return"success"})()}_getDistinctPages(e,t,r,n,l,s,c,i,f){var C=this;return(0,S.Z)(function*(){yield C._ensureLoaded();const P=yield C.databaseType();let U=r.parseTree.column;const G=C._layer.fields??[];for(let H=0;H<G.length;H++)if(G[H].name.toLowerCase()===U.toLowerCase()){U=G[H].name;break}const J=new se.Z;C._requestStandardised&&(J.sqlFormat="standard"),C.datesInUnknownTimezone&&(J.timeReferenceUnknownClient=!0);let X=null===s?null===l?"1=1":"":(0,T.zR)(s,P);C._layer.definitionExpression&&C._useDefinitionExpression&&(X=""!==X?"(("+C._layer.definitionExpression+") AND ("+X+"))":C._layer.definitionExpression),J.where=X,J.spatialRelationship=C._makeRelationshipEnum(n),J.relationParameter=C._makeRelationshipParam(n),J.geometry=null===l?null:l,J.returnDistinctValues=!0,J.returnGeometry=!1,J.outFields=[U];const Y=yield C.executeQuery(J,"execute");if(C._checkCancelled(f),!Y.hasOwnProperty("features"))throw new F.EN(F.H9.InvalidStatResponse);let ee=!1;for(let H=0;H<G.length;H++)if(G[H].name===U){"date"===G[H].type&&(ee=!0);break}for(let H=0;H<Y.features.length;H++){if(ee){const le=Y.features[H].attributes[U];i.push(null!==le?new Date(le):le)}else i.push(Y.features[H].attributes[U]);if(i.length>=c)break}return 0===Y.features.length?i:Y.features.length===C._layer.capabilities?.query.maxRecordCount&&i.length<c?{calculated:!0,result:yield C._getDistinctPages(e+Y.features.length,t,r,n,l,s,c,i,f)}:i})()}_distinctStat(e,t,r,n,l,s,c){var i=this;return(0,S.Z)(function*(){return{calculated:!0,result:yield i._getDistinctPages(0,e,t,r,n,l,s,[],c)}})()}isTable(){return this._layer.isTable||null===this._layer.geometryType||"table"===this._layer.type||""===this._layer.geometryType||"esriGeometryNull"===this._layer.geometryType}_countstat(e,t,r,n){var l=this;return(0,S.Z)(function*(){const s=yield l.databaseType(),c=new se.Z;if(l._requestStandardised&&(c.sqlFormat="standard"),l.isTable()&&r&&null!==t&&""!==t)return{calculated:!0,result:0};let i=null===n?null===r?"1=1":"":(0,T.zR)(n,s);return l._layer.definitionExpression&&l._useDefinitionExpression&&(i=""!==i?"(("+l._layer.definitionExpression+") AND ("+i+"))":l._layer.definitionExpression),c.where=i,l.datesInUnknownTimezone&&(c.timeReferenceUnknownClient=!0),c.where=i,c.spatialRelationship=l._makeRelationshipEnum(t),c.relationParameter=l._makeRelationshipParam(t),c.geometry=null===r?null:r,c.returnGeometry=!1,{calculated:!0,result:yield l.executeQuery(c,"executeForCount")}})()}_stats(e,t,r,n,l,s,c){var i=this;return(0,S.Z)(function*(){yield i._ensureLoaded();const f=i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsSqlExpression,C=i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsStatistics,P=i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsDistinct;if("count"===e)return P?i._countstat(e,r,n,l):{calculated:!1};if(!1===C||!1===(0,T.y5)(t)&&!1===f||!1===t.isStandardized)return""!==r||null!==l?{calculated:!1}:i._manualStat(e,t,s,c);if("distinct"===e)return!1===P?""!==r||null!==l?{calculated:!1}:i._manualStat(e,t,s,c):i._distinctStat(e,t,r,n,l,s,c);const U=yield i.databaseType();if(i.isTable()&&n&&null!==r&&""!==r)return{calculated:!0,result:null};const G=new se.Z;i._requestStandardised&&(G.sqlFormat="standard");let J=null===l?null===n?"1=1":"":(0,T.zR)(l,U);i._layer.definitionExpression&&i._useDefinitionExpression&&(J=""!==J?"(("+i._layer.definitionExpression+") AND ("+J+"))":i._layer.definitionExpression),G.where=J,G.spatialRelationship=i._makeRelationshipEnum(r),G.relationParameter=i._makeRelationshipParam(r),G.geometry=null===n?null:n,i.datesInUnknownTimezone&&(G.timeReferenceUnknownClient=!0);const X=new Ee.Z;X.statisticType=(0,N.g3)(e),X.onStatisticField=(0,T.zR)(t,U),X.outStatisticFieldName="ARCADE_STAT_RESULT",G.returnGeometry=!1;let Y="ARCADE_STAT_RESULT";G.outStatistics=[X];const ee=yield i.executeQuery(G,"execute");if(!ee.hasOwnProperty("features")||0===ee.features.length)throw new F.EN(F.H9.InvalidStatResponse);let H=!1;const le=ee.fields??[];for(let ae=0;ae<le.length;ae++)if("ARCADE_STAT_RESULT"===le[ae].name.toUpperCase()){Y=le[ae].name,"date"===le[ae].type&&(H=!0);break}if(H){let ae=ee.features[0].attributes[Y];return null!==ae&&(ae=new Date(ee.features[0].attributes[Y])),{calculated:!0,result:ae}}return{calculated:!0,result:ee.features[0].attributes[Y]}})()}_stat(e,t,r,n,l,s,c){return this._stats(e,t,r,n,l,s,c)}_canDoAggregates(e,t){var r=this;return(0,S.Z)(function*(){yield r._ensureLoaded();let n=!1;const l=r._layer.capabilities?.query,s=!0===l?.supportsSqlExpression;if(null!=l&&!0===l.supportsStatistics&&!0===l.supportsOrderBy&&(n=!0),n)for(let c=0;c<t.length-1;c++)(!1===t[c].workingexpr?.isStandardized||!1===(0,T.y5)(t[c].workingexpr)&&!1===s)&&(n=!1);return!1!==n})()}_makeRelationshipEnum(e){if(e.includes("esriSpatialRelRelation"))return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}_makeRelationshipParam(e){return e.includes("esriSpatialRelRelation")?e.split(":")[1]:""}_getAggregatePagesDataSourceDefinition(e,t,r,n,l,s,c){var i=this;return(0,S.Z)(function*(){yield i._ensureLoaded();const f=yield i.databaseType();let C="",P=!1,U=!1;null!==s&&i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsOrderBy&&(C=s.constructClause(),U=!0),i._layer.capabilities&&i._layer.capabilities.query&&!1===i._layer.capabilities.query.supportsPagination&&(U=!1,P=!0,C=i._layer.objectIdField);const G=[];for(let ee=0;ee<t.length;ee++){const H=new Ee.Z;H.onStatisticField=null!==t[ee].workingexpr?(0,T.zR)(t[ee].workingexpr,f):"",H.outStatisticFieldName=t[ee].field,H.statisticType=t[ee].toStatisticsName(),G.push(H)}""===C&&(C=e.join(","));let J=i._maxQueryRate();const X=i._layer.capabilities?.query.maxRecordCount;null!=X&&X<J&&(J=X);let Y=null===l?null===n?"1=1":"":(0,T.zR)(l,f);return i._layer.definitionExpression&&i._useDefinitionExpression&&(Y=""!==Y?"(("+i._layer.definitionExpression+") AND ("+Y+"))":i._layer.definitionExpression),new Z.Z([],["GETPAGES"],U,{groupbypage:!0,spatialRel:i._makeRelationshipEnum(r),relationParam:i._makeRelationshipParam(r),outFields:["*"],useOIDpagination:P,generatedOid:c,resultRecordCount:J,resultOffset:0,groupByFieldsForStatistics:e,outStatistics:G,geometry:null===n?null:n,where:Y,orderByFields:C,returnGeometry:!1,returnIdsOnly:!1,internal:{lastMaxId:-1,set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})})()}_getAgregagtePhysicalPage(e,t,r){var n=this;return(0,S.Z)(function*(){let l=e.pagesDefinition.where;!0===e.pagesDefinition.useOIDpagination&&(l=""!==l?"("+l+") AND ("+e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString()+")":e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString());const s=e.pagesDefinition.internal.lastRetrieved,c=s,i=e.pagesDefinition.internal.lastPage,f=new se.Z;if(n._requestStandardised&&(f.sqlFormat="standard"),f.where=l,f.spatialRelationship=e.pagesDefinition.spatialRel,f.relationParameter=e.pagesDefinition.relationParam,f.outFields=e.pagesDefinition.outFields,f.outStatistics=e.pagesDefinition.outStatistics,f.geometry=e.pagesDefinition.geometry,f.groupByFieldsForStatistics=e.pagesDefinition.groupByFieldsForStatistics,f.num=e.pagesDefinition.resultRecordCount,f.start=e.pagesDefinition.internal.lastPage,f.returnGeometry=e.pagesDefinition.returnGeometry,n.datesInUnknownTimezone&&(f.timeReferenceUnknownClient=!0),f.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,n.isTable()&&f.geometry&&f.spatialRelationship)return[];const C=yield n.executeQuery(f,"execute");if(n._checkCancelled(r),!C.hasOwnProperty("features"))throw new F.EN(F.H9.InvalidStatResponse);const P=[];if(e.pagesDefinition.internal.lastPage!==i)return[];C.features.length>0&&void 0===C.features[0].attributes[e.pagesDefinition.generatedOid]&&(e.pagesDefinition.generatedOid=e.pagesDefinition.generatedOid.toLowerCase());for(let U=0;U<C.features.length;U++)e.pagesDefinition.internal.set[c+U]=C.features[U].attributes[e.pagesDefinition.generatedOid];for(let U=0;U<C.features.length;U++)P.push(new M.Z({attributes:C.features[U].attributes,geometry:null}));return!0===e.pagesDefinition.useOIDpagination?0===C.features.length?e.pagesDefinition.internal.fullyResolved=!0:e.pagesDefinition.internal.lastMaxId=C.features[C.features.length-1].attributes[e.pagesDefinition.generatedOid]:(void 0===C.exceededTransferLimit&&C.features.length!==e.pagesDefinition.resultRecordCount||!1===C.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=s+C.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,P})()}static create(e,t,r,n,l){const s=new te.default({url:e,outFields:null===t?["*"]:t});return new ce({layer:s,spatialReference:r,lrucache:n,interceptor:l})}relationshipMetaData(){return this._layer&&this._layer.source&&this._layer.source.sourceJSON?.relationships?this._layer.source.sourceJSON.relationships:[]}serviceUrl(){return(0,m.US)(this._layer.parsedUrl.path)}queryAttachments(e,t,r,n,l){var s=this;return(0,S.Z)(function*(){const c=s._layer.capabilities;if(c?.data.supportsAttachment&&c?.operations.supportsQueryAttachments){const i={objectIds:[e],returnMetadata:l};(t&&t>0||r&&r>0)&&(i.size=[t&&t>0?t:0,r&&r>0?r:t+1]),n&&n.length>0&&(i.attachmentTypes=n),s.featureSetQueryInterceptor&&s.featureSetQueryInterceptor.preLayerQueryCallback({layer:s._layer,query:i,method:"attachments"});const f=yield s._layer.queryAttachments(i),C=[];return f&&f[e]&&f[e].forEach(P=>{const U=s._layer.parsedUrl.path+"/"+e.toString()+"/attachments/"+P.id.toString();let G=null;l&&P.exifInfo&&(G=oe.Z.convertJsonToArcade(P.exifInfo,"system",!0)),C.push(new V.Z(P.id,P.name,P.contentType,P.size,U,G,P.keywords??null))}),C}return[]})()}queryRelatedFeatures(e){var t=this;return(0,S.Z)(function*(){const r={f:"json",relationshipId:e.relationshipId.toString(),definitionExpression:e.where,outFields:e.outFields?.join(","),returnGeometry:e.returnGeometry.toString()};null!=e.resultOffset&&(r.resultOffset=e.resultOffset.toString()),null!=e.resultRecordCount&&(r.resultRecordCount=e.resultRecordCount.toString()),e.orderByFields&&(r.orderByFields=e.orderByFields.join(",")),e.objectIds&&e.objectIds.length>0&&(r.objectIds=e.objectIds.join(",")),e.outSpatialReference&&(r.outSR=(0,ie.B9)(e.outSpatialReference)),t.featureSetQueryInterceptor&&t.featureSetQueryInterceptor.preRequestCallback({layer:t._layer,queryPayload:r,method:"relatedrecords",url:t._layer.parsedUrl.path+"/queryRelatedRecords"});const n=yield(0,z.Z)(t._layer.parsedUrl.path+"/queryRelatedRecords",{responseType:"json",query:r});if(n.data){const l={},s=n.data;if(s?.relatedRecordGroups){const c=s.spatialReference;for(const i of s.relatedRecordGroups){const f=i.objectId,C=[];for(const P of i.relatedRecords){P.geometry&&(P.geometry.spatialReference=c);const U=new M.Z({geometry:P.geometry?(0,ue.im)(P.geometry):null,attributes:P.attributes});C.push(U)}l[f]={features:C,exceededTransferLimit:!0===s.exceededTransferLimit}}}return l}throw new F.EN(F.H9.InvalidRequest)})()}getFeatureByObjectId(e,t){var r=this;return(0,S.Z)(function*(){const n=new se.Z;n.outFields=t,n.returnGeometry=!1,n.outSpatialReference=r.spatialReference,n.where=r.objectIdField+"="+e.toString(),r.datesInUnknownTimezone&&(n.timeReferenceUnknownClient=!0),r.featureSetQueryInterceptor&&r.featureSetQueryInterceptor.preLayerQueryCallback({layer:r._layer,query:n,method:"execute"});const l=yield(0,he.e)(r._layer.parsedUrl.path,n);return 1===l.features.length?l.features[0]:null})()}getIdentityUser(){var e=this;return(0,S.Z)(function*(){yield e.load();const t=B.id?.findCredential(e._layer.url);return t?t.userId:null})()}getOwningSystemUrl(){var e=this;return(0,S.Z)(function*(){yield e.load();const t=B.id?.findServerInfo(e._layer.url);if(t)return t.owningSystemUrl;let r=e._layer.url;const n=r.toLowerCase().indexOf("/rest/services");if(r=n>-1?r.substring(0,n):r,r){r+="/rest/info";try{const l=yield(0,z.Z)(r,{query:{f:"json"}});let s="";return l.data?.owningSystemUrl&&(s=l.data.owningSystemUrl),s}catch{return""}}return""})()}getDataSourceFeatureSet(){const e=new ce({layer:this._layer,spatialReference:this.spatialReference??void 0,outFields:this._overrideFields??void 0,includeGeometry:!this._removeGeometry,lrucache:this.recentlyUsedQueries??void 0,interceptor:this.featureSetQueryInterceptor??void 0});return e._useDefinitionExpression=!1,e}get preferredTimeZone(){return this._layer.preferredTimeZone??null}get dateFieldsTimeZone(){return this._layer.dateFieldsTimeZone??null}get datesInUnknownTimezone(){return this._layer.datesInUnknownTimezone}get editFieldsInfo(){return this._layer.editFieldsInfo??null}get timeInfo(){return this._layer.timeInfo??null}getFeatureSetInfo(){var e=this;return(0,S.Z)(function*(){if(e.fsetInfo)return e.fsetInfo;let t=null,{parsedUrl:{path:r},serviceItemId:n=null}=e._layer;if(r){const s=yield(0,z.Z)(r,{responseType:"json",query:{f:"json"}});t=s?.data?.name??null,n=s?.data?.serviceItemId??null}const l=e._layer.title&&null!==(e._layer.parent??null);return e.featureSetInfo={layerId:e._layer.layerId,layerName:""===t?null:t,itemId:""===n?null:n,serviceLayerUrl:""===r?null:r,webMapLayerId:l?e._layer.id??null:null,webMapLayerTitle:l?e._layer.title??null:null,className:null,objectClassId:null},e.fsetInfo})()}}var Qe=h(54339);class Ve extends x.Z{constructor(e){super(e),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerRelated",this._findObjectId=-1,this._requestStandardised=!1,this._removeGeometry=!1,this._overrideFields=null,this.featureObjectId=null,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,this._findObjectId=e.objectId,this.featureObjectId=e.objectId,this.relationship=e.relationship,this._relatedLayer=e.relatedLayer,void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return m.tI}end(){return this._layer}optimisePagingFeatureQueries(){}loadImpl(){var e=this;return(0,S.Z)(function*(){return yield Promise.all([e._layer.load(),e._relatedLayer?.load()]),e._initialiseFeatureSet(),e})()}nativeCapabilities(){return this._relatedLayer.nativeCapabilities()}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._relatedLayer.geometryType,this.fields=this._relatedLayer.fields.slice(0),this.hasZ=this._relatedLayer.hasZ,this.hasM=this._relatedLayer.hasM,null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const t=[],r=[];for(const n of this.fields)if("oid"===n.type)t.push(n),r.push(n.name);else for(const l of this._overrideFields)if(l.toLowerCase()===n.name.toLowerCase()){t.push(n),r.push(n.name);break}this.fields=t,this._overrideFields=r}const e=this._layer.nativeCapabilities();e&&(this._databaseType=e.databaseType,this._requestStandardised=e.requestStandardised),this.objectIdField=this._relatedLayer.objectIdField,this.globalIdField=this._relatedLayer.globalIdField,this.hasM=this._relatedLayer.supportsM,this.hasZ=this._relatedLayer.supportsZ,this.typeIdField=this._relatedLayer.typeIdField,this.types=this._relatedLayer.types}databaseType(){var e=this;return(0,S.Z)(function*(){return yield e._relatedLayer.databaseType(),e._databaseType=e._relatedLayer._databaseType,e._databaseType})()}isTable(){return this._relatedLayer.isTable()}_isInFeatureSet(){return m.dj.InFeatureSet}_candidateIdTransform(e){return e}_getSet(e){var t=this;return(0,S.Z)(function*(){if(null===t._wset){yield t._ensureLoaded();const r=yield t._getFilteredSet("",null,null,null,e);return t._wset=r,r}return t._wset})()}_changeFeature(e){const t={};for(const r of this.fields)t[r.name]=e.attributes[r.name];return new M.Z({geometry:!0===this._removeGeometry?null:e.geometry,attributes:t})}_getFilteredSet(e,t,r,n,l){var s=this;return(0,S.Z)(function*(){if(yield s.databaseType(),s.isTable()&&t&&null!==e&&""!==e)return new Z.Z([],[],!0,null);const c=s._layer.nativeCapabilities();if(!1===c.canQueryRelated)return new Z.Z([],[],!0,null);if(c.capabilities?.queryRelated&&c.capabilities.queryRelated.supportsPagination)return s._getFilteredSetUsingPaging(e,t,r,n,l);let i="",f=!1;null!==n&&c.capabilities?.queryRelated&&!0===c.capabilities.queryRelated.supportsOrderBy&&(i=n.constructClause(),f=!0);const C=new Re.default;C.objectIds=[s._findObjectId];const P=null!==s._overrideFields?s._overrideFields:s._fieldsIncludingObjectId(s._relatedLayer.fields?s._relatedLayer.fields.map(H=>H.name):["*"]);C.outFields=P,C.relationshipId=s.relationship.id,C.where="1=1";let U=!0;!0===s._removeGeometry&&(U=!1),C.returnGeometry=U,s._requestStandardised&&(C.sqlFormat="standard"),C.outSpatialReference=s.spatialReference,C.orderByFields=""!==i?i.split(","):null;const G=yield c.source.queryRelatedFeatures(C);s._checkCancelled(l);const J=G[s._findObjectId]?G[s._findObjectId].features:[],X=[];for(let H=0;H<J.length;H++)s._featureCache[J[H].attributes[s._relatedLayer.objectIdField]]=J[H],X.push(J[H].attributes[s._relatedLayer.objectIdField]);const Y=t&&null!==e&&""!==e,ee=null!=r;return new Z.Z(Y||ee?X:[],Y||ee?[]:X,f,null)})()}_fieldsIncludingObjectId(e){if(null===e)return[this.objectIdField];const t=e.slice(0);if(t.includes("*"))return t;let r=!1;for(const n of t)if(n.toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t}_getFilteredSetUsingPaging(e,t,r,n,l){var s=this;return(0,S.Z)(function*(){let c="",i=!1;const f=s._layer.nativeCapabilities();null!==n&&f?.capabilities?.queryRelated&&!0===f.capabilities.queryRelated.supportsOrderBy&&(c=n.constructClause(),i=!0),yield s.databaseType();let P=s._maxQueryRate();const U=f.capabilities?.query.maxRecordCount;null!=U&&U<P&&(P=U);const G=t&&null!==e&&""!==e,J=null!=r;let X=null,Y=!0;!0===s._removeGeometry&&(Y=!1);const ee=null!==s._overrideFields?s._overrideFields:s._fieldsIncludingObjectId(s._relatedLayer.fields?s._relatedLayer.fields.map(H=>H.name):["*"]);return X=new Z.Z(G||J?["GETPAGES"]:[],G||J?[]:["GETPAGES"],i,{outFields:ee.join(","),resultRecordCount:P,resultOffset:0,objectIds:[s._findObjectId],where:"1=1",orderByFields:c,returnGeometry:Y,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}}),yield s._expandPagedSet(X,P,0,0,l),X})()}_expandPagedSet(e,t,r,n,l){return this._expandPagedSetFeatureSet(e,t,r,n,l)}_clonePageDefinition(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}_getPhysicalPage(e,t,r){var n=this;return(0,S.Z)(function*(){const l=e.pagesDefinition.internal.lastRetrieved,s=l,c=e.pagesDefinition.internal.lastPage,i=n._layer.nativeCapabilities(),f=new Re.default;!0===n._requestStandardised&&(f.sqlFormat="standard"),f.relationshipId=n.relationship.id,f.objectIds=e.pagesDefinition.objectIds,f.resultOffset=e.pagesDefinition.internal.lastPage,f.resultRecordCount=e.pagesDefinition.resultRecordCount,f.outFields=e.pagesDefinition.outFields.split(","),f.where=e.pagesDefinition.where,f.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,f.returnGeometry=e.pagesDefinition.returnGeometry,f.outSpatialReference=n.spatialReference;const C=yield i.source.queryRelatedFeatures(f);if(n._checkCancelled(r),e.pagesDefinition.internal.lastPage!==c)return 0;const P=C[n._findObjectId]?C[n._findObjectId].features:[];for(let G=0;G<P.length;G++)e.pagesDefinition.internal.set[s+G]=P[G].attributes[n._relatedLayer.objectIdField];for(let G=0;G<P.length;G++)n._featureCache[P[G].attributes[n._relatedLayer.objectIdField]]=P[G];return P.length!==e.pagesDefinition.resultRecordCount&&(!C[n._findObjectId]||!1===C[n._findObjectId].exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=l+P.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,P.length})()}_getFeatures(e,t,r,n){var l=this;return(0,S.Z)(function*(){const s=[];-1!==t&&void 0===l._featureCache[t]&&s.push(t);const c=l._maxQueryRate();if(!0===l._checkIfNeedToExpandKnownPage(e,c))return yield l._expandPagedSet(e,c,0,0,n),l._getFeatures(e,t,r,n);let i=0;for(let f=e._lastFetchedIndex;f<e._known.length&&(i++,i<=r&&(e._lastFetchedIndex+=1),!("GETPAGES"!==e._known[f]&&void 0===l._featureCache[e._known[f]]&&(e._known[f]!==t&&s.push(e._known[f]),s.length>r)))&&!(i>=r&&0===s.length);f++);if(0===s.length)return"success";throw new F.EN(F.H9.MissingFeatures)})()}_refineSetBlock(e,t,r){return(0,S.Z)(function*(){return e})()}_stat(e,t,r,n,l,s,c){return(0,S.Z)(function*(){return{calculated:!1}})()}get gdbVersion(){return this._relatedLayer.gdbVersion}_canDoAggregates(e,t,r,n,l){return(0,S.Z)(function*(){return!1})()}relationshipMetaData(){return this._relatedLayer.relationshipMetaData()}serviceUrl(){return this._relatedLayer.serviceUrl()}queryAttachments(e,t,r,n,l){return this._relatedLayer.queryAttachments(e,t,r,n,l)}getFeatureByObjectId(e,t){return this._relatedLayer.getFeatureByObjectId(e,t)}getOwningSystemUrl(){return this._relatedLayer.getOwningSystemUrl()}getIdentityUser(){return this._relatedLayer.getIdentityUser()}getDataSourceFeatureSet(){return this._relatedLayer}get preferredTimeZone(){return this._relatedLayer?.preferredTimeZone??null}get dateFieldsTimeZone(){return this._relatedLayer?.dateFieldsTimeZone??null}get datesInUnknownTimezone(){return this._relatedLayer?.datesInUnknownTimezone}get editFieldsInfo(){return this._relatedLayer?.editFieldsInfo??null}get timeInfo(){return this._relatedLayer?.timeInfo??null}getFeatureSetInfo(){var e=this;return(0,S.Z)(function*(){return e.fsetInfo??e._layer.featureSetInfo})()}}var $=h(19104),ze=h(27835);function Je(){null===$.Z.applicationCache&&($.Z.applicationCache=new $.Z)}function ye(w,e){return ge.apply(this,arguments)}function ge(){return(ge=(0,S.Z)(function*(w,e){if($.Z.applicationCache){const t=$.Z.applicationCache.getLayerInfo(w);if(t){const l=yield t;return new te.default({url:w,outFields:e,sourceJSON:l})}const r=new te.default({url:w,outFields:e}),n=(0,S.Z)(function*(){return yield r.load(),r.sourceJSON})();if($.Z.applicationCache){$.Z.applicationCache.setLayerInfo(w,n);try{return yield n,r}catch(l){throw $.Z.applicationCache.clearLayerInfo(w),l}}return yield n,r}return new te.default({url:w,outFields:e})})).apply(this,arguments)}function me(w,e,t,r,n){return Fe.apply(this,arguments)}function Fe(){return(Fe=(0,S.Z)(function*(w,e,t,r,n,l=null){return re(yield ye(w,["*"]),e,t,r,n,l)})).apply(this,arguments)}function re(w,e=null,t=null,r=!0,n=null,l=null){if(w instanceof te.default||(0,O.$)(w)){const c={layer:w,spatialReference:e,outFields:t,includeGeometry:r,lrucache:n,interceptor:l};return w.url||!w.source?new ce(c):new Qe.Z(c)}const s=re(w.parent,e,t,r,n,l);return s.filter(p.WhereClause.create(w.parent.subtypeField+"="+w.subtypeCode.toString(),w.parent.fieldsIndex,s.dateFieldsTimeZoneDefaultUTC))}function Se(){return(Se=(0,S.Z)(function*(w){if(null!==$.Z.applicationCache){const t=$.Z.applicationCache.getLayerInfo(w);if(null!==t)return t}const e=(0,S.Z)(function*(){const t=yield(0,z.Z)(w,{responseType:"json",query:{f:"json"}});return t.data?t.data:null})();if(null!==$.Z.applicationCache){$.Z.applicationCache.setLayerInfo(w,e);try{return yield e}catch(t){throw $.Z.applicationCache.clearLayerInfo(w),t}}return e})).apply(this,arguments)}function Ie(){return(Ie=(0,S.Z)(function*(w,e){const t="QUERYDATAELEMTS:"+e.toString()+":"+w;if(null!==$.Z.applicationCache){const n=$.Z.applicationCache.getLayerInfo(t);if(null!==n)return n}const r=(0,S.Z)(function*(){const n=yield(0,z.Z)(w+"/queryDataElements",{method:"post",responseType:"json",query:{layers:JSON.stringify([e.toString()]),f:"json"}});if(n.data){const l=n.data;if(l.layerDataElements?.[0])return l.layerDataElements[0]}throw new F.EN(F.H9.DataElementsNotFound)})();if(null!==$.Z.applicationCache){$.Z.applicationCache.setLayerInfo(t,r);try{return yield r}catch(n){throw $.Z.applicationCache.clearLayerInfo(t),n}}return r})).apply(this,arguments)}function xe(w){return ve.apply(this,arguments)}function ve(){return(ve=(0,S.Z)(function*(w){if(null!==$.Z.applicationCache){const t=$.Z.applicationCache.getLayerInfo(w);if(null!==t)return t}const e=(0,S.Z)(function*(){const t=yield(0,z.Z)(w,{responseType:"json",query:{f:"json"}});if(t.data){const r=t.data;return r.layers||(r.layers=[]),r.tables||(r.tables=[]),r}return{layers:[],tables:[]}})();if(null!==$.Z.applicationCache){$.Z.applicationCache.setLayerInfo(w,e);try{return yield e}catch(t){throw $.Z.applicationCache.clearLayerInfo(w),t}}return e})).apply(this,arguments)}function qe(w,e){return Ce.apply(this,arguments)}function Ce(){return Ce=(0,S.Z)(function*(w,e){const t={metadata:null,networkId:-1,unVersion:3,terminals:[],queryelem:null,layerNameLkp:{},lkp:null},r=yield xe(w);if(t.metadata=r,void 0!==r.controllerDatasetLayers?.utilityNetworkLayerId&&null!==r.controllerDatasetLayers.utilityNetworkLayerId){if(r.layers)for(const s of r.layers)t.layerNameLkp[s.id]=s.name;if(r.tables)for(const s of r.tables)t.layerNameLkp[s.id]=s.name;const n=r.controllerDatasetLayers.utilityNetworkLayerId;t.networkId=n;const l=yield function $e(w,e){return Ie.apply(this,arguments)}(w,n);if(l){t.queryelem=l,t.queryelem?.dataElement&&void 0!==t.queryelem.dataElement.schemaGeneration&&(t.unVersion=t.queryelem.dataElement.schemaGeneration),t.lkp={},t.queryelem.dataElement.domainNetworks||(t.queryelem.dataElement.domainNetworks=[]);for(const c of t.queryelem.dataElement.domainNetworks){for(const i of c.edgeSources??[]){const f={layerId:i.layerId,sourceId:i.sourceId,className:t.layerNameLkp[i.layerId]??null};f.className&&(t.lkp[f.className]=f)}for(const i of c.junctionSources??[]){const f={layerId:i.layerId,sourceId:i.sourceId,className:t.layerNameLkp[i.layerId]??null};f.className&&(t.lkp[f.className]=f)}}if(t.queryelem.dataElement.terminalConfigurations)for(const c of t.queryelem.dataElement.terminalConfigurations)for(const i of c.terminals)t.terminals.push({terminalId:i.terminalId,terminalName:i.terminalName});const s=yield function He(w){return Se.apply(this,arguments)}(w+"/"+n);if(void 0!==s.systemLayers?.associationsTableId&&null!==s.systemLayers.associationsTableId){const c=[];t.unVersion>=4&&(c.push("STATUS"),c.push("PERCENTALONG"));let i=yield me(w+"/"+s.systemLayers.associationsTableId.toString(),e,["OBJECTID","FROMNETWORKSOURCEID","TONETWORKSOURCEID","FROMGLOBALID","TOGLOBALID","TOTERMINALID","FROMTERMINALID","ASSOCIATIONTYPE","ISCONTENTVISIBLE","GLOBALID",...c],!1,null,null);return yield i.load(),t.unVersion>=4&&(i=i.filter(p.WhereClause.create("STATUS NOT IN (1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 30, 31, 33, 34, 35, 36, 37, 38, 39, 41, 42, 43, 44, 45, 46, 47, 49, 50, 51, 52, 53, 54, 55, 57, 58, 59, 60, 61, 62, 63)",i.getFieldsIndex(),i.dateFieldsTimeZoneDefaultUTC)),yield i.load()),{lkp:t.lkp,associations:i,unVersion:t.unVersion,terminals:t.terminals}}return{associations:null,unVersion:t.unVersion,lkp:null,terminals:[]}}return{associations:null,unVersion:t.unVersion,lkp:null,terminals:[]}}return{associations:null,unVersion:t.unVersion,lkp:null,terminals:[]}}),Ce.apply(this,arguments)}function Xe(w,e,t){return we.apply(this,arguments)}function we(){return(we=(0,S.Z)(function*(w,e,t,r=null,n=null,l=!0,s=null,c=null){let i=w.serviceUrl();if(!i)return null;i="/"===i.charAt(i.length-1)?i+e.relatedTableId.toString():i+"/"+e.relatedTableId.toString();const f=yield me(i,r,n,l,s,c);return new Ve({layer:w,relatedLayer:f,relationship:e,objectId:t,spatialReference:r,outFields:n,includeGeometry:l,lrucache:s,interceptor:c})})).apply(this,arguments)}A.Z.registerAction(),K.registerAction(),b.Z.registerAction(),W.Z.registerAction(),R.Z.registerAction();class Ye extends Q.Z{constructor(e,t=null,r=null,n=null){super(),this._map=e,this._overridespref=t,this._lrucache=r,this._interceptor=n,this._instantLayers=[]}_makeAndAddFeatureSet(e,t=!0,r=null){const n=re(e,this._overridespref,null===r?["*"]:r,t,this._lrucache,this._interceptor);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n}featureSetByName(e,t=!0,r=null){var n=this;return(0,S.Z)(function*(){if(void 0!==n._map.loaded&&void 0!==n._map.load&&!1===n._map.loaded)return yield n._map.load(),n.featureSetByName(e,t,r);null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const l=JSON.stringify(r);for(let i=0;i<n._instantLayers.length;i++){const f=n._instantLayers[i];if(f.opitem.title===e&&f.includeGeometry===t&&f.outFields===l)return n._instantLayers[i].featureset}const s=[],c=n._map.allLayers.find(i=>{if(i instanceof te.default){if(i.title===e)return!0}else if((0,O.$)(i)){if(i.title===e)return!0;s.push(i)}return!1});if(c)return n._makeAndAddFeatureSet(c,t,r);if(n._map.tables){const i=n._map.tables.find(f=>!!(f.title&&f.title===e||f.title&&f.title===e));if(i){if(i instanceof te.default)return n._makeAndAddFeatureSet(i,t,r);if(!i._materializedTable){const f=i.outFields?i:{...i,outFields:["*"]};i._materializedTable=new te.default(f)}return yield i._materializedTable.load(),n._makeAndAddFeatureSet(i._materializedTable,t,r)}}for(const i of s){if("not-loaded"===i.loadStatus||"loading"===i.loadStatus)try{yield i.load()}catch{}const f=i.sublayers.find(C=>C.title===e);if(f)return n._makeAndAddFeatureSet(f,t,r)}return null})()}featureSetById(e,t=!0,r=["*"]){var n=this;return(0,S.Z)(function*(){if(void 0!==n._map.loaded&&void 0!==n._map.load&&!1===n._map.loaded)return yield n._map.load(),n.featureSetById(e,t,r);null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const l=JSON.stringify(r);for(let i=0;i<n._instantLayers.length;i++){const f=n._instantLayers[i];if(f.opitem.id===e&&f.includeGeometry===t&&f.outFields===l)return n._instantLayers[i].featureset}const s=[],c=n._map.allLayers.find(i=>{if(i instanceof te.default){if(i.id===e)return!0}else if((0,O.$)(i)){if(i.id===e)return!0;s.push(i)}return!1});if(c)return n._makeAndAddFeatureSet(c,t,r);if(n._map.tables){const i=n._map.tables.find(f=>f.id===e);if(i){if(i instanceof te.default)return n._makeAndAddFeatureSet(i,t,r);if(!i._materializedTable){const f={...i,outFields:["*"]};i._materializedTable=new te.default(f)}return yield i._materializedTable.load(),n._makeAndAddFeatureSet(i._materializedTable,t,r)}}for(const i of s){if("not-loaded"===i.loadStatus||"loading"===i.loadStatus)try{yield i.load()}catch{}const f=i.sublayers.find(C=>C.id===e);if(f)return n._makeAndAddFeatureSet(f,t,r)}return null})()}}class De extends Q.Z{constructor(e,t=null,r=null,n=null){super(),this._url=e,this._overridespref=t,this._lrucache=r,this._interceptor=n,this.metadata=null,this._instantLayers=[]}get url(){return this._url}_makeAndAddFeatureSet(e,t=!0,r=null){const n=re(e,this._overridespref,null===r?["*"]:r,t,this._lrucache);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n}_loadMetaData(){var e=this;return(0,S.Z)(function*(){const t=yield xe(e._url);return e.metadata=t,t})()}load(){return this._loadMetaData()}clone(){return new De(this._url,this._overridespref,this._lrucache,this._interceptor)}featureSetByName(e,t=!0,r=null){var n=this;return(0,S.Z)(function*(){null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const l=JSON.stringify(r);for(let i=0;i<n._instantLayers.length;i++){const f=n._instantLayers[i];if(f.opitem.title===e&&f.includeGeometry===t&&f.outFields===l)return n._instantLayers[i].featureset}const s=yield n._loadMetaData();let c=null;for(const i of s.layers??[])i.name===e&&(c=i);if(!c)for(const i of s.tables??[])i.name===e&&(c=i);if(c){const i=yield ye(n._url+"/"+c.id,["*"]);return n._makeAndAddFeatureSet(i,t,r)}return null})()}featureSetById(e,t=!0,r=["*"]){var n=this;return(0,S.Z)(function*(){null===r&&(r=["*"]),r=(r=r.slice(0)).sort();const l=JSON.stringify(r);e=null!=e?e.toString():"";for(let i=0;i<n._instantLayers.length;i++){const f=n._instantLayers[i];if(f.opitem.id===e&&f.includeGeometry===t&&f.outFields===l)return n._instantLayers[i].featureset}const s=yield n._loadMetaData();let c=null;for(const i of s.layers??[])null!=i.id&&i.id.toString()===e&&(c=i);if(!c)for(const i of s.tables??[])null!=i.id&&i.id.toString()===e&&(c=i);if(c){const i=yield ye(n._url+"/"+c.id,["*"]);return n._makeAndAddFeatureSet(i,t,r)}return null})()}}function et(w,e,t=null,r=null){return new Ye(w,e,t,r)}function tt(w,e,t=null,r=null){return new De(w,e,t,r)}function rt(w,e,t,r,n){if(null===w)return null;if(w instanceof te.default){switch(e){case"datasource":return re(w,n,w.outFields,!0,t,r).getDataSourceFeatureSet();case"parent":case"root":return re(w,n,w.outFields,!0,t,r)}return null}if((0,O.$)(w)){switch(e){case"datasource":return re(w,n,w.outFields,!0,t,r).getDataSourceFeatureSet();case"parent":case"root":return re(w,n,w.outFields,!0,t,r)}return null}if((0,O.a0)(w)){switch(e){case"datasource":return re(w.parent,n,w.parent.outFields,!0,t,r).getDataSourceFeatureSet();case"parent":case"root":return re(w,n,w.parent.outFields,!0,t,r)}return null}if(w instanceof x.Z)switch(e){case"datasource":return w.getDataSourceFeatureSet();case"parent":return w;case"root":return w.getRootFeatureSet()}return null}function nt(w,e,t,r,n,l,s){return be.apply(this,arguments)}function be(){return(be=(0,S.Z)(function*(w,e,t,r,n,l,s,c=null){if($.Z.applicationCache){const f=$.Z.applicationCache.getLayerInfo(w+":"+l.url);if(f){const C=yield f;return re(new te.default({url:(0,m.US)(C.url)+"/"+e,outFields:["*"]}),t,r,n,s,c)}}const i=new ze.default({id:w,portal:l}).load();$.Z.applicationCache&&$.Z.applicationCache.setLayerInfo(w+":"+l.url,i);try{const f=yield i;return re(new te.default({url:(0,m.US)(f.url??"")+"/"+e,outFields:["*"]}),t,r,n,s,c)}catch(f){throw $.Z.applicationCache&&$.Z.applicationCache.clearLayerInfo(w+":"+l.url),f}})).apply(this,arguments)}},94511:(ne,q,h)=>{h.d(q,{$X:()=>m,QP:()=>T,TO:()=>N,Xx:()=>E,yN:()=>p});var S=h(15861),z=h(35458),Q=h(25137),O=h(70930),A=h(95418),M=h(58446),L=h(76961),b=h(77023),F=h(51172),x=h(85904),Z=h(43814);class v{constructor(I){this.field=I,this.sqlRewritable=!1}postInitialization(I,d){}}class m extends v{constructor(I){super(I),this.sqlRewritable=!0}extractValue(I){return I.attributes[this.field.name]}rewriteSql(I){return{rewritten:this.sqlRewritable,where:I}}}class T extends v{constructor(I,d,y){super((0,L.JW)(I)),this.originalField=I,this.sqlRewritable=!0,this.field.name=d,this.field.alias=y}rewriteSql(I,d){return{rewritten:this.sqlRewritable,where:(0,b.bB)(I,this.field.name,this.originalField.name,d.getFieldsIndex())}}extractValue(I){return I.attributes[this.originalField.name]}}let N=(()=>{class D extends v{constructor(d,y,u){super(d),this.codefield=y,this.lkp=u,this.reverseLkp={};for(const g in u)this.reverseLkp[u[g]]=g;this.sqlRewritable=!0}rewriteSql(d,y){const u=this.evaluateNodeToWhereClause(d.parseTree,L.Bj.Standardised,this.field.name,this.codefield instanceof x.WhereClause?(0,b.zR)(this.codefield,L.Bj.Standardised):this.codefield,d.parameters);return u.includes(D.BADNESS)?{rewritten:!1,where:d}:{rewritten:this.sqlRewritable,where:x.WhereClause.create(u,y._parent.getFieldsIndex(),y.dateFieldsTimeZoneDefaultUTC)}}evaluateNodeToWhereClause(d,y,u=null,g=null,_){let j,k,K,W;switch(d.type){case"interval":return(0,b.TE)(this.evaluateNodeToWhereClause(d.value,y,u,g,_),d.qualifier,d.op);case"case-expression":{let R=" CASE ";"simple"===d.format&&(R+=this.evaluateNodeToWhereClause(d.operand,y,u,D.BADNESS,_));for(let B=0;B<d.clauses.length;B++)R+=" WHEN "+this.evaluateNodeToWhereClause(d.clauses[B].operand,y,u,D.BADNESS,_)+" THEN "+this.evaluateNodeToWhereClause(d.clauses[B].value,y,u,D.BADNESS,_);return null!==d.else&&(R+=" ELSE "+this.evaluateNodeToWhereClause(d.else,y,u,D.BADNESS,_)),R+=" END ",R}case"parameter":{const R=_[d.value.toLowerCase()];if("string"==typeof R)return"'"+R.toString().replaceAll("'","''")+"'";if((0,L.J_)(R)||(0,L.T4)(R))return(0,b.vn)(R,y);if((0,L._U)(R))return(0,b.wF)(R,y);if((0,L.NP)(R))return(0,b.mA)(R,y);if((0,L.$A)(R))return(0,b.av)(R,y);if(R instanceof Array){const B=[];for(let V=0;V<R.length;V++)"string"==typeof R[V]?B.push("'"+R[V].toString().replaceAll("'","''")+"'"):(0,L.J_)(R[V])||(0,L.T4)(R[V])?B.push((0,b.vn)(R[V],y)):(0,L._U)(R[V])?B.push((0,b.wF)(R[V],y)):(0,L.NP)(R[V])?B.push((0,b.mA)(R[V],y)):(0,L.$A)(R[V])?B.push((0,b.av)(R[V],y)):B.push(R[V].toString());return B}return R.toString()}case"expression-list":k=[];for(const R of d.value)k.push(this.evaluateNodeToWhereClause(R,y,u,g,_));return k;case"unary-expression":return" ( NOT "+this.evaluateNodeToWhereClause(d.expr,y,u,D.BADNESS,_)+" ) ";case"binary-expression":switch(d.operator){case"AND":return" ("+this.evaluateNodeToWhereClause(d.left,y,u,g,_)+" AND "+this.evaluateNodeToWhereClause(d.right,y,u,g,_)+") ";case"OR":return" ("+this.evaluateNodeToWhereClause(d.left,y,u,g,_)+" OR "+this.evaluateNodeToWhereClause(d.right,y,u,g,_)+") ";case"IS":if("null"!==d.right.type)throw new O.eS(O.f.UnsupportedIsRhs);return" ("+this.evaluateNodeToWhereClause(d.left,y,u,g,_)+" IS NULL )";case"ISNOT":if("null"!==d.right.type)throw new O.eS(O.f.UnsupportedIsRhs);return" ("+this.evaluateNodeToWhereClause(d.left,y,u,g,_)+" IS NOT NULL )";case"IN":if(j=[],"expression-list"===d.right.type){if("column-reference"===d.left.type&&d.left.column.toUpperCase()===this.field.name.toUpperCase()){const R=[];let B=!0;for(const V of d.right.value){if("string"!==V.type){B=!1;break}if(void 0===this.lkp[V.value]){B=!1;break}R.push(this.lkp[V.value].toString())}if(B)return" ("+this.evaluateNodeToWhereClause(d.left,y,u,g,_)+" IN ("+R.join(",")+")) "}return j=this.evaluateNodeToWhereClause(d.right,y,u,g,_)," ("+this.evaluateNodeToWhereClause(d.left,y,u,g,_)+" IN ("+j.join(",")+")) "}return W=this.evaluateNodeToWhereClause(d.right,y,u,g,_),W instanceof Array?" ("+this.evaluateNodeToWhereClause(d.left,y,u,g,_)+" IN ("+W.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(d.left,y,u,g,_)+" IN ("+W+")) ";case"NOT IN":if(j=[],"expression-list"===d.right.type){if("column-reference"===d.left.type&&d.left.column.toUpperCase()===this.field.name.toUpperCase()){const R=[];let B=!0;for(const V of d.right.value){if("string"!==V.type){B=!1;break}if(void 0===this.lkp[V.value]){B=!1;break}R.push(this.lkp[V.value].toString())}if(B)return" ("+this.evaluateNodeToWhereClause(d.left,y,u,g,_)+" NOT IN ("+R.join(",")+")) "}return j=this.evaluateNodeToWhereClause(d.right,y,u,g,_)," ("+this.evaluateNodeToWhereClause(d.left,y,u,g,_)+" NOT IN ("+j.join(",")+")) "}return W=this.evaluateNodeToWhereClause(d.right,y,u,g,_),W instanceof Array?" ("+this.evaluateNodeToWhereClause(d.left,y,u,g,_)+" NOT IN ("+W.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(d.left,y,u,g,_)+" NOT IN ("+W+")) ";case"BETWEEN":return K=this.evaluateNodeToWhereClause(d.right,y,u,D.BADNESS,_)," ("+this.evaluateNodeToWhereClause(d.left,y,u,D.BADNESS,_)+" BETWEEN "+K[0]+" AND "+K[1]+" ) ";case"NOTBETWEEN":return K=this.evaluateNodeToWhereClause(d.right,y,u,D.BADNESS,_)," ("+this.evaluateNodeToWhereClause(d.left,y,u,D.BADNESS,_)+" NOT BETWEEN "+K[0]+" AND "+K[1]+" ) ";case"LIKE":return""!==d.escape?" ("+this.evaluateNodeToWhereClause(d.left,y,u,D.BADNESS,_)+" LIKE "+this.evaluateNodeToWhereClause(d.right,y,u,D.BADNESS,_)+" ESCAPE '"+d.escape+"') ":" ("+this.evaluateNodeToWhereClause(d.left,y,u,D.BADNESS,_)+" LIKE "+this.evaluateNodeToWhereClause(d.right,y,u,D.BADNESS,_)+") ";case"NOT LIKE":return""!==d.escape?" ("+this.evaluateNodeToWhereClause(d.left,y,u,D.BADNESS,_)+" NOT LIKE "+this.evaluateNodeToWhereClause(d.right,y,u,D.BADNESS,_)+" ESCAPE '"+d.escape+"') ":" ("+this.evaluateNodeToWhereClause(d.left,y,u,D.BADNESS,_)+" NOT LIKE "+this.evaluateNodeToWhereClause(d.right,y,u,D.BADNESS,_)+") ";case"<>":case"=":if("column-reference"===d.left.type&&"string"===d.right.type){if(d.left.column.toUpperCase()===this.field.name.toUpperCase()&&void 0!==this.lkp[d.right.value.toString()])return" ("+g+" "+d.operator+" "+this.lkp[d.right.value.toString()].toString()+") "}else if("column-reference"===d.right.type&&"string"===d.left.type&&d.right.column.toUpperCase()===this.field.name.toUpperCase())return" ("+this.lkp[d.right.value.toString()].toString()+" "+d.operator+" "+g+") ";return" ("+this.evaluateNodeToWhereClause(d.left,y,u,D.BADNESS,_)+" "+d.operator+" "+this.evaluateNodeToWhereClause(d.right,y,u,D.BADNESS,_)+") ";case"<":case">":case">=":case"<=":case"*":case"-":case"+":case"/":case"||":return" ("+this.evaluateNodeToWhereClause(d.left,y,u,D.BADNESS,_)+" "+d.operator+" "+this.evaluateNodeToWhereClause(d.right,y,u,D.BADNESS,_)+") "}case"null":return"null";case"boolean":return!0===d.value?"1":"0";case"string":return"'"+d.value.toString().replaceAll("'","''")+"'";case"timestamp":return`timestamp '${d.value}'`;case"date":return`date '${d.value}'`;case"time":return`time '${d.value}'`;case"number":return d.value.toString();case"current-time":return(0,b.vR)("date"===d.mode,y);case"column-reference":return u&&u.toLowerCase()===d.column.toLowerCase()?"("+g+")":d.column;case"data-type":return d.value;case"function":{const R=this.evaluateNodeToWhereClause(d.args,y,u,D.BADNESS,_);return(0,b.fz)(d.name,R,y)}}throw new O.eS(O.f.UnsupportedSyntax,{node:d.type})}extractValue(d){return this.codefield instanceof x.WhereClause?this.reverseLkp[x.WhereClause.convertValueToStorageFormat(this.codefield.calculateValueCompiled(d))]:this.reverseLkp[d.attributes[this.codefield]]}}return D.BADNESS="_!!!_BAD_LKP_!!!!",D})();class p extends v{constructor(I,d){super(I),this._sql=d}rewriteSql(I,d){return{rewritten:!0,where:(0,b.bB)(I,this.field.name,(0,b.zR)(this._sql,L.Bj.Standardised),d.getFieldsIndex())}}extractValue(I){return x.WhereClause.convertValueToStorageFormat(this._sql.calculateValueCompiled(I),this.field.type)}}class E extends A.Z{static findField(I,d){for(const y of I)if(y.name.toLowerCase()===d.toString().toLowerCase())return y;return null}constructor(I){super(I),this._calcFunc=null,this.declaredClass="esri.arcade.featureset.actions.Adapted",this.adaptedFields=[],this._extraFilter=null,this._extraFilter=I.extraFilter,this._parent=I.parentfeatureset,this._maxProcessing=30,this.adaptedFields=I.adaptedFields}_initialiseFeatureSet(){null!==this._parent?(this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.spatialReference=new Z.Z({wkid:4326}),this.objectIdField="",this.globalIdField="",this.geometryType=L.Qk.point,this.typeIdField="",this.types=null),this.fields=[];for(const I of this.adaptedFields)I.postInitialization(this,this._parent),this.fields.push(I.field)}_getSet(I){var d=this;return(0,S.Z)(function*(){if(null===d._wset){yield d._ensureLoaded();let y=null;return y=d._extraFilter?yield d._getFilteredSet("",null,null,null,I):yield d._parent?._getSet(I),d._checkCancelled(I),(0,F.O3)(y),d._wset=new M.Z(y._candidates.slice(0),y._known.slice(0),y._ordered,d._clonePageDefinition(y.pagesDefinition)),d._wset}return d._wset})()}_isInFeatureSet(I){return this._parent._isInFeatureSet(I)}_getFeatures(I,d,y,u){var g=this;return(0,S.Z)(function*(){const _=[];-1!==d&&void 0===g._featureCache[d]&&_.push(d);const j=g._maxQueryRate();if(!0===g._checkIfNeedToExpandKnownPage(I,j))return yield g._expandPagedSet(I,j,0,0,u),g._getFeatures(I,d,y,u);let k=0;for(let R=I._lastFetchedIndex;R<I._known.length&&(k++,k<=y&&(I._lastFetchedIndex+=1),!(void 0===g._featureCache[I._known[R]]&&(I._known[R]!==d&&_.push(I._known[R]),_.length>=j)));R++);if(0===_.length)return"success";I=new M.Z([],_,I._ordered,null);const K=Math.min(_.length,y);yield g._parent?._getFeatures(I,-1,K,u),g._checkCancelled(u);const W=[];for(let R=0;R<K;R++){const B=g._parent?._featureFromCache(_[R]);void 0!==B&&W.push({geometry:B.geometry,attributes:B.attributes,id:_[R]})}for(const R of W){const B=[];for(const V of g.adaptedFields)B[V.field.name]=V.extractValue(R);g._featureCache[R.id]=new z.Z({attributes:B,geometry:(0,Q.r1)(R.geometry)})}return"success"})()}_fetchAndRefineFeatures(){return(0,S.Z)(function*(){throw new O.EN(O.H9.NeverReach)})()}_getFilteredSet(I,d,y,u,g){var _=this;return(0,S.Z)(function*(){let j=!1;const k=_._reformulateWithoutAdaptions(y);j=k.cannot,y=k.where;let K=!1;if(null!==u){K=!0;const B=[];for(const V of _.adaptedFields)if(!(V instanceof m)&&!0===u.scanForField(V.field.name)){if(!(V instanceof T)){u=null,K=!1;break}B.push({field:V.field.name,newfield:V.originalField.name})}u&&B.length>0&&(u=u.replaceFields(B))}null!==y?null!==_._extraFilter&&(y=(0,b.$e)(_._extraFilter,y)):y=_._extraFilter,yield _._ensureLoaded();const W=yield _._parent._getFilteredSet(I,d,y,u,g);let R;return _._checkCancelled(g),R=!0===j?new M.Z(W._candidates.slice(0).concat(W._known.slice(0)),[],!0===K&&W._ordered,_._clonePageDefinition(W.pagesDefinition)):new M.Z(W._candidates.slice(0),W._known.slice(0),!0===K&&W._ordered,_._clonePageDefinition(W.pagesDefinition)),R})()}_reformulateWithoutAdaptions(I){const d={cannot:!1,where:I};if(null!==I)for(const y of this.adaptedFields)if(!0===(0,b.hq)(I,y.field.name)){const u=y.rewriteSql(I,this);if(!0!==u.rewritten){d.cannot=!0,d.where=null;break}d.where=u.where}return d}_stat(I,d,y,u,g,_,j){var k=this;return(0,S.Z)(function*(){let K=!1,W=k._reformulateWithoutAdaptions(d);if(K=W.cannot,d=W.where,W=k._reformulateWithoutAdaptions(g),K=K||W.cannot,null!==(g=W.where)?null!==k._extraFilter&&(g=(0,b.$e)(k._extraFilter,g)):g=k._extraFilter,!0===K)return null===g&&""===y&&null===u?k._manualStat(I,d,_,j):{calculated:!1};const R=yield k._parent._stat(I,d,y,u,g,_,j);return!1===R.calculated?null===g&&""===y&&null===u?k._manualStat(I,d,_,j):{calculated:!1}:R})()}_canDoAggregates(I,d,y,u,g){var _=this;return(0,S.Z)(function*(){if(null===_._parent)return!1;for(let K=0;K<I.length;K++)for(const W of _.adaptedFields)if(I[K].toLowerCase()===W.field.name.toLowerCase()&&!(W instanceof m))return!1;const j=[];for(let K=0;K<d.length;K++){const W=d[K];if(null!==W.workingexpr){const R=_._reformulateWithoutAdaptions(W.workingexpr);if(R.cannot)return!1;const B=W.clone();B.workingexpr=R.where,j.push(B)}else j.push(W)}const k=_._reformulateWithoutAdaptions(g);return!k.cannot&&(null!==(g=k.where)?null!==_._extraFilter&&(g=(0,b.$e)(_._extraFilter,g)):g=_._extraFilter,_._parent._canDoAggregates(I,j,y,u,g))})()}_getAggregatePagesDataSourceDefinition(I,d,y,u,g,_,j){var k=this;return(0,S.Z)(function*(){if(null===k._parent)throw new O.EN(O.H9.NeverReach);const K=[];for(let R=0;R<d.length;R++){const B=d[R];if(null!==B.workingexpr){const V=k._reformulateWithoutAdaptions(B.workingexpr);if(V.cannot)throw new O.EN(O.H9.NeverReach);const oe=B.clone();oe.workingexpr=V.where,K.push(oe)}else K.push(B)}const W=k._reformulateWithoutAdaptions(g);if(W.cannot)throw new O.EN(O.H9.NeverReach);return null!==(g=W.where)?null!==k._extraFilter&&(g=(0,b.$e)(k._extraFilter,g)):g=k._extraFilter,k._parent._getAggregatePagesDataSourceDefinition(I,K,y,u,g,_,j)})()}}},52034:(ne,q,h)=>{h.d(q,{Z:()=>x});var S=h(15861),z=h(70930),Q=h(95418),O=h(58446),A=h(76961),M=h(77023),L=h(79412),b=h(85904),F=h(43814);class x extends Q.Z{constructor(v){super(v),this.declaredClass="esri.arcade.featureset.actions.AttributeFilter",this._maxProcessing=1e3,this._parent=v.parentfeatureset,v.whereclause instanceof b.WhereClause?(this._whereclause=v.whereclause,this._whereClauseFunction=null):(this._whereClauseFunction=v.whereclause,this._whereclause=null)}_initialiseFeatureSet(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new F.Z({wkid:4326}),this.geometryType=A.Qk.point)}_getSet(v){var m=this;return(0,S.Z)(function*(){if(null===m._wset){yield m._ensureLoaded();const T=yield m._parent._getFilteredSet("",null,m._whereclause,null,v);return m._checkCancelled(v),m._wset=null!==m._whereClauseFunction?new O.Z(T._candidates.slice(0).concat(T._known.slice(0)),[],T._ordered,m._clonePageDefinition(T.pagesDefinition)):new O.Z(T._candidates.slice(0),T._known.slice(0),T._ordered,m._clonePageDefinition(T.pagesDefinition)),m._wset}return m._wset})()}_isInFeatureSet(v){let m=this._parent?._isInFeatureSet(v);return m===A.dj.NotInFeatureSet?m:(m=this._idstates[v],void 0===m?A.dj.Unknown:m)}_getFeature(v,m,T){return this._parent._getFeature(v,m,T)}_getFeatures(v,m,T,N){return this._parent._getFeatures(v,m,T,N)}_featureFromCache(v){return this._parent._featureFromCache(v)}executeWhereClause(v){return this._whereclause?.testFeature(v)??!1}executeWhereClauseDeferred(v){var m=this;return(0,S.Z)(function*(){if(null!==m._whereClauseFunction){const T=m._whereClauseFunction(v);return(0,L.y8)(T),T}return m.executeWhereClause(v)})()}_fetchAndRefineFeatures(v,m,T){var N=this;return(0,S.Z)(function*(){const p=new O.Z([],v,!1,null),E=Math.min(m,v.length);if(yield N._parent?._getFeatures(p,-1,E,T),N._checkCancelled(T),null==N._whereClauseFunction){for(let I=0;I<E;I++){const d=N._parent?._featureFromCache(v[I]);N._idstates[v[I]]=!0===N.executeWhereClause(d)?A.dj.InFeatureSet:A.dj.NotInFeatureSet}return"success"}const D=[];for(let I=0;I<E;I++){const d=N._parent?._featureFromCache(v[I]);D.push(yield N.executeWhereClauseDeferred(d))}for(let I=0;I<m;I++)N._idstates[v[I]]=!0===D[I]?A.dj.InFeatureSet:A.dj.NotInFeatureSet;return"success"})()}_getFilteredSet(v,m,T,N,p){var E=this;return(0,S.Z)(function*(){null!==E._whereClauseFunction||(null!==T?null!==E._whereclause&&(T=(0,M.$e)(E._whereclause,T)):T=E._whereclause),yield E._ensureLoaded();const D=yield E._parent._getFilteredSet(v,m,T,N,p);let I;return E._checkCancelled(p),I=null!==E._whereClauseFunction?new O.Z(D._candidates.slice(0).concat(D._known.slice(0)),[],D._ordered,E._clonePageDefinition(D.pagesDefinition)):new O.Z(D._candidates.slice(0),D._known.slice(0),D._ordered,E._clonePageDefinition(D.pagesDefinition)),I})()}_stat(v,m,T,N,p,E,D){var I=this;return(0,S.Z)(function*(){if(null!==I._whereClauseFunction)return null===p&&""===T&&null===N?I._manualStat(v,m,E,D):{calculated:!1};let d=I._whereclause;null!==p&&null!==I._whereclause&&(d=(0,M.$e)(I._whereclause,p));const y=yield I._parent._stat(v,m,T,N,d,E,D);return!1===y.calculated?null===p&&""===T&&null===N?I._manualStat(v,m,E,D):{calculated:!1}:y})()}_canDoAggregates(v,m,T,N,p){var E=this;return(0,S.Z)(function*(){return null===E._whereClauseFunction&&(null!==p?null!==E._whereclause&&(p=(0,M.$e)(E._whereclause,p)):p=E._whereclause,null!==E._parent&&E._parent._canDoAggregates(v,m,T,N,p))})()}_getAggregatePagesDataSourceDefinition(v,m,T,N,p,E,D){var I=this;return(0,S.Z)(function*(){if(null===I._parent)throw new z.EN(z.H9.NeverReach);return null!==p?null!==I._whereclause&&(p=(0,M.$e)(I._whereclause,p)):p=I._whereclause,I._parent._getAggregatePagesDataSourceDefinition(v,m,T,N,p,E,D)})()}static registerAction(){Q.Z._featuresetFunctions.filter=function(v){if("function"==typeof v)return new x({parentfeatureset:this,whereclause:v});let m=null;return v instanceof b.WhereClause&&(m=v),new x({parentfeatureset:this,whereclause:m})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}},11375:(ne,q,h)=>{h.d(q,{Z:()=>L});var S=h(15861),z=h(89018),Q=h(70930),O=h(95418),A=h(58446),M=h(25677);class L extends O.Z{constructor(F){super(F),this._orderbyclause=null,this.declaredClass="esri.arcade.featureset.actions.OrderBy",this._maxProcessing=100,this._orderbyclause=F.orderbyclause,this._parent=F.parentfeatureset}_getSet(F){var x=this;return(0,S.Z)(function*(){if(null===x._wset){yield x._ensureLoaded();const Z=yield x._getFilteredSet("",null,null,x._orderbyclause,F);return x._checkCancelled(F),x._wset=Z,x._wset}return x._wset})()}manualOrderSet(F,x){var Z=this;return(0,S.Z)(function*(){const v=yield Z.getIdColumnDictionary(F,[],-1,x);Z._orderbyclause?.order(v);const m=new A.Z([],[],!0,null);for(let T=0;T<v.length;T++)m._known.push(v[T].id);return m})()}getIdColumnDictionary(F,x,Z,v){var m=this;return(0,S.Z)(function*(){if(Z<F._known.length-1){const T=m._maxQueryRate();if("GETPAGES"===F._known[Z+1])return yield(0,z.a1)(m._parent._expandPagedSet(F,T,0,0,v)),m.getIdColumnDictionary(F,x,Z,v);let N=Z+1;const p=[];for(;N<F._known.length&&"GETPAGES"!==F._known[N];)p.push(F._known[N]),N++;Z+=p.length;const E=yield(0,z.a1)(m._parent._getFeatureBatch(p,v));m._checkCancelled(v);for(const D of E)x.push({id:D.attributes[m.objectIdField],feature:D});return m.getIdColumnDictionary(F,x,Z,v)}return F._candidates.length>0?(yield(0,z.a1)(m._refineSetBlock(F,m._maxProcessingRate(),v)),m._checkCancelled(v),m.getIdColumnDictionary(F,x,Z,v)):x})()}_isInFeatureSet(F){return this._parent._isInFeatureSet(F)}_getFeatures(F,x,Z,v){return this._parent._getFeatures(F,x,Z,v)}_featureFromCache(F){if(void 0===this._featureCache[F]){const x=this._parent._featureFromCache(F);return void 0===x?void 0:null===x?null:(this._featureCache[F]=x,x)}return this._featureCache[F]}_fetchAndRefineFeatures(){return(0,S.Z)(function*(){throw new Q.EN(Q.H9.NeverReach)})()}_getFilteredSet(F,x,Z,v,m){var T=this;return(0,S.Z)(function*(){yield T._ensureLoaded();const N=yield T._parent._getFilteredSet(F,x,Z,null===v?T._orderbyclause:v,m);T._checkCancelled(m);const p=new A.Z(N._candidates.slice(0),N._known.slice(0),N._ordered,T._clonePageDefinition(N.pagesDefinition));let E=!0;if(N._candidates.length>0&&(E=!1),!1===p._ordered){let D=yield T.manualOrderSet(p,m);return!1===E&&(null===x&&null===Z||(D=new A.Z(D._candidates.slice(0).concat(D._known.slice(0)),[],D._ordered,T._clonePageDefinition(D.pagesDefinition)))),D}return p})()}static registerAction(){O.Z._featuresetFunctions.orderBy=function(F){return""===F?this:new L({parentfeatureset:this,orderbyclause:new M.Z(F)})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}},92224:(ne,q,h)=>{h.d(q,{Z:()=>M});var S=h(15861),z=h(70930),Q=h(95418),O=h(58446),A=h(76961);class M extends Q.Z{constructor(b){super(b),this._topnum=0,this.declaredClass="esri.arcade.featureset.actions.Top",this._countedin=0,this._maxProcessing=100,this._topnum=b.topnum,this._parent=b.parentfeatureset}_getSet(b){var F=this;return(0,S.Z)(function*(){if(null===F._wset){yield F._ensureLoaded();const x=yield F._parent._getSet(b);return F._wset=new O.Z(x._candidates.slice(0),x._known.slice(0),!1,F._clonePageDefinition(x.pagesDefinition)),F._setKnownLength(F._wset)>F._topnum&&(F._wset._known=F._wset._known.slice(0,F._topnum)),F._setKnownLength(F._wset)>=F._topnum&&(F._wset._candidates=[]),F._wset}return F._wset})()}_setKnownLength(b){return b._known.length>0&&"GETPAGES"===b._known[b._known.length-1]?b._known.length-1:b._known.length}_isInFeatureSet(b){const F=this._parent._isInFeatureSet(b);if(F===A.dj.NotInFeatureSet)return F;const x=this._idstates[b];return x===A.dj.InFeatureSet||x===A.dj.NotInFeatureSet?x:F===A.dj.InFeatureSet&&void 0===x?this._countedin<this._topnum?(this._idstates[b]=A.dj.InFeatureSet,this._countedin++,A.dj.InFeatureSet):(this._idstates[b]=A.dj.NotInFeatureSet,A.dj.NotInFeatureSet):A.dj.Unknown}_expandPagedSet(b,F,x,Z,v){var m=this;return(0,S.Z)(function*(){if(null===m._parent)throw new z.EN(z.H9.NotImplemented);if(F>m._topnum&&(F=m._topnum),m._countedin>=m._topnum&&b.pagesDefinition.internal.set.length<=b.pagesDefinition.resultOffset){let N=b._known.length;return N>0&&"GETPAGES"===b._known[N-1]&&(b._known.length=N-1),N=b._candidates.length,N>0&&"GETPAGES"===b._candidates[N-1]&&(b._candidates.length=N-1),"success"}const T=yield m._parent._expandPagedSet(b,F,x,Z,v);return m._setKnownLength(b)>m._topnum&&(b._known.length=m._topnum),m._setKnownLength(b)>=m._topnum&&(b._candidates.length=0),T})()}_getFeatures(b,F,x,Z){var v=this;return(0,S.Z)(function*(){const m=[],T=v._maxQueryRate();if(!0===v._checkIfNeedToExpandKnownPage(b,T))return yield v._expandPagedSet(b,T,0,0,Z),v._getFeatures(b,F,x,Z);-1!==F&&void 0===v._featureCache[F]&&m.push(F);let N=0;for(let D=b._lastFetchedIndex;D<b._known.length&&(N++,N<=x&&(b._lastFetchedIndex+=1),!(void 0===v._featureCache[b._known[D]]&&(b._known[D]!==F&&m.push(b._known[D]),m.length>T)));D++);if(0===m.length)return"success";const p=new O.Z([],m,!1,null),E=Math.min(m.length,x);yield v._parent._getFeatures(p,-1,E,Z);for(let D=0;D<E;D++){const I=v._parent._featureFromCache(m[D]);void 0!==I&&(v._featureCache[m[D]]=I)}return"success"})()}_getFilteredSet(b,F,x,Z,v){var m=this;return(0,S.Z)(function*(){yield m._ensureLoaded();const T=yield m._getSet(v);return new O.Z(T._candidates.slice(0).concat(T._known.slice(0)),[],!1,m._clonePageDefinition(T.pagesDefinition))})()}_refineKnowns(b,F){let x=0,Z=null;const v=[];for(let m=0;m<b._candidates.length;m++){const T=this._isInFeatureSet(b._candidates[m]);if(T===A.dj.InFeatureSet){if(b._known.push(b._candidates[m]),x+=1,null===Z?Z={start:m,end:m}:Z.end===m-1?Z.end=m:(v.push(Z),Z={start:m,end:m}),b._known.length>=this._topnum)break}else if(T===A.dj.NotInFeatureSet)null===Z?Z={start:m,end:m}:Z.end===m-1?Z.end=m:(v.push(Z),Z={start:m,end:m}),x+=1;else if(T===A.dj.Unknown)break;if(x>=F)break}null!==Z&&v.push(Z);for(let m=v.length-1;m>=0;m--)b._candidates.splice(v[m].start,v[m].end-v[m].start+1);this._setKnownLength(b)>this._topnum&&(b._known=b._known.slice(0,this._topnum)),this._setKnownLength(b)>=this._topnum&&(b._candidates=[])}_stat(){return(0,S.Z)(function*(){return{calculated:!1}})()}_canDoAggregates(){return(0,S.Z)(function*(){return!1})()}static registerAction(){Q.Z._featuresetFunctions.top=function(b){return new M({parentfeatureset:this,topnum:b})}}getFieldsIndex(){return this._parent.getFieldsIndex()}}},54339:(ne,q,h)=>{h.d(q,{Z:()=>T});var S=h(15861),z=h(35458),Q=h(70930),O=h(95418),A=h(58446),M=h(76961),L=h(77023),b=h(32184),F=h(90373),x=h(46663),Z=h(50243),v=h(81247),m=h(91866);class T extends O.Z{constructor(p){super(p),this.declaredClass="esri.arcade.featureset.sources.FeatureLayerMemory",this._removeGeometry=!1,this._overrideFields=null,this._forceIsTable=!1,p.spatialReference&&(this.spatialReference=p.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=p.layer,this._wset=null,!0===p.isTable&&(this._forceIsTable=!0),void 0!==p.outFields&&(this._overrideFields=p.outFields),void 0!==p.includeGeometry&&(this._removeGeometry=!1===p.includeGeometry)}_maxQueryRate(){return M.tI}end(){return this._layer}optimisePagingFeatureQueries(){}loadImpl(){var p=this;return(0,S.Z)(function*(){return!0===p._layer.loaded?(p._initialiseFeatureSet(),p):(yield p._layer.load(),p._initialiseFeatureSet(),p)})()}get gdbVersion(){return""}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{const p=[],E=[];for(const D of this.fields)if("oid"===D.type)p.push(D),E.push(D.name);else for(const I of this._overrideFields)if(I.toLowerCase()===D.name.toLowerCase()){p.push(D),E.push(D.name);break}this.fields=p,this._overrideFields=E}this.objectIdField=this._layer.objectIdField;for(const p of this.fields)"global-id"===p.type&&(this.globalIdField=p.name);this._databaseType=M.Bj.Standardised,this.hasZ=!0===this._layer?.capabilities?.data?.supportsZ,this.hasM=!0===this._layer?.capabilities?.data?.supportsM,this._layer instanceof x.default?(this.typeIdField=this._layer.subtypeField??"",this.types=this._layer.subtypes):(this.typeIdField=this._layer.typeIdField??"",this.types=this._layer.types)}isTable(){return this._forceIsTable||this._layer.isTable||"table"===this._layer.type||!this._layer.geometryType}_isInFeatureSet(){return M.dj.InFeatureSet}_candidateIdTransform(p){return p}_getSet(p){var E=this;return(0,S.Z)(function*(){if(null===E._wset){yield E._ensureLoaded();const D=yield E._getFilteredSet("",null,null,null,p);return E._wset=D,D}return E._wset})()}_changeFeature(p){const E={};for(const D of this.fields)E[D.name]=p.attributes[D.name];return new z.Z({geometry:!0===this._removeGeometry?null:p.geometry,attributes:E})}_getFilteredSet(p,E,D,I,d){var y=this;return(0,S.Z)(function*(){let u="",g=!1;if(null!==I&&(u=I.constructClause(),g=!0),y.isTable()&&E&&null!==p&&""!==p)return new A.Z([],[],!0,null);const _=new m.Z;_.returnZ=y.hasZ,_.returnM=y.hasM,_.where=null===D?null===E?"1=1":"":(0,L.zR)(D,M.Bj.Standardised),_.spatialRelationship=y._makeRelationshipEnum(p),_.outSpatialReference=y.spatialReference,_.orderByFields=""!==u?u.split(","):null,_.geometry=null===E?null:E,_.returnGeometry=!0,_.relationParameter=y._makeRelationshipParam(p);const j=yield y._layer.queryFeatures(_);if(null===j)return new A.Z([],[],g,null);y._checkCancelled(d);const k=[];return j.features.forEach(K=>{const W=K.attributes[y._layer.objectIdField];k.push(W),y._featureCache[W]=y._changeFeature(K)}),new A.Z([],k,g,null)})()}_makeRelationshipEnum(p){if(p.includes("esriSpatialRelRelation"))return"relation";switch(p){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return p}_makeRelationshipParam(p){return p.includes("esriSpatialRelRelation")?p.split(":")[1]:""}_queryAllFeatures(){var p=this;return(0,S.Z)(function*(){if(p._wset)return p._wset;const E=new m.Z;if(E.where="1=1",yield p._ensureLoaded(),p._layer.source&&p._layer.source.items){const d=[];return p._layer.source.items.forEach(y=>{const u=y.attributes[p._layer.objectIdField];d.push(u),p._featureCache[u]=p._changeFeature(y)}),p._wset=new A.Z([],d,!1,null),p._wset}E.returnZ=p.hasZ,E.returnM=p.hasM;const D=yield p._layer.queryFeatures(E),I=[];return D.features.forEach(d=>{const y=d.attributes[p._layer.objectIdField];I.push(y),p._featureCache[y]=p._changeFeature(d)}),p._wset=new A.Z([],I,!1,null),p._wset})()}_getFeatures(p,E,D){var I=this;return(0,S.Z)(function*(){const d=[];-1!==E&&void 0===I._featureCache[E]&&d.push(E);for(let y=p._lastFetchedIndex;y<p._known.length&&(p._lastFetchedIndex+=1,!(void 0===I._featureCache[p._known[y]]&&(p._known[y]!==E&&d.push(p._known[y]),d.length>D)));y++);if(0===d.length)return"success";throw new Q.EN(Q.H9.MissingFeatures)})()}_refineSetBlock(p){return(0,S.Z)(function*(){return p})()}_stat(){return(0,S.Z)(function*(){return{calculated:!1}})()}_canDoAggregates(){return(0,S.Z)(function*(){return!1})()}relationshipMetaData(){return[]}static _cloneAttr(p){const E={};for(const D in p)E[D]=p[D];return E}nativeCapabilities(){return{title:this._layer.title??"",canQueryRelated:!1,source:this,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:!0}}static create(p,E){let D=p.layerDefinition.objectIdField;const I=p.layerDefinition.typeIdField??"",d=[];if(p.layerDefinition.types)for(const R of p.layerDefinition.types)d.push(Z.Z.fromJSON(R));let y=p.layerDefinition.geometryType;void 0===y&&(y=p.featureSet.geometryType||"");let u=p.featureSet.features;const g=E.toJSON();if(!D){let R=!1;for(const B of p.layerDefinition.fields)if("oid"===B.type||"esriFieldTypeOID"===B.type){D=B.name,R=!0;break}if(!1===R){let B="FID",V=!0,oe=0;for(;V;){let ie=!0;for(const te of p.layerDefinition.fields)if(te.name===B){ie=!1;break}!0===ie?V=!1:(oe++,B="FID"+oe.toString())}p.layerDefinition.fields.push({type:"esriFieldTypeOID",name:B,alias:B});const ue=[];for(let ie=0;ie<u.length;ie++)ue.push({geometry:p.featureSet.features[ie].geometry,attributes:p.featureSet.features[ie].attributes?this._cloneAttr(p.featureSet.features[ie].attributes):{}}),ue[ie].attributes[B]=ie;u=ue,D=B}}const _=[];for(const R of p.layerDefinition.fields)_.push(R instanceof v.Z?R:v.Z.fromJSON(R));let j=y;switch(j||(j=""),j){case"esriGeometryPoint":j="point";break;case"esriGeometryPolyline":j="polyline";break;case"esriGeometryPolygon":j="polygon";break;case"esriGeometryEnvelope":j="extent";break;case"esriGeometryMultipoint":j="multipoint";break;case"":case"esriGeometryNull":j="esriGeometryNull"}if("esriGeometryNull"!==j)for(const R of u)R.geometry&&!(R.geometry instanceof b.Z)&&(R.geometry.type=j,void 0===R.geometry.spatialReference&&(R.geometry.spatialReference=g));else for(const R of u)R.geometry&&(R.geometry=null);const k={outFields:["*"],source:u,fields:_,hasZ:!0===p?.layerDefinition?.hasZ||!0===p?.featureSet?.hasZ,hasM:!0===p?.layerDefinition?.hasM||!0===p?.featureSet?.hasM,types:d,typeIdField:I,objectIdField:D,spatialReference:E},K="esriGeometryNull"===j||null===j;K||(k.geometryType=j);const W=new F.default(k);return new T({layer:W,spatialReference:E,isTable:K})}queryAttachments(){return(0,S.Z)(function*(){return[]})()}getFeatureByObjectId(p){var E=this;return(0,S.Z)(function*(){const D=new m.Z;D.where=E.objectIdField+"="+p.toString(),D.returnZ=E.hasZ,D.returnM=E.hasM;const I=yield E._layer.queryFeatures(D);return 1===I.features.length?I.features[0]:null})()}getOwningSystemUrl(){return(0,S.Z)(function*(){return""})()}getIdentityUser(){return(0,S.Z)(function*(){return""})()}get preferredTimeZone(){return this._layer.preferredTimeZone??null}get dateFieldsTimeZone(){return this._layer.dateFieldsTimeZone??null}get datesInUnknownTimezone(){return this._layer?.datesInUnknownTimezone}get editFieldsInfo(){return this._layer?.editFieldsInfo}get timeInfo(){return this._layer?.timeInfo}getFeatureSetInfo(){var p=this;return(0,S.Z)(function*(){const E=p._layer.title&&p._layer.parent;return p.fsetInfo??{layerId:null,layerName:null,itemId:null,serviceLayerUrl:null,webMapLayerId:E?p._layer.id??null:null,webMapLayerTitle:E?p._layer.title??null:null,className:null,objectClassId:null}})()}}},25677:(ne,q,h)=>{function S(Q,O){return Q===O?0:null===Q?-1:null===O?1:Q<O?-1:1}h.d(q,{Z:()=>z});class z{constructor(O){const A=O.split(",");this._fields=[],this._directions=[];for(let M=0;M<A.length;M++){const L=A[M].match(/\S+/g);this._fields.push(L[0]),2===L.length?"asc"===L[1].toLowerCase()?this._directions.push(1):this._directions.push(0):this._directions.push(1)}}constructClause(){let O="";for(let A=0;A<this._fields.length;A++)0!==A&&(O+=","),O+=this._fields[A],O+=1===this._directions[A]?" ASC":" DESC";return O}order(O){O.sort((A,M)=>{for(let L=0;L<this._fields.length;L++){const b=this.featureValue(A.feature,this._fields[L],L),F=this.featureValue(M.feature,this._fields[L],L);let x=0;if(x=1===this._directions[L]?S(b,F):-1*S(b,F),0!==x)return x}return 0})}scanForField(O){for(let A=0;A<this._fields.length;A++)if(this._fields[A].toLowerCase().trim()===O.toLowerCase().trim())return!0;return!1}replaceFields(O){let A="";for(let M=0;M<this._fields.length;M++){0!==M&&(A+=",");let L=this._fields[M];for(const b of O)if(L.toLowerCase()===b.field.toLowerCase()){L=b.newfield;break}A+=L,A+=1===this._directions[M]?" ASC":" DESC"}return new z(A)}featureValue(O,A,M){const L=O.attributes[A];if(void 0!==L)return L;for(const b in O.attributes)if(A.toLowerCase()===b.toLowerCase())return this._fields[M]=b,O.attributes[b];return null}}},24859:(ne,q,h)=>{h.d(q,{P:()=>A});var S=h(15861),z=h(15462),Q=h(82784),O=h(91866);function A(L,b,F){return M.apply(this,arguments)}function M(){return(M=(0,S.Z)(function*(L,b,F){const x=(0,z.en)(L);return(0,Q.hH)(x,O.Z.from(b),{...F}).then(Z=>Z.data.count)})).apply(this,arguments)}},61375:(ne,q,h)=>{h.d(q,{G:()=>A});var S=h(15861),z=h(15462),Q=h(82784),O=h(91866);function A(L,b,F){return M.apply(this,arguments)}function M(){return(M=(0,S.Z)(function*(L,b,F){const x=(0,z.en)(L);return(0,Q.Ev)(x,O.Z.from(b),{...F}).then(Z=>Z.data.objectIds)})).apply(this,arguments)}},46708:(ne,q,h)=>{h.d(q,{F:()=>b,e:()=>M});var S=h(15861),z=h(15462),Q=h(82784),O=h(93792),A=h(91866);function M(x,Z,v){return L.apply(this,arguments)}function L(){return(L=(0,S.Z)(function*(x,Z,v){const m=yield b(x,Z,v);return O.Z.fromJSON(m)})).apply(this,arguments)}function b(x,Z,v){return F.apply(this,arguments)}function F(){return(F=(0,S.Z)(function*(x,Z,v){const m=(0,z.en)(x),T={...v},N=A.Z.from(Z),{data:p}=yield(0,Q.JT)(m,N,N.sourceSpatialReference,T);return p})).apply(this,arguments)}},36026:(ne,q,h)=>{h.d(q,{t:()=>I});var S=h(15861),z=h(15462),Q=h(51172),O=h(53456),A=h(10842);function M(y,u){return u}function L(y,u,g,_){switch(g){case 0:return Z(y,u+_,0);case 1:return"lowerLeft"===y.originPosition?Z(y,u+_,1):function v({translate:y,scale:u},g,_){return y[_]-g*u[_]}(y,u+_,1)}}function b(y,u,g,_){return 2===g?Z(y,u,2):L(y,u,g,_)}function F(y,u,g,_){return 2===g?Z(y,u,3):L(y,u,g,_)}function x(y,u,g,_){return 3===g?Z(y,u,3):b(y,u,g,_)}function Z({translate:y,scale:u},g,_){return y[_]+g*u[_]}class m{constructor(u){this._options=u,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this._previousCoordinate=[0,0],this._transform=null,this._applyTransform=M,this._lengths=[],this._currentLengthIndex=0,this._toAddInCurrentPath=0,this._vertexDimension=0,this._coordinateBuffer=null,this._coordinateBufferPtr=0,this._attributesConstructor=class{}}createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(u){if(this._options.applyTransform&&(u.transform=null),this._attributesConstructor=class{},this._coordinateBuffer=null,this._lengths.length=0,!u.hasZ)return;const g=(0,O.k)(u.geometryType,this._options.sourceSpatialReference,u.spatialReference);if(null!=g)for(const _ of u.features)g(_.geometry)}createSpatialReference(){return{}}addField(u,g){const _=u.fields;(0,Q.O3)(_),_.push(g);const j=_.map(k=>k.name);this._attributesConstructor=function(){for(const k of j)this[k]=null}}addFeature(u,g){u.features.push(g)}prepareFeatures(u){switch(this._transform=u.transform,this._options.applyTransform&&u.transform&&(this._applyTransform=this._deriveApplyTransform(u)),this._vertexDimension=2,u.hasZ&&this._vertexDimension++,u.hasM&&this._vertexDimension++,u.geometryType){case"esriGeometryPoint":this.addCoordinate=(g,_,j)=>this.addCoordinatePoint(g,_,j),this.createGeometry=g=>this.createPointGeometry(g);break;case"esriGeometryPolygon":this.addCoordinate=(g,_,j)=>this._addCoordinatePolygon(g,_,j),this.createGeometry=g=>this._createPolygonGeometry(g);break;case"esriGeometryPolyline":this.addCoordinate=(g,_,j)=>this._addCoordinatePolyline(g,_,j),this.createGeometry=g=>this._createPolylineGeometry(g);break;case"esriGeometryMultipoint":this.addCoordinate=(g,_,j)=>this._addCoordinateMultipoint(g,_,j),this.createGeometry=g=>this._createMultipointGeometry(g)}}createFeature(){return this._lengths.length=0,this._currentLengthIndex=0,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0,this._coordinateBuffer=null,this._coordinateBufferPtr=0,{attributes:new this._attributesConstructor}}allocateCoordinates(){}addLength(u,g,_){0===this._lengths.length&&(this._toAddInCurrentPath=g),this._lengths.push(g)}addQueryGeometry(u,g){const{queryGeometry:_,queryGeometryType:j}=g,k=(0,A.$g)(_.clone(),_,!1,!1,this._transform),K=(0,A.di)(k,j,!1,!1);u.queryGeometryType=j,u.queryGeometry={...K}}createPointGeometry(u){const g={x:0,y:0,spatialReference:u.spatialReference};return u.hasZ&&(g.z=0),u.hasM&&(g.m=0),g}addCoordinatePoint(u,g,_){switch(g=this._applyTransform(this._transform,g,_,0),_){case 0:u.x=g;break;case 1:u.y=g;break;case 2:"z"in u?u.z=g:u.m=g;break;case 3:u.m=g}}_transformPathLikeValue(u,g){let _=0;return g<=1&&(_=this._previousCoordinate[g],this._previousCoordinate[g]+=u),this._applyTransform(this._transform,u,g,_)}_addCoordinatePolyline(u,g,_){this._dehydratedAddPointsCoordinate(u.paths,g,_)}_addCoordinatePolygon(u,g,_){this._dehydratedAddPointsCoordinate(u.rings,g,_)}_addCoordinateMultipoint(u,g,_){0===_&&u.points.push([]);const j=this._transformPathLikeValue(g,_);u.points[u.points.length-1].push(j)}_createPolygonGeometry(u){return{rings:[[]],spatialReference:u.spatialReference,hasZ:!!u.hasZ,hasM:!!u.hasM}}_createPolylineGeometry(u){return{paths:[[]],spatialReference:u.spatialReference,hasZ:!!u.hasZ,hasM:!!u.hasM}}_createMultipointGeometry(u){return{points:[],spatialReference:u.spatialReference,hasZ:!!u.hasZ,hasM:!!u.hasM}}_dehydratedAddPointsCoordinate(u,g,_){0===_&&0==this._toAddInCurrentPath--&&(u.push([]),this._toAddInCurrentPath=this._lengths[++this._currentLengthIndex]-1,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0);const j=this._transformPathLikeValue(g,_),k=u[u.length-1];0===_&&(this._coordinateBufferPtr=0,this._coordinateBuffer=new Array(this._vertexDimension),k.push(this._coordinateBuffer)),this._coordinateBuffer[this._coordinateBufferPtr++]=j}_deriveApplyTransform(u){const{hasZ:g,hasM:_}=u;return g&&_?x:g?b:_?F:L}}var T=h(82784),p=(h(93792),h(91866));function I(y,u,g){return d.apply(this,arguments)}function d(){return(d=(0,S.Z)(function*(y,u,g){const _=(0,z.en)(y),j={...g},k=p.Z.from(u),K=!k.quantizationParameters,{data:W}=yield(0,T.qp)(_,k,new m({sourceSpatialReference:k.sourceSpatialReference,applyTransform:K}),j);return W})).apply(this,arguments)}},85596:(ne,q,h)=>{h.d(q,{Z:()=>m});var x,S=h(50484),z=h(89317),Q=h(80543),O=h(1535),L=(h(57678),h(14007),h(10141));const Z={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let v=x=class extends z.wq{constructor(T){super(T),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:T}=this,N=function b(T){const{exifInfo:N,exifName:p,tagName:E}=T;if(!N||!p||!E)return null;const D=N.find(I=>I.name===p);return D?function F(T){const{tagName:N,tags:p}=T;return p&&N&&p.find(D=>D.name===N)?.value||null}({tagName:E,tags:D.tags}):null}({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:T});return Z[N]||null}clone(){return new x({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};(0,S._)([(0,Q.Cb)({type:String})],v.prototype,"contentType",void 0),(0,S._)([(0,Q.Cb)()],v.prototype,"exifInfo",void 0),(0,S._)([(0,Q.Cb)({readOnly:!0})],v.prototype,"orientationInfo",null),(0,S._)([(0,Q.Cb)({type:O.z8})],v.prototype,"id",void 0),(0,S._)([(0,Q.Cb)({type:String})],v.prototype,"globalId",void 0),(0,S._)([(0,Q.Cb)({type:String})],v.prototype,"keywords",void 0),(0,S._)([(0,Q.Cb)({type:String})],v.prototype,"name",void 0),(0,S._)([(0,Q.Cb)({json:{read:!1}})],v.prototype,"parentGlobalId",void 0),(0,S._)([(0,Q.Cb)({json:{read:!1}})],v.prototype,"parentObjectId",void 0),(0,S._)([(0,Q.Cb)({type:O.z8})],v.prototype,"size",void 0),(0,S._)([(0,Q.Cb)({json:{read:!1}})],v.prototype,"url",void 0),v=x=(0,S._)([(0,L.j)("esri.layers.support.AttachmentInfo")],v);const m=v}}]);