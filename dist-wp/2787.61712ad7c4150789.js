"use strict";(self.webpackChunkangular_17_test=self.webpackChunkangular_17_test||[]).push([[2787,5251],{60084:(F,E,i)=>{i.d(E,{D:()=>f});var c=i(26496);function f(M){M?.writtenProperties&&M.writtenProperties.forEach(({target:y,propName:P,newOrigin:O})=>{(0,c.l)(y)&&O&&y.originOf(P)!==O&&y.updateOrigin(P,O)})}},26496:(F,E,i)=>{function c(f){return f&&"getAtOrigin"in f&&"originOf"in f}i.d(E,{l:()=>c})},5251:(F,E,i)=>{i.r(E),i.d(E,{addOrUpdateResource:()=>N,contentToBlob:()=>j,fetchResources:()=>P,getSiblingOfSameType:()=>W,getSiblingOfSameTypeI:()=>w,removeAllResources:()=>T,removeResource:()=>G,splitPrefixFileNameAndExtension:()=>p});var c=i(15861),f=i(66476),M=i(57964),y=i(6785);function P(o){return O.apply(this,arguments)}function O(){return(O=(0,c.Z)(function*(o,r={},s){yield o.load(s);const u=(0,y.v_)(o.itemUrl,"resources"),{start:_=1,num:v=10,sortOrder:h="asc",sortField:D="created"}=r,g={query:{start:_,num:v,sortOrder:h,sortField:D,token:o.apiKey},signal:s?.signal},d=yield o.portal.request(u,g);return{total:d.total,nextStart:d.nextStart,resources:d.resources.map(({created:C,size:S,resource:B})=>({created:new Date(C),size:S,resource:o.resourceFromPath(B)}))}})).apply(this,arguments)}function N(o,r,s,u){return x.apply(this,arguments)}function x(){return(x=(0,c.Z)(function*(o,r,s,u){if(!o.hasPath())throw new M.Z(`portal-item-resource-${r}:invalid-path`,"Resource does not have a valid path");const _=o.portalItem;yield _.load(u);const v=(0,y.v_)(_.userItemUrl,"add"===r?"addResources":"updateResources"),[h,D]=b(o.path),g=new FormData;return h&&"."!==h&&g.append("resourcesPrefix",h),null!=u&&u.compress&&g.append("compress","true"),g.append("fileName",D),g.append("file",s,D),g.append("f","json"),u?.access&&g.append("access",u.access),yield _.portal.request(v,{method:"post",body:g,signal:u?.signal}),o})).apply(this,arguments)}function G(o,r,s){return U.apply(this,arguments)}function U(){return(U=(0,c.Z)(function*(o,r,s){if(!r.hasPath())throw new M.Z("portal-item-resources-remove:invalid-path","Resource does not have a valid path");yield o.load(s);const u=(0,y.v_)(o.userItemUrl,"removeResources");yield o.portal.request(u,{method:"post",query:{resource:r.path},signal:s?.signal}),r.portalItem=null})).apply(this,arguments)}function T(o,r){return R.apply(this,arguments)}function R(){return(R=(0,c.Z)(function*(o,r){yield o.load(r);const s=(0,y.v_)(o.userItemUrl,"removeResources");return o.portal.request(s,{method:"post",query:{deleteAll:!0},signal:r?.signal})})).apply(this,arguments)}function b(o){const r=o.lastIndexOf("/");return-1===r?[".",o]:[o.slice(0,r),o.slice(r+1)]}function p(o){const[r,s]=function L(o){const r=(0,y.Ml)(o);return null==r?[o,""]:[o.slice(0,o.length-r.length-1),`.${r}`]}(o),[u,_]=b(r);return[u,_,s]}function j(o){return A.apply(this,arguments)}function A(){return(A=(0,c.Z)(function*(o){return"blob"===o.type?o.blob:"json"===o.type?new Blob([o.jsonString],{type:"application/json"}):(yield(0,f.Z)(o.url,{responseType:"blob"})).data})).apply(this,arguments)}function W(o,r){if(!o.hasPath())return null;const[s,,u]=p(o.path);return o.portalItem.resourceFromPath((0,y.v_)(s,r+u))}function w(o,r){if(!o.hasPath())return null;const[s,,u]=p(o.path);return o.portalItem.resourceFromPath((0,y.v_)(s,r+u))}},65820:(F,E,i)=>{i.d(E,{w:()=>y});var c=i(11931),f=i(57964),M=i(40907);function y(P){if(c.default.apiKey&&(0,M.r)(P.portal.url))throw new f.Z("save-api-key-utils:api-key-not-supported",`Saving is not supported on ${P.portal.url} when using an api key`)}},46018:(F,E,i)=>{i.d(E,{Hn:()=>N,Pl:()=>w,bx:()=>G});var c=i(15861),f=i(37636),M=i(57964),y=i(79412),P=i(19986),O=i(5251);function N(r,s){return x.apply(this,arguments)}function x(){return(x=(0,c.Z)(function*(r,s,u=null){const _=yield T(r,s,u);yield b(_,s,u)})).apply(this,arguments)}function G(r,s,u,_){return U.apply(this,arguments)}function U(){return(U=(0,c.Z)(function*(r,s,u,_,v=null){const h=yield T(u,_,v);yield r.update({data:s}),yield b(h,_,v)})).apply(this,arguments)}function T(r,s){return R.apply(this,arguments)}function R(){return(R=(0,c.Z)(function*(r,s,u=null){if(!s?.resources)return;const _=s.portalItem===r.portalItem?new Set(r.paths):new Set;r.paths.length=0,r.portalItem=s.portalItem;const v=new Set(s.resources.toKeep.map(d=>d.resource.path)),h=new Set,D=[];v.forEach(d=>{_.delete(d),r.paths.push(d)});for(const d of s.resources.toUpdate)if(_.delete(d.resource.path),v.has(d.resource.path)||h.has(d.resource.path)){const{resource:C,content:S,finish:B,error:V}=d,k=(0,O.getSiblingOfSameTypeI)(C,(0,P.DO)());r.paths.push(k.path),D.push(L({resource:k,content:S,compress:d.compress,finish:B,error:V},u))}else r.paths.push(d.resource.path),D.push(A(d,u)),h.add(d.resource.path);for(const d of s.resources.toAdd)r.paths.push(d.resource.path),_.has(d.resource.path)?_.delete(d.resource.path):D.push(L(d,u));if(0===D.length)return _;const g=yield(0,y.UO)(D);if((0,y.k_)(u),g.length>0)throw new M.Z("save:resources","Failed to save one or more resources",{errors:g});return _})).apply(this,arguments)}function b(r,s){return p.apply(this,arguments)}function p(){return(p=(0,c.Z)(function*(r,s,u=null){if(!r||!s.portalItem)return;const _=[];for(const v of r){const h=s.portalItem.resourceFromPath(v);_.push(h.portalItem.removeResource(h,u))}yield(0,y.as)(_)})).apply(this,arguments)}function L(r,s){return j.apply(this,arguments)}function j(){return(j=(0,c.Z)(function*(r,s){const u={...s??{},compress:r.compress},_=yield(0,f.q6)(r.resource.portalItem.addResource(r.resource,yield(0,O.contentToBlob)(r.content),u));if(!0!==_.ok)throw r.error?.(_.error),_.error;r.finish?.(r.resource)})).apply(this,arguments)}function A(r,s){return W.apply(this,arguments)}function W(){return(W=(0,c.Z)(function*(r,s){const u=yield(0,f.q6)(r.resource.update(yield(0,O.contentToBlob)(r.content),s));if(!0!==u.ok)throw r.error?.(u.error),u.error;r.finish?.(r.resource)})).apply(this,arguments)}function w(r){return o.apply(this,arguments)}function o(){return(o=(0,c.Z)(function*(r){const s=[];for(const u of r.allLayers)if("beforeSave"in u&&"function"==typeof u.beforeSave){const _=u.beforeSave();_&&s.push(_)}yield Promise.allSettled(s)})).apply(this,arguments)}},12787:(F,E,i)=>{i.r(E),i.d(E,{save:()=>r,saveAs:()=>u});var c=i(15861),f=i(57964),M=i(3233),y=i(77675),P=i(6785),O=i(60084),N=i(43814),x=i(33721),G=i(48230),U=i(89713),T=i(85971),R=i(61018),b=i(27835),p=i(50318),L=i(22497),j=i(93305),A=i(63335),W=i(65820),w=i(46018);const o=["NatGeo_World_Map","Ocean_Basemap","USA_Topo_Maps","World_Imagery","World_Street_Map","World_Terrain_Base","World_Topo_Map","World_Hillshade","Canvas/World_Light_Gray_Base","Canvas/World_Light_Gray_Reference","Canvas/World_Dark_Gray_Base","Canvas/World_Dark_Gray_Reference","Ocean/World_Ocean_Base","Ocean/World_Ocean_Reference","Reference/World_Boundaries_and_Places","Reference/World_Reference_Overlay","Reference/World_Transportation"].map(t=>t.toLowerCase());function r(t,e,n){return s.apply(this,arguments)}function s(){return s=(0,c.Z)(function*(t,e,n){n??={},function v(t,e){if(!e.portalItem)throw new f.Z(`${t.name}:portal-item-not-set`,"Portal item to save to has not been set on the WebMap");(0,W.w)(e.portalItem),h(t,e.portalItem)}(t,e),yield(0,y.N1)(()=>!e.updatingFromView),yield e.load(),yield C(e),yield(0,w.Pl)(e),yield D(t,e);const a=e.portalItem,l=(0,P.mN)(a.itemUrl),m={origin:"web-map",messages:[],writtenProperties:[],url:l,portal:a.portal||R.Z.getDefault(),portalItem:a,verifyItemRelativeUrls:l?{rootPath:l.path,writtenUrls:[]}:null,blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},I=e.write({},m);return yield Promise.all(m.resources.pendingOperations),S(t,m,n),yield B(e,a),yield function We(t,e,n,a,l){return Y.apply(this,arguments)}(t,e,a,I,m),yield Promise.all([e.updateItemThumbnail(),(0,w.Hn)(e.resourceReferences,m,null)]),a}),s.apply(this,arguments)}function u(t,e,n,a){return _.apply(this,arguments)}function _(){return _=(0,c.Z)(function*(t,e,n,a){a??={};const l=function d(t,e){let n=b.default.from(e);return n.id&&(n=n.clone(),n.id=null),n.type||(n.type=t.itemType),n.portal||(n.portal=R.Z.getDefault()),(0,W.w)(n),h(t,n),n}(t,n);yield(0,y.N1)(()=>!e.updatingFromView),yield e.load(),yield C(e),yield(0,w.Pl)(e),yield D(t,e);const m={origin:"web-map",messages:[],writtenProperties:[],url:null,portal:l.portal,portalItem:l,blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},I=e.write({},m);yield Promise.all(m.resources.pendingOperations),S(t,m,a),yield function he(t,e){return z.apply(this,arguments)}(e,l);const K=e.getThumbnailState();return(yield function we(t,e,n,a,l,m){return q.apply(this,arguments)}(t,e,l,I,m,a))&&(e.resourceReferences.portalItem=l),e.restoreThumbnailFromState(K),yield Promise.all([e.updateItemThumbnail(),(0,w.Hn)(e.resourceReferences,m,null)]),l}),_.apply(this,arguments)}function h(t,e){if(e.type!==t.itemType)throw new f.Z(`${t.name}:portal-item-wrong-type`,`Portal item needs to have type "${t.itemType}"`)}function D(t,e){return g.apply(this,arguments)}function g(){return(g=(0,c.Z)(function*(t,e){if(!e.basemap?.baseLayers.length)throw new f.Z(`${t.name}:save`,"Map does not have a valid basemap with a base layer.");let n=null;if(yield(0,y.N1)(()=>{const a=(0,A.Us)(e.initialViewProperties,e.basemap);return n=a.spatialReference,!a.updating}),!(0,x.fS)(n,e.initialViewProperties.spatialReference))throw new f.Z(`${t.name}:save`,"The spatial reference of the basemap is not compatible with the one from the map.",{expected:e.initialViewProperties.spatialReference,actual:n})})).apply(this,arguments)}function C(t){const e=[];return t.basemap&&e.push(t.basemap.load()),t.ground&&e.push(t.ground.load()),Promise.allSettled(e).then(()=>{})}function S(t,e,n){let a=(e.messages??[]).filter(l=>"error"===l.type).map(l=>new f.Z(l.name,l.message,l.details));if(e.blockedRelativeUrls&&(a=a.concat(e.blockedRelativeUrls.map(l=>new f.Z("url:unsupported",`Relative url '${l}' is not supported in Web Map`)))),n.ignoreUnsupported&&(a=a.filter(l=>"layer:unsupported"!==l.name&&"symbol:unsupported"!==l.name&&"symbol-layer:unsupported"!==l.name&&"property:unsupported"!==l.name&&"url:unsupported"!==l.name)),a.length>0)throw new f.Z(`${t.name}:save`,"Failed to save webmap due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:a})}function B(t,e){return V.apply(this,arguments)}function V(){return V=(0,c.Z)(function*(t,e){e.extent=yield function Ie(t,e){return Q.apply(this,arguments)}(t.portalItem,t.initialViewProperties.viewpoint.targetGeometry),yield function ge(t,e){return H.apply(this,arguments)}(t,e)}),V.apply(this,arguments)}const k=p.Kz.JSAPI,ne="CollectorDisabled",oe="Collector",se="Data Editing",ae="OfflineDisabled",ie="Offline",le="Workforce Project",ue="Workforce Worker",pe="Workforce Dispatcher",fe="Offline Map Areas",ye="FieldMapsDisabled",_e=p.Kz.DEVELOPER_BASEMAP,ce="UtilityNetwork";function z(){return(z=(0,c.Z)(function*(t,e){(0,p.ck)(e,ne),(0,p.ck)(e,ye),(0,p.ck)(e,p.Kz.METADATA),(0,p.ck)(e,ae),(0,p.ck)(e,fe),(0,p.ck)(e,pe),(0,p.ck)(e,le),(0,p.ck)(e,ue),yield B(t,e)})).apply(this,arguments)}function H(){return(H=(0,c.Z)(function*(t,e){(0,p.qj)(e,k),yield function Ee(t){const e=J(t).map(n=>n.load()).toArray();return Promise.allSettled(e).then(()=>{})}(t),function Oe(t,e){(0,p._$)(e,ne)||(0,p._$)(e,le)||(0,p._$)(e,ue)||(0,p._$)(e,pe)||!de(t)?(0,p.ck)(e,oe):(0,p.qj)(e,oe)}(t,e),function ve(t,e){de(t)?(0,p.qj)(e,se):(0,p.ck)(e,se)}(t,e),function De(t,e){!(0,p._$)(e,ae)&&function Pe(t){return J(t).filter(e=>"group"!==e.type).every(e=>e.loaded&&function Ae(t,e){return(0,T.fP)(e)&&e.capabilities.operations.supportsSync||function Ue(t){return(0,T.rQ)(t)||"map-notes"===t.type||"route"===t.type}(e)&&!e.portalItem||("tile"===e.type||"vector-tile"===e.type)&&(e.capabilities.operations.supportsExportTiles||function Te(t){return"tile"===t.type&&(0,U.h3)(t.url)&&o.some(e=>t.url?.toLowerCase().includes("/"+e+"/"))}(e)||(0,A.aL)(e))&&e.spatialReference.equals(t.initialViewProperties.spatialReference)}(t,e))}(t)?(0,p.qj)(e,ie):(0,p.ck)(e,ie)}(t,e),function Me(t,e){(0,A.zb)(t.basemap)?(0,p.qj)(e,_e):(0,p.ck)(e,_e)}(t,e),function Re(t,e){t.utilityNetworks?.length?(0,p.qj)(e,ce):(0,p.ck)(e,ce)}(t,e),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((n,a,l)=>l.indexOf(n)===a))})).apply(this,arguments)}function J(t){return t.allLayers.concat(t.allTables)}function de(t){return J(t).some(e=>e.loaded&&(0,T.fP)(e)&&e.capabilities.operations.supportsEditing&&e.editingEnabled&&("subtype-group"!==e.type||e.sublayers.some(n=>n.editingEnabled)))}function Q(){return Q=(0,c.Z)(function*(t,e){const n=e.clone().normalize();let a;if(n.length>1)for(const l of n)a?l.width>a.width&&(a=l):a=l;else a=n[0];return function xe(t,e){return X.apply(this,arguments)}(t,a)}),Q.apply(this,arguments)}function X(){return(X=(0,c.Z)(function*(t,e){const n=e.spatialReference;if(n.isWGS84)return e.clone();if(n.isWebMercator)return(0,G.Sx)(e);const{getGeometryServiceURL:a}=yield i.e(4135).then(i.bind(i,34135)),l=yield a(t),m=new j.Z;return m.geometries=[e],m.outSpatialReference=N.Z.WGS84,(yield(0,L.i)(l,m))[0]})).apply(this,arguments)}function Y(){return(Y=(0,c.Z)(function*(t,e,n,a,l){yield n.update({data:a}),me(t,e,n,a,l)})).apply(this,arguments)}function q(){return q=(0,c.Z)(function*(t,e,n,a,l,m){const I=e.portalItem,K={item:I,authenticated:!(!I?.id||!I.portal.user)},Z=n.portal;yield Z.signIn();const{copyAllowed:$,itemReloaded:re}=yield function be(t,e){return ee.apply(this,arguments)}(K,Z);if(K.authenticated||=re,!$)throw new f.Z(`${t.name}:save-as-copy-not-allowed`,"Owner of this map does not allow others to save a copy");const Ke=yield function je(t,e,n,a){return te.apply(this,arguments)}(n,K,a,m);return e.portalItem=n,me(t,e,n,a,l),Ke}),q.apply(this,arguments)}function ee(){return(ee=(0,c.Z)(function*(t,e){const{item:n,authenticated:a}=t;return n?.id&&n.typeKeywords?.includes("useOnly")?n.portal.portalHostname!==e.portalHostname?{copyAllowed:!1,itemReloaded:!1}:(a||(yield n.reload()),{copyAllowed:"admin"===n.itemControl||"update"===n.itemControl,itemReloaded:!0}):{copyAllowed:!0,itemReloaded:!1}})).apply(this,arguments)}function te(){return(te=(0,c.Z)(function*(t,e,n,a){const l=t.portal,{item:m}=e,{folder:I,copyAllResources:K}=a;let Z=!1;if(K&&m?.id&&(0,P.Zo)(m.portal.url,l.url)&&parseInt(m.portal.currentVersion,10)>=2023){const{total:$}=yield m.fetchResources();Z=!!$}if(Z){const $=yield m.copy({copyResources:"all",folder:I});t.id=$.id,t.portal=$.portal;const re=t.toJSON();yield t.load(),t.read(re),yield t.update({data:n})}else yield l.user?.addItem({item:t,folder:I,data:n});return Z})).apply(this,arguments)}function me(t,e,n,a,l){M.w.prototype.read.call(e,{version:a.version,authoringApp:a.authoringApp,authoringAppVersion:a.authoringAppVersion},{origin:t.origin,ignoreDefaults:!0,url:n.itemUrl?(0,P.mN)(n.itemUrl):void 0}),(0,O.D)(l),e.resourceInfo=a}}}]);