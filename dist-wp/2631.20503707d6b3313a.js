"use strict";(self.webpackChunkangular_17_test=self.webpackChunkangular_17_test||[]).push([[2631],{62631:(L,f,n)=>{n.r(f),n.d(f,{default:()=>j});var a=n(15861),P=n(37636),E=n(57964),M=n(4703),d=n(79412),T=n(33721),g=n(10842),D=n(53919),h=n(58829),R=n(36518),m=n(78642),S=n(42726),F=n(21970),I=n(40100),C=n(764);class j{constructor(){this._queryEngine=null,this._customParameters=null}destroy(){this._queryEngine?.destroy(),this._queryEngine=null}load(r,t){var e=this;return(0,a.Z)(function*(){const{getFeatureUrl:l,getFeatureOutputFormat:y,fields:s,geometryType:i,featureType:u,objectIdField:p,customParameters:_}=r,{spatialReference:o,getFeatureSpatialReference:c}=(0,F.fU)(l,u,r.spatialReference);e._featureType=u,e._customParameters=_,e._getFeatureUrl=l,e._getFeatureOutputFormat=y,e._getFeatureSpatialReference=c;try{yield(0,h._W)(c,o)}catch{throw new E.Z("unsupported-projection","Projection not supported",{inSpatialReference:c,outSpatialReference:o})}(0,d.k_)(t);const O=I.Z.fromLayerJSON({fields:s,dateFieldsTimeReference:s.some(U=>"esriFieldTypeDate"===U.type)?{timeZoneIANA:C.pt}:null}),v=yield e._snapshotFeatures({fieldsIndex:O,geometryType:i,objectIdField:p,spatialReference:o},t.signal);return e._queryEngine=new R.q({fieldsIndex:O,geometryType:i,hasM:!1,hasZ:!1,objectIdField:p,spatialReference:o,timeInfo:null,featureStore:new D.Z({geometryType:i,hasM:!1,hasZ:!1})}),e._queryEngine.featureStore.addMany(v),{extent:(yield e._queryEngine.fetchRecomputedExtents()).fullExtent}})()}applyEdits(){return(0,a.Z)(function*(){throw new E.Z("wfs-source:editing-not-supported","applyEdits() is not supported on WFSLayer")})()}queryFeatures(r={},t={}){var e=this;return(0,a.Z)(function*(){return yield e._waitSnapshotComplete(),e._queryEngine.executeQuery(r,t.signal)})()}queryFeatureCount(r={},t={}){var e=this;return(0,a.Z)(function*(){return yield e._waitSnapshotComplete(),e._queryEngine.executeQueryForCount(r,t.signal)})()}queryObjectIds(r={},t={}){var e=this;return(0,a.Z)(function*(){return yield e._waitSnapshotComplete(),e._queryEngine.executeQueryForIds(r,t.signal)})()}queryExtent(r={},t={}){var e=this;return(0,a.Z)(function*(){return yield e._waitSnapshotComplete(),e._queryEngine.executeQueryForExtent(r,t.signal)})()}querySnapping(r,t={}){var e=this;return(0,a.Z)(function*(){return yield e._waitSnapshotComplete(),e._queryEngine.executeQueryForSnapping(r,t.signal)})()}refresh(r){var t=this;return(0,a.Z)(function*(){return t._customParameters=r,t._snapshotTask?.abort(),t._snapshotTask=(0,P.vr)(e=>t._snapshotFeatures(t._queryEngine,e)),t._snapshotTask.promise.then(e=>{t._queryEngine.featureStore.clear(),e&&t._queryEngine.featureStore.addMany(e)},e=>{t._queryEngine.featureStore.clear(),(0,d.D_)(e)||M.Z.getLogger("esri.layers.WFSLayer").error(new E.Z("wfs-layer:getfeature-error","An error occurred during the GetFeature request",{error:e}))}),yield t._waitSnapshotComplete(),{extent:(yield t._queryEngine.fetchRecomputedExtents()).fullExtent}})()}_waitSnapshotComplete(){var r=this;return(0,a.Z)(function*(){if(r._snapshotTask&&!r._snapshotTask.finished){try{yield r._snapshotTask.promise}catch{}return r._waitSnapshotComplete()}})()}_snapshotFeatures({objectIdField:r,geometryType:t,spatialReference:e,fieldsIndex:l},y){var s=this;return(0,a.Z)(function*(){const i=yield(0,F.Bm)(s._getFeatureUrl??"",s._featureType.typeName,s._getFeatureSpatialReference,s._getFeatureOutputFormat,{customParameters:s._customParameters,signal:y});(0,m.O3)(i,s._getFeatureSpatialReference.wkid),(0,d.k_)(y);const u=(0,m.lG)(i,{geometryType:t,hasZ:!1,objectIdField:r});if(!(0,T.fS)(e,s._getFeatureSpatialReference))for(const _ of u)null!=_.geometry&&(_.geometry=(0,g.GH)((0,h.iV)((0,g.di)(_.geometry,t,!1,!1),s._getFeatureSpatialReference,e)));let p=1;for(const _ of u){const o={};(0,S.O0)(l,o,_.attributes,!0),_.attributes=o,null==o[r]&&(_.objectId=o[r]=p++)}return u})()}}}}]);