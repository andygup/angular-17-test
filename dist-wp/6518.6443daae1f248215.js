"use strict";(self.webpackChunkangular_17_test=self.webpackChunkangular_17_test||[]).push([[6518],{36518:(Ae,oe,c)=>{c.d(oe,{q:()=>Qt});var h=c(15861),$=c(57678),w=c(57964),ge=c(89317),ne=c(34222),V=c(51172),he=c(39921),C=c(79412),D=c(49602),U=c(83821),O=c(27048),E=c(45425),S=c(43585),A=c(40637),b=c(93566),L=c(33721),z=c(10842),ae=c(52540),se=c(85904),ue=c(51217);const p=new class ye{constructor(e,t){this._cache=new ae.z(e),this._invalidCache=new ae.z(t)}get(e,t){const s=`${t.uid}:${e}`,i=this._cache.get(s);if(i)return i;if(null!=this._invalidCache.get(s))return null;try{const r=se.WhereClause.create(e,t);return this._cache.put(s,r),r}catch(r){return this._invalidCache.put(s,r),null}}getError(e,t){return this._invalidCache.get(`${t.uid}:${e}`)??null}}(50,500),M="unsupported-query",W=" as ",X=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeBigInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong"]),G=new Set(["esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]),ie=new Set(["esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...X,...G]);function g(l,e,t={}){const s=N(e,l);if(!s){const r=p.getError(e,l);throw new w.Z(M,"invalid SQL expression",{expression:e,error:r})}const i=t.expressionName||"expression";if(t.validateStandardized&&!s.isStandardized)throw new w.Z(M,`${i} is not standard`,{expression:e});if(t.validateAggregate&&!s.isAggregate)throw new w.Z(M,`${i} does not contain a valid aggregate function`,{expression:e});return s.fieldNames}function N(l,e){return l?p.get(l,e):null}function ee(l){return/\((.*?)\)/.test(l)?l:l.split(W)[0]}function Z(l,e,t,s={}){const i=new Map;if(function de(l,e,t,s,i){for(const r of i)if("*"!==r)if(e.get(r))re(l,e,t,s,r);else try{const a=g(e,ee(r),{validateStandardized:!0});for(const n of a)re(l,e,t,s,n)}catch(a){l.set(r,{type:"expression-error",expression:r,error:a})}}(i,l,e,s.allowedFieldTypes??ie,t),i.size)throw new w.Z(M,`${s.expressionName??"expression"} contains invalid or missing fields`,{errors:Array.from(i.values()),query:s.query})}function re(l,e,t,s,i){if("*"===i)return;const r=e.get(i);r?t.has(r.name)?!1===s?.has(r.type)&&l.set(i,{type:"invalid-type",fieldName:r.name,fieldType:ue.v.fromJSON(r.type),allowedFieldTypes:Array.from(s,a=>ue.v.fromJSON(a))}):l.set(i,{type:"missing-field",fieldName:r.name}):l.set(i,{type:"invalid-field",fieldName:i})}var B=c(29085),q=c(58829),Ue=c(85559),Ie=c(56880),Ne=c(14138),Ce=c(66398),ce=c(85295),_t=c(71518),te=c(46169),Je=c(4978);class Le{constructor(e,t,s){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=e.returnDistinctValues??!1,this.fieldsIndex=s,this.featureAdapter=t;const i=e.outFields;if(i&&!i.includes("*")){this.outFields=i;let r=0;for(const a of i){const n=ee(a),o=this.fieldsIndex.get(n),u=o?null:N(n,s),d=o?o.name:a.split(W)[1]||"FIELD_EXP_"+r++;this._fieldDataCache.set(a,{alias:d,clause:u})}}}countDistinctValues(e){return this.returnDistinctValues?(e.forEach(t=>this.getAttributes(t)),this._returnDistinctMap.size):e.length}getAttributes(e){const t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)}getFieldValue(e,t,s){const i=s?s.name:t;let r=null;return this._fieldDataCache.has(i)?r=this._fieldDataCache.get(i)?.clause:s||(r=N(t,this.fieldsIndex),this._fieldDataCache.set(i,{alias:i,clause:r})),s?this.featureAdapter.getAttribute(e,i):r?.calculateValue(e,this.featureAdapter)}getDataValues(e,t,s=!0){const i=t.normalizationType,r=t.normalizationTotal,a=this.fieldsIndex.get(t.field),n=(0,ce.UQ)(a)||(0,ce.ig)(a),o=(0,ce.sX)(a);return e.map(u=>{let d=t.field&&this.getFieldValue(u,t.field,this.fieldsIndex.get(t.field));if(t.field2?(d=`${(0,te.wk)(d)}${t.fieldDelimiter}${(0,te.wk)(this.getFieldValue(u,t.field2,this.fieldsIndex.get(t.field2)))}`,t.field3&&(d=`${d}${t.fieldDelimiter}${(0,te.wk)(this.getFieldValue(u,t.field3,this.fieldsIndex.get(t.field3)))}`)):"string"==typeof d&&s&&(n?d=d?new Date(d).getTime():null:o&&(d=d?(0,_t.yO)(d):null)),i&&Number.isFinite(d)){const m="field"===i&&t.normalizationField?this.getFieldValue(u,t.normalizationField,this.fieldsIndex.get(t.normalizationField)):null;d=(0,te.fk)(d,i,m,r)}return d})}getExpressionValues(e,t,s,i,r){var a=this;return(0,h.Z)(function*(){const{arcadeUtils:n}=yield(0,Je.LC)(),o=n.hasGeometryOperations(t);o&&(yield n.enableGeometryOperations());const u=n.createFunction(t),d=n.getViewInfo(s),m={fields:a.fieldsIndex.fields};return e.map(y=>{const T={attributes:a.featureAdapter.getAttributes(y),layer:m,geometry:o?{...(0,B.Op)(i.geometryType,i.hasZ,i.hasM,a.featureAdapter.getGeometry(y)),spatialReference:s?.spatialReference}:null},I=n.createExecContext(T,d,r);return n.executeFunction(u,I)})})()}validateItem(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:N(t,this.fieldsIndex)}),this._fieldDataCache.get(t)?.clause?.testFeature(e,this.featureAdapter)??!1}validateItems(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:N(t,this.fieldsIndex)}),this._fieldDataCache.get(t)?.clause?.testSet(e,this.featureAdapter)??!1}_processAttributesForOutFields(e){const t=this.outFields;if(!t?.length)return this.featureAdapter.getAttributes(e);const s={};for(const i of t){const{alias:r,clause:a}=this._fieldDataCache.get(i);s[r]=a?a.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,r)}return s}_processAttributesForDistinctValues(e){if(null==e||!this.returnDistinctValues)return e;const t=this.outFields,s=[];if(t)for(const a of t){const{alias:n}=this._fieldDataCache.get(a);s.push(e[n])}else for(const a in e)s.push(e[a]);const i=`${(t||["*"]).join(",")}=${s.join(",")}`;let r=this._returnDistinctMap.get(i)||0;return this._returnDistinctMap.set(i,++r),r>1?null:e}}function Ke(l,e,t){return{objectId:l,target:e,distance:t,type:"vertex"}}function Et(l,e,t,s,i,r=!1){return{objectId:l,target:e,distance:t,type:"edge",start:s,end:i,draped:r}}class le{constructor(e,t,s){this.items=e,this.query=t,this.geometryType=s.geometryType,this.hasM=s.hasM,this.hasZ=s.hasZ,this.fieldsIndex=s.fieldsIndex,this.objectIdField=s.objectIdField,this.spatialReference=s.spatialReference,this.featureAdapter=s.featureAdapter}get size(){return this.items.length}createQueryResponseForCount(){const e=new Le(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return e.countDistinctValues(this.items);const{groupByFieldsForStatistics:t,having:s,outStatistics:i}=this.query;if(!t?.length)return 1;const a=new Map,n=new Map,o=new Set;for(const u of i){const{statisticType:d}=u,m="exceedslimit"!==d?u.onStatisticField:void 0;if(!n.has(m)){const T=[];for(const I of t){const R=this._getAttributeValues(e,I,a);T.push(R)}n.set(m,this._calculateUniqueValues(T,e.returnDistinctValues))}const y=n.get(m);for(const T in y){const{data:I,items:R}=y[T],_=I.join(",");s&&!e.validateItems(R,s)||o.add(_)}}return o.size}createQueryResponse(){var e=this;return(0,h.Z)(function*(){let t;if(t=e.query.outStatistics?e.query.outStatistics.some(s=>"exceedslimit"===s.statisticType)?e._createExceedsLimitQueryResponse(e.query):yield e._createStatisticsQueryResponse(e.query):e._createFeatureQueryResponse(e.query),e.query.returnQueryGeometry){const s=e.query.geometry;t.queryGeometry=(0,L.JY)(e.query.outSR)&&!(0,L.fS)(s.spatialReference,e.query.outSR)?(0,B.S2)({spatialReference:e.query.outSR,...(0,q.iV)(s,s.spatialReference,e.query.outSR)}):(0,B.S2)({spatialReference:e.query.outSR,...s})}return t})()}createSnappingResponse(e,t){const s=this.featureAdapter,i=et(this.hasZ,this.hasM),{point:r,mode:a}=e,n="number"==typeof e.distance?e.distance:e.distance.x,o="number"==typeof e.distance?e.distance:e.distance.y,u={candidates:[]},d="esriGeometryPolygon"===this.geometryType,m=this._getPointCreator(a,this.spatialReference,t),y=new tt(null,0),T=new tt(null,0),I={x:0,y:0,z:0};for(const R of this.items){const _=s.getGeometry(R);if(null==_)continue;const{coords:P,lengths:J}=_;if(y.coords=P,T.coords=P,e.returnEdge){let j=0;for(let k=0;k<J.length;k++){const v=J[k];for(let x=0;x<v;x++,j+=i){const H=y;if(H.coordsIndex=j,x!==v-1){const Y=T;Y.coordsIndex=j+i;const pe=I;xt(I,r,H,Y);const Se=(r.x-pe.x)/n,Fe=(r.y-pe.y)/o,Qe=Se*Se+Fe*Fe;Qe<=1&&u.candidates.push(Et(s.getObjectId(R),m(pe),Math.sqrt(Qe),m(H),m(Y)))}}}}if("none"!==e.vertexMode){const j=d?P.length-i:P.length;if("all"===e.vertexMode)for(let k=0;k<j;k+=i){const v=y;v.coordsIndex=k;const x=(r.x-v.x)/n,H=(r.y-v.y)/o,Y=x*x+H*H;Y<=1&&u.candidates.push(Ke(s.getObjectId(R),m(v),Math.sqrt(Y)))}else if("ends"===e.vertexMode){const k=[0];d||k.push(P.length-i);for(const v of k){const x=y;x.coordsIndex=v;const H=(r.x-x.x)/n,Y=(r.y-x.y)/o,pe=H*H+Y*Y;pe<=1&&u.candidates.push(Ke(s.getObjectId(R),m(x),Math.sqrt(pe)))}}}}return u.candidates.sort((R,_)=>R.distance-_.distance),u}_getPointCreator(e,t,s){const i=null==s||(0,L.fS)(t,s)?n=>n:n=>(0,q.iV)(n,t,s),{hasZ:r}=this;return"3d"===e?r?({x:n,y:o,z:u})=>i({x:n,y:o,z:u}):({x:n,y:o})=>i({x:n,y:o,z:0}):({x:n,y:o})=>i({x:n,y:o})}createSummaryStatisticsResponse(e){var t=this;return(0,h.Z)(function*(){const{field:s,valueExpression:i,normalizationField:r,normalizationType:a,normalizationTotal:n,minValue:o,maxValue:u,scale:d,timeZone:m}=e,y=t.fieldsIndex.get(s),T=(0,ce.y2)(y)||(0,ce.UQ)(y)||(0,ce.ig)(y),I=yield t._getDataValues({field:s,valueExpression:i,normalizationField:r,normalizationType:a,normalizationTotal:n,scale:d,timeZone:m}),R=(0,te.S5)({normalizationType:a,normalizationField:r,minValue:o,maxValue:u}),_={value:.5,fieldType:y?.type},P=(0,ce.qN)(y)?(0,te.H0)({values:I,supportsNullCount:R,percentileParams:_}):(0,te.i5)({values:I,minValue:o,maxValue:u,useSampleStdDev:!a,supportsNullCount:R,percentileParams:_});return(0,te.F_)(P,T)})()}createUniqueValuesResponse(e){var t=this;return(0,h.Z)(function*(){const{field:s,valueExpression:i,domains:r,returnAllCodedValues:a,scale:n,timeZone:o}=e,u=yield t._getDataValues({field:s,field2:e.field2,field3:e.field3,fieldDelimiter:e.fieldDelimiter,valueExpression:i,scale:n,timeZone:o},!1),d=(0,te.eT)(u);return(0,te.Qm)(d,r,a,e.fieldDelimiter)})()}createClassBreaksResponse(e){var t=this;return(0,h.Z)(function*(){const{field:s,valueExpression:i,normalizationField:r,normalizationType:a,normalizationTotal:n,classificationMethod:o,standardDeviationInterval:u,minValue:d,maxValue:m,numClasses:y,scale:T,timeZone:I}=e,R=yield t._getDataValues({field:s,valueExpression:i,normalizationField:r,normalizationType:a,normalizationTotal:n,scale:T,timeZone:I}),_=(0,te.G2)(R,{field:s,normalizationField:r,normalizationType:a,normalizationTotal:n,classificationMethod:o,standardDeviationInterval:u,minValue:d,maxValue:m,numClasses:y});return(0,te.DL)(_,o)})()}createHistogramResponse(e){var t=this;return(0,h.Z)(function*(){const{field:s,valueExpression:i,normalizationField:r,normalizationType:a,normalizationTotal:n,classificationMethod:o,standardDeviationInterval:u,minValue:d,maxValue:m,numBins:y,scale:T,timeZone:I}=e,R=yield t._getDataValues({field:s,valueExpression:i,normalizationField:r,normalizationType:a,normalizationTotal:n,scale:T,timeZone:I});return(0,te.oF)(R,{field:s,normalizationField:r,normalizationType:a,normalizationTotal:n,classificationMethod:o,standardDeviationInterval:u,minValue:d,maxValue:m,numBins:y})})()}_sortFeatures(e,t,s){if(e.length>1&&t?.length)for(const i of t.reverse()){const r=i.split(" "),a=r[0],n=this.fieldsIndex.get(a),o=!!r[1]&&"desc"===r[1].toLowerCase(),u=(0,te.Lq)(n?.type,o);e.sort((d,m)=>{const y=s(d,a,n),T=s(m,a,n);return u(y,T)})}}_createFeatureQueryResponse(e){const t=this.items,{geometryType:s,hasM:i,hasZ:r,objectIdField:a,spatialReference:n}=this,{outFields:o,outSR:u,quantizationParameters:d,resultRecordCount:m,resultOffset:y,returnZ:T,returnM:I}=e,R=null!=m&&t.length>(y||0)+m,_=o&&(o.includes("*")?[...this.fieldsIndex.fields]:o.map(P=>this.fieldsIndex.get(P)));return{exceededTransferLimit:R,features:this._createFeatures(e,t),fields:_,geometryType:s,hasM:i&&I,hasZ:r&&T,objectIdFieldName:a,spatialReference:(0,B.S2)(u||n),transform:d&&(0,Ce.vY)(d)||null}}_createFeatures(e,t){const s=new Le(e,this.featureAdapter,this.fieldsIndex),{hasM:i,hasZ:r}=this,{orderByFields:a,quantizationParameters:n,returnGeometry:o,returnCentroid:u,maxAllowableOffset:d,resultOffset:m,resultRecordCount:y,returnZ:T=!1,returnM:I=!1}=e,R=r&&T,_=i&&I;let P=[],J=0;const j=[...t];if(this._sortFeatures(j,a,(v,x,H)=>s.getFieldValue(v,x,H)),this.geometryType&&(o||u)){const v=(0,Ce.vY)(n)??void 0;if(o&&!u)for(const x of j)P[J++]={attributes:s.getAttributes(x),geometry:(0,B.Op)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(x),d,v,R,_)};else if(!o&&u)for(const x of j)P[J++]={attributes:s.getAttributes(x),centroid:(0,B.EG)(this,this.featureAdapter.getCentroid(x,this),v)};else for(const x of j)P[J++]={attributes:s.getAttributes(x),centroid:(0,B.EG)(this,this.featureAdapter.getCentroid(x,this),v),geometry:(0,B.Op)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(x),d,v,R,_)}}else for(const v of j){const x=s.getAttributes(v);x&&(P[J++]={attributes:x})}const k=m||0;return null!=y&&(P=P.slice(k,Math.min(P.length,k+y))),P}_createExceedsLimitQueryResponse(e){let t=!1,s=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY;for(const a of e.outStatistics??[])if("exceedslimit"===a.statisticType){s=null!=a.maxPointCount?a.maxPointCount:Number.POSITIVE_INFINITY,i=null!=a.maxRecordCount?a.maxRecordCount:Number.POSITIVE_INFINITY,r=null!=a.maxVertexCount?a.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)t=this.items.length>s;else if(this.items.length>i)t=!0;else{const a=et(this.hasZ,this.hasM),n=this.featureAdapter;t=this.items.reduce((o,u)=>{const d=n.getGeometry(u);return o+(null!=d&&d.coords.length||0)},0)/a>r}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(t)}}]}}_createStatisticsQueryResponse(e){var t=this;return(0,h.Z)(function*(){const s={attributes:{}},i=[],r=new Map,a=new Map,n=new Map,o=new Map,u=new Le(e,t.featureAdapter,t.fieldsIndex),d=e.outStatistics,{groupByFieldsForStatistics:m,having:y,orderByFields:T,resultRecordCount:I}=e,R=m?.length,_=!!R,P=_?m[0]:null,J=_&&!t.fieldsIndex.get(P);for(const k of d??[]){const{outStatisticFieldName:v,statisticType:x}=k,H=k,Y="exceedslimit"!==x?k.onStatisticField:void 0,pe="percentile_disc"===x||"percentile_cont"===x,Se="EnvelopeAggregate"===x||"CentroidAggregate"===x||"ConvexHullAggregate"===x,Fe=_&&1===R&&(Y===P||J)&&"count"===x;if(_){if(!n.has(Y)){const Ze=[];for(const qe of m){const Ve=t._getAttributeValues(u,qe,r);Ze.push(Ve)}n.set(Y,t._calculateUniqueValues(Ze,!Se&&u.returnDistinctValues))}const Te=n.get(Y);if(!Te)continue;const Xe=Object.keys(Te);for(const Ze of Xe){const{count:qe,data:Ve,items:pt,itemPositions:Zt}=Te[Ze],gt=Ve.join(",");if(!y||u.validateItems(pt,y)){const Pe=o.get(gt)||{attributes:{}};if(Se){Pe.aggregateGeometries||(Pe.aggregateGeometries={});const{aggregateGeometries:Re,outStatisticFieldName:De}=yield t._getAggregateGeometry(H,pt);Pe.aggregateGeometries[De]=Re}else{let Re=null;if(Fe)Re=qe;else{const De=t._getAttributeValues(u,Y,r),yt=Zt.map(wt=>De[wt]);Re=pe&&"statisticParameters"in H?t._getPercentileValue(H,yt):t._getStatisticValue(H,yt,null,u.returnDistinctValues)}Pe.attributes[v]=Re}let Vt=0;m.forEach((Re,De)=>Pe.attributes[t.fieldsIndex.get(Re)?Re:"EXPR_"+ ++Vt]=Ve[De]),o.set(gt,Pe)}}}else if(Se){s.aggregateGeometries||(s.aggregateGeometries={});const{aggregateGeometries:Te,outStatisticFieldName:Xe}=yield t._getAggregateGeometry(H,t.items);s.aggregateGeometries[Xe]=Te}else{const Te=t._getAttributeValues(u,Y,r);s.attributes[v]=pe&&"statisticParameters"in H?t._getPercentileValue(H,Te):t._getStatisticValue(H,Te,a,u.returnDistinctValues)}const Qe="min"!==x&&"max"!==x||!(0,ce.qN)(t.fieldsIndex.get(Y))&&!t._isAnyDateField(Y)?null:t.fieldsIndex.get(Y)?.type;i.push({name:v,alias:v,type:Qe||"esriFieldTypeDouble"})}const j=_?Array.from(o.values()):[s];return t._sortFeatures(j,T,(k,v)=>k.attributes[v]),I&&(j.length=Math.min(I,j.length)),{fields:i,features:j}})()}_isAnyDateField(e){const t=this.fieldsIndex.get(e);return(0,ce.y2)(t)||(0,ce.UQ)(t)||(0,ce.ig)(t)||(0,ce.sX)(t)}_getAggregateGeometry(e,t){var s=this;return(0,h.Z)(function*(){const{convexHull:i,union:r}=yield Promise.all([c.e(9465),c.e(8592)]).then(c.bind(c,49574)),{statisticType:a,outStatisticFieldName:n}=e,{featureAdapter:o,spatialReference:u,geometryType:d,hasZ:m,hasM:y}=s,T=t.map(_=>(0,B.Op)(d,m,y,o.getGeometry(_))),I=i(u,T,!0)[0],R={aggregateGeometries:null,outStatisticFieldName:null};if("EnvelopeAggregate"===a){const _=I?(0,Ne._w)(I):(0,Ne.aO)(r(u,T));R.aggregateGeometries={..._,spatialReference:u},R.outStatisticFieldName=n||"extent"}else if("CentroidAggregate"===a){const _=I?(0,Ie.tO)(I):(0,Ie.$G)((0,Ne.aO)(r(u,T)));R.aggregateGeometries={x:_[0],y:_[1],spatialReference:u},R.outStatisticFieldName=n||"centroid"}else"ConvexHullAggregate"===a&&(R.aggregateGeometries=I,R.outStatisticFieldName=n||"convexHull");return R})()}_getStatisticValue(e,t,s,i){const{onStatisticField:r,statisticType:a}=e;let n=null;return n=s?.has(r)?s.get(r):(0,ce.qN)(this.fieldsIndex.get(r))||this._isAnyDateField(r)?(0,te.H0)({values:t,returnDistinct:i}):(0,te.i5)({values:i?[...new Set(t)]:t,minValue:null,maxValue:null,useSampleStdDev:!0}),s&&s.set(r,n),n["var"===a?"variance":a]}_getPercentileValue(e,t){const{onStatisticField:s,statisticParameters:i,statisticType:r}=e,{value:a,orderBy:n}=i,o=this.fieldsIndex.get(s);return(0,te.XL)(t,{value:a,orderBy:n,fieldType:o?.type,isDiscrete:"percentile_disc"===r})}_getAttributeValues(e,t,s){if(s.has(t))return s.get(t);const i=this.fieldsIndex.get(t),r=this.items.map(a=>e.getFieldValue(a,t,i));return s.set(t,r),r}_calculateUniqueValues(e,t){const s={},i=this.items,r=i.length;for(let a=0;a<r;a++){const n=i[a],o=[];for(const d of e)o.push(d[a]);const u=o.join(",");null==s[u]?s[u]={count:1,data:o,items:[n],itemPositions:[a]}:(t||s[u].count++,s[u].items.push(n),s[u].itemPositions.push(a))}return s}_getDataValues(e,t=!0){var s=this;return(0,h.Z)(function*(){const i=new Le(s.query,s.featureAdapter,s.fieldsIndex),{valueExpression:r,scale:a,timeZone:n}=e;return r?i.getExpressionValues(s.items,r,{viewingMode:"map",scale:a,spatialReference:s.query.outSR||s.spatialReference},{geometryType:s.geometryType,hasZ:s.hasZ,hasM:s.hasM},n):i.getDataValues(s.items,(0,ne.d9)(e),t)})()}}function xt(l,e,t,s){const i=s.x-t.x,r=s.y-t.y,o=Math.min(1,Math.max(0,((e.x-t.x)*i+(e.y-t.y)*r)/(i*i+r*r)));l.x=t.x+i*o,l.y=t.y+r*o}function et(l,e){return l?e?4:3:e?3:2}class tt{constructor(e,t){this.coords=e,this.coordsIndex=t}get x(){return this.coords[this.coordsIndex]}get y(){return this.coords[this.coordsIndex+1]}get z(){return this.coords[this.coordsIndex+2]}}var Ee=c(44452),xe=c(51089);const Oe="unsupported-query";function st(l,e){return we.apply(this,arguments)}function we(){return(we=(0,h.Z)(function*(l,{fieldsIndex:e,geometryType:t,spatialReference:s,availableFields:i}){if((l.distance??0)<0||null!=l.geometryPrecision||l.multipatchOption&&"xyFootprint"!==l.multipatchOption||l.pixelSize||l.relationParam||l.text)throw new w.Z(Oe,"Unsupported query options",{query:l});return it(e,i,l),function Tt(l,e,t){const{outStatistics:s,groupByFieldsForStatistics:i,having:r}=t,a=i?.length,n=s?.length;if(r){if(!a||!n)throw new w.Z(Oe,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:t});!function Q(l,e,t,s,i){if(!t)return!0;const r="having clause",a=g(l,t,{validateAggregate:!0,expressionName:r});if(Z(l,e,a,{expressionName:r,query:i}),!N(t,l)?.getExpressions().every(u=>{const{aggregateType:d,field:m}=u,y=l.get(m)?.name;return s.some(T=>{const{onStatisticField:I,statisticType:R}=T;return l.get(I)?.name===y&&R.toLowerCase().trim()===d})}))throw new w.Z(M,"expressions in having clause should also exist in outStatistics",{having:t})}(l,e,r,s,t)}if(n){if(!function vt(l){return null!=l&&l.every(e=>"exceedslimit"!==e.statisticType)}(s))return;Z(l,e,s.map(u=>u.onStatisticField).filter(Boolean),{expressionName:"onStatisticFields",query:t}),a&&Z(l,e,i,{expressionName:"groupByFieldsForStatistics",query:t});for(const u of s){const{onStatisticField:d,statisticType:m}=u;if("percentile_disc"!==m&&"percentile_cont"!==m||!("statisticParameters"in u))l.get(d)&&"count"!==m&&"min"!==m&&"max"!==m&&Z(l,e,[d],{expressionName:`outStatistics with '${m}' statistic type`,allowedFieldTypes:St,query:t});else{const{statisticParameters:y}=u;if(!y)throw new w.Z(Oe,"statisticParameters should be set for percentile type",{definition:u,query:t})}}}}(e,i,l),Promise.all([(0,xe.P0)(l,t,s),(0,q._W)(s,l.outSR)]).then(()=>l)})).apply(this,arguments)}function it(l,e,t){const{outFields:s,orderByFields:i,returnDistinctValues:r,outStatistics:a}=t,n=a?a.map(o=>o.outStatisticFieldName&&o.outStatisticFieldName.toLowerCase()).filter(Boolean):[];if(i&&i.length>0){const o=" asc",u=" desc";Z(l,e,i.map(m=>{const y=m.toLowerCase();return y.includes(o)?y.split(o)[0]:y.includes(u)?y.split(u)[0]:m}).filter(m=>!n.includes(m)),{expressionName:"orderByFields",query:t})}if(s&&s.length>0)Z(l,e,s,{expressionName:"outFields",query:t});else if(r)throw new w.Z(Oe,"outFields should be specified for returnDistinctValues",{query:t});!function f(l,e,t,s){if(!t)return!0;const i="where clause";Z(l,e,g(l,t,{validateStandardized:!0,expressionName:i}),{expressionName:i,query:s})}(l,e,t.where,t)}const St=new Set([...X,...G]);function ze(){return(ze=(0,h.Z)(function*(l,e,{fieldsIndex:t,geometryType:s,spatialReference:i,availableFields:r}){if((l.distance??0)<0||null!=l.geometryPrecision||l.multipatchOption||l.pixelSize||l.relationParam||l.text||l.outStatistics||l.groupByFieldsForStatistics||l.having||l.orderByFields)throw new w.Z(Oe,"Unsupported query options",{query:l});return it(t,r,l),Promise.all([It(t,r,e,l),(0,xe.P0)(l,s,i),(0,q._W)(i,l.outSR)]).then(()=>l)})).apply(this,arguments)}function It(l,e,t,s){return Be.apply(this,arguments)}function Be(){return(Be=(0,h.Z)(function*(l,e,t,s){let i=[];if(t.valueExpression){const{arcadeUtils:r}=yield(0,Je.LC)();i=r.extractFieldNames(t.valueExpression)}if(t.field&&i.push(t.field),t.field2&&i.push(t.field2),t.field3&&i.push(t.field3),t.normalizationField&&i.push(t.normalizationField),!i.length&&!t.valueExpression)throw new w.Z(Oe,"field or valueExpression is required",{params:t});Z(l,e,i,{expressionName:"statistics",query:s})})).apply(this,arguments)}var rt=c(21418),Ft=c(40100),At=c(50433),Ct=(c(14007),c(4703)),je=c(44169),ke=c(43029),He=c(77675),Ye=c(45974),fe=c(95854);class Ot{constructor(){this._tasks=new Array,this._running=(0,Ye.t)(!1)}get length(){return this._tasks.length}get running(){return this._running.value}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,s){return this._running.value=!0,new Promise((i,r)=>this._tasks.push(new nt(i,r,e,t,s)))}unshift(e,t,s){return this._running.value=!0,new Promise((i,r)=>this._tasks.unshift(new nt(i,r,e,t,s)))}_process(e){if(0===this._tasks.length)return!1;const t=this._tasks.shift();try{const s=(0,C.Hc)(t.signal);if(s&&!t.abortCallback)t.reject((0,C.zE)());else{const i=s?t.abortCallback?.((0,C.zE)()):t.callback(e);(0,C.y8)(i)?i.then(t.resolve,t.reject):t.resolve(i)}}catch(s){t.reject(s)}return this._running.value=this._tasks.length>0,!0}cancelAll(){const e=(0,C.zE)();for(const t of this._tasks)if(t.abortCallback){const s=t.abortCallback(e);t.resolve(s)}else t.reject(e);this._tasks.length=0,this._running.value=!1}}class nt{constructor(e,t,s,i=void 0,r=void 0){this.resolve=e,this.reject=t,this.callback=s,this.signal=i,this.abortCallback=r}}var We=c(50484),Pt=c(73514),at=c(80543),Nt=(c(1535),c(10141));let be=class extends Pt.Z{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};(0,We._)([(0,at.Cb)()],be.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,We._)([(0,at.Cb)()],be.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),be=(0,We._)([(0,Nt.j)("esri.views.support.DebugFlags")],be);const bt=new be;var $e,F,l,me=c(24940);(l=$e||($e={}))[l.YIELD=1]="YIELD",function(l){l.RESOURCE_CONTROLLER_IMMEDIATE="immediate",l.RESOURCE_CONTROLLER="schedule",l.SLIDE="slide",l.STREAM_DATA_LOADER="stream loader",l.ELEVATION_QUERY="elevation query",l.TERRAIN_SURFACE="terrain",l.SURFACE_GEOMETRY_UPDATES="surface geometry updates",l.LOD_RENDERER="LoD renderer",l.GRAPHICS_CORE="Graphics3D",l.I3S_CONTROLLER="I3S",l.POINT_CLOUD_LAYER="point cloud",l.FEATURE_TILE_FETCHER="feature fetcher",l.OVERLAY="overlay",l.STAGE="stage",l.GRAPHICS_DECONFLICTOR="graphics deconflictor",l.FILTER_VISIBILITY="Graphics3D filter visibility",l.SCALE_VISIBILITY="Graphics3D scale visibility",l.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",l.POINT_OF_INTEREST_FREQUENT="POI frequent",l.POINT_OF_INTEREST_INFREQUENT="POI infrequent",l.LABELER="labeler",l.FEATURE_QUERY_ENGINE="feature query",l.FEATURE_TILE_TREE="feature tile tree",l.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",l.ELEVATION_ALIGNMENT="elevation alignment",l.TEXT_TEXTURE_ATLAS="text texture atlas",l.TEXTURE_UNLOAD="texture unload",l.LINE_OF_SIGHT_TOOL="line of sight tool",l.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",l.ELEVATION_PROFILE="elevation profile",l.SNAPPING="snapping",l.SHADOW_ACCUMULATOR="shadow accumulator",l.CLOUDS_GENERATOR="clouds generator",l[l.NONE=0]="NONE",l[l.TEST_PRIO=1]="TEST_PRIO"}(F||(F={}));const lt=new Map([[F.RESOURCE_CONTROLLER_IMMEDIATE,0],[F.RESOURCE_CONTROLLER,4],[F.SLIDE,0],[F.STREAM_DATA_LOADER,0],[F.ELEVATION_QUERY,0],[F.TERRAIN_SURFACE,1],[F.SURFACE_GEOMETRY_UPDATES,1],[F.LOD_RENDERER,2],[F.GRAPHICS_CORE,2],[F.I3S_CONTROLLER,2],[F.POINT_CLOUD_LAYER,2],[F.FEATURE_TILE_FETCHER,2],[F.OVERLAY,4],[F.STAGE,4],[F.GRAPHICS_DECONFLICTOR,4],[F.FILTER_VISIBILITY,4],[F.SCALE_VISIBILITY,4],[F.FRUSTUM_VISIBILITY,4],[F.CLOUDS_GENERATOR,4],[F.POINT_OF_INTEREST_FREQUENT,6],[F.POINT_OF_INTEREST_INFREQUENT,30],[F.LABELER,8],[F.FEATURE_QUERY_ENGINE,8],[F.FEATURE_TILE_TREE,16],[F.FEATURE_TILE_TREE_ACTIVE,0],[F.ELEVATION_ALIGNMENT,12],[F.TEXT_TEXTURE_ATLAS,12],[F.TEXTURE_UNLOAD,12],[F.LINE_OF_SIGHT_TOOL,16],[F.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[F.SNAPPING,0],[F.SHADOW_ACCUMULATOR,30]]);function ot(l){return lt.has(l)?lt.get(l):"number"==typeof l?l:1}const ut=(0,fe.HA)(6.5),ct=(0,fe.HA)(1),Dt=(0,fe.HA)(30),dt=(0,fe.HA)(1e3/30),ht=(0,fe.HA)(100);var Me,ve;(function(l){l.Scheduler=class e{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(r=>r.needsUpdate)}constructor(){this._updating=(0,Ye.t)(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new je.Z("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new s,this._state=me.n.INTERACTING,this._tasks=new ke.Z,this._runQueue=new ke.Z,this._load=0,this._idleStateCallbacks=new ke.Z,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=(0,He.YP)(()=>bt.SCHEDULER_LOG_SLOW_TASKS,a=>this._debug=a,He.nn);for(const a of Object.keys(F))this.performanceInfo.tasks.set(F[a],new je.Z(F[a]));const r=this;this._test={FRAME_SAFETY_BUDGET:ut,INTERACTING_BUDGET:dt,IDLE_BUDGET:ht,get availableBudget(){return r._budget.budget},usedBudget:0,getBudget:()=>r._budget,setBudget:a=>r._budget=a,updateTask:a=>this._updateTask(a),getState:a=>this._getState(a),getRuntime:a=>this._getRuntime(a),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(r=>r.remove()),this._tasks.clear(),(0,V.hw)(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(r){this._updatingChanged(),r&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(r,a){const n=ot(r),o=new t(this,r,a,n);return this._tasks.push(o),this._updatingChanged(),this.performanceInfo.tasks.has(r)||this.performanceInfo.tasks.set(r,new je.Z(r)),o}registerIdleStateCallbacks(r,a){const n={idleBegin:r,idleEnd:a};this._idleStateCallbacks.push(n),this.state===me.n.IDLE&&this._idleUpdatesStartFired&&n.idleBegin();const o=this;return{remove:()=>this._removeIdleStateCallbacks(n),set idleBegin(u){o._idleUpdatesStartFired&&(n.idleEnd(),o._state===me.n.IDLE&&u()),n.idleBegin=u},set idleEnd(u){n.idleEnd=u}}}get load(){return this._load}set state(r){this._state!==r&&(this._state=r,this.state!==me.n.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(a=>a.idleEnd())))}get state(){return this._state}updateBudget(r){this._test.usedBudget=0,++this._frameNumber;let a=ut,n=r.frameDuration,o=ct;switch(this.state){case me.n.IDLE:a=(0,fe.HA)(0),n=(0,fe.HA)(Math.max(ht,r.frameDuration)),o=Dt;break;case me.n.INTERACTING:n=(0,fe.HA)(Math.max(dt,r.frameDuration))}return n=(0,fe.HA)(n-r.elapsedFrameTime-a),this.state!==me.n.IDLE&&n<ct&&!this._forceTask?(this._forceTask=!0,!1):(n=(0,fe.HA)(Math.max(n,o)),this._budget.reset(n,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case me.n.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(r=>r.idleBegin())),this._runIdle();break;case me.n.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset((0,fe.HA)(0),this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(r){this._idleUpdatesStartFired&&r.idleEnd(),this._idleStateCallbacks.removeUnordered(r)}removeTask(r){this._tasks.removeUnordered(r),this._runQueue.removeUnordered(r),this._updatingChanged()}_updateTask(r){this._tasks.forAll(a=>{a.name===r&&a.setPriority(r)})}_getState(r){if(this._runQueue.some(n=>n.name===r))return ve.SCHEDULED;let a=ve.IDLE;return this._tasks.forAll(n=>{n.name===r&&n.needsUpdate&&(n.schedulePriority<=1?a=ve.READY:a!==ve.READY&&(a=ve.WAITING))}),a}_getRuntime(r){let a=0;return this._tasks.forAll(n=>{n.name===r&&(a+=n.runtime)}),a}_resetRuntimes(){this._tasks.forAll(r=>r.runtime=0)}_getRunning(){const r=new Map;if(this._tasks.forAll(n=>{n.needsUpdate&&r.set(n.name,(r.get(n.name)||0)+1)}),0===r.size)return null;let a="";return r.forEach((n,o)=>{a+=n>1?` ${n}x ${o}`:` ${o}`}),a}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const r=this._tasks.reduce((a,n)=>n.needsUpdate?++a:a,0);this._load=.9*this._load+r*(1-.9)}_schedule(){for(this._runQueue.filterInPlace(r=>!!r.needsUpdate||(r.schedulePriority=r.basePriority,!1)),this._tasks.forAll(r=>{0===r.basePriority&&r.needsUpdate&&!this._runQueue.includes(r)&&r.blockFrame!==this._frameNumber&&this._runQueue.unshift(r)});0===this._runQueue.length;){let r=!1,a=0;if(this._tasks.forAll(n=>{n.needsUpdate&&0!==n.schedulePriority&&0!==n.basePriority&&n.blockFrame!==this._frameNumber&&(r=!0,a=Math.max(a,n.basePriority),1===n.schedulePriority?(n.schedulePriority=0,this._runQueue.push(n)):--n.schedulePriority)}),!r)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const r=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){const a=this._budget.now(),n=this._runQueue.pop();this._budget.resetProgress();try{n.task.runTask(this._budget)===$e.YIELD&&(n.blockFrame=this._frameNumber)}catch(u){Ct.Z.getLogger("esri.views.support.Scheduler").error(`Exception in task "${n.name}"`,u),n.blockFrame=this._frameNumber}!this._budget.hasProgressed&&n.blockFrame!==this._frameNumber&&n.needsUpdate&&(n.blockFrame=this._frameNumber),n.schedulePriority=n.basePriority;const o=this._budget.now()-a;if(n.runtime+=o,this._frameTaskTimes.set(n.priority,this._frameTaskTimes.get(n.priority)+o),this._debug&&o>2*this._budget.budget&&console.log("Task",n.name,"used",o,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-r)}}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-r)}_startFrameTaskTimes(){for(const r of Object.keys(F))this._frameTaskTimes.set(F[r],0)}_recordFrameTaskTimes(r){this._frameTaskTimes.forEach((a,n)=>this.performanceInfo.tasks.get(n).record(a)),this.performanceInfo.total.record(r)}get test(){return this._test}};class t{get task(){return this._task.value}get updating(){return this._queue.running}constructor(r,a,n,o){this._scheduler=r,this.name=a,this._basePriority=o,this.blockFrame=0,this.runtime=0,this._queue=new Ot,this._handles=new At.Z,this.schedulePriority=this._basePriority,this._task=(0,Ye.t)(n??this._queue),this._handles.add((0,He.gx)(()=>this.task.running,u=>r.taskRunningChanged(u)))}remove(){this.processQueue(Ge),this._scheduler.removeTask(this),this.schedule=mt.schedule,this.reschedule=mt.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(r){this.name=r;const a=ot(r);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=a),this._basePriority=a}get priority(){return this.name}set priority(r){this.setPriority(r)}get needsUpdate(){return this.updating||this.task.running}schedule(r,a,n){return this._queue.push(r,a,n)}reschedule(r,a,n){return this._queue.unshift(r,a,n)}processQueue(r){this._queue.runTask(r)}}class s{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=me.n.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(r){return!this.done&&(!0===r()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(r){this._enabled=r}reset(r,a){this._begin=this.now(),this._budget=r,this._state=a,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}l.Budget=s})(Me||(Me={})),function(l){l.SCHEDULED="s",l.READY="r",l.WAITING="w",l.IDLE="i"}(ve||(ve={}));const Ge=(()=>{const l=new Me.Budget;return l.enabled=!1,l})(),mt=new class Ut{remove(){}processQueue(){}schedule(e,t,s){try{if((0,C.Hc)(t)){const i=(0,C.zE)();return s?Promise.resolve(s(i)):Promise.reject(i)}return(0,C.gx)(e(Ge))}catch(i){return Promise.reject(i)}}reschedule(e,t,s){return this.schedule(e,t,s)}},Mt=new he.WJ(2e6);let Gt=0;class Qt{constructor(e){this._geometryQueryCache=null,this._changeHandle=null,this.capabilities={query:Ue.g},this.geometryType=e.geometryType,this.hasM=!!e.hasM,this.hasZ=!!e.hasZ,this.objectIdField=e.objectIdField,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.featureStore=e.featureStore,this.aggregateAdapter=e.aggregateAdapter,this._changeHandle=this.featureStore.events.on("changed",()=>this.clearCache()),this.timeInfo=e.timeInfo,e.cacheSpatialQueries&&(this._geometryQueryCache=new he.Xq(Gt+++"$$",Mt)),this.fieldsIndex=(0,ge.AK)(e.fieldsIndex)?e.fieldsIndex:Ft.Z.fromJSON(e.fieldsIndex),this.availableFields=null==e.availableFields?new Set(this.fieldsIndex.fields.map(t=>t.name)):new Set(e.availableFields.map(t=>this.fieldsIndex.get(t)?.name).filter(t=>null!=t)),e.scheduler&&e.priority&&(this._frameTask=e.scheduler.registerTask(e.priority))}destroy(){this._frameTask=(0,V.hw)(this._frameTask),this.clearCache(),(0,V.SC)(this._geometryQueryCache),this._changeHandle=(0,V.hw)(this._changeHandle)}get featureAdapter(){return this.featureStore.featureAdapter}clearCache(){this._geometryQueryCache?.clear(),this._allFeaturesPromise=null,this._timeExtentPromise=null,this._fullExtentPromise=null}executeQuery(e,t){var s=this;return(0,h.Z)(function*(){try{return(yield s._executeQuery(e,{},t)).createQueryResponse()}catch(i){if(i!==Ee.Ti)throw i;return new le([],e,s).createQueryResponse()}})()}executeQueryForCount(e={},t){var s=this;return(0,h.Z)(function*(){try{return(yield s._executeQuery(e,{returnGeometry:!1,returnCentroid:!1,outSR:null},t)).createQueryResponseForCount()}catch(i){if(i!==Ee.Ti)throw i;return 0}})()}executeQueryForExtent(e,t){var s=this;return(0,h.Z)(function*(){const i=e.outSR;try{const r=yield s._executeQuery(e,{returnGeometry:!0,returnCentroid:!1,outSR:null},t),a=r.size;return a?{count:a,extent:yield s._getBounds(r.items,r.spatialReference,i||s.spatialReference)}:{count:0,extent:null}}catch(r){if(r===Ee.Ti)return{count:0,extent:null};throw r}})()}executeQueryForIds(e,t){var s=this;return(0,h.Z)(function*(){return s.executeQueryForIdSet(e,t).then(i=>Array.from(i))})()}executeQueryForIdSet(e,t){var s=this;return(0,h.Z)(function*(){try{const i=yield s._executeQuery(e,{returnGeometry:!0,returnCentroid:!1,outSR:null},t),r=i.items,a=new Set;return yield s._reschedule(()=>{for(const n of r)a.add(i.featureAdapter.getObjectId(n))},t),a}catch(i){if(i===Ee.Ti)return new Set;throw i}})()}executeQueryForSnapping(e,t){var s=this;return(0,h.Z)(function*(){const{point:i,distance:r,returnEdge:a,vertexMode:n}=e;if(!a&&"none"===n)return{candidates:[]};let o=(0,ne.d9)(e.query);o=yield s._schedule(()=>(0,Ee.j6)(o,s.definitionExpression,s.spatialReference),t),o=yield s._reschedule(()=>st(o,{availableFields:s.availableFields,fieldsIndex:s.fieldsIndex,geometryType:s.geometryType,spatialReference:s.spatialReference}),t);const u=!(0,L.fS)(i.spatialReference,s.spatialReference);u&&(yield(0,q._W)(i.spatialReference,s.spatialReference));const d="number"==typeof r?r:r.x,m="number"==typeof r?r:r.y,y={xmin:i.x-d,xmax:i.x+d,ymin:i.y-m,ymax:i.y+m,spatialReference:i.spatialReference},T=u?(0,q.iV)(y,s.spatialReference):y;if(!T)return{candidates:[]};const I=(yield(0,b.aX)((0,A.im)(i),null,{signal:t}))[0],R=(yield(0,b.aX)((0,A.im)(T),null,{signal:t}))[0];if(null==I||null==R)return{candidates:[]};const _=new le(yield s._reschedule(()=>s._searchFeatures(s._getQueryBBoxes(R.toJSON())),t),o,s);yield s._reschedule(()=>s._executeObjectIdsQuery(_),t),yield s._reschedule(()=>s._executeTimeQuery(_),t),yield s._reschedule(()=>s._executeAttributesQuery(_),t),yield s._reschedule(()=>s._executeGeometryQueryForSnapping(_,t),t);const P=I.toJSON(),J=u?(0,q.iV)(P,s.spatialReference):P,j=u?Math.max(T.xmax-T.xmin,T.ymax-T.ymin)/2:r;return _.createSnappingResponse({...e,point:J,distance:j},i.spatialReference)})()}executeQueryForLatestObservations(e,t){var s=this;return(0,h.Z)(function*(){if(!s.timeInfo?.trackIdField)throw new w.Z("unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:e,timeInfo:s.timeInfo});try{const i=yield s._executeQuery(e,{},t);return yield s._reschedule(()=>s._filterLatest(i),t),i.createQueryResponse()}catch(i){if(i!==Ee.Ti)throw i;return new le([],e,s).createQueryResponse()}})()}executeQueryForSummaryStatistics(e={},t,s){var i=this;return(0,h.Z)(function*(){const{field:r,normalizationField:a,valueExpression:n}=t;return(yield i._executeQueryForStatistics(e,{field:r,normalizationField:a,valueExpression:n},s)).createSummaryStatisticsResponse(t)})()}executeQueryForUniqueValues(e={},t,s){var i=this;return(0,h.Z)(function*(){const{field:r,field2:a,field3:n,valueExpression:o}=t;return(yield i._executeQueryForStatistics(e,{field:r,field2:a,field3:n,valueExpression:o},s)).createUniqueValuesResponse(t)})()}executeQueryForClassBreaks(e={},t,s){var i=this;return(0,h.Z)(function*(){const{field:r,normalizationField:a,valueExpression:n}=t;return(yield i._executeQueryForStatistics(e,{field:r,normalizationField:a,valueExpression:n},s)).createClassBreaksResponse(t)})()}executeQueryForHistogram(e={},t,s){var i=this;return(0,h.Z)(function*(){const{field:r,normalizationField:a,valueExpression:n}=t;return(yield i._executeQueryForStatistics(e,{field:r,normalizationField:a,valueExpression:n},s)).createHistogramResponse(t)})()}fetchRecomputedExtents(e){var t=this;return(0,h.Z)(function*(){t._timeExtentPromise||=(0,rt.R)(t.timeInfo,t.featureStore);const[s,i]=yield Promise.all([t._getFullExtent(),t._timeExtentPromise]);return(0,C.k_)(e),{fullExtent:s,timeExtent:i}})()}_getBounds(e,t,s){var i=this;return(0,h.Z)(function*(){const r=(0,O.t8)((0,O.Ue)(),O.G_);yield i.featureStore.forEachBounds(e,o=>(0,O.TC)(r,o));const a={xmin:r[0],ymin:r[1],xmax:r[3],ymax:r[4],spatialReference:(0,B.S2)(i.spatialReference)};i.hasZ&&isFinite(r[2])&&isFinite(r[5])&&(a.zmin=r[2],a.zmax=r[5]);const n=(0,q.iV)(a,t,s);if(n.spatialReference=(0,B.S2)(s),n.xmax-n.xmin==0){const o=(0,D.c9)(n.spatialReference);n.xmin-=o,n.xmax+=o}if(n.ymax-n.ymin==0){const o=(0,D.c9)(n.spatialReference);n.ymin-=o,n.ymax+=o}if(i.hasZ&&null!=n.zmin&&null!=n.zmax&&n.zmax-n.zmin==0){const o=(0,D.c9)(n.spatialReference);n.zmin-=o,n.zmax+=o}return n})()}_getFullExtent(){return this._fullExtentPromise||="getFullExtent"in this.featureStore&&this.featureStore.getFullExtent?Promise.resolve(this.featureStore.getFullExtent(this.spatialReference)):this._getAllFeatures().then(e=>this._getBounds(e,this.spatialReference,this.spatialReference)),this._fullExtentPromise}_schedule(e,t){var s=this;return(0,h.Z)(function*(){return null!=s._frameTask?s._frameTask.schedule(e,t):e(Ge)})()}_reschedule(e,t){var s=this;return(0,h.Z)(function*(){return null!=s._frameTask?s._frameTask.reschedule(e,t):e(Ge)})()}_getAllFeaturesQueryEngineResult(e){var t=this;return(0,h.Z)(function*(){return new le(yield t._getAllFeatures(),e,t)})()}_getAllFeatures(){var e=this;return(0,h.Z)(function*(){if(null==e._allFeaturesPromise){const i=[];e._allFeaturesPromise=(0,h.Z)(function*(){yield e.featureStore.forEach(r=>i.push(r))})().then(()=>i)}const t=e._allFeaturesPromise,s=yield t;return t===e._allFeaturesPromise?s.slice():e._getAllFeatures()})()}_executeQuery(e,t,s){var i=this;return(0,h.Z)(function*(){e=(0,ne.d9)(e),e=yield i._schedule(()=>(0,Ee.Up)(e,i.definitionExpression,i.spatialReference),s),e=yield i._reschedule(()=>st(e,{availableFields:i.availableFields,fieldsIndex:i.fieldsIndex,geometryType:i.geometryType,spatialReference:i.spatialReference}),s),e={...e,...t};const r=yield i._reschedule(()=>i._executeSceneFilterQuery(e,s),s),a=yield i._reschedule(()=>i._executeGeometryQuery(e,r,s),s);return yield i._reschedule(()=>i._executeAggregateIdsQuery(a),s),yield i._reschedule(()=>i._executeObjectIdsQuery(a),s),yield i._reschedule(()=>i._executeTimeQuery(a),s),yield i._reschedule(()=>i._executeAttributesQuery(a),s),a})()}_executeSceneFilterQuery(e,t){var s=this;return(0,h.Z)(function*(){if(null==e.sceneFilter)return null;const{outSR:i,returnGeometry:r,returnCentroid:a}=e,n=s.featureStore.featureSpatialReference,o=e.sceneFilter.geometry,u=null==n||(0,L.fS)(n,o.spatialReference)?o:(0,q.iV)(o,n);if(!u)return null;const d=r||a,m=(0,L.JY)(i)&&!(0,L.fS)(s.spatialReference,i)&&d?function(){var _=(0,h.Z)(function*(P){return s._project(P,i)});return function(P){return _.apply(this,arguments)}}():_=>_,y=s.featureAdapter,T=yield s._reschedule(()=>s._searchFeatures(s._getQueryBBoxes(u)),t);if("disjoint"===e.sceneFilter.spatialRelationship){if(!T.length)return null;const _=new Set;for(const j of T)_.add(y.getObjectId(j));const P=yield s._reschedule(()=>s._getAllFeatures(),t);return m(yield s._reschedule((0,h.Z)(function*(){const j=yield(0,xe.cW)("esriSpatialRelDisjoint",u,s.geometryType,s.hasZ,s.hasM),v=yield s._runSpatialFilter(P,x=>!_.has(y.getObjectId(x))||j(y.getGeometry(x)),t);return new le(v,e,s)}),t))}if(!T.length)return new le([],e,s);if(s._canExecuteSinglePass(u,e))return m(new le(T,e,s));const I=yield(0,xe.cW)("esriSpatialRelContains",u,s.geometryType,s.hasZ,s.hasM),R=yield s._runSpatialFilter(T,_=>I(y.getGeometry(_)),t);return m(new le(R,e,s))})()}_executeGeometryQuery(e,t,s){var i=this;return(0,h.Z)(function*(){if(null!=t&&0===t.items.length)return t;e=null!=t?t.query:e;const{geometry:r,outSR:a,spatialRel:n,returnGeometry:o,returnCentroid:u}=e,d=i.featureStore.featureSpatialReference,m=!r||null==d||(0,L.fS)(d,r.spatialReference)?r:(0,q.iV)(r,d),y=o||u,T=(0,L.JY)(a)&&!(0,L.fS)(i.spatialReference,a),I=i._geometryQueryCache&&null==t?JSON.stringify(T&&y?{originalFilterGeometry:r,spatialRelationship:n,outSpatialReference:a}:{originalFilterGeometry:r,spatialRelationship:n}):null,R=I?i._geometryQueryCache.get(I):null;if(null!=R)return new le(R,e,i);const _=function(){var v=(0,h.Z)(function*(x){return T&&y&&(yield i._project(x,a)),I&&i._geometryQueryCache.put(I,x.items,x.items.length+1),x});return function(H){return v.apply(this,arguments)}}();if(!m)return _(t??(yield i._getAllFeaturesQueryEngineResult(e)));const P=i.featureAdapter;let J=yield i._reschedule(()=>i._searchFeatures(i._getQueryBBoxes(r)),s);if("esriSpatialRelDisjoint"===n){if(!J.length)return _(t??(yield i._getAllFeaturesQueryEngineResult(e)));const v=new Set;for(const Y of J)v.add(P.getObjectId(Y));const x=null!=t?t.items:yield i._reschedule(()=>i._getAllFeatures(),s);return _(yield i._reschedule((0,h.Z)(function*(){const Y=yield(0,xe.cW)(n,m,i.geometryType,i.hasZ,i.hasM),Se=yield i._runSpatialFilter(x,Fe=>!v.has(P.getObjectId(Fe))||Y(P.getGeometry(Fe)),s);return new le(Se,e,i)}),s))}if(null!=t){const v=new $.SO;J=J.filter(x=>(0,$.cq)(t.items,x,t.items.length,v)>=0)}if(!J.length){const v=new le([],e,i);return I&&i._geometryQueryCache.put(I,v.items,1),v}if(i._canExecuteSinglePass(m,e))return _(new le(J,e,i));const j=yield(0,xe.cW)(n,m,i.geometryType,i.hasZ,i.hasM),k=yield i._runSpatialFilter(J,v=>j(P.getGeometry(v)),s);return _(new le(k,e,i))})()}_executeGeometryQueryForSnapping(e,t){var s=this;return(0,h.Z)(function*(){const{query:i}=e,{spatialRel:r}=i;if(!e?.items?.length||!i.geometry||!r)return;const a=yield(0,xe.cW)(r,i.geometry,s.geometryType,s.hasZ,s.hasM),n=yield s._runSpatialFilter(e.items,o=>a(o.geometry),t);e.items=n})()}_executeAggregateIdsQuery(e){if(0===e.items.length||!e.query.aggregateIds?.length||null==this.aggregateAdapter)return;const t=new Set;for(const i of e.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(i).forEach(r=>t.add(r));const s=this.featureAdapter.getObjectId;e.items=e.items.filter(i=>t.has(s(i)))}_executeObjectIdsQuery(e){if(0===e.items.length||!e.query.objectIds?.length)return;const t=new Set(e.query.objectIds),s=this.featureAdapter.getObjectId;e.items=e.items.filter(i=>t.has(s(i)))}_executeTimeQuery(e){if(0===e.items.length)return;const t=(0,rt.y)(this.timeInfo,e.query.timeExtent,this.featureAdapter);null!=t&&(e.items=e.items.filter(t))}_executeAttributesQuery(e){if(0===e.items.length)return;const t=N(e.query.where,this.fieldsIndex);if(t){if(!t.isStandardized)throw new TypeError("Where clause is not standardized");e.items=e.items.filter(s=>t.testFeature(s,this.featureAdapter))}}_runSpatialFilter(e,t,s){var i=this;return(0,h.Z)(function*(){if(!t)return e;if(null==i._frameTask)return e.filter(o=>t(o));let r=0;const a=new Array,n=function(){var o=(0,h.Z)(function*(u){for(;r<e.length;){const d=e[r++];t(d)&&(a.push(d),u.madeProgress()),u.done&&(yield i._reschedule(m=>n(m),s))}});return function(d){return o.apply(this,arguments)}}();return i._reschedule(o=>n(o),s).then(()=>a)})()}_filterLatest(e){const{trackIdField:t,startTimeField:s,endTimeField:i}=this.timeInfo,r=i||s,a=new Map,n=this.featureAdapter.getAttribute;for(const o of e.items){const u=n(o,t),d=n(o,r),m=a.get(u);(!m||d>n(m,r))&&a.set(u,o)}e.items=Array.from(a.values())}_canExecuteSinglePass(e,t){const{spatialRel:s}=t;return(0,xe.hN)(e)&&("esriSpatialRelEnvelopeIntersects"===s||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===s||"esriSpatialRelContains"===s))}_project(e,t){var s=this;return(0,h.Z)(function*(){if(!t||(0,L.fS)(s.spatialReference,t))return e;const i=s.featureAdapter;let r;try{const n=yield s._getFullExtent();r=(0,U.getTransformation)(s.spatialReference,t,n)}catch{}const a=yield(0,q.oj)(e.items.map(n=>(0,B.Op)(s.geometryType,s.hasZ,s.hasM,i.getGeometry(n))),s.spatialReference,t,r);return e.items=a.map((n,o)=>i.cloneWithGeometry(e.items[o],(0,z.GH)(n,s.hasZ,s.hasM))),e})()}_getQueryBBoxes(e){if((0,xe.hN)(e)){if((0,A.YX)(e))return[(0,E.al)(Math.min(e.xmin,e.xmax),Math.min(e.ymin,e.ymax),Math.max(e.xmin,e.xmax),Math.max(e.ymin,e.ymax))];if((0,A.oU)(e))return e.rings.map(t=>(0,E.al)(Math.min(t[0][0],t[2][0]),Math.min(t[0][1],t[2][1]),Math.max(t[0][0],t[2][0]),Math.max(t[0][1],t[2][1])))}return[(0,S.$P)((0,E.Ue)(),e)]}_searchFeatures(e){var t=this;return(0,h.Z)(function*(){const s=new Set;yield Promise.all(e.map(r=>t.featureStore.forEachInBounds(r,a=>s.add(a))));const i=Array.from(s.values());return s.clear(),i})()}_executeQueryForStatistics(e,t,s){var i=this;return(0,h.Z)(function*(){e=(0,ne.d9)(e);try{e=yield i._schedule(()=>(0,Ee.Up)(e,i.definitionExpression,i.spatialReference),s),e=yield i._reschedule(()=>function Rt(l,e,t){return ze.apply(this,arguments)}(e,t,{availableFields:i.availableFields,fieldsIndex:i.fieldsIndex,geometryType:i.geometryType,spatialReference:i.spatialReference}),s);const r=yield i._reschedule(()=>i._executeSceneFilterQuery(e,s),s),a=yield i._reschedule(()=>i._executeGeometryQuery(e,r,s),s);return yield i._reschedule(()=>i._executeAggregateIdsQuery(a),s),yield i._reschedule(()=>i._executeObjectIdsQuery(a),s),yield i._reschedule(()=>i._executeTimeQuery(a),s),yield i._reschedule(()=>i._executeAttributesQuery(a),s),a}catch(r){if(r!==Ee.Ti)throw r;return new le([],e,i)}})()}}},85559:(Ae,oe,c)=>{c.d(oe,{g:()=>h});const h={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},29085:(Ae,oe,c)=>{c.d(oe,{EG:()=>he,Op:()=>C,S2:()=>D});var h=c(10842),$=c(62209);const w=new $.Z,ge=new $.Z,ne=new $.Z,V={esriGeometryPoint:h.fQ,esriGeometryPolyline:h.J6,esriGeometryPolygon:h.eG,esriGeometryMultipoint:h.Iv};function he(E,S,A,b=E.hasZ,L=E.hasM){if(null==S)return null;const z=E.hasZ&&b,ae=E.hasM&&L;if(A){const se=(0,h.Nh)(ne,S,E.hasZ,E.hasM,"esriGeometryPoint",A,b,L);return(0,h.fQ)(se,z,ae)}return(0,h.fQ)(S,z,ae)}function C(E,S,A,b,L,z,ae=S,se=A){const ye=S&&ae,ue=A&&se,p=null!=b?"coords"in b?b:b.geometry:null;if(null==p)return null;if(L){let M=(0,h.zj)(ge,p,S,A,E,L,ae,se);return z&&(M=(0,h.Nh)(ne,M,ye,ue,E,z)),V[E]?.(M,ye,ue)??null}if(z){const M=(0,h.Nh)(ne,p,S,A,E,z,ae,se);return V[E]?.(M,ye,ue)??null}return(0,h.hY)(w,p,S,A,ae,se),V[E]?.(w,ye,ue)??null}function D(E){return E&&U in E?JSON.parse(JSON.stringify(E,O)):E}const U="_geVersion",O=(E,S)=>E!==U?S:void 0},44452:(Ae,oe,c)=>{c.d(oe,{Ti:()=>O,Up:()=>E,j6:()=>A});var h=c(15861),$=c(84303),w=c(49602),ge=c(83821),ne=c(14138),V=c(40637),he=c(93566),C=c(33721),D=c(58829);const U=new $.X({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),O=Object.freeze({});function E(p,M,W){return S.apply(this,arguments)}function S(){return(S=(0,h.Z)(function*(p,M,W){const{outFields:X,orderByFields:G,groupByFieldsForStatistics:ie,outStatistics:g}=p;if(X)for(let f=0;f<X.length;f++)X[f]=X[f].trim();if(G)for(let f=0;f<G.length;f++)G[f]=G[f].trim();if(ie)for(let f=0;f<ie.length;f++)ie[f]=ie[f].trim();if(g)for(let f=0;f<g.length;f++)g[f].onStatisticField&&(g[f].onStatisticField=g[f].onStatisticField.trim());return p.geometry&&!p.outSR&&(p.outSR=p.geometry.spatialReference),A(p,M,W)})).apply(this,arguments)}function A(p,M,W){return b.apply(this,arguments)}function b(){return b=(0,h.Z)(function*(p,M,W){if(!p)return null;let{where:X}=p;if(p.where=X=X?.trim(),(!X||/^1 *= *1$/.test(X)||M&&M===X)&&(p.where=null),!p.geometry)return p;let G=yield function ae(p){return se.apply(this,arguments)}(p);if(p.distance=0,p.units=null,"esriSpatialRelEnvelopeIntersects"===p.spatialRel){const{spatialReference:ie}=p.geometry;G=(0,ne.aO)(G),G.spatialReference=ie}if(G){yield(0,D._W)(G.spatialReference,W),G=function z(p,M){const W=p.spatialReference;return L(p,M)&&(0,V.YX)(p)?{spatialReference:W,rings:[[[p.xmin,p.ymin],[p.xmin,p.ymax],[p.xmax,p.ymax],[p.xmax,p.ymin],[p.xmin,p.ymin]]]}:p}(G,W);const ie=(yield(0,he.aX)((0,V.im)(G)))[0];if(null==ie)throw O;const g="quantizationParameters"in p&&p.quantizationParameters?.tolerance||"maxAllowableOffset"in p&&p.maxAllowableOffset||0,f=g&&L(G,W)?{densificationStep:8*g}:void 0,Q=ie.toJSON(),N=(0,D.iV)(Q,Q.spatialReference,W,f);if(!N)throw O;N.spatialReference=W,p.geometry=N}return p}),b.apply(this,arguments)}function L(p,M){if(!p)return!1;const W=p.spatialReference;return((0,V.YX)(p)||(0,V.oU)(p)||(0,V.l9)(p))&&!(0,C.fS)(W,M)&&!(0,ge.canProjectWithoutEngine)(W,M)}function se(){return se=(0,h.Z)(function*(p){const{distance:M,units:W}=p,X=p.geometry;if(null==M||"vertexAttributes"in X)return X;const G=X.spatialReference,ie=W?U.fromJSON(W):(0,w.qE)(G),g=G&&((0,C.sT)(G)||(0,C.sS)(G))?X:yield(0,D._W)(G,C.Zn).then(()=>(0,D.iV)(X,C.Zn));return(yield function ye(){return ue.apply(this,arguments)}())(g.spatialReference,g,M,ie)}),se.apply(this,arguments)}function ue(){return(ue=(0,h.Z)(function*(){return(yield Promise.all([c.e(9465),c.e(8592)]).then(c.bind(c,49574))).geodesicBuffer})).apply(this,arguments)}},51089:(Ae,oe,c)=>{c.d(oe,{hN:()=>ie,P0:()=>X,cW:()=>W});var h=c(15861),$=c(57964),w=c(5825),ge=c(26230),V=c(40637),he=c(33721);function C(g,f){return g?f?4:3:f?3:2}function O(g,f,Q,N,ee){if(!g)return!1;const K=C(f,Q),{coords:Z,lengths:de}=g;let re=!1,B=0;for(const q of de)re=E(re,Z,K,B,q,N,ee),B+=q*K;return re}function E(g,f,Q,N,ee,K,Z){let de=g,re=N;for(let B=N,q=N+ee*Q;B<q;B+=Q){re=B+Q,re===q&&(re=N);const Ue=f[B],Ie=f[B+1],Ce=f[re+1];(Ie<Z&&Ce>=Z||Ce<Z&&Ie>=Z)&&Ue+(Z-Ie)/(Ce-Ie)*(f[re]-Ue)<K&&(de=!de)}return de}var S=c(10842),A=c(62209),b=c(29085),L=c(58829);const z="unsupported-query",ae={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},se={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};function W(g,f,Q,N,ee){if((0,V.oU)(f)&&"esriGeometryPoint"===Q&&("esriSpatialRelIntersects"===g||"esriSpatialRelContains"===g)){const K=(0,S.Uy)(new A.Z,f,!1,!1);return Promise.resolve(Z=>function D(g,f,Q,N){return O(g,f,Q,N.coords[0],N.coords[1])}(K,!1,!1,Z))}if((0,V.oU)(f)&&"esriGeometryMultipoint"===Q){const K=(0,S.Uy)(new A.Z,f,!1,!1);if("esriSpatialRelContains"===g)return Promise.resolve(Z=>function U(g,f,Q,N,ee,K){const Z=C(ee,K),{coords:de,lengths:re}=N;if(!re)return!1;for(let B=0,q=0;B<re.length;B++,q+=Z)if(!O(g,f,Q,de[q],de[q+1]))return!1;return!0}(K,!1,!1,Z,N,ee))}if((0,V.YX)(f)&&"esriGeometryPoint"===Q&&("esriSpatialRelIntersects"===g||"esriSpatialRelContains"===g))return Promise.resolve(K=>(0,w.aV)(f,(0,b.Op)(Q,N,ee,K)));if((0,V.YX)(f)&&"esriGeometryMultipoint"===Q&&"esriSpatialRelContains"===g)return Promise.resolve(K=>(0,w.lQ)(f,(0,b.Op)(Q,N,ee,K)));if((0,V.YX)(f)&&"esriSpatialRelIntersects"===g){const K=function ne(g){return"mesh"===g?ge.h_:(0,ge.IY)(g)}(Q);return Promise.resolve(Z=>K(f,(0,b.Op)(Q,N,ee,Z)))}return function M(){return Promise.all([c.e(9465),c.e(8592)]).then(c.bind(c,49574))}().then(K=>{const Z=K[ae[g]].bind(null,f.spatialReference,f);return de=>Z((0,b.Op)(Q,N,ee,de))})}function X(g,f,Q){return G.apply(this,arguments)}function G(){return(G=(0,h.Z)(function*(g,f,Q){const{spatialRel:N,geometry:ee}=g;if(ee){if(!function ye(g){return null!=g&&!0===se.spatialRelationship[g]}(N))throw new $.Z(z,"Unsupported query spatial relationship",{query:g});if((0,he.JY)(ee.spatialReference)&&(0,he.JY)(Q)){if(!function ue(g){return null!=g&&!0===se.queryGeometry[(0,V.Ji)(g)]}(ee))throw new $.Z(z,"Unsupported query geometry type",{query:g});if(!function p(g){return null!=g&&!0===se.layerGeometry[g]}(f))throw new $.Z(z,"Unsupported layer geometry type",{query:g});if(g.outSR)return(0,L._W)(g.geometry?.spatialReference,g.outSR)}}})).apply(this,arguments)}function ie(g){if((0,V.YX)(g))return!0;if((0,V.oU)(g)){for(const f of g.rings)if(5!==f.length||f[0][0]!==f[1][0]||f[0][0]!==f[4][0]||f[2][0]!==f[3][0]||f[0][1]!==f[3][1]||f[0][1]!==f[4][1]||f[1][1]!==f[2][1])return!1;return!0}return!1}},21418:(Ae,oe,c)=>{c.d(oe,{R:()=>$,y:()=>ge});var h=c(15861);function $(C,D){return w.apply(this,arguments)}function w(){return(w=(0,h.Z)(function*(C,D){if(!C)return null;const U=D.featureAdapter,{startTimeField:O,endTimeField:E}=C;let S=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY;if(O&&E)yield D.forEach(b=>{const L=U.getAttribute(b,O),z=U.getAttribute(b,E);null==L||isNaN(L)||(S=Math.min(S,L)),null==z||isNaN(z)||(A=Math.max(A,z))});else{const b=O||E;yield D.forEach(L=>{const z=U.getAttribute(L,b);null==z||isNaN(z)||(S=Math.min(S,z),A=Math.max(A,z))})}return{start:S,end:A}})).apply(this,arguments)}function ge(C,D,U){if(!D||!C)return null;const{startTimeField:O,endTimeField:E}=C;if(!O&&!E)return null;const{start:S,end:A}=D;if(null===S&&null===A)return null;if(void 0===S&&void 0===A)return()=>!1;const b=U.getAttributeAsTimestamp?.bind(U)??U.getAttribute.bind(U);return O&&E?function ne(C,D,U,O,E){return null!=O&&null!=E?S=>{const A=C(S,D),b=C(S,U);return(null==A||A<=E)&&(null==b||b>=O)}:null!=O?S=>{const A=C(S,U);return null==A||A>=O}:null!=E?S=>{const A=C(S,D);return null==A||A<=E}:void 0}(b,O,E,S,A):function V(C,D,U,O){return null!=U&&null!=O&&U===O?E=>C(E,D)===U:null!=U&&null!=O?E=>{const S=C(E,D);return null!=S&&S>=U&&S<=O}:null!=U?E=>{const S=C(E,D);return null!=S&&S>=U}:null!=O?E=>{const S=C(E,D);return null!=S&&S<=O}:void 0}(b,O||E,S,A)}},24940:(Ae,oe,c)=>{var h,$;c.d(oe,{n:()=>h}),($=h||(h={}))[$.ANIMATING=0]="ANIMATING",$[$.INTERACTING=1]="INTERACTING",$[$.IDLE=2]="IDLE"}}]);