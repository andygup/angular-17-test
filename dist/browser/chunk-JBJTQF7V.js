import{a as D}from"./chunk-CN5O6E6T.js";import{a as F}from"./chunk-HPJ6EQFO.js";import{a as C}from"./chunk-VVAIF23J.js";import{p as T}from"./chunk-465DRXTW.js";var y,v;function N(e){return e&&e.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function z(e){return e!=null&&!isNaN(e)&&isFinite(e)}function M(e){return e.valueExpression?y.Expression:e.field&&typeof e.field=="string"?y.Field:y.Unknown}function H(e,r){let n=r||M(e),a=e.valueUnit||"unknown";return n===y.Unknown?v.Constant:e.stops?v.Stops:e.minSize!=null&&e.maxSize!=null&&e.minDataValue!=null&&e.maxDataValue!=null?v.ClampedLinear:a==="unknown"?e.minSize!=null&&e.minDataValue!=null?e.minSize&&e.minDataValue?v.Proportional:v.Additive:v.Identity:v.RealWorldSize}(function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"})(y||(y={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(v||(v={}));var S=T.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),R=new D,w=Math.PI,ne=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function I(e,r,n){let a="visualVariables"in e&&e.visualVariables?e.visualVariables.find(u=>u.type==="color"):e;if(!a)return;if(a.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void S.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");let i=typeof r=="number",t=i?null:r,l=t?.attributes,o=i?r:null,s=a.field,{ipData:d,hasExpression:m}=a.cache,c=a.cache.compiledFunc;if(!s&&!m){let u=a.stops;return u&&u[0]&&u[0].color}if(typeof o!="number")if(m){if(n?.arcade==null)return void S.error("Use of arcade expressions requires an arcade context");let u={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},p=n.arcade.arcadeUtils,h=p.getViewInfo(u),x=p.createExecContext(t,h,n.timeZone);if(!c){let g=p.createSyntaxTree(a.valueExpression);c=p.createFunction(g),a.cache.compiledFunc=c}o=p.executeFunction(c,x)}else l&&(o=l[s]);let f=a.normalizationField,b=l!=null&&f!=null?parseFloat(l[f]):void 0;if(o!=null&&(!f||i||!isNaN(b)&&b!==0)){isNaN(b)||i||(o/=b);let u=E(o,d);if(u){let p=u[0],h=u[1],x=p===h?a.stops[p].color:F.blendColors(a.stops[p].color,a.stops[h].color,u[2],n?.color);return new F(x)}}}function q(e,r,n){let a="visualVariables"in e&&e.visualVariables?e.visualVariables.find(u=>u.type==="opacity"):e;if(!a)return;if(a.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void S.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");let i=typeof r=="number",t=i?null:r,l=t?.attributes,o=i?r:null,s=a.field,{ipData:d,hasExpression:m}=a.cache,c=a.cache.compiledFunc;if(!s&&!m){let u=a.stops;return u&&u[0]&&u[0].opacity}if(typeof o!="number")if(m){if(n?.arcade==null)return void S.error("Use of arcade expressions requires an arcade context");let u={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},p=n.arcade.arcadeUtils,h=p.getViewInfo(u),x=p.createExecContext(t,h,n.timeZone);if(!c){let g=p.createSyntaxTree(a.valueExpression);c=p.createFunction(g),a.cache.compiledFunc=c}o=p.executeFunction(c,x)}else l&&(o=l[s]);let f=a.normalizationField,b=l!=null&&f!=null?parseFloat(l[f]):void 0;if(o!=null&&(!f||i||!isNaN(b)&&b!==0)){isNaN(b)||i||(o/=b);let u=E(o,d);if(u){let p=u[0],h=u[1];if(p===h)return a.stops[p].opacity;{let x=a.stops[p].opacity;return x+(a.stops[h].opacity-x)*u[2]}}}}function A(e,r,n){let a="visualVariables"in e&&e.visualVariables?e.visualVariables.find(b=>b.type==="rotation"):e;if(!a)return;if(a.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void S.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");let i=a.axis||"heading",t=i==="heading"&&a.rotationType==="arithmetic"?90:0,l=i==="heading"&&a.rotationType==="arithmetic"?-1:1,o=typeof r=="number"?null:r,s=o?.attributes,d=a.field,{hasExpression:m}=a.cache,c=a.cache.compiledFunc,f=0;if(!d&&!m)return f;if(m){if(n?.arcade==null)return void S.error("Use of arcade expressions requires an arcade context");let b={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},u=n.arcade.arcadeUtils,p=u.getViewInfo(b),h=u.createExecContext(o,p,n.timeZone);if(!c){let x=u.createSyntaxTree(a.valueExpression);c=u.createFunction(x),a.cache.compiledFunc=c}f=u.executeFunction(c,h)}else s&&(f=s[d]||0);return f=typeof f!="number"||isNaN(f)?null:t+l*f,f}function L(e,r,n){let a=typeof r=="number",i=a?null:r,t=i?.attributes,l=a?r:null,{isScaleDriven:o}=e.cache,s=e.cache.compiledFunc;if(o){let m=n?.scale,c=n?.view;l=m==null||c==="3d"?O(e):m}else if(!a)switch(e.inputValueType){case y.Expression:{if(n?.arcade==null)return void S.error("Use of arcade expressions requires an arcade context");let m={viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},c=n.arcade.arcadeUtils,f=c.getViewInfo(m),b=c.createExecContext(i,f,n.timeZone);if(!s){let u=c.createSyntaxTree(e.valueExpression);s=c.createFunction(u),e.cache.compiledFunc=s}l=c.executeFunction(s,b);break}case y.Field:t&&(l=t[e.field]);break;case y.Unknown:l=null}if(!z(l))return null;if(a||!e.normalizationField)return l;let d=t?parseFloat(t[e.normalizationField]):null;return z(d)&&d!==0?l/d:null}function O(e){let r=null,n=null,a=e.stops;return a?(r=a[0].value,n=a[a.length-1].value):(r=e.minDataValue||0,n=e.maxDataValue||0),(r+n)/2}function k(e,r,n){let a="visualVariables"in e&&e.visualVariables?e.visualVariables.find(t=>t.type==="size"):e;if(!a)return;if(a.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void S.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");let i=G(L(a,r,n),a,r,n,a.cache.ipData);return i==null||isNaN(i)?0:i}function V(e,r,n){return e==null?null:N(e)?k(e,r,n):z(e)?e:null}function U(e,r,n){return z(n)&&e>n?n:z(r)&&e<r?r:e}function P(e,r,n,a){return e+((V(r.minSize,n,a)||r.minDataValue)??0)}function Z(e,r,n){let a=e.stops,i=a?.length&&a[0].size;return i==null&&(i=e.minSize),V(i,r,n)}function W(e,r,n,a){let i=(e-r.minDataValue)/(r.maxDataValue-r.minDataValue),t=V(r.minSize,n,a),l=V(r.maxSize,n,a),o=a?.shape;if(e<=r.minDataValue)return t;if(e>=r.maxDataValue)return l;if(t==null||l==null)return null;if(r.scaleBy==="area"&&o){let s=o==="circle",d=s?w*(t/2)**2:t*t,m=d+i*((s?w*(l/2)**2:l*l)-d);return s?2*Math.sqrt(m/w):Math.sqrt(m)}return t+i*(l-t)}function $(e,r,n,a){let i=a?.shape,t=e/r.minDataValue,l=V(r.minSize,n,a),o=V(r.maxSize,n,a),s=null;return s=i==="circle"?2*Math.sqrt(t*(l/2)**2):i==="square"||i==="diamond"||i==="image"?Math.sqrt(t*l**2):t*l,U(s,l,o)}function B(e,r,n,a,i){let[t,l,o]=E(e,i);if(t===l)return V(r.stops?.[t].size,n,a);{let s=V(r.stops?.[t].size,n,a);return s+(V(r.stops?.[l].size,n,a)-s)*o}}function j(e,r,n,a){let i=(a?.resolution??1)*C[r.valueUnit],t=V(r.minSize,n,a),l=V(r.maxSize,n,a),{valueRepresentation:o}=r,s=null;return s=o==="area"?2*Math.sqrt(e/w)/i:o==="radius"||o==="distance"?2*e/i:e/i,U(s,t,l)}function G(e,r,n,a,i){switch(r.transformationType){case v.Additive:return P(e,r,n,a);case v.Constant:return Z(r,n,a);case v.ClampedLinear:return W(e,r,n,a);case v.Proportional:return $(e,r,n,a);case v.Stops:return B(e,r,n,a,i);case v.RealWorldSize:return j(e,r,n,a);case v.Identity:return e;case v.Unknown:return null}}function re(e,r,n){let{isScaleDriven:a}=e.cache;if(!(a&&n==="3d"||r))return null;let i={scale:r,view:n},t=V(e.minSize,R,i),l=V(e.maxSize,R,i);if(t!=null||l!=null){if(t>l){let o=l;l=t,t=o}return{minSize:t,maxSize:l}}}function te(e,r,n){if(!e.visualVariables)return;let a=[],i=[],t=[],l=[],o=[];for(let s of e.visualVariables)switch(s.type){case"color":i.push(s);break;case"opacity":t.push(s);break;case"rotation":o.push(s);break;case"size":l.push(s)}return i.forEach(s=>{let d=I(s,r,n);a.push({variable:s,value:d})}),t.forEach(s=>{let d=q(s,r,n);a.push({variable:s,value:d})}),o.forEach(s=>{let d=A(s,r,n);a.push({variable:s,value:d})}),l.forEach(s=>{let d=k(s,r,n);a.push({variable:s,value:d})}),a.filter(s=>s.value!=null)}function E(e,r){if(!r)return;let n=0,a=r.length-1;return r.some((i,t)=>e<i?(a=t,!0):(n=t,!1)),[n,a,(e-r[n])/(r[a]-r[n])]}function ie(e,r,n){let a=["proportional","proportional","proportional"];for(let i of e){let t=i.useSymbolValue?"symbol-value":k(i,r,n);switch(i.axis){case"width":a[0]=t;break;case"depth":a[1]=t;break;case"height":a[2]=t;break;case"width-and-depth":a[0]=t,a[1]=t;break;case"all":case void 0:case null:a[0]=t,a[1]=t,a[2]=t;break;default:i.axis}}return a}export{v as a,N as b,M as c,H as d,ne as e,I as f,q as g,A as h,k as i,V as j,G as k,re as l,te as m,ie as n};
