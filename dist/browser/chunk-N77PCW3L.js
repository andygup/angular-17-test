import{a as I,b as T}from"./chunk-MBI4IOAA.js";import{p as A}from"./chunk-M3GEY4SR.js";import{a as h}from"./chunk-U2QVIRVP.js";import{f as x}from"./chunk-4ATIL3QV.js";import{a as p,b}from"./chunk-UZQ577CU.js";import{a,c,h as m}from"./chunk-URPCXPAW.js";import{a as g}from"./chunk-XDTDVCGP.js";import{a as n}from"./chunk-AC62Z3FX.js";import{a as y}from"./chunk-ESDYQQXO.js";var l=class u{static fromBuffer(e,t){return new u(e,t)}static create(e,t=4294967295){let r=new Uint32Array(Math.ceil(e/32));return new u(r,t)}constructor(e,t){this._mask=0,this._buf=e,this._mask=t}_getIndex(e){return Math.floor(e/32)}has(e){let t=this._mask&e;return!!(this._buf[this._getIndex(t)]&1<<t%32)}hasRange(e,t){let r=e,s=t;for(;r%32&&r!==s;){if(this.has(r))return!0;r++}for(;s%32&&r!==s;){if(this.has(r))return!0;s--}if(r===s)return!1;for(let i=r/32;i!==s/32;i++)if(this._buf[i])return!0;return!1}set(e){let t=this._mask&e,r=this._getIndex(t),s=1<<t%32;this._buf[r]|=s}setRange(e,t){let r=e,s=t;for(;r%32&&r!==s;)this.set(r++);for(;s%32&&r!==s;)this.set(s--);if(r!==s)for(let i=r/32;i!==s/32;i++)this._buf[i]=4294967295}unset(e){let t=this._mask&e,r=this._getIndex(t),s=1<<t%32;this._buf[r]&=4294967295^s}resize(e){let t=this._buf,r=new Uint32Array(Math.ceil(e/32));r.set(t),this._buf=r}or(e){for(let t=0;t<this._buf.length;t++)this._buf[t]|=e._buf[t];return this}and(e){for(let t=0;t<this._buf.length;t++)this._buf[t]&=e._buf[t];return this}xor(e){for(let t=0;t<this._buf.length;t++)this._buf[t]^=e._buf[t];return this}ior(e){for(let t=0;t<this._buf.length;t++)this._buf[t]|=~e._buf[t];return this}iand(e){for(let t=0;t<this._buf.length;t++)this._buf[t]&=~e._buf[t];return this}ixor(e){for(let t=0;t<this._buf.length;t++)this._buf[t]^=~e._buf[t];return this}any(){for(let e=0;e<this._buf.length;e++)if(this._buf[e])return!0;return!1}copy(e){for(let t=0;t<this._buf.length;t++)this._buf[t]=e._buf[t];return this}clone(){return new u(this._buf.slice(),this._mask)}clear(){for(let e=0;e<this._buf.length;e++)this._buf[e]=0}forEachSet(e){for(let t=0;t<this._buf.length;t++){let r=this._buf[t],s=32*t;if(r)for(;r;)1&r&&e(s),r>>>=1,s++}}countSet(){let e=0;return this.forEachSet(t=>{e++}),e}};var o=0,f=n("featurelayer-simplify-thresholds")??[.5,.5,.5,.5],D=f[0],F=f[1],w=f[2],C=f[3],_=n("featurelayer-simplify-payload-size-factors")??[1,2,4],O=_[0],R=_[1],j=_[2],v=n("featurelayer-simplify-mobile-factor")??2,z=n("esri-mobile"),S=class{constructor(e,t){this.type="FeatureSetReader",this.arcadeDeclaredClass="esri.arcade.Feature",this.seen=!1,this.instance=0,this._tx=0,this._ty=0,this._sx=1,this._sy=1,this._deleted=null,this._joined=[],this._objectIdToIndex=null,this._contextTimeZone=null,this._level=0,this.instance=e,this._layerSchema=t}static createInstance(){return o++,o=o>65535?0:o,o}get isEmpty(){return this._deleted!=null&&this._deleted.countSet()===this.getSize()}get contextTimeZone(){return this._contextTimeZone}set contextTimeZone(e){this._contextTimeZone=e}set level(e){this._level=e}getAreaSimplificationThreshold(e,t){let r=1,s=z?v:1;t>4e6?r=j*s:t>1e6?r=R*s:t>5e5?r=O*s:t>1e5&&(r=s);let i=0;e>4e3?i=C*r:e>2e3?i=w*r:e>100?i=F:e>15&&(i=D);let d=8;return this._level<4?d=1:this._level<5?d=2:this._level<6&&(d=4),i*d}createQuantizedExtrudedGeometry(e,t){return this.geometryType==="esriGeometryPolyline"?this._createQuantizedExtrudedLine(e,t):this._createQuantizedExtrudedQuad(e,t)}_createQuantizedExtrudedQuad(e,t){return new h([5],[e-1,t,1,-1,1,1,-1,1,-1,-1])}_createQuantizedExtrudedLine(e,t){return new h([2],[e-1,t+1,1,-1])}parseTimestampOffset(e){return e}setArcadeSpatialReference(e){this._arcadeSpatialReference=e}attachStorage(e){this._storage=e}getQuantizationTransform(){throw new Error("Unable to find transform for featureSet")}getStorage(){return this._storage}getComputedNumeric(e){return this.getComputedNumericAtIndex(0)}setComputedNumeric(e,t){return this.setComputedNumericAtIndex(t,0)}getComputedString(e){return this.getComputedStringAtIndex(0)}setComputedString(e,t){return this.setComputedStringAtIndex(0,t)}getComputedNumericAtIndex(e){return this._storage.getComputedNumericAtIndex(this.getDisplayId(),e)}setComputedNumericAtIndex(e,t){this._storage.setComputedNumericAtIndex(this.getDisplayId(),e,t)}getComputedStringAtIndex(e){return this._storage.getComputedStringAtIndex(this.getDisplayId(),e)}setComputedStringAtIndex(e,t){return this._storage.setComputedStringAtIndex(this.getDisplayId(),e,t)}transform(e,t,r,s){let i=this.copy();return i._tx+=e,i._ty+=t,i._sx*=r,i._sy*=s,i}readAttributeAsTimestamp(e){let t=this.readAttribute(e);return typeof t=="string"?new Date(t).getTime():typeof t=="number"||t==null?t:null}readAttribute(e,t=!1){let r=this._readAttribute(e,t);if(r!==void 0)return r;for(let s of this._joined){s.setIndex(this.getIndex());let i=s._readAttribute(e,t);if(i!==void 0)return i}}readAttributes(){let e=this._readAttributes();for(let t of this._joined){t.setIndex(this.getIndex());let r=t._readAttributes();for(let s of Object.keys(r))e[s]=r[s]}return e}joinAttributes(e){this._joined.push(e)}readArcadeFeature(){return this}hasField(e){return this.fields.has(e)}geometry(){let e=this.readHydratedGeometry(),t=A(e,this.geometryType,this.hasZ,this.hasM),r=x(t);return r&&(r.spatialReference=this._arcadeSpatialReference),r}autocastArcadeDate(e,t){return t&&t instanceof Date?this.isUnknownDateTimeField(e)?a.unknownDateJSToArcadeDate(t):a.dateJSAndZoneToArcadeDate(t,this.contextTimeZone??p):t}isUnknownDateTimeField(e){return this._layerSchema.fieldsIndex.getTimeZone(e)===b}field(e){let t=this.fields.get(e);if(t)switch(t.type){case"date-only":case"esriFieldTypeDateOnly":return c.fromReader(this.readAttribute(e,!1));case"time-only":case"esriFieldTypeTimeOnly":return m.fromReader(this.readAttribute(e,!1));case"esriFieldTypeTimestampOffset":case"timestamp-offset":return a.fromReaderAsTimeStampOffset(this.readAttribute(e,!1));case"date":case"esriFieldTypeDate":return this.autocastArcadeDate(e,this.readAttribute(e,!0));default:return this.readAttribute(e,!1)}for(let r of this._joined)if(r.setIndex(this.getIndex()),t=r.fields.get(e),t)switch(t.type){case"date-only":case"esriFieldTypeDateOnly":return c.fromReader(r._readAttribute(e,!1));case"time-only":case"esriFieldTypeTimeOnly":return m.fromReader(r._readAttribute(e,!1));case"esriFieldTypeTimestampOffset":case"timestamp-offset":return a.fromReaderAsTimeStampOffset(r._readAttribute(e,!1));case"date":case"esriFieldTypeDate":return this.autocastArcadeDate(e,r._readAttribute(e,!0));default:return this.readAttribute(e,!1)}throw new Error(`Field ${e} does not exist`)}setField(e,t){throw new Error("Unable to update feature attribute values, feature is readonly")}keys(){return this.fields.fields.map(e=>e.name)}castToText(e=!1){if(!e)return JSON.stringify(this.readLegacyFeature());let t=this.readLegacyFeature();if(!t)return JSON.stringify(null);let r={geometry:t.geometry,attributes:y({},t.attributes??{})};for(let s in r.attributes){let i=r.attributes[s];i instanceof Date&&(r.attributes[s]=i.getTime())}return JSON.stringify(r)}gdbVersion(){return null}fullSchema(){return this._layerSchema}castAsJson(e=null){return{attributes:this._readAttributes(),geometry:e?.keepGeometryType===!0?this.geometry():this.geometry()?.toJSON()??null}}castAsJsonAsync(e=null,t=null){return Promise.resolve(this.castAsJson(t))}removeIds(e){if(this._objectIdToIndex==null){let r=new Map,s=this.getCursor();for(;s.next();){let i=s.getObjectId();g(i),r.set(i,s.getIndex())}this._objectIdToIndex=r}let t=this._objectIdToIndex;for(let r of e)t.has(r)&&this.removeAtIndex(t.get(r))}removeAtIndex(e){this._deleted==null&&(this._deleted=l.create(this.getSize())),this._deleted.set(e)}readGeometryForDisplay(){return this.readUnquantizedGeometry(!0)}readLegacyGeometryForDisplay(){return this.readLegacyGeometry(!0)}*features(){let e=this.getCursor();for(;e.next();)yield e.readOptimizedFeature()}_getExists(){return this._deleted==null||!this._deleted.has(this.getIndex())}_computeCentroid(){if(this.geometryType!=="esriGeometryPolygon")return null;let e=this.readUnquantizedGeometry();if(!e||e.hasIndeterminateRingOrder)return null;let t=I.fromOptimized(e,this.geometryType);t.yFactor*=-1;let r=T(t);return r?(r[1]*=-1,new h([],r)):null}copyInto(e){e.seen=this.seen,e._storage=this._storage,e._arcadeSpatialReference=this._arcadeSpatialReference,e._joined=this._joined,e._tx=this._tx,e._ty=this._ty,e._sx=this._sx,e._sy=this._sy,e._deleted=this._deleted,e._objectIdToIndex=this._objectIdToIndex,e.contextTimeZone=this.contextTimeZone}};export{l as a,S as b};
