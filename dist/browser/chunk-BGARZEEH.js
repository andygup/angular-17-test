import{a as ze,b as w,d as ee}from"./chunk-B3I4XIHJ.js";import{a as Ae}from"./chunk-6EFGHIXX.js";import{a as Re}from"./chunk-DZ3DW7ED.js";import{b as Ue}from"./chunk-IFUI4HFB.js";import{a as $}from"./chunk-JOOJSGLF.js";import{A as pe,C as Ne,o as Ge,s as Te,v as Y,y as Me}from"./chunk-MYELF7MV.js";import{a as je,b as De}from"./chunk-KCKP7FIY.js";import{a as Ee}from"./chunk-7K4WIBFN.js";import{c as Oe}from"./chunk-AUVYUYNK.js";import{a as Ie,b as xe}from"./chunk-O5K35OSE.js";import{a as G}from"./chunk-D6LLE2YP.js";import{g as _,i as te}from"./chunk-VDN3XKL2.js";import{a as me}from"./chunk-6MGDEI2H.js";import{a as Fe}from"./chunk-WUM4JBII.js";import{a as K}from"./chunk-CBOFHDSC.js";import{c as se}from"./chunk-B4PK7RBX.js";import{a as F}from"./chunk-HBTOKQC5.js";import{a as b}from"./chunk-A52LT7YB.js";import{a as X}from"./chunk-2BBIRZVO.js";import{a as Q}from"./chunk-WQAXQD4X.js";import{h as f}from"./chunk-FNDPIYNC.js";import{H as o,K as qe}from"./chunk-WMYPRHRR.js";import{H as we,L as _e,M as Se,R as u,v as Ve,z as ge}from"./chunk-IAMDMFZ7.js";import{a as r}from"./chunk-53MWZ23O.js";import{b as g,g as L,p as W,r as Z}from"./chunk-465DRXTW.js";import{p as ve}from"./chunk-AC62Z3FX.js";import{a as B,b as ue,g as y}from"./chunk-ESDYQQXO.js";var ce=new Q({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0}),P=class extends f{constructor(e){super(e),this.authoringInfo=null,this.type=null}getRequiredFields(e){return y(this,null,function*(){if(!this.collectRequiredFields)return[];let t=new Set;return yield this.collectRequiredFields(t,e),Array.from(t).sort()})}getSymbol(e,t){}getSymbolAsync(e,t){return y(this,null,function*(){})}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};r([o({type:ze,json:{write:!0}})],P.prototype,"authoringInfo",void 0),r([o({type:ce.apiValues,readOnly:!0,json:{type:ce.jsonValues,read:!1,write:{writer:ce.write,ignoreOrigin:!0}}})],P.prototype,"type",void 0),P=r([u("esri.renderers.Renderer")],P);var $e=P;function Pe(e){return e.match(Xe)?.[1]?.replace(/\\'/g,"'")??null}var Xe=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var fe,O=fe=class extends w{constructor(e){super(e),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,s)=>t.value-s.value),this._set("stops",e)}clone(){return new fe({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};r([o({readOnly:!0})],O.prototype,"cache",null),r([o({type:["color"],json:{type:["colorInfo"]}})],O.prototype,"type",void 0),r([o({type:String,json:{write:!0}})],O.prototype,"normalizationField",void 0),r([o({type:[Ae],json:{write:!0}})],O.prototype,"stops",null),O=fe=r([u("esri.renderers.visualVariables.ColorVariable")],O);var ie=O;var de,S=de=class extends f{constructor(e){super(e),this.label=null,this.opacity=null,this.value=null}readOpacity(e,t){return De(t.transparency)}writeOpacity(e,t,s){t[s]=je(e)}clone(){return new de({label:this.label,opacity:this.opacity,value:this.value})}};r([o({type:String,json:{write:!0}})],S.prototype,"label",void 0),r([o({type:Number,json:{type:we,write:{target:"transparency"}}})],S.prototype,"opacity",void 0),r([F("opacity",["transparency"])],S.prototype,"readOpacity",null),r([b("opacity")],S.prototype,"writeOpacity",null),r([o({type:Number,json:{write:!0}})],S.prototype,"value",void 0),S=de=r([u("esri.renderers.visualVariables.support.OpacityStop")],S);var ke=S;var he,U=he=class extends w{constructor(e){super(e),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,s)=>t.value-s.value),this._set("stops",e)}clone(){return new he({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};r([o({readOnly:!0})],U.prototype,"cache",null),r([o({type:["opacity"],json:{type:["transparencyInfo"]}})],U.prototype,"type",void 0),r([o({type:String,json:{write:!0}})],U.prototype,"normalizationField",void 0),r([o({type:[ke],json:{write:!0}})],U.prototype,"stops",null),U=he=r([u("esri.renderers.visualVariables.OpacityVariable")],U);var re=U;var ye,v=ye=class extends w{constructor(e){super(e),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(e,t,s,i){if(i?.messages){let l=`visualVariables[${this.index}]`;i.messages.push(new Z("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:l+".valueExpressionTitle",context:i}))}}clone(){return new ye({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions?.clone()})}};r([o({readOnly:!0})],v.prototype,"cache",null),r([o({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],v.prototype,"axis",void 0),r([o({type:["rotation"],json:{type:["rotationInfo"]}})],v.prototype,"type",void 0),r([o({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],v.prototype,"rotationType",void 0),r([o({type:String,json:{write:!0}})],v.prototype,"valueExpressionTitle",void 0),r([b("web-scene","valueExpressionTitle")],v.prototype,"writeValueExpressionTitleWebScene",null),v=ye=r([u("esri.renderers.visualVariables.RotationVariable")],v);var oe=v;var Ye={color:ie,size:ee,opacity:re,rotation:oe},et=new Q({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),tt=/^\[([^\]]+)\]$/i,le=class extends qe{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),e=e&&e.filter(t=>!!t),e?.length){for(let t of e)switch(t.type){case"color":this.colorVariables.push(t);break;case"opacity":this.opacityVariables.push(t);break;case"rotation":this.rotationVariables.push(t);break;case"size":this.sizeVariables.push(t)}this.sizeVariables.length&&this.sizeVariables.some(t=>!!t.target)&&e.sort((t,s)=>{let i=null;return i=t.target===s.target?0:t.target?1:-1,i});for(let t=0;t<e.length;t++)e[t].index=t;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,t,s){let{rotationExpression:i,rotationType:l}=t,a=i?.match(tt),p=a?.[1];if(p&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:l,field:p})),e)return e.map(m=>{let c=et.read(m.type),d=Ye[c];d||(W.getLogger(this).warn(`Unknown variable type: ${c}`),s?.messages&&s.messages.push(new _e("visual-variable:unsupported",`visualVariable of type '${c}' is not supported`,{definition:m,context:s})));let h=new d;return h.read(m,s),h})}writeVariables(e,t){let s=[];for(let i of e){let l=i.toJSON(t);l&&s.push(l)}return s}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};r([o()],le.prototype,"visualVariables",null),le=r([u("esri.renderers.visualVariables.VisualVariableFactory")],le);var Je=le;var st={base:w,key:"type",typeMap:{opacity:re,color:ie,rotation:oe,size:ee}},Ce=e=>{let t=class extends e{constructor(){super(...arguments),this._vvFactory=new Je}set visualVariables(s){this._vvFactory.visualVariables=s,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(s,i,l){return this._vvFactory.readVariables(s,i,l)}writeVisualVariables(s,i,l,a){i[l]=this._vvFactory.writeVariables(s,a)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(let s of this.visualVariables)if(s.arcadeRequired)return!0;return!1}hasVisualVariables(s,i){return s?this.getVisualVariablesForType(s,i).length>0:this.getVisualVariablesForType("size",i).length>0||this.getVisualVariablesForType("color",i).length>0||this.getVisualVariablesForType("opacity",i).length>0||this.getVisualVariablesForType("rotation",i).length>0}getVisualVariablesForType(s,i){let l=this.visualVariables;return l?l.filter(a=>a.type===s&&(typeof i=="string"?a.target===i:i!==!1||!a.target)):[]}collectVVRequiredFields(s,i){return y(this,null,function*(){let l=[];this.visualVariables&&(l=l.concat(this.visualVariables));for(let a of l)a&&(a.field&&_(s,i,a.field),a.normalizationField&&_(s,i,a.normalizationField),a.valueExpression&&(it(a.valueExpression,s,i)||(yield te(s,i,a.valueExpression))))})}};return r([o({types:[st],value:null,json:{write:!0}})],t.prototype,"visualVariables",null),r([F("visualVariables",["visualVariables","rotationType","rotationExpression"])],t.prototype,"readVisualVariables",null),r([b("visualVariables")],t.prototype,"writeVisualVariables",null),t=r([u("esri.renderers.mixins.VisualVariablesMixin")],t),t};function it(e,t,s){let i=Pe(e);return i!=null&&(_(t,s,i),!0)}var k={types:Me,json:{write:{writer:$},origins:{"web-scene":{types:pe,write:{writer:$},read:{reader:Se({types:pe})}}}}},He=L({json:{origins:{"web-scene":{write:{isRequired:!0}}}}},k),Be={types:{base:Ee,key:"type",typeMap:{"simple-fill":Y.typeMap["simple-fill"],"picture-fill":Y.typeMap["picture-fill"],"polygon-3d":Y.typeMap["polygon-3d"]}},json:{write:{writer:$},origins:{"web-scene":{type:Ge,write:{writer:$}}}}},T={cast:e=>e==null||typeof e=="string"||typeof e=="number"?e:`${e}`,json:{type:String,write:{writer:(e,t)=>{t.value=e?.toString()}}}};var M=class extends G(f){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};r([o(T)],M.prototype,"value",void 0),r([o(T)],M.prototype,"value2",void 0),r([o(T)],M.prototype,"value3",void 0),M=r([u("esri.renderers.support.UniqueValue")],M);var q=M;var I=class extends G(f){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(e==null)return null;let t=typeof(e=Array.isArray(e)?e:[e])[0];return t==="string"||t==="number"?e.map(s=>new q({value:s})):t==="object"?e[0]instanceof q?e:e.map(s=>new q(s)):null}};r([o({type:String,json:{write:!0}})],I.prototype,"description",void 0),r([o({type:String,json:{write:!0}})],I.prototype,"label",void 0),r([o(k)],I.prototype,"symbol",void 0),r([o({type:[q],json:{type:[[String]],read:{reader:e=>e?e.map(t=>new q({value:t[0],value2:t[1],value3:t[2]})):null},write:{writer:(e,t)=>{let s=[];for(let i of e){let l=[i.value,i.value2,i.value3].filter(ve).map(a=>a.toString());s.push(l)}t.values=s}}}})],I.prototype,"values",void 0),r([X("values")],I.prototype,"castValues",null),I=r([u("esri.renderers.support.UniqueValueClass")],I);var ae=I;var J=class extends G(f){constructor(e){super(e),this.heading=null,this.classes=null}};r([o({type:String,json:{write:!0}})],J.prototype,"heading",void 0),r([o({type:[ae],json:{write:!0}})],J.prototype,"classes",void 0),J=r([u("esri.renderers.support.UniqueValueGroup")],J);var ne=J;var be,E=be=class extends f{constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new be({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){let e=JSON.stringify(this.symbol?.toJSON());return`${this.value}.${e}`}};r([o({type:String,json:{write:!0}})],E.prototype,"description",void 0),r([o({type:String,json:{write:!0}})],E.prototype,"label",void 0),r([o(He)],E.prototype,"symbol",void 0),r([o(T)],E.prototype,"value",void 0),E=be=r([u("esri.renderers.support.UniqueValueInfo")],E);var N=E;var C,Ze="esri.renderers.UniqueValueRenderer",x=W.getLogger(Ze),Le="uvInfos-watcher",We="uvGroups-watcher",rt=",",ot=ge(N);function lt(e){let{field1:t,field2:s,field3:i,fieldDelimiter:l,uniqueValueInfos:a,valueExpression:p}=e,m=!(!t||!s);return[{classes:(a??[]).map(c=>{let{symbol:d,label:h,value:j,description:D}=c,[z,R,A]=m?j?.toString()?.split(l||"")||[]:[j],V=[];return(t||p)&&V.push(z),s&&V.push(R),i&&V.push(A),{symbol:d,label:h,values:[V],description:D}})}]}var n=C=class extends Ce($e){constructor(e){super(e),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(t,s){if(!t&&!s)return;if(!t||!s)return{type:"complete",oldValue:t,newValue:s};let i=!1,l={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let a=0;a<s.length;a++){let p=t.find(m=>m.value===s[a].value);p?Oe(p,s[a])?(l.changed.push({type:"complete",oldValue:p,newValue:s[a]}),i=!0):l.unchanged.push({oldValue:p,newValue:s[a]}):(l.added.push(s[a]),i=!0)}for(let a=0;a<t.length;a++)s.find(p=>p.value===t[a].value)||(l.removed.push(t[a]),i=!0);return i?l:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(e){this._set("field",e),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(e){return e==null||typeof e=="function"?e:Ve(e)}writeField(e,t,s,i){typeof e=="string"?t[s]=e:i?.messages?i.messages.push(new Z("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):x.error(".field: cannot write field to JSON since it's not a string value")}set field2(e){this._set("field2",e),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(e){this._set("field3",e),this._updateUniqueValues()}set valueExpression(e){this._set("valueExpression",e),this._updateUniqueValues()}set defaultSymbol(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)}set fieldDelimiter(e){this._set("fieldDelimiter",e),this._updateUniqueValues()}readPortal(e,t,s){return s.portal||se.getDefault()}readStyleOrigin(e,t,s){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){let i=Ie(t.styleUrl,s);return Object.freeze({styleUrl:i})}}writeStyleOrigin(e,t,s,i){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=xe(e.styleUrl,i))}set uniqueValueGroups(e){this.styleOrigin?x.error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",e),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(e){this.styleOrigin?x.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(e,t){if(this.styleOrigin)return void x.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let s;s=typeof e=="object"?ot(e):new N({value:e,symbol:Ne(t)}),this.uniqueValueInfos?.push(s),this._valueInfoMap[s.value]=s,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(e){if(this.styleOrigin)return void x.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let t=this.uniqueValueInfos;if(t)for(let s=0;s<t.length;s++){let i=t[s];if(String(i.value)===String(e)){delete this._valueInfoMap[e],t.splice(s,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}getUniqueValueInfo(e,t){return y(this,null,function*(){let s=t;return this.valueExpression&&t?.arcade==null&&(s=ue(B({},s),{arcade:yield me()})),this._getUniqueValueInfo(e,s)})}getSymbol(e,t){return this.valueExpression&&t?.arcade==null?void x.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used"):this._getUniqueValueInfo(e,t)?.symbol||this.defaultSymbol}getSymbolAsync(e,t){return y(this,null,function*(){let s=t;if(this.valueExpression&&s?.arcade==null){let l=yield me(),{arcadeUtils:a}=l;a.hasGeometryOperations(this.valueExpression)&&(yield a.enableGeometryOperations()),s=ue(B({},s),{arcade:l})}return this._getUniqueValueInfo(e,s)?.symbol||this.defaultSymbol})}getSymbols(){let e=[];for(let t of this.uniqueValueInfos??[])t.symbol&&e.push(t.symbol);return this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){let e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),s=this.uniqueValueInfos?.reduce((i,l)=>i+l.getMeshHash(),"");return`${e}.${t}.${s}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){let e=new C({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:g(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:g(this.visualVariables),legendOptions:g(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:g(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);let t=g(this.uniqueValueInfos),s=g(this.uniqueValueGroups);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze(g(this.styleOrigin))),Object.freeze(t),Object.freeze(s)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e._set("uniqueValueGroups",s),e._isInfosSource=this._isInfosSource,e._watchUniqueValueInfosAndGroups(),e}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}collectRequiredFields(e,t){return y(this,null,function*(){let s=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];yield Promise.all(s)})}collectSymbolFields(e,t){return y(this,null,function*(){let s=[...this.getSymbols().map(i=>i.collectRequiredFields(e,t)),te(e,t,this.valueExpression)];_(e,t,this.field),_(e,t,this.field2),_(e,t,this.field3),yield Promise.all(s)})}populateFromStyle(){return Ue(this.styleOrigin,{portal:this.portal}).then(e=>{let t=[];return this._valueInfoMap={},e&&e.data&&Array.isArray(e.data.items)&&e.data.items.forEach(s=>{let i=new Te({styleUrl:e.styleUrl,styleName:e.styleName,portal:this.portal,name:s.name});this.defaultSymbol||s.name!==e.data.defaultItem||(this.defaultSymbol=i,this._isDefaultSymbolDerived=!0);let l=new N({value:s.name,symbol:i});t.push(l),this._valueInfoMap[s.name]=l}),this._set("uniqueValueInfos",Object.freeze(t)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&this.uniqueValueInfos?.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",rt)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};let{uniqueValueInfos:e}=this;if(e)for(let t of e)this._valueInfoMap[t.value+""]=t}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(Le);let{uniqueValueInfos:e}=this;if(e){let t=[];for(let s of e)t.push(K(()=>({symbol:s.symbol,value:s.value,label:s.label,description:s.description}),(i,l)=>{i!==l&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(t,Le)}}_watchUniqueValueGroups(){this.removeHandles(We);let{uniqueValueGroups:e}=this;if(e){let t=[];for(let s of e){t.push(K(()=>({classes:s.classes}),(i,l)=>{i!==l&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(let i of s.classes??[])t.push(K(()=>({symbol:i.symbol,values:i.values,label:i.label,description:i.description}),(l,a)=>{l!==a&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(t,We)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();let e=[],{field:t,field2:s,field3:i,fieldDelimiter:l,uniqueValueGroups:a,valueExpression:p}=this;if(!t&&!p)return this._set("uniqueValueInfos",e),this._updateValueInfoMap(),void this._watchUniqueValueInfos();let m=!(!t||!s);for(let c of a)for(let d of c.classes??[]){let{symbol:h,label:j,values:D,description:z}=d;for(let R of D??[]){let{value:A,value2:V,value3:Ke}=R,H=[A];s&&H.push(V),i&&H.push(Ke);let Qe=m?H.join(l||""):H[0];e.push(new N({symbol:h,label:j,value:Qe,description:z}))}}this._set("uniqueValueInfos",e),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(e=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();let{field:t,field2:s,valueExpression:i,fieldDelimiter:l,uniqueValueInfos:a}=this;if(!t&&!i||!a.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();let p=!(!t||!s),m=a.map(d=>{let{symbol:h,label:j,value:D,description:z}=d,[R,A,V]=p?D?.toString()?.split(l||"")||[]:[D];return new ae({symbol:h,label:j,description:z,values:[new q({value:R,value2:A,value3:V})]})}),c=[new ne({classes:m})];e&&Object.freeze(c),this._set("uniqueValueGroups",c),this._watchUniqueValueGroups()}_getUniqueValueInfo(e,t){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,t):this._getUnqiueValueInfoForFields(e)}_getUnqiueValueInfoForExpression(e,t){let{viewingMode:s,scale:i,spatialReference:l,arcade:a,timeZone:p}=t??{},m=this._cache.compiledFunc,c=a.arcadeUtils;if(!m){let h=c.createSyntaxTree(this.valueExpression);m=c.createFunction(h),this._cache.compiledFunc=m}let d=c.executeFunction(m,c.createExecContext(e,c.getViewInfo({viewingMode:s,scale:i,spatialReference:l}),p));return this._valueInfoMap[d+""]}_getUnqiueValueInfoForFields(e){let t=this.field,s=e.attributes,i;if(typeof t!="function"&&this.field2){let l=this.field2,a=this.field3,p=[];t&&p.push(s[t]),l&&p.push(s[l]),a&&p.push(s[a]),i=p.join(this.fieldDelimiter||"")}else typeof t=="function"?i=t(e):t&&(i=s[t]);return this._valueInfoMap[i+""]}static fromPortalStyle(e,t){let s=new C(t?.properties);s._set("styleOrigin",Object.freeze({styleName:e})),s._set("portal",t?.portal||se.getDefault());let i=s.populateFromStyle();return i.catch(l=>{x.error(`#fromPortalStyle('${e}'[, ...])`,"Failed to create unique value renderer from style name",l)}),i}static fromStyleUrl(e,t){let s=new C(t?.properties);s._set("styleOrigin",Object.freeze({styleUrl:e}));let i=s.populateFromStyle();return i.catch(l=>{x.error(`#fromStyleUrl('${e}'[, ...])`,"Failed to create unique value renderer from style URL",l)}),i}};r([o({readOnly:!0})],n.prototype,"_cache",null),r([Fe({uniqueValue:"unique-value"})],n.prototype,"type",void 0),r([o(Be)],n.prototype,"backgroundFillSymbol",void 0),r([o({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],n.prototype,"field",null),r([X("field")],n.prototype,"castField",null),r([b("field")],n.prototype,"writeField",null),r([o({type:String,value:null,json:{write:!0}})],n.prototype,"field2",null),r([o({type:String,value:null,json:{write:!0}})],n.prototype,"field3",null),r([o({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],n.prototype,"orderByClassesEnabled",void 0),r([o({type:String,value:null,json:{write:!0}})],n.prototype,"valueExpression",null),r([o({type:String,json:{write:!0}})],n.prototype,"valueExpressionTitle",void 0),r([o({type:Re,json:{write:!0}})],n.prototype,"legendOptions",void 0),r([o({type:String,json:{write:!0}})],n.prototype,"defaultLabel",void 0),r([o(L(B({},k),{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],n.prototype,"defaultSymbol",null),r([o({type:String,value:null,json:{write:!0}})],n.prototype,"fieldDelimiter",null),r([o({type:se,readOnly:!0})],n.prototype,"portal",void 0),r([F("portal",["styleName"])],n.prototype,"readPortal",null),r([o({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],n.prototype,"styleOrigin",void 0),r([F("styleOrigin",["styleName","styleUrl"])],n.prototype,"readStyleOrigin",null),r([b("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],n.prototype,"writeStyleOrigin",null),r([o({type:[ne],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(e,t,s)=>(t.uniqueValueGroups||lt(t)).map(i=>ne.fromJSON(i,s))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],n.prototype,"uniqueValueGroups",null),r([o({type:[N],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],n.prototype,"uniqueValueInfos",null),n=C=r([u(Ze)],n);var yr=n;export{$e as a,oe as b,Ce as c,k as d,He as e,Be as f,N as g,yr as h};
