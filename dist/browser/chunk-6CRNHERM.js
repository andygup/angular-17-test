import{a as l}from"./chunk-6GLCEHEN.js";import{a as n}from"./chunk-XDTDVCGP.js";import{a as o}from"./chunk-AC62Z3FX.js";var h=o("esri-2d-log-allocations"),_=class s{constructor(t,e){this._array=t,this._pool=e}get array(){return this._array}get length(){return this._array.length}static create(t,e){let a=e.acquire(t);return new s(a,e)}expand(t){let e=this._pool.acquire(t);e.set(this._array),this._pool.release(this._array),this._array=e}destroy(){this._pool.release(this._array)}set(t,e){this._array.set(t._array,e)}slice(){let t=this._pool.acquire(this._array.byteLength);return t.set(this._array),new s(t,this._pool)}},r=class s{constructor(){this._data=new ArrayBuffer(s.BYTE_LENGTH),this._freeList=new l({start:0,end:this._data.byteLength})}static get BYTE_LENGTH(){return 64e6}get buffer(){return this._data}allocate(t){let e=this._freeList.firstFit(t);return e==null?null:new Uint32Array(this._data,e,t/Uint32Array.BYTES_PER_ELEMENT)}free(t){this._freeList.free(t.byteOffset,t.byteLength)}},c=class{constructor(){this._bytesAllocated=0,this._pages=[],this._pagesByBuffer=new Map,this._addPage()}destroy(){this._pages=[],this._pagesByBuffer=null}get _bytesTotal(){return this._pages.length*r.BYTE_LENGTH}acquire(t){if(this._bytesAllocated+=t,h&&console.log(`Allocating ${t}, (${this._bytesAllocated} / ${this._bytesTotal})`),t>r.BYTE_LENGTH)return new Uint32Array(t/Uint32Array.BYTES_PER_ELEMENT);for(let a of this._pages){let i=a.allocate(t);if(i!=null)return i}let e=this._addPage().allocate(t);return n(e,"Expected to allocate page"),e}release(t){this._bytesAllocated-=t.byteLength,h&&console.log(`Freeing ${t.byteLength}, (${this._bytesAllocated} / ${this._bytesTotal})`);let e=this._pagesByBuffer.get(t.buffer);e&&e.free(t)}_addPage(){let t=new r;return this._pages.push(t),this._pagesByBuffer.set(t.buffer,t),t}};export{_ as a,c as b};
