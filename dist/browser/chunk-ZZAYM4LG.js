import{a as De}from"./chunk-AC55GQHL.js";import"./chunk-RXCBC6AD.js";import"./chunk-Q7TY7XC3.js";import"./chunk-XZCX6BPD.js";import{i as Te,j as Nt,k as Ir,l as Ar,n as Cr}from"./chunk-MYYAF3XU.js";import"./chunk-DWAHQUVA.js";import{a as wr}from"./chunk-V3FR6PF5.js";import{a as St}from"./chunk-4573E3RZ.js";import"./chunk-EOQW4XXT.js";import"./chunk-QB2WNRL5.js";import"./chunk-VGW7YJZ7.js";import"./chunk-BSQ5TFLX.js";import{a as ai}from"./chunk-YW3L7OMP.js";import"./chunk-DDZ3KR2Q.js";import"./chunk-JHWJLQOC.js";import"./chunk-DTWRSK4M.js";import"./chunk-M3GEY4SR.js";import"./chunk-7QY3BMVN.js";import"./chunk-4HXOVZYF.js";import"./chunk-U2QVIRVP.js";import{a as Tt,b as Qe}from"./chunk-OVKL2WYY.js";import{a as F,b as Ge,c as V,d as xr}from"./chunk-DAWZQX4A.js";import"./chunk-ZIQX3XYG.js";import{a as _r}from"./chunk-QCHQODPK.js";import"./chunk-KYW34JK7.js";import"./chunk-4R7MTAA6.js";import"./chunk-YH5YGPKQ.js";import"./chunk-OJTJKYFK.js";import"./chunk-WSUW6W66.js";import"./chunk-WF5LZUVW.js";import"./chunk-E4G7B7K5.js";import"./chunk-RZU6EEB3.js";import"./chunk-WHNNLNN4.js";import"./chunk-2YMAK36I.js";import"./chunk-ZVPHD6FG.js";import"./chunk-BHUF7DXK.js";import"./chunk-VYBYHQTJ.js";import"./chunk-YKLD6O7Z.js";import"./chunk-2SRHEZDP.js";import"./chunk-4YLYZGNM.js";import"./chunk-PHG7WLHF.js";import"./chunk-3AY2ZIM4.js";import"./chunk-XFFNQH2H.js";import"./chunk-VL6L3PH6.js";import{a as br}from"./chunk-EGQHBYFL.js";import"./chunk-MXNDRZNB.js";import"./chunk-XWKYTQFT.js";import"./chunk-RAIGRXV3.js";import"./chunk-UULYHJV4.js";import"./chunk-WDTJILD4.js";import"./chunk-6J7DCVWC.js";import"./chunk-CIQJCIGH.js";import"./chunk-RI77TKRA.js";import"./chunk-UW2TVJUN.js";import"./chunk-LGUXUFJ7.js";import"./chunk-Z7MKEISX.js";import"./chunk-5L5TH44W.js";import"./chunk-URPONBMS.js";import"./chunk-QB3NROF7.js";import{a as pi}from"./chunk-5WCYRI4X.js";import"./chunk-DR5NPQZL.js";import"./chunk-5P24QCNC.js";import"./chunk-6UF7N5AK.js";import"./chunk-6UQ2Y4IC.js";import"./chunk-KZREEH45.js";import{a as ci}from"./chunk-N3XRI3RU.js";import"./chunk-BGARZEEH.js";import"./chunk-B3I4XIHJ.js";import"./chunk-6EFGHIXX.js";import"./chunk-DZ3DW7ED.js";import"./chunk-3XRT3SNQ.js";import"./chunk-YEFTRNE3.js";import"./chunk-5OGCWDP4.js";import"./chunk-JBJTQF7V.js";import{a as st}from"./chunk-5JBKPHFU.js";import"./chunk-6JYX4V7N.js";import{a as ae}from"./chunk-CN5O6E6T.js";import{b as hr,d as kt,e as mr,f as fr,g as gr,i as Rt,j as yr,k as vr,l as $e,m as di}from"./chunk-4KJ462UD.js";import{a as Et}from"./chunk-HSB35X5B.js";import"./chunk-7BGNDY2B.js";import"./chunk-FBHJEXCM.js";import"./chunk-IFUI4HFB.js";import"./chunk-JOOJSGLF.js";import{p as pr}from"./chunk-MYELF7MV.js";import"./chunk-MS3ZOARX.js";import"./chunk-KCKP7FIY.js";import"./chunk-BQABCLW6.js";import"./chunk-HTB4QCFJ.js";import"./chunk-7K4WIBFN.js";import"./chunk-45GFWXQC.js";import"./chunk-AUVYUYNK.js";import"./chunk-PUCLHWWW.js";import"./chunk-DMYB246F.js";import"./chunk-C7M5MSEL.js";import{a as li}from"./chunk-HPJ6EQFO.js";import"./chunk-5MJXKSZ4.js";import{b as ur,c as Lt}from"./chunk-TJ3KO5EG.js";import"./chunk-FC6HKZZX.js";import"./chunk-LGGJOMLJ.js";import"./chunk-VVAIF23J.js";import"./chunk-6N5DPLFH.js";import"./chunk-HI2T2YSZ.js";import"./chunk-O5K35OSE.js";import{a as cr}from"./chunk-D6LLE2YP.js";import"./chunk-I3S324BU.js";import"./chunk-O5IGEGOS.js";import"./chunk-2UDQ3IWX.js";import"./chunk-MXH75ZNY.js";import"./chunk-PQKTT6AH.js";import"./chunk-OM24DGCK.js";import"./chunk-YQRTHGFD.js";import"./chunk-EDSVJRYE.js";import"./chunk-QAVDKCSH.js";import"./chunk-H2AOS66Z.js";import"./chunk-YH4Z47PR.js";import"./chunk-CJJRHJ2S.js";import"./chunk-HZP7XBNB.js";import"./chunk-YUZT5LSA.js";import"./chunk-725QQXBM.js";import"./chunk-ZYPPRX53.js";import"./chunk-574KRDZU.js";import"./chunk-2APWMENK.js";import"./chunk-ZWFVPWKA.js";import"./chunk-JOYABHZZ.js";import{f as dr}from"./chunk-IEXZWAIE.js";import{G as Mr,H as ui,u as Fr,z as Pt}from"./chunk-VDN3XKL2.js";import"./chunk-SVEGZVCP.js";import"./chunk-AQ74ANSJ.js";import"./chunk-SAOUSUZE.js";import{a as Ot}from"./chunk-6MGDEI2H.js";import"./chunk-QSGARGRB.js";import"./chunk-SREKDU6P.js";import"./chunk-IXIJFOEL.js";import"./chunk-QZ4L25WE.js";import"./chunk-4ATIL3QV.js";import"./chunk-WUM4JBII.js";import"./chunk-URUYU25U.js";import"./chunk-3S2DT2SI.js";import"./chunk-7PPV2CP7.js";import"./chunk-U62SHMHB.js";import"./chunk-55ESOXMJ.js";import"./chunk-BCREO4Q5.js";import{b as lr}from"./chunk-EJ3VIBAJ.js";import"./chunk-4LHUJTP5.js";import"./chunk-NBRBW7H5.js";import{e as ne,f as Q,g as N,h as B,j as At,k as rr,m as Ct,n as or}from"./chunk-GNHGUIJP.js";import{f as se,g as si,h as ni,q as c,r as ir}from"./chunk-OOYAVZJN.js";import"./chunk-225WJVLD.js";import"./chunk-T62VBPHF.js";import"./chunk-RIZAJ3RX.js";import"./chunk-V2KSICSA.js";import{a as g,b as Ve,c as re,d as Ki,f as Ji,g as P}from"./chunk-CBOFHDSC.js";import"./chunk-HB7BVTLV.js";import{a as ot,b as ue,c as X}from"./chunk-WZKL6OPG.js";import"./chunk-WF37UVOV.js";import{a as rt,f as er,h as Mt,i as It}from"./chunk-UZQ577CU.js";import{b as ye}from"./chunk-FC3MPJI4.js";import{a as Xi}from"./chunk-5ETRXDS4.js";import{a as Yi}from"./chunk-QDNKD3H5.js";import"./chunk-F72O5PVM.js";import"./chunk-B4PK7RBX.js";import"./chunk-6J4Y65BV.js";import"./chunk-RXHILZH7.js";import"./chunk-KBFIYTBH.js";import"./chunk-PEPXQ7N3.js";import"./chunk-VU5W7W6Y.js";import"./chunk-6QIKBCPR.js";import{g as nr,i as ar}from"./chunk-AHKJJNRE.js";import"./chunk-HBTOKQC5.js";import"./chunk-A52LT7YB.js";import{L as xt}from"./chunk-CZPMRK53.js";import"./chunk-IDSF2RZ6.js";import{a as oe}from"./chunk-2BBIRZVO.js";import"./chunk-WQAXQD4X.js";import{a as tr}from"./chunk-IUPUERVS.js";import{$ as sr}from"./chunk-XF4NUYV7.js";import"./chunk-FNDPIYNC.js";import{H as a,K as j,b as oi}from"./chunk-WMYPRHRR.js";import{R as w,m as Ee,u as Zi}from"./chunk-IAMDMFZ7.js";import{a as n}from"./chunk-53MWZ23O.js";import{g as bt,l as ji,o as Qi,p as Gi,q as wt,r as ge,v as _t,y as Ft}from"./chunk-PT7S6WNL.js";import{b as Ui}from"./chunk-XDTDVCGP.js";import"./chunk-JPDAKIWT.js";import{k as fe,o as ri,p as D,r as L}from"./chunk-465DRXTW.js";import{d as it,p as me}from"./chunk-AC62Z3FX.js";import{a as v,b as he,g as f}from"./chunk-ESDYQQXO.js";function Uo(e,t){return{type:xt(t),value:e,unit:t}}function jo(e,t){return{type:xt(t),value:e,unit:t}}function Er(e,t,i="arithmetic"){return{type:xt(t),value:e,unit:t,rotationType:i}}var mn=Uo(0,"meters"),fn=jo(0,"square-meters"),gn=Er(0,"radians"),yn=Er(0,"degrees");var Tr=["B","kB","MB","GB","TB"];function Lr(e,t){let i=(t=Math.round(t))===0?0:Math.floor(Math.log(t)/Math.log(ai.KILOBYTES));i=lr(i,0,Tr.length-1);let r=ue(t/ai.KILOBYTES**i,{maximumFractionDigits:2});return fe(e.units.bytes[Tr[i]],{fileSize:r})}var Qo="esri.widgets.Feature.support.featureUtils",kr=D.getLogger(Qo),Go=/href=(""|'')/gi,Zo=/(\{([^\{\r\n]+)\})/g,Xo=/\'/g,Nr=/^\s*expression\//i,Yo=/(\n)/gi,Ko=/[\u00A0-\u9999<>\&]/gim,Jo=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,es=/^(?:mailto:|tel:)/,Vr="relationships/",Rr=Mt("short-date-short-time");function Vt(e){if(e!=null)return(e.sourceLayer||e.layer)??void 0}function Ze(e,t){return f(this,null,function*(){return typeof e=="function"?e(t):e})}function $t(e=""){if(e)return!es.test(e.trim().toLowerCase())}function nt(e){return!!e&&Nr.test(e)}function ts(e,t){if(!nt(t)||!e)return null;let i=t.replace(Nr,"").toLowerCase(),r=null;return e.some(o=>o.name.toLowerCase()===i&&(r=o,!0)),r}function Dt(e,t){let i=ts(t,e?.fieldName);return i?i.title||null:e?e.label||e.fieldName:null}function is(e,t){return`{${t.get(e.toLowerCase())?.fieldName||e}}`}function rs(e){return e.replaceAll(Go,"")}function Be(e,t){let i=mi(t,e);return i?i.name:e}function $r(e,t){return e&&e.map(i=>Be(i,t))}function mi(e,t){return e&&typeof e.getField=="function"&&t?e.getField(t)??null:null}function Dr(e){return`${e}`.trim()}function _e({attributes:e,globalAttributes:t,layer:i,text:r,expressionAttributes:o,fieldInfoMap:s}){return r?Bt({formattedAttributes:t,template:as(r,v(v(v({},t),o),e),i),fieldInfoMap:s}):""}function Bt({formattedAttributes:e,template:t,fieldInfoMap:i}){return Dr(rs(fe(fe(t,r=>is(r,i)),e)))}function os(e,t,i=!1){let r=t[e];if(typeof r=="string"){let o="%27",s=(i?encodeURIComponent(r):r).replaceAll(Xo,o);t[e]=s}}function ss(e,t=!1){let i=v({},e);return Object.keys(i).forEach(r=>os(r,i,t)),i}function ns(e,t,i){let r=(t=Dr(t))&&t[0]!=="{";return fe(e,ss(i,r||!1))}function qt(e,t){return e.replaceAll(Zo,(i,r,o)=>{let s=mi(t,o);return s?`{${s.name}}`:r})}function as(e,t,i){let r=qt(e,i);return r&&r.replaceAll(Jo,(o,s,l)=>ns(o,s||l,t))}function ls(e,t){if(typeof e=="string"&&t&&t.dateFormat==null&&(t.places!=null||t.digitSeparator!=null)){let i=Number(e);if(!isNaN(i))return i}return e}function ds(e){return e!=null&&typeof e=="object"&&"fieldsIndex"in e&&"geometryType"in e&&"getField"in e&&"load"in e&&"loaded"in e&&"objectIdField"in e&&"spatialReference"in e&&"type"in e&&(e.type==="feature"||e.type==="scene")&&"when"in e}function cs(e){return e!=null&&typeof e=="object"&&"createQuery"in e&&"queryFeatureCount"in e&&"queryObjectIds"in e&&"queryRelatedFeatures"in e&&"queryRelatedFeaturesCount"in e&&"relationships"in e}function fi(e){return ds(e)&&cs(e)}function us(e,t){let{fieldInfos:i,fieldName:r,preventPlacesFormatting:o,layer:s,timeZone:l}=t,d=gi(i,r),u=mi(s,r);if(d&&!ui(r)){let h=u?.type,m=d.format?.dateFormat;if(h==="date"||h==="date-only"||h==="time-only"||h==="timestamp-offset"||m)return Qe(e,{format:m,fieldType:h,timeZoneOptions:{layerTimeZone:s&&"preferredTimeZone"in s?s.preferredTimeZone:null,viewTimeZone:l,datesInUnknownTimezone:!(!s||!("datesInUnknownTimezone"in s))&&!!s.datesInUnknownTimezone}})}let p=d?.format;return typeof e=="string"&&ui(r)&&p?ps(e,p):typeof(e=ls(e,p))=="string"||e==null||p==null?Xe(e):ue(e,o?he(v({},ot(p)),{minimumFractionDigits:0,maximumFractionDigits:20}):ot(p))}function ps(e,t){return e=e.trim(),/\d{2}-\d{2}/.test(e)?e:e.includes(",")?hi(e,",",", ",t):e.includes(";")?hi(e,";","; ",t):e.includes(" ")?hi(e," "," ",t):ue(Number(e),ot(t))}function hi(e,t,i,r){return e.trim().split(t).map(o=>ue(Number(o),ot(r))).join(i)}function gi(e,t){if(e?.length&&t)return e.find(i=>i.fieldName?.toLowerCase()===t.toLowerCase())}function hs({fieldName:e,graphic:t,layer:i}){if(le(e)||!i||typeof i.getFeatureType!="function")return null;let{typeIdField:r}=i;if(!r||e!==r)return null;let o=i.getFeatureType(t);return o?o.name:null}function ms({fieldName:e,value:t,graphic:i,layer:r}){if(le(e)||!r||typeof r.getFieldDomain!="function")return null;let o=i&&r.getFieldDomain(e,{feature:i});return o&&o.type==="coded-value"?o.getName(t):null}function Br(e,t,i,r){let{creatorField:o,creationDateField:s,editorField:l,editDateField:d}=e;if(!t)return;let u=er(r&&"preferredTimeZone"in r?r.preferredTimeZone:null,!(!r||!("datesInUnknownTimezone"in r))&&!!r.datesInUnknownTimezone,i,Rr,"date"),p=v(v({},Rr),u),h=t[d];if(typeof h=="number"){let y=t[l];return{type:"edit",date:It(h,p),user:y}}let m=t[s];if(typeof m=="number"){let y=t[o];return{type:"create",date:It(m,p),user:y}}return null}function qr(e,t){let i=new Map;return e&&e.forEach(r=>{let o=Be(r.fieldName,t);r.fieldName=o,i.set(o.toLowerCase(),r)}),i}function yi(e){let t=[];if(!e)return t;let{fieldInfos:i,content:r}=e;return i&&t.push(...i),r&&Array.isArray(r)&&r.forEach(o=>{if(o.type==="fields"){let s=o?.fieldInfos;s&&t.push(...s)}}),t}function Ht(e){return e.replaceAll(Ko,t=>`&#${t.charCodeAt(0)};`)}function Xe(e){return typeof e=="string"?e.replaceAll(Yo,'<br class="esri-text-new-line" />'):e}function Hr(e){let{value:t,fieldName:i,fieldInfos:r,fieldInfoMap:o,layer:s,graphic:l,timeZone:d}=e;if(t==null)return"";let u=ms({fieldName:i,value:t,graphic:l,layer:s});if(u)return u;let p=hs({fieldName:i,graphic:l,layer:s});if(p)return p;if(o.get(i.toLowerCase()))return us(t,{fieldInfos:r||Array.from(o.values()),fieldName:i,layer:s,timeZone:d});let h=s?.fieldsIndex?.get(i);return h&&(Tt(h)||Pt(h))?Qe(t,{fieldType:h.type,timeZoneOptions:{layerTimeZone:s&&"preferredTimeZone"in s?s.preferredTimeZone:null,viewTimeZone:d,datesInUnknownTimezone:!(!s||!("datesInUnknownTimezone"in s))&&!!s.datesInUnknownTimezone}}):Xe(t)}function zt({fieldInfos:e,attributes:t,layer:i,graphic:r,fieldInfoMap:o,relatedInfos:s,timeZone:l}){let d={};return s?.forEach(u=>ys({attributes:d,relatedInfo:u,fieldInfoMap:o,fieldInfos:e,layer:i,timeZone:l})),t&&Object.keys(t).forEach(u=>{let p=t[u];d[u]=Hr({fieldName:u,fieldInfos:e,fieldInfoMap:o,layer:i,value:p,graphic:r,timeZone:l})}),d}function vi(e,t){return f(this,null,function*(){let{layer:i,graphic:r,outFields:o,objectIds:s,returnGeometry:l,spatialReference:d}=e,u=s[0];if(typeof u!="number"&&typeof u!="string"){let h="Could not query required fields for the specified feature. The feature's ID is invalid.",m={layer:i,graphic:r,objectId:u,requiredFields:o};return kr.warn(h,m),null}if(!dr(i)?.operations?.supportsQuery){let h="The specified layer cannot be queried. The following fields will not be available.",m={layer:i,graphic:r,requiredFields:o,returnGeometry:l};return kr.warn(h,m),null}let p=i.createQuery();return p.objectIds=s,p.outFields=o?.length?o:[i.objectIdField],p.returnGeometry=!!l,p.returnZ=!!l,p.returnM=!!l,p.outSpatialReference=d,(yield i.queryFeatures(p,t)).features[0]})}function fs(e){return f(this,null,function*(){if(!e.expressionInfos?.length)return!1;let t=yield Ot(),{arcadeUtils:{hasGeometryFunctions:i}}=t;return i(e)})}function zr(s,l){return f(this,arguments,function*({graphic:e,popupTemplate:t,layer:i,spatialReference:r},o){if(!i||!t||(typeof i.load=="function"&&(yield i.load(o)),!e.attributes))return;let d=e.attributes[i.objectIdField];if(d==null)return;let u=[d],p=yield t.getRequiredFields(i.fieldsIndex),h=Mr(p,e),m=h?[]:p,y=t.returnGeometry||(yield fs(t));if(h&&!y)return;let b=yield vi({layer:i,graphic:e,outFields:m,objectIds:u,returnGeometry:y,spatialReference:r},o);b&&(b.geometry&&(e.geometry=b.geometry),b.attributes&&(e.attributes=v(v({},e.attributes),b.attributes)))})}function le(e=""){return!!e&&e.includes(Vr)}function gs(e){return e?`${Vr}${e.layerId}/${e.fieldName}`:""}function Sr({attributes:e,graphic:t,relatedInfo:i,fieldInfos:r,fieldInfoMap:o,layer:s,timeZone:l}){e&&t&&i&&Object.keys(t.attributes).forEach(d=>{let u=gs({layerId:i.relation.id.toString(),fieldName:d}),p=t.attributes[d];e[u]=Hr({fieldName:u,fieldInfos:r,fieldInfoMap:o,layer:s,value:p,graphic:t,timeZone:l})})}function ys({attributes:e,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:o,timeZone:s}){e&&t&&(t.relatedFeatures?.forEach(l=>Sr({attributes:e,graphic:l,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:o,timeZone:s})),t.relatedStatsFeatures?.forEach(l=>Sr({attributes:e,graphic:l,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:o,timeZone:s})))}var Or=e=>{if(!e)return!1;let t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},Wr=({layer:e,method:t,query:i,definitionExpression:r})=>{if(!e.capabilities?.query?.supportsCacheHint||t==="attachments")return;let o=i.where!=null?i.where:null,s=i.geometry!=null?i.geometry:null;Or(r)||Or(o)||s?.type==="extent"||i.resultType==="tile"||(i.cacheHint=!0)},Ur=({query:e,layer:t,method:i})=>{Wr({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})},jr=({queryPayload:e,layer:t,method:i})=>{Wr({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})};function Qr(e,t,i){return e&&t&&i?Pr(e.allLayers,t,i)||Pr(e.allTables,t,i):null}function Pr(e,t,i){let r=t.type==="scene"&&t.associatedLayer?t.associatedLayer.url:t.url;return e.filter(fi).find(o=>o!==t&&o.url===r&&o.layerId===i.relatedTableId)}var Gr={editing:!1,operations:{add:!0,update:!0,delete:!0}},Zr=ye.ofType(wr),ee=class extends j{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.capabilities=v({},Gr),this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new Zr,this.fileInfos=new ye,this.graphic=null,this.mode="view",this.filesEnabled=!1,this.addHandles(g(()=>this.graphic,()=>this._graphicChanged(),P))}destroy(){this._attachmentLayer=null,this.graphic=null}castCapabilities(e){return v(v({},Gr),e)}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){let{graphic:e}=this;if(!e)return!1;let t=e.layer||e.sourceLayer;return t?.loaded&&"capabilities"in t&&t.capabilities&&"operations"in t.capabilities&&"supportsResizeAttachments"in t.capabilities.operations&&t.capabilities.operations.supportsResizeAttachments||!1}getAttachments(){return f(this,null,function*(){let{_attachmentLayer:e,attachmentInfos:t}=this;if(!e||typeof e.queryAttachments!="function")throw new L("invalid-layer","getAttachments(): A valid layer is required.");let i=this._getObjectId(),r=new ci({objectIds:[i],returnMetadata:!0}),o=[],s=e.queryAttachments(r).then(d=>d[i]||o).catch(()=>o);this._getAttachmentsPromise=s,this.notifyChange("state");let l=yield s;return t.removeAll(),l.length&&t.addMany(l),this._getAttachmentsPromise=null,this.notifyChange("state"),l})}addAttachment(i){return f(this,arguments,function*(e,t=this.graphic){let{_attachmentLayer:r,attachmentInfos:o,capabilities:s}=this;if(!t)throw new L("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:t});if(!e)throw new L("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!s.operations?.add)throw new L("invalid-capabilities","addAttachment(): add capabilities are required.");if(!r||typeof r.addAttachment!="function")throw new L("invalid-layer","addAttachment(): A valid layer is required.");let l=r.addAttachment(t,e).then(u=>this._queryAttachment(u.objectId,t)),d=yield l;return o.add(d),d})}deleteAttachment(e){return f(this,null,function*(){let{_attachmentLayer:t,attachmentInfos:i,graphic:r,capabilities:o}=this;if(!e)throw new L("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!o.operations?.delete)throw new L("invalid-capabilities","deleteAttachment(): delete capabilities are required.");if(!t||typeof t.deleteAttachments!="function")throw new L("invalid-layer","deleteAttachment(): A valid layer is required.");if(!r)throw new L("invalid-graphic","deleteAttachment(): A graphic is required.");let s=t.deleteAttachments(r,[e.id]).then(()=>e),l=yield s;return i.remove(l),l})}updateAttachment(i){return f(this,arguments,function*(e,t=this.activeAttachmentInfo){let{_attachmentLayer:r,attachmentInfos:o,graphic:s,capabilities:l}=this;if(!e)throw new L("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new L("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!l.operations?.update)throw new L("invalid-capabilities","updateAttachment(): Update capabilities are required.");let d=o.indexOf(t);if(!r||typeof r.updateAttachment!="function")throw new L("invalid-layer","updateAttachment(): A valid layer is required.");if(!s)throw new L("invalid-graphic","updateAttachment(): A graphic is required.");let u=r.updateAttachment(s,t.id,e).then(h=>this._queryAttachment(h.objectId)),p=yield u;return o.splice(d,1,p),p})}commitFiles(){return f(this,null,function*(){return yield Promise.all(this.fileInfos.items.map(e=>this.addAttachment(e.form))),this.fileInfos.removeAll(),this.getAttachments()})}addFile(e,t){if(!e||!t)return null;let i={file:e,form:t};return this.fileInfos.add(i),i}updateFile(e,t,i=this.activeFileInfo){if(!e||!t||!i)return null;let r=this.fileInfos.indexOf(i);return r>-1&&this.fileInfos.splice(r,1,{file:e,form:t}),this.fileInfos.items[r]}deleteFile(e){let t=this.fileInfos.find(i=>i.file===e);return t?(this.fileInfos.remove(t),t):null}_queryAttachment(e,t){return f(this,null,function*(){let{_attachmentLayer:i}=this;if(!e||!i?.queryAttachments)throw new L("invalid-attachment-id","Could not query attachment.");let r=this._getObjectId(t),o=new ci({objectIds:[r],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return i.queryAttachments(o).then(s=>s[r][0])})}_getObjectId(e=this.graphic){return e?.getObjectId()??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){let{graphic:e}=this,t=Vt(e);this._attachmentLayer=t?t.type==="scene"&&t.associatedLayer!=null?t.associatedLayer:t:null}};n([a()],ee.prototype,"capabilities",void 0),n([oe("capabilities")],ee.prototype,"castCapabilities",null),n([a()],ee.prototype,"activeAttachmentInfo",void 0),n([a()],ee.prototype,"activeFileInfo",void 0),n([a({readOnly:!0,type:Zr})],ee.prototype,"attachmentInfos",void 0),n([a()],ee.prototype,"fileInfos",void 0),n([a({type:ae})],ee.prototype,"graphic",void 0),n([a()],ee.prototype,"mode",void 0),n([a({readOnly:!0})],ee.prototype,"state",null),n([a()],ee.prototype,"filesEnabled",void 0),n([a({readOnly:!0})],ee.prototype,"supportsResizeAttachments",null),ee=n([w("esri.widgets.Attachments.AttachmentsViewModel")],ee);var at=ee;function bi(e){let t=e.toLowerCase();return t==="image/bmp"||t==="image/emf"||t==="image/exif"||t==="image/gif"||t==="image/x-icon"||t==="image/jpeg"||t==="image/png"||t==="image/tiff"||t==="image/x-wmf"}function Xr(e){let t=tr("esri/themes/base/images/files/");return e?e==="text/plain"?`${t}text-32.svg`:e==="application/pdf"?`${t}pdf-32.svg`:e==="text/csv"?`${t}csv-32.svg`:e==="application/gpx+xml"?`${t}gpx-32.svg`:e==="application/x-dwf"?`${t}cad-32.svg`:e==="application/postscript"||e==="application/json"||e==="text/xml"||e==="model/vrml"?`${t}code-32.svg`:e==="application/x-zip-compressed"||e==="application/x-7z-compressed"||e==="application/x-gzip"||e==="application/x-tar"||e==="application/x-gtar"||e==="application/x-bzip2"||e==="application/gzip"||e==="application/x-compress"||e==="application/x-apple-diskimage"||e==="application/x-rar-compressed"||e==="application/zip"?`${t}zip-32.svg`:e.includes("image/")?`${t}image-32.svg`:e.includes("audio/")?`${t}sound-32.svg`:e.includes("video/")?`${t}video-32.svg`:e.includes("msexcel")||e.includes("ms-excel")||e.includes("spreadsheetml")?`${t}excel-32.svg`:e.includes("msword")||e.includes("ms-word")||e.includes("wordprocessingml")?`${t}word-32.svg`:e.includes("powerpoint")||e.includes("presentationml")?`${t}report-32.svg`:`${t}generic-32.svg`:`${t}generic-32.svg`}var Yr={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},k="esri-attachments",M={base:k,loaderContainer:`${k}__loader-container`,loader:`${k}__loader`,fadeIn:`${k}--fade-in`,container:`${k}__container`,containerList:`${k}__container--list`,containerPreview:`${k}__container--preview`,actions:`${k}__actions`,deleteButton:`${k}__delete-button`,addAttachmentButton:`${k}__add-attachment-button`,errorMessage:`${k}__error-message`,items:`${k}__items`,item:`${k}__item`,itemButton:`${k}__item-button`,itemMask:`${k}__item-mask`,itemMaskIcon:`${k}__item-mask--icon`,itemImage:`${k}__image`,itemImageResizable:`${k}__image--resizable`,itemLabel:`${k}__label`,itemFilename:`${k}__filename`,itemChevronIcon:`${k}__item-chevron-icon`,itemLink:`${k}__item-link`,itemLinkOverlay:`${k}__item-link-overlay`,itemLinkOverlayIcon:`${k}__item-link-overlay-icon`,itemEditIcon:`${k}__item-edit-icon`,itemAddIcon:`${k}__item-add-icon`,itemAddButton:`${k}__item-add-button`,formNode:`${k}__form-node`,fileFieldset:`${k}__file-fieldset`,fileLabel:`${k}__file-label`,fileName:`${k}__file-name`,fileInput:`${k}__file-input`,metadata:`${k}__metadata`,metadataFieldset:`${k}__metadata-fieldset`,progressBar:`${k}__progress-bar`},wi=window.CSS,G=class extends N{constructor(e,t){super(e,t),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements=v({},Yr),this._supportsImageOrientation=wi&&wi.supports&&wi.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}normalizeCtorArgs(e){return e?.viewModel||(e=v({viewModel:new at},e)),e}initialize(){this.addHandles([re(()=>this.viewModel?.attachmentInfos,"change",()=>this.scheduleRender()),re(()=>this.viewModel?.fileInfos,"change",()=>this.scheduleRender()),g(()=>this.viewModel?.mode,()=>this._modeChanged(),P)])}loadDependencies(){return ne({icon:()=>import("./chunk-QKBODARO.js")})}get capabilities(){return this.viewModel.capabilities}set capabilities(e){this.viewModel.capabilities=e}get effectiveDisplayType(){let{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}castVisibleElements(e){return v(v({},Yr),e)}addAttachment(){let{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new L("attachments:add-attachment",this.messages.addErrorMessage,i)),i})}deleteAttachment(e){let{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new L("attachments:delete-attachment",this.messages.deleteErrorMessage,i)),i})}updateAttachment(){let{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then(i=>(this._set("submitting",!1),this._set("error",null),e.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new L("attachments:update-attachment",this.messages.updateErrorMessage,i)),i})}addFile(){let e=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",e}updateFile(){let{viewModel:e}=this,t=e.updateFile(this.selectedFile,this._updateAttachmentForm,e.activeFileInfo);return e.mode="view",t}deleteFile(e){let t=this.viewModel.deleteFile(e||this.viewModel.activeFileInfo?.file);return this.viewModel.mode="view",t}render(){let{submitting:e,viewModel:t}=this,{state:i}=t;return c("div",{class:this.classes(M.base,F.widget)},e?this._renderProgressBar():null,i==="loading"?this._renderLoading():this._renderAttachments(),this._renderErrorMessage())}_renderErrorMessage(){let{error:e,visibleElements:t}=this;return e&&t.errorMessage?c("div",{class:M.errorMessage,key:"error-message"},e.message):null}_renderAttachments(){let{activeFileInfo:e,mode:t,activeAttachmentInfo:i}=this.viewModel;return t==="add"?this._renderAddForm():t==="edit"?this._renderDetailsForm(i||e):this._renderAttachmentContainer()}_renderLoading(){return c("div",{class:M.loaderContainer,key:"loader"},c("div",{class:M.loader}))}_renderProgressBar(){return this.visibleElements.progressBar?c("div",{class:M.progressBar,key:"progress-bar"}):null}_renderAddForm(){let{submitting:e,selectedFile:t}=this,i=e||!t,r=this.visibleElements.cancelAddButton?c("button",{bind:this,class:this.classes(F.button,F.buttonTertiary,F.buttonSmall,F.buttonHalf,e&&F.buttonDisabled),disabled:e,onclick:this._cancelForm,type:"button"},this.messages.cancel):null,o=this.visibleElements.addSubmitButton?c("button",{class:this.classes(F.button,F.buttonSecondary,F.buttonSmall,F.buttonHalf,{[F.buttonDisabled]:i}),disabled:i,type:"submit"},this.messages.add):null,s=t?c("span",{class:M.fileName,key:"file-name"},t.name):null,l=c("form",{afterCreate:ni,afterRemoved:si,bind:this,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},c("fieldset",{class:M.fileFieldset},s,c("label",{class:this.classes(M.fileLabel,F.button,F.buttonSecondary)},t?this.messages.changeFile:this.messages.selectFile,c("input",{bind:this,class:M.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))),o,r);return c("div",{class:M.formNode,key:"add-form-container"},l)}_renderDetailsForm(e){let{visibleElements:t,viewModel:i,selectedFile:r,submitting:o}=this,{capabilities:s}=i,l=o||!r,d,u,p,h;r?(d=r.type,u=r.name,p=r.size):e&&"file"in e?(d=e.file.type,u=e.file.name,p=e.file.size):e&&"contentType"in e&&(d=e.contentType,u=e.name,p=e.size,h=e.url);let m=s.editing&&s.operations?.delete&&t.deleteButton?c("button",{bind:this,class:this.classes(F.button,F.buttonSmall,F.buttonTertiary,M.deleteButton,{[F.buttonDisabled]:o}),disabled:o,key:"delete-button",onclick:I=>this._submitDeleteAttachment(I,e),type:"button"},this.messages.delete):void 0,y=s.editing&&s.operations?.update&&t.updateButton?c("button",{class:this.classes(F.button,F.buttonSmall,F.buttonThird,{[F.buttonDisabled]:l}),disabled:l,key:"update-button",type:"submit"},this.messages.update):void 0,b=this.visibleElements.cancelUpdateButton?c("button",{bind:this,class:this.classes(F.button,F.buttonSmall,F.buttonTertiary,F.buttonThird,{[F.buttonDisabled]:o}),disabled:o,key:"cancel-button",onclick:this._cancelForm,type:"button"},this.messages.cancel):void 0,_=s.editing&&s.operations?.update?c("fieldset",{class:M.fileFieldset,key:"file"},c("span",{class:M.fileName,key:"file-name"},u),c("label",{class:this.classes(M.fileLabel,F.button,F.buttonSecondary)},this.messages.changeFile,c("input",{bind:this,class:M.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))):void 0,x=c("fieldset",{class:M.metadataFieldset,key:"size"},c("label",null,Lr(this.messagesUnits,p??0))),T=c("fieldset",{class:M.metadataFieldset,key:"content-type"},c("label",null,d)),C=h!=null?c("a",{class:M.itemLink,href:h,rel:"noreferrer",target:"_blank"},this._renderImageMask(e,400),c("div",{class:M.itemLinkOverlay},c("span",{class:M.itemLinkOverlayIcon},c("calcite-icon",{icon:"launch"})))):this._renderImageMask(e,400),R=c("form",{afterCreate:ni,afterRemoved:si,bind:this,"data-node-ref":"_updateAttachmentForm",onsubmit:I=>this._submitUpdateAttachment(I,e)},c("div",{class:M.metadata},x,T),_,c("div",{class:M.actions},m,b,y));return c("div",{class:M.formNode,key:"edit-form-container"},C,R)}_renderImageMask(e,t){return e?"file"in e?this._renderGenericImageMask(e.file.name,e.file.type):this._renderImageMaskForAttachment(e,t):null}_renderGenericImageMask(e,t){let{supportsResizeAttachments:i}=this.viewModel,r=Xr(t),o={[M.itemImageResizable]:i};return c("div",{class:this.classes(M.itemMaskIcon,M.itemMask),key:r},c("img",{alt:e,class:this.classes(o,M.itemImage),src:r,title:e}))}_renderImageMaskForAttachment(e,t){let{supportsResizeAttachments:i}=this.viewModel;if(!e)return null;let{contentType:r,name:o,url:s}=e;if(!i||!bi(r))return this._renderGenericImageMask(o,r);let l=this._getCSSTransform(e),d=l?{transform:l,"image-orientation":"none"}:{},u=`${s}${s?.includes("?")?"&":"?"}w=${t}`,p={[M.itemImageResizable]:i};return c("div",{class:this.classes(M.itemMask),key:u},c("img",{alt:o,class:this.classes(p,M.itemImage),src:u,styles:d,title:o}))}_renderFile(e){let{file:t}=e;return c("li",{class:M.item,key:t},c("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:M.itemButton,key:"details-button",onclick:()=>this._startEditFile(e),title:this.messages.attachmentDetails,type:"button"},this._renderImageMask(e),c("label",{class:M.itemLabel},c("span",{class:M.itemFilename},t.name||this.messages.noTitle),c("span",{"aria-hidden":"true",class:this.classes(M.itemChevronIcon,se(this.container)?Q.left:Q.right)}))))}_renderAttachmentInfo({attachmentInfo:e,displayType:t}){let{viewModel:i,effectiveDisplayType:r}=this,{capabilities:o,supportsResizeAttachments:s}=i,{contentType:l,name:d,url:u}=e,p=this._renderImageMask(e,t==="list"?48:400),h=o.editing?c("span",{"aria-hidden":"true",class:this.classes(M.itemChevronIcon,se(this.container)?Q.left:Q.right)}):null,m=[p,r==="preview"&&s&&bi(l)?null:c("label",{class:M.itemLabel},c("span",{class:M.itemFilename},d||this.messages.noTitle),h)],y=o.editing?c("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:M.itemButton,"data-attachment-info-id":e.id,key:"details-button",onclick:()=>this._startEditAttachment(e),title:this.messages.attachmentDetails,type:"button"},m):c("a",{class:M.itemButton,href:u??void 0,key:"details-link",target:"_blank"},m);return c("li",{class:M.item,key:e},y)}_renderAttachmentContainer(){let{effectiveDisplayType:e,viewModel:t,visibleElements:i}=this,{attachmentInfos:r,capabilities:o,fileInfos:s}=t,l=!!r?.length,d=!!s?.length,u={[M.containerList]:e!=="preview",[M.containerPreview]:e==="preview"},p=o.editing&&o.operations?.add&&i.addButton?c("button",{bind:this,class:this.classes(F.button,F.buttonTertiary,M.addAttachmentButton),onclick:()=>this._startAddAttachment(),type:"button"},c("span",{"aria-hidden":"true",class:this.classes(M.itemAddIcon,Q.plus)}),this.messages.add):void 0,h=l?c("ul",{class:M.items,key:"attachments-list"},r.toArray().map(b=>this._renderAttachmentInfo({attachmentInfo:b,displayType:e}))):void 0,m=d?c("ul",{class:M.items,key:"file-list"},s.toArray().map(b=>this._renderFile(b))):void 0,y=d||l?void 0:c("div",{class:F.empty},this.messages.noAttachments);return c("div",{class:this.classes(M.container,u),key:"attachments-container"},h,m,y,p)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){let t=e.target,i=t.files?.item(0);this._set("selectedFile",i)}_submitDeleteAttachment(e,t){e.preventDefault(),t&&("file"in t?this.deleteFile(t.file):t&&this.deleteAttachment(t))}_submitAddAttachment(e){e.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(e,t){e.preventDefault(),t&&"file"in t?this.updateFile():this.updateAttachment()}_startEditAttachment(e){let{viewModel:t}=this;t.activeFileInfo=null,t.activeAttachmentInfo=e,t.mode="edit"}_startEditFile(e){let{viewModel:t}=this;t.activeAttachmentInfo=null,t.activeFileInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e){let{orientationInfo:t}=e;return!this._supportsImageOrientation&&t?[t.rotation?`rotate(${t.rotation}deg)`:"",t.mirrored?"scaleX(-1)":""].join(" "):""}};n([a()],G.prototype,"capabilities",null),n([a()],G.prototype,"displayType",void 0),n([a({readOnly:!0})],G.prototype,"effectiveDisplayType",null),n([a()],G.prototype,"graphic",null),n([a()],G.prototype,"label",null),n([a(),B("esri/widgets/Attachments/t9n/Attachments")],G.prototype,"messages",void 0),n([a(),B("esri/core/t9n/Units")],G.prototype,"messagesUnits",void 0),n([a({readOnly:!0})],G.prototype,"selectedFile",void 0),n([a({readOnly:!0})],G.prototype,"submitting",void 0),n([a({readOnly:!0})],G.prototype,"error",void 0),n([a({type:at})],G.prototype,"viewModel",void 0),n([a()],G.prototype,"visibleElements",void 0),n([oe("visibleElements")],G.prototype,"castVisibleElements",null),G=n([w("esri.widgets.Attachments")],G);var Kr=G;var lt=class extends at{constructor(e){super(e),this.description=null,this.title=null}};n([a()],lt.prototype,"description",void 0),n([a()],lt.prototype,"title",void 0),lt=n([w("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],lt);var dt=lt;var _i="esri-feature-element-info",Fi={base:_i,title:`${_i}__title`,description:`${_i}__description`},Ye=class extends N{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return c("div",{class:Fi.base},this._renderTitle(),this._renderDescription())}_renderTitle(){let{title:e}=this;return e?c(Ge,{class:Fi.title,level:this.headingLevel},e):null}_renderDescription(){let{description:e}=this;return e?c("div",{class:Fi.description,key:"description"},e):null}};n([a()],Ye.prototype,"description",void 0),n([a()],Ye.prototype,"headingLevel",void 0),n([a()],Ye.prototype,"title",void 0),Ye=n([w("esri.widgets.Feature.support.FeatureElementInfo")],Ye);var Le=Ye;var vs={base:"esri-feature-attachments"},ve=class extends N{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new Kr,this.headingLevel=2,this.viewModel=new dt}initialize(){this._featureElementInfo=new Le,this.addHandles([g(()=>[this.viewModel?.description,this.viewModel?.title,this.headingLevel],()=>this._setupFeatureElementInfo(),P),g(()=>this.viewModel,e=>this.attachmentsWidget.viewModel=e,P)])}destroy(){this.attachmentsWidget.viewModel=null,this.attachmentsWidget.destroy(),this._featureElementInfo?.destroy()}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get displayType(){return this.attachmentsWidget.displayType}set displayType(e){this.attachmentsWidget.displayType=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){let{attachmentsWidget:e}=this;return c("div",{class:vs.base},this._featureElementInfo?.render(),e?.render())}_setupFeatureElementInfo(){let{description:e,title:t,headingLevel:i}=this;this._featureElementInfo?.set({description:e,title:t,headingLevel:i})}};n([a({readOnly:!0})],ve.prototype,"attachmentsWidget",void 0),n([a()],ve.prototype,"description",null),n([a()],ve.prototype,"displayType",null),n([a()],ve.prototype,"graphic",null),n([a()],ve.prototype,"headingLevel",void 0),n([a()],ve.prototype,"title",null),n([a({type:dt})],ve.prototype,"viewModel",void 0),ve=n([w("esri.widgets.Feature.FeatureAttachments")],ve);var Jr=ve;var ke=class extends j{constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.addHandles(g(()=>this.creator,t=>{this._destroyContent(),this._createContent(t)},P))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){let{created:e,graphic:t,destroyer:i}=this;e&&t&&(Ze(i,{graphic:t}).catch(()=>null),this._set("created",null))}_createContent(e){return f(this,null,function*(){let t=this.graphic;if(!t||!e)return;let i=Ze(e,{graphic:t}).catch(()=>null);this._loadingPromise=i,this.notifyChange("state");let r=yield i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",r))})}};n([a({readOnly:!0})],ke.prototype,"created",void 0),n([a()],ke.prototype,"creator",void 0),n([a()],ke.prototype,"destroyer",void 0),n([a({type:ae})],ke.prototype,"graphic",void 0),n([a({readOnly:!0})],ke.prototype,"state",null),ke=n([w("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],ke);var qe=ke;var Mi="esri-feature-content",Ii={base:Mi,loaderContainer:`${Mi}__loader-container`,loader:`${Mi}__loader`},Ke=class extends N{constructor(e,t){super(e,t),this.viewModel=null,this._addTargetToAnchors=i=>{Array.from(i.querySelectorAll("a")).forEach(r=>{$t(r.href)&&!r.hasAttribute("target")&&r.setAttribute("target","_blank")})}}get creator(){return this.viewModel?.creator}set creator(e){this.viewModel&&(this.viewModel.creator=e)}get graphic(){return this.viewModel?.graphic}set graphic(e){this.viewModel&&(this.viewModel.graphic=e)}render(){let e=this.viewModel?.state;return c("div",{class:Ii.base},e==="loading"?this._renderLoading():this._renderCreated())}_renderLoading(){return c("div",{class:Ii.loaderContainer,key:"loader"},c("div",{class:Ii.loader}))}_renderCreated(){let e=this.viewModel?.created;return e?e instanceof HTMLElement?c("div",{afterCreate:this._attachToNode,bind:e,key:e}):Ct(e)?c("div",{key:e},!e.destroyed&&e.render()):c("div",{afterCreate:this._addTargetToAnchors,innerHTML:e,key:e}):null}_attachToNode(e){let t=this;e.appendChild(t)}};n([a()],Ke.prototype,"creator",null),n([a()],Ke.prototype,"graphic",null),n([a({type:qe})],Ke.prototype,"viewModel",void 0),Ke=n([w("esri.widgets.Feature.FeatureContent")],Ke);var Je=Ke;var Fe=class extends j{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){let{expressionInfos:e,fieldInfos:t}=this,i=[];return t?.forEach(r=>{if(!(!r.hasOwnProperty("visible")||r.visible))return;let o=r.clone();o.label=Dt(o,e),i.push(o)}),i}};n([a()],Fe.prototype,"attributes",void 0),n([a({type:[yr]})],Fe.prototype,"expressionInfos",void 0),n([a()],Fe.prototype,"description",void 0),n([a({type:[kt]})],Fe.prototype,"fieldInfos",void 0),n([a({readOnly:!0})],Fe.prototype,"formattedFieldInfos",null),n([a()],Fe.prototype,"title",void 0),Fe=n([w("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],Fe);var He=Fe;var bs=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function ws(e){let t=null;return bs.some(i=>(i.pattern.test(e)&&(t=i),!!t)),t}function eo(e,t){if(typeof t!="string"||!t)return t;let i=ws(t);if(!i)return t;let r=t.match(i.pattern),o=r&&r[2],s=fe(fe(i.label,{messages:e,hierPart:o}),{appName:i.appName}),l=i.target?` target="${i.target}"`:"",d=i.target==="_blank"?' rel="noreferrer"':"";return t.replace(i.pattern,`<a${l} href="$1"${d}>${s}</a>`)}var Wt="esri-feature-fields",Ut={base:Wt,fieldHeader:`${Wt}__field-header`,fieldData:`${Wt}__field-data`,fieldDataDate:`${Wt}__field-data--date`},pe=class extends N{constructor(e,t){super(e,t),this._featureElementInfo=null,this.viewModel=new He,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new Le,this.addHandles(g(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),P))}destroy(){this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(e){this.viewModel.expressionInfos=e}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(e){this.viewModel.fieldInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){return c("div",{class:Ut.base},this._featureElementInfo?.render(),this._renderFields())}_renderFieldInfo(e,t){let{attributes:i}=this.viewModel,r=e.fieldName,o=e.label||r,s=i?i[r]==null?"":i[r]:"",l=!(!e.format||!e.format.dateFormat),d=typeof s=="number"&&!l?this._forceLTR(s):eo(this.messagesURIUtils,s),u={[Ut.fieldDataDate]:l};return c("tr",{key:`fields-element-info-row-${r}-${t}`},c("th",{class:Ut.fieldHeader,innerHTML:o,key:`fields-element-info-row-header-${r}-${t}`}),c("td",{class:this.classes(Ut.fieldData,u),innerHTML:d,key:`fields-element-info-row-data-${r}-${t}`}))}_renderFields(){let{formattedFieldInfos:e}=this.viewModel;return e?.length?c("table",{class:F.table,summary:this.messages.fieldsSummary},c("tbody",null,e.map((t,i)=>this._renderFieldInfo(t,i)))):null}_setupFeatureElementInfo(){let{description:e,title:t}=this;this._featureElementInfo?.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};n([a()],pe.prototype,"attributes",null),n([a()],pe.prototype,"description",null),n([a()],pe.prototype,"expressionInfos",null),n([a()],pe.prototype,"fieldInfos",null),n([a()],pe.prototype,"title",null),n([a({type:He,nonNullable:!0})],pe.prototype,"viewModel",void 0),n([a(),B("esri/widgets/Feature/t9n/Feature")],pe.prototype,"messages",void 0),n([a(),B("esri/widgets/support/t9n/uriUtils")],pe.prototype,"messagesURIUtils",void 0),pe=n([w("esri.widgets.Feature.FeatureFields")],pe);var jt=pe;var to=()=>window.matchMedia("(prefers-reduced-motion: reduce)").matches;var _s={maximumFractionDigits:20};function Ai(e){return ue(e,_s)}var Fs="<",Ms=">";function io(e,t,i,r){let o="";return t===0?o=`${Fs} `:t===i&&(o=`${Ms} `),o+(r?Qe(e,r):Ai(e))}var Is=new li([64,64,64]);function As(e,t){let i=[],r=e.length-1;return e.length===5?i.push(0,2,4):i.push(0,r),e.map((o,s)=>i.includes(s)?io(o,s,r,t):null)}function ro(e,t,i){return f(this,null,function*(){let r=!1,o=[],s=[];if(e.stops){let p=e.stops;o=p.map(h=>h.value),r=p.some(h=>!!h.label),r&&(s=p.map(h=>h.label))}let l=o[0],d=o[o.length-1];if(l==null&&d==null)return null;let u=r?null:As(o,i);return(yield Promise.all(o.map((p,h)=>f(this,null,function*(){return{value:p,color:e.type==="opacity"?yield Cs(p,e,t):(yield import("./chunk-FXZLSSDR.js")).getColor(e,p),label:r?s[h]:u?.[h]??""}})))).reverse()})}function Cs(e,t,i){return f(this,null,function*(){let r=new li(i??Is),o=(yield import("./chunk-FXZLSSDR.js")).getOpacity(t,e);return o!=null&&(r.a=o),r})}function oo(e){if(!e.colorStops)return[];let t=[...e.colorStops].filter(r=>r.color?.a>0),i=t.length-1;if(t&&t[0]){let r=t[i];r&&r.ratio!==1&&(t.push(new br({ratio:1,color:r.color})),i++)}return t.map((r,o)=>{let s="";return o===0?s=e.legendOptions?.minLabel||"low":o===i&&(s=e.legendOptions?.maxLabel||"high"),{color:r.color,label:s,ratio:r.ratio}}).reverse()}var Gd=D.getLogger("esri.renderers.support.utils");var Zd=Mt("short-date");function te(e,t,i){return f(this,null,function*(){Zi(e,t,()=>[]).push(...i)})}function so(e){return f(this,null,function*(){let t=new Map;if(!e)return t;if("visualVariables"in e&&e.visualVariables){let i=e.visualVariables.filter(r=>r.type==="color");for(let r of i){let o=((yield ro(r))??[]).map(s=>s.color);yield te(t,r.field||r.valueExpression,o)}}if(e.type==="heatmap"){let i=oo(e).map(r=>r.color);yield te(t,e.field||e.valueExpression,i)}else if(e.type==="pie-chart"){for(let i of e.attributes)yield te(t,i.field||i.valueExpression,[i.color]);yield te(t,"default",[e?.othersCategory?.color,Te(e.backgroundFillSymbol,null)])}else if(e.type==="dot-density"){for(let i of e.attributes)yield te(t,i.field||i.valueExpression,[i.color]);yield te(t,"default",[e.backgroundColor])}else if(e.type==="unique-value")if(e.authoringInfo?.type==="predominance")for(let i of e.uniqueValueInfos??[])yield te(t,i.value.toString(),[Te(i.symbol,null)]);else{let i=(e.uniqueValueInfos??[]).map(d=>Te(d.symbol,null)),{field:r,field2:o,field3:s,valueExpression:l}=e;(r||l)&&(yield te(t,r||l,i)),o&&(yield te(t,o,i)),s&&(yield te(t,s,i))}else if(e.type==="class-breaks"){let i=e.classBreakInfos.map(s=>Te(s.symbol,null)),{field:r,valueExpression:o}=e;yield te(t,r??o,i)}else e.type==="simple"&&(yield te(t,"default",[Te(e.symbol,null)]));return"defaultSymbol"in e&&e.defaultSymbol&&(yield te(t,"default",[Te(e.defaultSymbol,null)])),t.forEach((i,r)=>{let o=it(i.filter(Boolean),(s,l)=>JSON.stringify(s)===JSON.stringify(l));t.set(r,o)}),t})}var xs="esri.widgets.Feature.support.relatedFeatureUtils",no=D.getLogger(xs),ao=new Map;function et(e){if(!le(e))return null;let[t,i]=e.split("/").slice(1);return{layerId:t,fieldName:i}}function Es(e,t){if(!t.relationships)return null;let i=null,{relationships:r}=t;return r.some(o=>o.id===parseInt(e,10)&&(i=o,!0)),i}function Ts({originRelationship:e,relationships:t,layerId:i}){let r=null;return t&&t.some(o=>(`${o.relatedTableId}`===i&&o.id===e?.id&&(r=o),!!r)),r}function Ls(e,t){let i=t.toLowerCase();for(let r in e)if(r.toLowerCase()===i)return e[r];return null}function lo(e,t){let i=Es(e,t);if(i)return{url:`${t.url}/${i.relatedTableId}`,sourceSpatialReference:t.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}function co(e,t){if(!t||!e)return;let{features:i,statsFeatures:r}=e,o=i?.value;t.relatedFeatures=o?o.features:[];let s=r?.value;t.relatedStatsFeatures=s?s.features:[]}function ks(e,t,i,r){let o=new st;return o.outFields=["*"],o.relationshipId=typeof t.id=="number"?t.id:parseInt(t.id,10),o.objectIds=[e.attributes[i.objectIdField]],i.queryRelatedFeatures?.(o,r)??Promise.resolve({})}function Rs(e,t,i){let r=0,o=[];for(;r<t.length;)o.push(`${e} IN (${t.slice(r,i+r)})`),r+=i;return o.join(" OR ")}function Ss(e){return e?it(e):void 0}function Os(e){return e?it(e,(t,i)=>JSON.stringify(t.toJSON())===JSON.stringify(i.toJSON())):void 0}function Ps(e,t,i,r){return f(this,null,function*(){let o=i.layerId.toString(),{layerInfo:s,relation:l,relatedFields:d,outStatistics:u,url:p,sourceSpatialReference:h}=t,m=Ss(d),y=Os(u);if(!s||!l)return null;let b=Ts({originRelationship:l,relationships:s.relationships,layerId:o});if(b?.relationshipTableId&&b.keyFieldInRelationshipTable){let x=(yield ks(e,b,i,r))[e.attributes[i.objectIdField]];if(!x)return null;let T=x.features.map(C=>C.attributes[s.objectIdField]);if(y?.length&&s.supportsStatistics){let C=new Lt;C.where=Rs(s.objectIdField,T,1e3),C.outFields=m,C.outStatistics=y,C.sourceSpatialReference=h;let R={features:Promise.resolve(x),statsFeatures:St(p,C)};return ge(R)}}let _=b?.keyField;if(_){let x=Fr(Vs(s.fields,_)),T=Ls(e.attributes,l.keyField),C=x?`${_}=${T}`:`${_}='${T}'`,R=St(p,new Lt({where:C,outFields:m,sourceSpatialReference:h}),r),I=y?.length&&s.supportsStatistics?St(p,new Lt({where:C,outFields:m,outStatistics:y,sourceSpatialReference:h}),r):null,xe={features:R};return I&&(xe.statsFeatures=I),ge(xe)}return null})}function Ns(e,t){return sr(e,{query:{f:"json"},signal:t?.signal})}function uo({relatedInfos:e,layer:t},i){let r={};return e.forEach((o,s)=>{let{relation:l}=o;if(!l){let m=new L("relation-required","A relation is required on a layer to retrieve related records.");throw no.error(m),m}let{relatedTableId:d}=l;if(typeof d!="number"){let m=new L("A related table ID is required on a layer to retrieve related records.");throw no.error(m),m}let u=`${t.url}/${d}`,p=ao.get(u),h=p??Ns(u);p||ao.set(u,h),r[s]=h}),Qi(ge(r),i)}function po({graphic:e,relatedInfos:t,layer:i},r){let o={};return t.forEach((s,l)=>{s.layerInfo&&(o[l]=Ps(e,s,i,r))}),ge(o)}function ho({relatedInfo:e,fieldName:t,fieldInfo:i}){if(e.relatedFields?.push(t),i.statisticType){let r=new ur({statisticType:i.statisticType,onStatisticField:t,outStatisticFieldName:t});e.outStatistics?.push(r)}}function Vs(e,t){if(e!=null){t=t.toLowerCase();for(let i of e)if(i&&i.name.toLowerCase()===t)return i}return null}var mo={chartAnimation:!0},H=class extends j{constructor(e){super(e),this.abilities=v({},mo),this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.isAggregate=!1,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return v(v({},mo),e)}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){let{formattedMediaInfoCount:t}=this,i=(e+t)%t;this.activeMediaInfoIndex=i}_pageContentElementMedia(e){let{activeMediaInfoIndex:t}=this,i=t+e;this._setContentElementMedia(i)}_formatMediaInfos(){let{mediaInfos:e,layer:t}=this,i=this.attributes??{},r=this.formattedAttributes??{},o=this.expressionAttributes??{},s=this.fieldInfoMap??new Map;return e?.map(l=>{let d=l?.clone();if(!d)return null;if(d.title=_e({attributes:i,fieldInfoMap:s,globalAttributes:r,expressionAttributes:o,layer:t,text:d.title}),d.caption=_e({attributes:i,fieldInfoMap:s,globalAttributes:r,expressionAttributes:o,layer:t,text:d.caption}),d.altText=_e({attributes:i,fieldInfoMap:s,globalAttributes:r,expressionAttributes:o,layer:t,text:d.altText}),d.type==="image"){let{value:u}=d;return this._setImageValue({value:u,formattedAttributes:r,layer:t}),d.value.sourceURL?d:void 0}if(d.type==="pie-chart"||d.type==="line-chart"||d.type==="column-chart"||d.type==="bar-chart"){let{value:u}=d;return this._setChartValue({value:u,chartType:d.type,attributes:i,formattedAttributes:r,layer:t,expressionAttributes:o}),d}return null}).filter(me)??[]}_setImageValue(e){let t=this.fieldInfoMap??new Map,{value:i,formattedAttributes:r,layer:o}=e,{linkURL:s,sourceURL:l}=i;if(l){let d=qt(l,o);i.sourceURL=Bt({formattedAttributes:r,template:d,fieldInfoMap:t})}if(s){let d=qt(s,o);i.linkURL=Bt({formattedAttributes:r,template:d,fieldInfoMap:t})}}_setChartValue(e){let{value:t,attributes:i,formattedAttributes:r,chartType:o,layer:s,expressionAttributes:l}=e,{popupTemplate:d,relatedInfos:u}=this,{fields:p,normalizeField:h}=t,m=s;if(t.fields=$r(p,m),h&&(t.normalizeField=Be(h,m)),!p.some(b=>!!(r[b]!=null||le(b)&&u?.size)))return;let y=d?.fieldInfos??[];p.forEach((b,_)=>{let x=t.colors?.[_];if(le(b))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:y,fieldName:b,formattedAttributes:r,chartType:o,value:t,color:x})]);let T=this._getChartOption({value:t,attributes:i,chartType:o,formattedAttributes:r,expressionAttributes:l,fieldName:b,fieldInfos:y,color:x});t.series.push(T)})}_getRelatedChartInfos(e){let{fieldInfos:t,fieldName:i,formattedAttributes:r,chartType:o,value:s,color:l}=e,d=[],u=et(i),p=u&&this.relatedInfos?.get(u.layerId.toString());if(!p)return d;let{relatedFeatures:h,relation:m}=p;if(!m||!h)return d;let{cardinality:y}=m;return h.forEach(b=>{let{attributes:_}=b;_&&Object.keys(_).forEach(x=>{x===u.fieldName&&d.push(this._getChartOption({value:s,attributes:_,formattedAttributes:r,fieldName:i,chartType:o,relatedFieldName:x,hasMultipleRelatedFeatures:h?.length>1,fieldInfos:t,color:l}))})}),y==="one-to-many"||y==="many-to-many"?d:[d[0]]}_getTooltip({label:e,value:t,chartType:i}){return i==="pie-chart"?`${e}`:`${e}: ${t}`}_getChartOption(e){let{value:t,attributes:i,formattedAttributes:r,expressionAttributes:o,fieldName:s,relatedFieldName:l,fieldInfos:d,chartType:u,hasMultipleRelatedFeatures:p,color:h}=e,m=this.layer,y=this.fieldInfoMap??new Map,{normalizeField:b,tooltipField:_}=t,x=b?le(b)?i[et(b).fieldName]:i[b]:null,T=nt(s)&&o&&o[s]!==void 0?o[s]:l&&i[l]!==void 0?i[l]:i[s]!==void 0?i[s]:r[s],C=new fr({fieldName:s,color:h,value:T===void 0?null:T&&x?T/x:T});if(le(s)){let ce=y.get(s.toLowerCase()),Bo=_&&y.get(_.toLowerCase()),qo=ce?.fieldName??s,ii=p&&_?et(_).fieldName:Bo?.fieldName??_,Ho=p&&ii?i[ii]:r[ii]??ce?.label??ce?.fieldName??l,zo=p&&l?i[l]:r[qo];return C.tooltip=this._getTooltip({label:Ho,value:zo,chartType:u}),C}let R=gi(d,s),I=Be(s,m),xe=_&&r[_]!==void 0?r[_]:Dt(R||new kt({fieldName:I}),this.popupTemplate?.expressionInfos),Ne=r[I];return C.tooltip=this._getTooltip({label:xe,value:Ne,chartType:u}),C}};n([a()],H.prototype,"abilities",void 0),n([oe("abilities")],H.prototype,"castAbilities",null),n([a()],H.prototype,"activeMediaInfoIndex",void 0),n([a({readOnly:!0})],H.prototype,"activeMediaInfo",null),n([a()],H.prototype,"attributes",void 0),n([a()],H.prototype,"description",void 0),n([a()],H.prototype,"fieldInfoMap",void 0),n([a()],H.prototype,"formattedAttributes",void 0),n([a()],H.prototype,"expressionAttributes",void 0),n([a({readOnly:!0})],H.prototype,"formattedMediaInfos",null),n([a()],H.prototype,"isAggregate",void 0),n([a()],H.prototype,"layer",void 0),n([a({readOnly:!0})],H.prototype,"formattedMediaInfoCount",null),n([a()],H.prototype,"mediaInfos",void 0),n([a()],H.prototype,"popupTemplate",void 0),n([a()],H.prototype,"relatedInfos",void 0),n([a()],H.prototype,"title",void 0),H=n([w("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],H);var be=H;var z="esri-feature-media",Y={base:z,mediaContainer:`${z}__container`,mediaItemContainer:`${z}__item-container`,mediaItem:`${z}__item`,mediaItemText:`${z}__item-text`,mediaItemTitle:`${z}__item-title`,mediaItemCaption:`${z}__item-caption`,mediaNavigation:`${z}__item-navigation`,mediaPagination:`${z}__pagination`,mediaPaginationText:`${z}__pagination-text`,mediaPrevious:`${z}__previous`,mediaPreviousIconLTR:`${z}__previous-icon`,mediaPreviousIconRTL:`${z}__previous-icon--rtl`,mediaNext:`${z}__next`,mediaNextIconLTR:`${z}__next-icon`,mediaNextIconRTL:`${z}__next-icon--rtl`,mediaChart:`${z}__chart`,mediaPaginationButton:`${z}__pagination-button`,mediaPaginationIcon:`${z}__pagination-icon`,mediaChartRendered:`${z}__chart--rendered`},Ci=15,Re="category",ct="value",$s="rgba(50, 50, 50, 1)",Ds=250,Bs=500,qs=200,K=class extends N{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this._chartRootMap=new WeakMap,this.viewModel=new be,this.messages=null,this._disposeChart=i=>{this._chartRootMap.get(i)?.dispose(),this._chartRootMap.delete(i)},this._createChart=i=>f(this,null,function*(){let{destroyed:r,viewModel:o}=this;if(r||!o||!i)return;let{createRoot:s}=yield import("./chunk-6JOMRMJV.js"),l=yield s(i);this._chartRootMap.set(i,l),this._renderChart({mediaInfo:o.activeMediaInfo,root:l})})}initialize(){this._featureElementInfo=new Le,this.addHandles([g(()=>[this.viewModel?.activeMediaInfo,this.viewModel?.activeMediaInfoIndex],()=>this._setupMediaRefreshTimer(),P),g(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),P)])}loadDependencies(){return ne({icon:()=>import("./chunk-QKBODARO.js")})}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(e){this.viewModel.activeMediaInfoIndex=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(e){this.viewModel.fieldInfoMap=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(e){this.viewModel.mediaInfos=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(e){this.viewModel.relatedInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){return c("div",{bind:this,class:Y.base,onkeyup:this._handleMediaKeyup},this._featureElementInfo?.render(),this._renderMedia())}_renderMedia(){let{formattedMediaInfoCount:e,activeMediaInfoIndex:t}=this.viewModel,i=this._renderMediaText();return e?c("div",{class:Y.mediaContainer,key:"media-element-container"},this._renderMediaInfo(),c("div",{class:Y.mediaNavigation},i,e>1?c("div",{class:Y.mediaPagination},this._renderMediaPageButton("previous"),c("span",{class:Y.mediaPaginationText},X(this.messages.pageText,{index:t+1,total:e})),this._renderMediaPageButton("next")):null)):null}_renderMediaText(){let{activeMediaInfo:e}=this.viewModel;if(!e)return null;let t=e&&e.title?c("div",{class:Y.mediaItemTitle,innerHTML:e.title,key:"media-title"}):null,i=e&&e.caption?c("div",{class:Y.mediaItemCaption,innerHTML:e.caption,key:"media-caption"}):null;return t||i?c("div",{class:Y.mediaItemText,key:"media-text"},t,i):null}_renderImageMediaInfo(e){let{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:r}=this.viewModel,{value:o,refreshInterval:s,altText:l,title:d,type:u}=e,{sourceURL:p,linkURL:h}=o,m=$t(h??void 0)?"_blank":"_self",y=m==="_blank"?"noreferrer":"",b=s?t:null,_=b?b.timestamp:0,x=b?b.sourceURL:p,T=c("img",{alt:l||d,key:`media-${u}-${i}-${r}-${_}`,src:x??void 0});return(h?c("a",{href:h,rel:y,target:m,title:d},T):null)??T}_renderChartMediaInfo(e){let{activeMediaInfoIndex:t,formattedMediaInfoCount:i}=this.viewModel;return c("div",{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:Y.mediaChart,key:`media-${e.type}-${t}-${i}`})}_renderMediaInfoType(){let{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this._renderImageMediaInfo(e):e.type.includes("chart")?this._renderChartMediaInfo(e):null:null}_renderMediaInfo(){let{activeMediaInfo:e}=this.viewModel;return e?c("div",{class:Y.mediaItemContainer,key:"media-container"},c("div",{class:Y.mediaItem,key:"media-item-container"},this._renderMediaInfoType())):null}_renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;let t=e==="previous",i=t?this.messages.previous:this.messages.next,r=t?"chevron-left":"chevron-right",o=t?"media-previous":"media-next",s=t?this._previous:this._next;return c("button",{"aria-label":i,bind:this,class:Y.mediaPaginationButton,key:o,onclick:s,tabIndex:0,title:i,type:"button"},c("calcite-icon",{class:Y.mediaPaginationIcon,icon:r,scale:"s"}))}_setupFeatureElementInfo(){let{description:e,title:t}=this;this._featureElementInfo?.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){if(!this.viewModel)return;let{isAggregate:e,layer:t}=this.viewModel;return e&&t?.featureReduction&&"renderer"in t.featureReduction?t.featureReduction.renderer:t?.renderer}_getSeriesColors(e){return f(this,null,function*(){let{colorAm5:t}=yield import("./chunk-I6LA4NNK.js"),i=new Map;return e.forEach(r=>{r.color&&i.set(r,t(r.color.toCss(!0)))}),i})}_getRendererColors(){return f(this,null,function*(){let{colorAm5:e}=yield import("./chunk-I6LA4NNK.js"),t=new Map,i=this._getRenderer(),r="default";if(!i)return t;let o=yield so(i);return o.delete(r),Array.from(o.values()).every(s=>s?.length===1)&&Array.from(o.keys()).forEach(s=>{let l=o.get(s)?.[0]?.toCss(!0);l&&t.set(s,e(l))}),t})}_handleMediaKeyup(e){let t=bt(e);t==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_canAnimateChart(){return!!this.viewModel&&!!this.viewModel.abilities.chartAnimation&&!to()}_getChartAnimationMS(){return this._canAnimateChart()?Ds:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?Bs:0}_renderChart(e){return f(this,null,function*(){let{root:t,mediaInfo:i}=e,{value:r,type:o}=i,{ResponsiveThemeAm5:s,DarkThemeAm5:l,AnimatedThemeAm5:d,ColorSetAm5:u,ThemeAm5:p,esriChartColorSet:h}=yield import("./chunk-I6LA4NNK.js"),m=p.new(t);m.rule("ColorSet").set("colors",h),m.rule("ColorSet").set("reuse",!0);let y=[s.new(t),m];rr()&&y.push(l.new(t)),this._canAnimateChart()&&y.push(d.new(t)),t.setThemes(y);let b=yield this._getRendererColors(),_=yield this._getSeriesColors(r.series),x=u.new(t,{}),T=_.get(r.series[0]),C=T?{lineSettings:{stroke:T}}:void 0,R=r.series.map((I,xe)=>{let Ne=_.get(I)||b.get(I.fieldName)||x.getIndex(xe);return v({[Re]:I.tooltip,[ct]:I.value,columnSettings:{fill:Ne,stroke:Ne}},C)}).filter(I=>o!=="pie-chart"||I.value!=null&&I.value>0);o==="pie-chart"?this._createPieChart(e,R):this._createXYChart(e,R)})}_getDirection(){return se(this.container)?"rtl":"ltr"}_isInversed(){return!!se(this.container)}_customizeChartTooltip(e,t="horizontal"){return f(this,null,function*(){let{colorAm5:i}=yield import("./chunk-I6LA4NNK.js");e.setAll({pointerOrientation:t}),e.get("background")?.setAll({stroke:i($s)}),e.label.setAll({direction:this._getDirection(),oversizedBehavior:"wrap",maxWidth:qs})})}_createPieChart(e,t){return f(this,null,function*(){let{TooltipAm5:i}=yield import("./chunk-I6LA4NNK.js"),{PieChartAm5:r,PieSeriesAm5:o}=yield import("./chunk-JRANXVHS.js"),{mediaInfo:s,root:l}=e,{title:d}=s,u=5,p=s?.altText||s?.title||"",h=l.container.children.push(r.new(l,{ariaLabel:p,focusable:!0,paddingBottom:u,paddingTop:u,paddingLeft:u,paddingRight:u})),m=`{category}: {valuePercentTotal.formatNumber('0.00')}%
 ({value})`,y=i.new(l,{labelText:m}),b=h.series.push(o.new(l,{name:d,valueField:ct,categoryField:Re,tooltip:y}));b.ticks.template.set("forceHidden",!0),b.labels.template.set("forceHidden",!0),b.slices.template.states.create("active",{shiftRadius:u}),this._customizeChartTooltip(y),b.slices.template.setAll({ariaLabel:m,focusable:!0,templateField:"columnSettings"}),b.data.setAll(t),b.appear(this._getChartSeriesAnimationMS()),h.appear(this._getChartAnimationMS()),h.root.dom.classList.toggle(Y.mediaChartRendered,!0)})}_getMinSeriesValue(e){let t=0;return e.forEach(i=>t=Math.min(i.value,t)),t}_createColumnChart(e,t,i){return f(this,null,function*(){let{TooltipAm5:r,ScrollbarAm5:o}=yield import("./chunk-I6LA4NNK.js"),{CategoryAxisAm5:s,AxisRendererXAm5:l,ValueAxisAm5:d,AxisRendererYAm5:u,ColumnSeriesAm5:p}=yield import("./chunk-FUB7VJ4C.js"),{mediaInfo:h,root:m}=t,{value:y,title:b}=h;e.setAll({wheelX:"panX",wheelY:"zoomX"});let _=e.xAxes.push(s.new(m,{renderer:l.new(m,{inversed:this._isInversed()}),categoryField:Re}));_.get("renderer").labels.template.setAll({forceHidden:!0});let x=e.yAxes.push(d.new(m,{renderer:u.new(m,{inside:!1}),min:this._getMinSeriesValue(y.series)}));x.get("renderer").labels.template.setAll({direction:this._getDirection()});let T="{categoryX}",C=r.new(m,{labelText:T}),R=e.series.push(p.new(m,{name:b,xAxis:_,yAxis:x,valueYField:ct,categoryXField:Re,tooltip:C}));this._customizeChartTooltip(C),R.columns.template.setAll({ariaLabel:T,focusable:!0,templateField:"columnSettings"}),y.series.length>Ci&&e.set("scrollbarX",o.new(m,{orientation:"horizontal"})),_.data.setAll(i),R.data.setAll(i),R.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())})}_createBarChart(e,t,i){return f(this,null,function*(){let{TooltipAm5:r,ScrollbarAm5:o}=yield import("./chunk-I6LA4NNK.js"),{CategoryAxisAm5:s,AxisRendererXAm5:l,ValueAxisAm5:d,AxisRendererYAm5:u,ColumnSeriesAm5:p}=yield import("./chunk-FUB7VJ4C.js"),{mediaInfo:h,root:m}=t,{value:y,title:b}=h;e.setAll({wheelX:"panY",wheelY:"zoomY"});let _=e.yAxes.push(s.new(m,{renderer:u.new(m,{inversed:!0}),categoryField:Re}));_.get("renderer").labels.template.setAll({forceHidden:!0});let x=e.xAxes.push(d.new(m,{renderer:l.new(m,{inside:!1,inversed:this._isInversed()}),min:this._getMinSeriesValue(y.series)}));x.get("renderer").labels.template.setAll({direction:this._getDirection()});let T="{categoryY}",C=r.new(m,{labelText:T}),R=e.series.push(p.new(m,{name:b,xAxis:x,yAxis:_,valueXField:ct,categoryYField:Re,tooltip:C}));this._customizeChartTooltip(C,"vertical"),R.columns.template.setAll({ariaLabel:T,focusable:!0,templateField:"columnSettings"}),y.series.length>Ci&&e.set("scrollbarY",o.new(m,{orientation:"vertical"})),_.data.setAll(i),R.data.setAll(i),R.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())})}_createLineChart(e,t,i){return f(this,null,function*(){let{TooltipAm5:r,ScrollbarAm5:o}=yield import("./chunk-I6LA4NNK.js"),{CategoryAxisAm5:s,AxisRendererXAm5:l,ValueAxisAm5:d,AxisRendererYAm5:u,LineSeriesAm5:p}=yield import("./chunk-FUB7VJ4C.js"),{root:h,mediaInfo:m}=t,{value:y,title:b}=m;e.setAll({wheelX:"panX",wheelY:"zoomX"});let _=e.xAxes.push(s.new(h,{renderer:l.new(h,{inversed:this._isInversed()}),categoryField:Re}));_.get("renderer").labels.template.setAll({forceHidden:!0});let x=e.yAxes.push(d.new(h,{renderer:u.new(h,{inside:!1}),min:this._getMinSeriesValue(y.series)}));x.get("renderer").labels.template.setAll({direction:this._getDirection()});let T="{categoryX}",C=i[0]?.lineSettings?.stroke,R=r.new(h,{getFillFromSprite:!C,labelText:T});C&&R.get("background")?.setAll({fill:C});let I=e.series.push(p.new(h,{name:b,xAxis:_,yAxis:x,valueYField:ct,categoryXField:Re,tooltip:R}));I.strokes.template.setAll({templateField:"lineSettings"}),this._customizeChartTooltip(R,"vertical"),y.series.length>Ci&&e.set("scrollbarX",o.new(h,{orientation:"horizontal"})),_.data.setAll(i),I.data.setAll(i),I.appear(this._getChartSeriesAnimationMS()),e.appear(this._getChartAnimationMS())})}_createXYChart(e,t){return f(this,null,function*(){let{XYChartAm5:i,XYCursorAm5:r}=yield import("./chunk-FUB7VJ4C.js"),{root:o,mediaInfo:s}=e,{type:l}=s,d=s?.altText||s?.title||"",u=o.container.children.push(i.new(o,{ariaLabel:d,focusable:!0,panX:!0,panY:!0}));u.set("cursor",r.new(o,{})),l==="column-chart"&&(yield this._createColumnChart(u,e,t)),l==="bar-chart"&&(yield this._createBarChart(u,e,t)),l==="line-chart"&&(yield this._createLineChart(u,e,t)),u.root.dom.classList.toggle(Y.mediaChartRendered,!0)})}_clearMediaRefreshTimer(){let{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){let t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:e&&this._getImageSource(e,t)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();let{activeMediaInfo:e}=this.viewModel;e&&e.type==="image"&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){let{refreshInterval:t,value:i}=e;if(!t)return;let r=6e4*t;this._updateMediaInfoTimestamp(i.sourceURL);let o=setInterval(()=>{this._updateMediaInfoTimestamp(i.sourceURL)},r);this._refreshTimer=o}_getImageSource(e,t){let i=e.includes("?")?"&":"?",[r,o=""]=e.split("#");return`${r}${i}timestamp=${t}${o?"#":""}${o}`}};n([a()],K.prototype,"_refreshIntervalInfo",void 0),n([a()],K.prototype,"attributes",null),n([a()],K.prototype,"activeMediaInfoIndex",null),n([a()],K.prototype,"description",null),n([a()],K.prototype,"fieldInfoMap",null),n([a()],K.prototype,"layer",null),n([a()],K.prototype,"mediaInfos",null),n([a()],K.prototype,"popupTemplate",null),n([a()],K.prototype,"relatedInfos",null),n([a()],K.prototype,"title",null),n([a({type:be})],K.prototype,"viewModel",void 0),n([a(),B("esri/widgets/Feature/t9n/Feature")],K.prototype,"messages",void 0),K=n([w("esri.widgets.Feature.FeatureMedia")],K);var Qt=K;var Hs=["$datastore","$map","$layer","$aggregatedfeatures"],zs="esri.widgets.Feature.support.arcadeFeatureUtils",Ws=D.getLogger(zs);function Us(e){return typeof e=="string"?Xe(Ht(e)):Array.isArray(e)?js(e):e?.declaredClass==="esri.arcade.Dictionary"?Qs(e):e}function js(e){return`<ul class="esri-widget__list">${e.map(t=>`<li>${typeof t=="string"?Xe(Ht(t)):t}</li>`).join("")}</ul>`}function Qs(e){return`<table class="esri-widget__table">${e.keys().map(t=>{let i=e.field(t);return`<tr><th>${t}</th><td>${typeof i=="string"?Xe(Ht(i)):i}</td></tr>`}).join("")}</table>`}function Gs({aggregatedFeatures:e,arcadeUtils:t,featureSetVars:i,context:r,viewInfo:o,map:s,graphic:l,interceptor:d}){i.forEach(u=>{let p=u.toLowerCase(),h=o.sr,m={map:s,spatialReference:h,interceptor:d};if(p==="$map"&&(r.vars[p]=t.convertMapToFeatureSetCollection(m)),p==="$layer"&&(r.vars[p]=t.convertFeatureLayerToFeatureSet({layer:l.sourceLayer,spatialReference:h,interceptor:d})),p==="$datastore"&&(r.vars[p]=t.convertServiceUrlToWorkspace({url:l.sourceLayer.url,spatialReference:h,interceptor:d})),p==="$aggregatedfeatures"){let y=l.layer,{fields:b,objectIdField:_,geometryType:x,spatialReference:T,displayField:C}=y,R=new _r(he(v({fields:b,objectIdField:_,geometryType:x,spatialReference:T,displayField:C},y.type==="feature"?{templates:y.templates,typeIdField:y.typeIdField,types:y.types}:null),{source:e}));r.vars[p]=t.convertFeatureLayerToFeatureSet({layer:R,spatialReference:T,interceptor:d})}})}function xi(){return import("./chunk-73JU7LC6.js")}function Zs(e){return"createQuery"in e&&"queryFeatures"in e}function Xs(i){return f(this,arguments,function*({graphic:e,view:t}){let{isAggregate:r,layer:o}=e;if(!r||!o||t?.type!=="2d")return[];let s=yield t.whenLayerView(o);if(!Zs(s))return[];let l=s.createQuery(),d=e.getObjectId();l.aggregateIds=d!=null?[d]:[];let{features:u}=yield s.queryFeatures(l);return u})}function Ei(d){return f(this,arguments,function*({expressionInfo:e,arcadeUtils:t,interceptor:i,spatialReference:r,map:o,graphic:s,view:l}){if(!e?.expression)return null;let u=t.createSyntaxTree(e.expression),p=Hs.filter(_=>t.hasVariable(u,_)),[h]=yield Promise.all([Xs({graphic:s,view:l}),t.loadScriptDependencies(u,!0,p)]),m=t.getViewInfo({spatialReference:r}),y=t.createExecContext(s,m,l?.timeZone);y.interceptor=i,y.useAsync=!0,Gs({aggregatedFeatures:h,arcadeUtils:t,featureSetVars:p,context:y,viewInfo:m,map:o,graphic:s,interceptor:i});let b=t.createFunction(u,y);return t.executeAsyncFunction(b,y).catch(_=>Ws.error("arcade-execution-error",{error:_,graphic:s,expressionInfo:e}))})}function fo(l){return f(this,arguments,function*({expressionInfos:e,spatialReference:t,graphic:i,interceptor:r,map:o,view:s}){if(!e?.length)return{};let d=yield xi(),u={};for(let m of e)u[`expression/${m.name}`]=Ei({expressionInfo:m,arcadeUtils:d,interceptor:r,spatialReference:t,map:o,graphic:i,view:s});let p=yield ge(u),h={};for(let m in p)h[m]=Us(p[m].value);return h})}var Ys=1,ie=class extends j{constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.view=null,this._cancelQuery=()=>{let{_abortController:t}=this;t&&t.abort(),this._abortController=null},this._createVM=()=>{let t=this.contentElement?.type;this.contentElementViewModel?.destroy();let i=t==="fields"?new He:t==="media"?new be:t==="text"?new qe:null;this._set("contentElementViewModel",i)},this._compile=()=>f(this,null,function*(){this._cancelQuery();let t=new AbortController;this._abortController=t,yield this._compileExpression(),this._abortController===t&&(this._abortController=null)}),this._compileThrottled=De(this._compile,Ys,this),this._compileExpression=()=>f(this,null,function*(){let{expressionInfo:t,graphic:i,interceptor:r,spatialReference:o,map:s,view:l,_abortController:d}=this;if(!(t&&i&&o&&s))return void this._set("contentElement",null);let u=yield xi();if(d!==this._abortController)return;let p=yield Ei({arcadeUtils:u,expressionInfo:t,graphic:i,interceptor:r,map:s,spatialReference:o,view:l});if(!p||p.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);let h=yield p.castAsJsonAsync(d?.signal),m=h?.type,y=m==="media"?gr.fromJSON(h):m==="text"?Rt.fromJSON(h):m==="fields"?mr.fromJSON(h):null;this._set("contentElement",y)}),this.addHandles([g(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),P),g(()=>[this.contentElement],()=>this._createVM(),P)])}initialize(){this.addHandles(this._compileThrottled)}destroy(){this._cancelQuery(),this.contentElementViewModel?.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(e){this._override("spatialReference",e)}get state(){let{_abortController:e,contentElement:t,contentElementViewModel:i}=this;return e?"loading":t||i?"ready":"disabled"}get map(){return this.view?.map??null}set map(e){this._override("map",e)}};n([a()],ie.prototype,"_abortController",void 0),n([a({type:hr})],ie.prototype,"expressionInfo",void 0),n([a({type:ae})],ie.prototype,"graphic",void 0),n([a({readOnly:!0})],ie.prototype,"contentElement",void 0),n([a({readOnly:!0})],ie.prototype,"contentElementViewModel",void 0),n([a()],ie.prototype,"interceptor",void 0),n([a()],ie.prototype,"spatialReference",null),n([a({readOnly:!0})],ie.prototype,"state",null),n([a()],ie.prototype,"map",null),n([a()],ie.prototype,"view",void 0),ie=n([w("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],ie);var ut=ie;var Ti="esri-feature",Li={base:`${Ti}-expression`,loadingSpinnerContainer:`${Ti}__loading-container`,spinner:`${Ti}__loading-spinner`},Gt=class extends N{constructor(e,t){super(e,t),this._contentWidget=null,this.viewModel=new ut}initialize(){this.addHandles(g(()=>this.viewModel?.contentElementViewModel,()=>this._setupExpressionWidget(),P))}destroy(){this._destroyContentWidget()}render(){let{state:e}=this.viewModel;return c("div",{class:Li.base},e==="loading"?this._renderLoading():e==="disabled"?null:this._contentWidget?.render())}_renderLoading(){return c("div",{class:Li.loadingSpinnerContainer,key:"loading-container"},c("span",{class:this.classes(Q.loadingIndicator,F.rotating,Li.spinner)}))}_destroyContentWidget(){let{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){let{contentElementViewModel:e,contentElement:t}=this.viewModel,i=t?.type;this._destroyContentWidget();let r=e?i==="fields"?new jt({viewModel:e}):i==="media"?new Qt({viewModel:e}):i==="text"?new Je({viewModel:e}):null:null;this._contentWidget=r,this.scheduleRender()}};n([a({type:ut})],Gt.prototype,"viewModel",void 0),Gt=n([w("esri.widgets.Feature.FeatureExpression")],Gt);var go=Gt;var yo;(function(e){e.TOO_SHORT="length-validation-error::too-short"})(yo||(yo={}));var vo=e=>{let t=[];if(e.formTemplate){let{description:i,title:r}=e.formTemplate;e.fields?.forEach(o=>{let s=r&&ri(r,o.name),l=i&&ri(i,o.name);(s||l)&&t.push(o.name)})}return t};var ki=100,S=class extends cr(Et(j)){constructor(e){super(e),this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{let{_queryAbortController:t}=this;t&&t.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{let{_queryFeatureCountAbortController:t}=this;t&&t.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{let{_queryPageAbortController:t}=this;t&&t.abort(),this._queryPageAbortController=null},this._queryController=()=>f(this,null,function*(){this._cancelQuery();let t=new AbortController;this._queryAbortController=t,yield wt(this._query()),this._queryAbortController===t&&(this._queryAbortController=null)}),this._queryFeatureCountController=()=>f(this,null,function*(){this._loaded=!1,this._cancelQueryFeatureCount();let t=new AbortController;this._queryFeatureCountAbortController=t,yield wt(this._queryFeatureCount()),this._queryFeatureCountAbortController===t&&(this._queryFeatureCountAbortController=null),this._loaded=!0}),this._queryPageController=()=>f(this,null,function*(){let t=new AbortController;this._queryPageAbortController=t,yield wt(this._queryPage()),this._queryPageAbortController===t&&(this._queryPageAbortController=null)}),this._queryDebounced=Ft(this._queryController,ki),this._queryFeatureCountDebounced=Ft(this._queryFeatureCountController,ki),this._queryPageDebounced=Ft(this._queryPageController,ki),this._query=()=>f(this,null,function*(){let{_queryAbortController:t,relatedFeatures:i}=this;this.featureCount&&(this._destroyRelatedFeatureViewModels(),this.featurePage=1,i.removeAll(),this.destroyed||i.addMany(this._sliceFeatures(yield this._queryRelatedFeatures({signal:t?.signal}))))}),this.addHandles([g(()=>[this.displayCount,this.graphic,this.layer,this.layer?.loaded,this.map,this.orderByFields,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount],()=>this._queryDebounced(),P),g(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageDebounced()),g(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery],()=>this._queryFeatureCountDebounced())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.removeAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(e){let{featuresPerPage:t,featureCount:i}=this,r=1,o=Math.ceil(i/t)||1;this._set("featurePage",Math.min(Math.max(e,r),o))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){let{orderByFields:e,relatedLayer:t}=this;return e&&t?.loaded?e.map(i=>{let r=i.clone();return r.field=Be(i.field,t),r}):e??[]}get supportsCacheHint(){return!!this.layer?.capabilities?.queryRelated?.supportsCacheHint}get canLoad(){return!!this.map&&typeof this.relationshipId=="number"&&typeof this.objectId=="number"}get canQuery(){let e=this.layer?.capabilities?.queryRelated;return!!(this.relatedLayer&&this.relationship&&typeof this.relationshipId=="number"&&typeof this.objectId=="number"&&e?.supportsCount&&e?.supportsPagination)}get itemDescriptionFieldName(){return this.orderByFieldsFixedCasing[0]?.field||null}set displayCount(e){this._set("displayCount",Math.min(Math.max(e,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){return(this.objectIdField&&this.graphic?.attributes?.[this.objectIdField])??null}get objectIdField(){return this.layer?.objectIdField||null}get relatedFeatures(){return this._get("relatedFeatures")||new ye}get relatedLayer(){let{layer:e,map:t,relationship:i}=this;return e?.loaded&&t&&i?Qr(t,e,i)??null:null}get relationship(){let{relationshipId:e,layer:t}=this;return typeof e=="number"?t?.relationships?.find(({id:i})=>i===e)??null:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new ye}get state(){let{_queryAbortController:e,_queryFeatureCountAbortController:t,_queryPageAbortController:i,canQuery:r,_loaded:o,canLoad:s}=this;return t||s&&!o?"loading":e||i?"querying":r?"ready":"disabled"}getRelatedFeatureByObjectId(e){return this.relatedFeatures.find(t=>t.getObjectId()===e)}_destroyRelatedFeatureViewModels(){this.relatedFeatureViewModels?.forEach(e=>!e.destroyed&&e.destroy()),this.relatedFeatureViewModels.removeAll()}_queryFeatureCount(){return f(this,null,function*(){let{layer:e,relatedLayer:t,relationshipId:i,objectId:r,_queryFeatureCountAbortController:o,canQuery:s,supportsCacheHint:l}=this;if(yield e?.load(),yield t?.load(),!s||!e||!t)return void this._set("featureCount",0);let d=t.createQuery(),u=new st({cacheHint:l,relationshipId:i,returnGeometry:!1,objectIds:[r],where:d.where??void 0}),p=yield e.queryRelatedFeaturesCount(u,{signal:o?.signal});this._set("featureCount",p[r]||0)})}_sliceFeatures(e){let{showAllEnabled:t,displayCount:i}=this;return t?e:i?e.slice(0,i):[]}_queryPage(){return f(this,null,function*(){let{relatedFeatures:e,featurePage:t,showAllEnabled:i,_queryPageAbortController:r,featureCount:o}=this;!i||t<2||!o||e.addMany(yield this._queryRelatedFeatures({signal:r?.signal}))})}_queryRelatedFeatures(e){return f(this,null,function*(){let{orderByFieldsFixedCasing:t,showAllEnabled:i,featuresPerPage:r,displayCount:o,layer:s,relationshipId:l,featurePage:d,featureCount:u,relatedLayer:p,supportsCacheHint:h}=this,{canQuery:m,objectId:y}=this;if(!m||!s||!p)return[];let b=i?((d-1)*r+u)%u:0,_=i?r:o,x=p.objectIdField,T=[...t.map(ce=>ce.field),...vo(p),x].filter(me),C=t.map(ce=>`${ce.field} ${ce.order}`),R=p.createQuery(),I=new st({orderByFields:C,start:b,num:_,outFields:T,cacheHint:h,relationshipId:l,returnGeometry:!1,objectIds:[y],where:R.where??void 0}),xe=yield s.queryRelatedFeatures(I,{signal:e?.signal}),Ne=xe[y]?.features||[];return Ne.forEach(ce=>{ce.sourceLayer=p,ce.layer=p}),Ne})}};n([a()],S.prototype,"_loaded",void 0),n([a()],S.prototype,"_queryAbortController",void 0),n([a()],S.prototype,"_queryPageAbortController",void 0),n([a()],S.prototype,"_queryFeatureCountAbortController",void 0),n([a({value:1})],S.prototype,"featurePage",null),n([a()],S.prototype,"featuresPerPage",void 0),n([a({readOnly:!0})],S.prototype,"orderByFieldsFixedCasing",null),n([a({readOnly:!0})],S.prototype,"supportsCacheHint",null),n([a({readOnly:!0})],S.prototype,"canLoad",null),n([a({readOnly:!0})],S.prototype,"canQuery",null),n([a()],S.prototype,"description",void 0),n([a({readOnly:!0})],S.prototype,"itemDescriptionFieldName",null),n([a({value:3})],S.prototype,"displayCount",null),n([a({type:ae})],S.prototype,"graphic",void 0),n([a()],S.prototype,"layer",void 0),n([a()],S.prototype,"map",void 0),n([a({readOnly:!0})],S.prototype,"objectId",null),n([a({readOnly:!0})],S.prototype,"objectIdField",null),n([a()],S.prototype,"orderByFields",void 0),n([a({readOnly:!0})],S.prototype,"relatedFeatures",null),n([a({readOnly:!0})],S.prototype,"relatedLayer",null),n([a({readOnly:!0})],S.prototype,"relationship",null),n([a()],S.prototype,"featureCount",void 0),n([a({readOnly:!0})],S.prototype,"relatedFeatureViewModels",null),n([a()],S.prototype,"relationshipId",void 0),n([a()],S.prototype,"showAllEnabled",void 0),n([a()],S.prototype,"state",null),n([a()],S.prototype,"title",void 0),n([a()],S.prototype,"getRelatedFeatureByObjectId",null),S=n([w("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],S);var pt=S;var mt="esri-feature",ht=`${mt}-relationship`,Me={base:ht,listContainer:`${ht}__list`,listItem:`${ht}__list-item`,listItemHidden:`${ht}__list-item--hidden`,listContainerQuerying:`${ht}__list--querying`,featureObserver:`${mt}__feature-observer`,stickySpinnerContainer:`${mt}__sticky-loading-container`,loadingSpinnerContainer:`${mt}__loading-container`,spinner:`${mt}__loading-spinner`},bo={title:!0,description:!0},J=class extends N{constructor(e,t){super(e,t),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([i])=>{i?.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.headingLevel=2,this.viewModel=new pt,this.messages=null,this.messagesCommon=null,this.visibleElements=v({},bo),this._increaseFeaturePage=()=>{let{state:i,showAllEnabled:r,relatedFeatures:o,featuresPerPage:s,featurePage:l}=this.viewModel;i==="ready"&&r&&o.length>=s*l&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new Le,this.addHandles([g(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),P),g(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),re(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return ne({icon:()=>import("./chunk-QKBODARO.js"),list:()=>import("./chunk-5ENHBRFJ.js"),"list-item":()=>import("./chunk-GHCHJZTH.js"),notice:()=>import("./chunk-6GINYR3K.js")})}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=Ui(this._featureElementInfo)}get displayShowAllButton(){let{showAllEnabled:e,featureCount:t,displayCount:i,state:r}=this.viewModel;return!e&&!!t&&r==="ready"&&(t>i||i===0)}get displayListItems(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get featureCountDescription(){let{messages:e}=this,{featureCount:t}=this.viewModel;return X(e?.numberRecords,{number:t})}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}castVisibleElements(e){return v(v({},bo),e)}render(){let{state:e}=this.viewModel;return c("div",{class:this.classes(Me.base,F.widget)},this._featureElementInfo?.render(),e==="loading"?this._renderLoading():e==="disabled"?this._renderRelationshipNotFound():this._renderRelatedFeatures())}_renderStickyLoading(){return this.viewModel.state==="querying"?c("div",{class:Me.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoadingIcon(){return c("span",{class:this.classes(Q.loadingIndicator,F.rotating,Me.spinner)})}_renderLoading(){return c("div",{class:Me.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}_renderShowAllIconNode(){return c("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})}_renderChevronIconNode(){let e=se(this.container)?"chevron-left":"chevron-right";return c("calcite-icon",{icon:e,scale:"s",slot:"content-end"})}_renderRelatedFeature(e){let{itemDescriptionFieldName:t}=this.viewModel,i=e.title;e.description=t&&e.formattedAttributes?.global[t];let r=e.state==="loading";return c("calcite-list-item",{class:this.classes(Me.listItem,{[Me.listItemHidden]:r}),description:e.description??"",key:e.uid,label:i,onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:e})},this._renderChevronIconNode())}_renderShowAllListItem(){return this.displayShowAllButton?c("calcite-list-item",{description:this.featureCountDescription,key:"show-all-item",label:this.messages?.showAll,onCalciteListItemSelect:()=>this.emit("show-all-records")},this._renderShowAllIconNode()):null}_renderNoRelatedFeaturesMessage(){return c("calcite-notice",{icon:"information",key:"no-related-features-message",kind:"brand",open:!0,scale:"s",width:"full"},c("div",{slot:"message"},this.messages?.noRelatedFeatures))}_renderFeatureObserver(){return c("div",{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:Me.featureObserver,key:"feature-observer"})}_renderList(){let{relatedFeatureViewModels:e}=this.viewModel;return c("calcite-list",null,e.toArray().map(t=>this._renderRelatedFeature(t)),this._renderShowAllListItem())}_renderRelatedFeatures(){let{displayListItems:e}=this,{state:t}=this.viewModel;return c("div",{class:this.classes(Me.listContainer,{[Me.listContainerQuerying]:t==="querying"}),key:"list-container"},e?this._renderList():t==="ready"?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}_renderRelationshipNotFound(){return c("calcite-notice",{icon:"exclamation-mark-triangle",key:"relationship-not-found",kind:"danger",open:!0,scale:"s",width:"full"},c("div",{slot:"message"},this.messages?.relationshipNotFound))}_setupRelatedFeatureViewModels(){let{relatedFeatureViewModels:e}=this.viewModel,t="related-feature-viewmodels";this.removeHandles(t),e?.forEach(i=>{this.addHandles(g(()=>[i.title,i.state],()=>this.scheduleRender(),P),t)}),this.scheduleRender()}_setupFeatureElementInfo(){let{headingLevel:e,visibleElements:t}=this,i=t.description&&this.description,r=t.title&&this.title;this._featureElementInfo?.set({description:i,title:r,headingLevel:e})}_handleRelatedFeatureObserverChange(){return f(this,null,function*(){this._unobserveRelatedFeatureObserver();let{state:e,showAllEnabled:t}=this.viewModel;yield _t(0),this._relatedFeatureIntersectionObserverNode&&e==="ready"&&t&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)})}_relatedFeatureIntersectionObserverCreated(e){this._relatedFeatureIntersectionObserverNode=e}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};n([a()],J.prototype,"_relatedFeatureIntersectionObserverNode",void 0),n([a({readOnly:!0})],J.prototype,"displayShowAllButton",null),n([a({readOnly:!0})],J.prototype,"displayListItems",null),n([a()],J.prototype,"description",null),n([a({readOnly:!0})],J.prototype,"featureCountDescription",null),n([a()],J.prototype,"headingLevel",void 0),n([a()],J.prototype,"title",null),n([a({type:pt})],J.prototype,"viewModel",void 0),n([a(),B("esri/widgets/Feature/t9n/Feature")],J.prototype,"messages",void 0),n([a(),B("esri/t9n/common")],J.prototype,"messagesCommon",void 0),n([a()],J.prototype,"visibleElements",void 0),n([oe("visibleElements")],J.prototype,"castVisibleElements",null),J=n([w("esri.widgets.Feature.FeatureRelationship")],J);var Ri=J;var Zt=class{constructor(t,i){this.preLayerQueryCallback=t,this.preRequestCallback=i,this.preLayerQueryCallback||(this.preLayerQueryCallback=r=>{}),this.preRequestCallback||(this.preLayerQueryCallback=r=>{})}};var ft,Ks=1,wo="content-view-models",_o="relationship-view-models",Fo={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0},$=ft=class extends Et(j){constructor(e){super(e),this._error=null,this._featureAbortController=null,this._graphicChangedThrottled=De(this._graphicChanged,Ks,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities=v({},Fo),this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=t=>{let{abilities:i}=this;return t.type==="attachments"&&!!i.attachmentsContent||t.type==="custom"&&!!i.customContent||t.type==="fields"&&!!i.fieldsContent||t.type==="media"&&!!i.mediaContent||t.type==="text"&&!!i.textContent||t.type==="expression"&&!!i.expressionContent||t.type==="relationship"&&!!i.relationshipContent},this.addHandles(g(()=>[this.graphic,this._effectivePopupTemplate,this.abilities],()=>this._graphicChangedThrottled(),P))}initialize(){this.addHandles(this._graphicChangedThrottled)}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return this.graphic!=null?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return qr(yi(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return Vt(this.graphic)}castAbilities(e){return v(v({},Fo),e)}get isTable(){return this._sourceLayer?.isTable||!1}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(e){this._set("graphic",e?e.clone():null)}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(e){this._override("spatialReference",e)}get map(){return this.view?.map||null}set map(e){this._override("map",e)}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(e,t){let i=this.contentViewModels[e];i instanceof be&&i.setActiveMedia(t)}nextMedia(e){let t=this.contentViewModels[e];t instanceof be&&t.next()}previousMedia(e){let t=this.contentViewModels[e];t instanceof be&&t.previous()}updateGeometry(){return f(this,null,function*(){let{graphic:e,spatialReference:t,_sourceLayer:i}=this;yield i?.load();let r=i?.objectIdField;if(!r||!e||!i)return;let o=e?.attributes?.[r];if(o==null)return;let s=[o];if(!e.geometry){let l=yield vi({layer:i,graphic:e,outFields:[],objectIds:s,returnGeometry:!0,spatialReference:t}),d=l?.geometry;d&&(e.geometry=d)}})}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}_graphicChanged(){return f(this,null,function*(){this._cancelFeatureQuery(),this._error=null,this._clear();let{graphic:e}=this;if(!e)return;let t=new AbortController;this._featureAbortController=t;try{yield this._queryFeature({signal:t.signal})}catch(i){Gi(i)||(this._error=i,D.getLogger(this).error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:e,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===t&&(this._featureAbortController=null)})}_cancelFeatureQuery(){let{_featureAbortController:e}=this;e&&e.abort(),this._featureAbortController=null}_compileContentElement(e,t){return e.type==="attachments"?this._compileAttachments(e,t):e.type==="custom"?this._compileCustom(e,t):e.type==="fields"?this._compileFields(e,t):e.type==="media"?this._compileMedia(e,t):e.type==="text"?this._compileText(e,t):e.type==="expression"?this._compileExpression(e,t):e.type==="relationship"?this._compileRelationship(e,t):void 0}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map((t,i)=>this._compileContentElement(t,i)).filter(me):typeof e=="string"?this._compileText(new Rt({text:e}),0).text:e}_destroyContentViewModels(){this.removeHandles(_o),this.removeHandles(wo),this.contentViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("contentViewModels",[])}_matchesFeature(e,t){let i=e?.graphic?.getObjectId(),r=t?.getObjectId();return i!=null&&r!=null&&i===r}_setRelatedFeaturesViewModels({relatedFeatureViewModels:e,relatedFeatures:t,map:i}){let{view:r,spatialReference:o}=this;t?.filter(Boolean).forEach(s=>{e.find(l=>this._matchesFeature(l,s))||e.add(new ft({abilities:{relationshipContent:!1},map:i,view:r,spatialReference:o,graphic:s}))}),e.forEach(s=>{t?.find(d=>this._matchesFeature(s,d))||e.remove(s)})}_setExpressionContentVM(e,t){let i=this.formattedAttributes,{contentElement:r,contentElementViewModel:o}=e,s=r?.type;o&&s&&(s==="fields"&&(this._createFieldsFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),o.set(this._createFieldsVMParams(r,t))),s==="media"&&(this._createMediaFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),o.set(this._createMediaVMParams(r,t))),s==="text"&&o.set(this._createTextVMParams(r)))}_compileRelationship(e,t){let{displayCount:i,orderByFields:r,relationshipId:o,title:s,description:l}=e,{_sourceLayer:d,graphic:u,map:p}=this;if(!fi(d))return;let h=new pt(v({displayCount:i,graphic:u,orderByFields:r,relationshipId:o,layer:d,map:p},this._compileTitleAndDesc({title:s,description:l})));return this.contentViewModels[t]=h,this.addHandles(re(()=>h.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(h)),_o),e}_compileExpression(e,t){let{expressionInfo:i}=e,{graphic:r,map:o,spatialReference:s,view:l}=this,d=new ut({expressionInfo:i,graphic:r,interceptor:ft.interceptor,map:o,spatialReference:s,view:l});return this.contentViewModels[t]=d,this.addHandles(g(()=>d.contentElementViewModel,()=>this._setExpressionContentVM(d,t),P),wo),e}_compileAttachments(e,t){let{graphic:i}=this,{description:r,title:o}=e;return this.contentViewModels[t]=new dt(v({graphic:i},this._compileTitleAndDesc({title:o,description:r}))),e}_compileCustom(e,t){let{graphic:i}=this,{creator:r,destroyer:o}=e;return this.contentViewModels[t]=new qe({graphic:i,creator:r,destroyer:o}),e}_compileTitleAndDesc({title:e,description:t}){let{_fieldInfoMap:i,_sourceLayer:r,graphic:o,formattedAttributes:s}=this,l=o?.attributes,d=this._expressionAttributes,u=s.global;return{title:_e({attributes:l,fieldInfoMap:i,globalAttributes:u,expressionAttributes:d,layer:r,text:e}),description:_e({attributes:l,fieldInfoMap:i,globalAttributes:u,expressionAttributes:d,layer:r,text:t})}}_createFieldsVMParams(e,t){let i=this._effectivePopupTemplate,r=this.formattedAttributes,o=v(v({},r?.global),r?.content[t]),s=e?.fieldInfos||i?.fieldInfos,l=s?.filter(({fieldName:h})=>nt(h)||le(h)||o.hasOwnProperty(h)),d=i?.expressionInfos,{description:u,title:p}=e;return v({attributes:o,expressionInfos:d,fieldInfos:l},this._compileTitleAndDesc({title:p,description:u}))}_compileFields(e,t){let i=e.clone(),r=new He(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=r,i.fieldInfos=r.formattedFieldInfos.slice(0),i}_createMediaVMParams(e,t){let{abilities:i,graphic:r,_fieldInfoMap:o,_effectivePopupTemplate:s,relatedInfos:l,_sourceLayer:d,_expressionAttributes:u}=this,p=this.formattedAttributes,h=r?.attributes??{},{description:m,mediaInfos:y,title:b}=e;return v({abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:h,isAggregate:r?.isAggregate,layer:d,fieldInfoMap:o,formattedAttributes:v(v({},p?.global),p?.content[t]),expressionAttributes:u,mediaInfos:y,popupTemplate:s,relatedInfos:l},this._compileTitleAndDesc({title:b,description:m}))}_compileMedia(e,t){let i=e.clone(),r=new be(this._createMediaVMParams(e,t));return i.mediaInfos=r.formattedMediaInfos.slice(0),this.contentViewModels[t]=r,i}_createTextVMParams(e){let{graphic:t,_fieldInfoMap:i,_sourceLayer:r,_expressionAttributes:o}=this;if(e&&e.text){let s=t?.attributes??{},l=this.formattedAttributes?.global??{};e.text=_e({attributes:s,fieldInfoMap:i,globalAttributes:l,expressionAttributes:o,layer:r,text:e.text})}return{graphic:t,creator:e.text}}_compileText(e,t){let i=e.clone();return this.contentViewModels[t]=new qe(this._createTextVMParams(i)),i}_compileLastEditInfo(){let{_effectivePopupTemplate:e,_sourceLayer:t,graphic:i,view:r}=this;if(!e)return;let{lastEditInfoEnabled:o}=e,s=t?.editFieldsInfo;return o&&s?Br(s,i?.attributes,r?.timeZone??rt,t):void 0}_compileTitle(e){let{_fieldInfoMap:t,_sourceLayer:i,graphic:r,_expressionAttributes:o}=this,s=r?.attributes??{},l=this.formattedAttributes?.global??{};return _e({attributes:s,fieldInfoMap:t,globalAttributes:l,expressionAttributes:o,layer:i,text:e})}_getTitle(){return f(this,null,function*(){let{_effectivePopupTemplate:e,graphic:t}=this;if(!t)return null;let i=e?.title;return Ze(i,{graphic:t})})}_getContent(){return f(this,null,function*(){let{_effectivePopupTemplate:e,graphic:t}=this;if(!t)return null;let i=e?.content;return Ze(i,{graphic:t})})}_queryFeature(e){return f(this,null,function*(){let{_featureAbortController:t,_sourceLayer:i,graphic:r,_effectivePopupTemplate:o}=this,s=this.map,l=this.view,d=this.spatialReference;if(t!==this._featureAbortController||!r)return;yield zr({graphic:r,popupTemplate:o,layer:i,spatialReference:d},e);let{content:{value:u},title:{value:p}}=yield ge({content:this._getContent(),title:this._getTitle()}),{expressionAttributes:{value:h}}=yield ge({checkForRelatedFeatures:this._checkForRelatedFeatures(e),expressionAttributes:fo({expressionInfos:o?.expressionInfos,spatialReference:d,graphic:r,map:s,interceptor:ft.interceptor,view:l})});t===this._featureAbortController&&r&&(this._expressionAttributes=h,this._graphicExpressionAttributes=v(v({},r.attributes),h),this._set("formattedAttributes",this._createFormattedAttributes(u)),this._set("title",this._compileTitle(p)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(u)||null))})}_createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){let{_effectivePopupTemplate:r,graphic:o,relatedInfos:s,_sourceLayer:l,_fieldInfoMap:d,_graphicExpressionAttributes:u}=this;i.content[t]=zt({fieldInfos:r?.fieldInfos,graphic:o,attributes:v(v({},u),e.attributes),layer:l,fieldInfoMap:d,relatedInfos:s,timeZone:this.view?.timeZone??rt})}_createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){if(e.fieldInfos){let{graphic:r,relatedInfos:o,_sourceLayer:s,_fieldInfoMap:l,_graphicExpressionAttributes:d}=this;i.content[t]=zt({fieldInfos:e.fieldInfos,graphic:r,attributes:v(v({},d),e.attributes),layer:s,fieldInfoMap:l,relatedInfos:o,timeZone:this.view?.timeZone??rt})}}_createFormattedAttributes(e){let{_effectivePopupTemplate:t,graphic:i,relatedInfos:r,_sourceLayer:o,_fieldInfoMap:s,_graphicExpressionAttributes:l}=this,d=t?.fieldInfos,u={global:zt({fieldInfos:d,graphic:i,attributes:l,layer:o,fieldInfoMap:s,relatedInfos:r,timeZone:this.view?.timeZone??rt}),content:[]};return Array.isArray(e)&&e.forEach((p,h)=>{p.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:p,contentElementIndex:h,formattedAttributes:u}),p.type==="media"&&this._createMediaFormattedAttributes({contentElement:p,contentElementIndex:h,formattedAttributes:u})}),u}_checkForRelatedFeatures(e){let{graphic:t,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(t,yi(i),e)}_queryRelatedInfos(e,t,i){return f(this,null,function*(){let{relatedInfos:r,_sourceLayer:o}=this;r.clear();let s=o?.associatedLayer!=null?yield o?.associatedLayer.load(i):o;if(!s||!e||!t.filter(p=>p&&le(p.fieldName))?.length)return;t.forEach(p=>this._configureRelatedInfo(p,s));let d=yield uo({relatedInfos:r,layer:s},i);Object.keys(d).forEach(p=>{let h=r.get(p.toString()),m=d[p]?.value;h&&m&&(h.layerInfo=m.data)});let u=yield po({graphic:e,relatedInfos:r,layer:s},i);Object.keys(u).forEach(p=>{co(u[p]?.value,r.get(p.toString()))})})}_configureRelatedInfo(e,t){let{relatedInfos:i}=this,r=et(e.fieldName);if(!r)return;let{layerId:o,fieldName:s}=r;if(!o)return;let l=i.get(o.toString())||lo(o,t);l&&(ho({relatedInfo:l,fieldName:s,fieldInfo:e}),this.relatedInfos.set(o,l))}};$.interceptor=new Zt(Ur,jr),n([a()],$.prototype,"_error",void 0),n([a()],$.prototype,"_featureAbortController",void 0),n([a({readOnly:!0})],$.prototype,"_effectivePopupTemplate",null),n([a({readOnly:!0})],$.prototype,"_fieldInfoMap",null),n([a({readOnly:!0})],$.prototype,"_sourceLayer",null),n([a()],$.prototype,"abilities",void 0),n([oe("abilities")],$.prototype,"castAbilities",null),n([a({readOnly:!0})],$.prototype,"content",void 0),n([a({readOnly:!0})],$.prototype,"contentViewModels",void 0),n([a()],$.prototype,"description",void 0),n([a({type:Boolean})],$.prototype,"defaultPopupTemplateEnabled",void 0),n([a({readOnly:!0})],$.prototype,"isTable",null),n([a({readOnly:!0})],$.prototype,"state",null),n([a({readOnly:!0})],$.prototype,"formattedAttributes",void 0),n([a({type:ae,value:null})],$.prototype,"graphic",null),n([a({readOnly:!0})],$.prototype,"lastEditInfo",void 0),n([a({readOnly:!0})],$.prototype,"relatedInfos",void 0),n([a()],$.prototype,"spatialReference",null),n([a({readOnly:!0})],$.prototype,"title",void 0),n([a()],$.prototype,"map",null),n([a({readOnly:!0})],$.prototype,"waitingForContent",null),n([a()],$.prototype,"view",void 0),$=ft=n([w("esri.widgets.FeatureViewModel")],$);var gt=$;var Xt=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=i=>Ct(i)&&!i.destroyed?c("div",{class:V.contentNode,key:i},i.render()):i instanceof HTMLElement?c("div",{afterCreate:this._attachToNode,bind:i,class:V.contentNode,key:i}):or(i)?c("div",{afterCreate:this._attachToNode,bind:i.domNode,class:V.contentNode,key:i}):null}_attachToNode(i){let r=this;i.appendChild(r)}};return t=n([w("esri.widgets.Feature.ContentMixin")],t),t};var Si,Mo={title:!0,content:!0,lastEditedInfo:!0},Io="relationship-handles",U=Si=class extends Xt(N){constructor(e,t){super(e,t),this._contentWidgets=[],this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.visibleElements=v({},Mo),this.viewModel=new gt}initialize(){this.addHandles(g(()=>this.viewModel?.contentViewModels,()=>this._setupContentWidgets(),P))}loadDependencies(){return ne({notice:()=>import("./chunk-6GINYR3K.js")})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get isTable(){return this.viewModel.isTable}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get title(){return this.viewModel.title}castVisibleElements(e){return v(v({},Mo),e)}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}setActiveMedia(e,t){return this.viewModel.setActiveMedia(e,t)}nextMedia(e){return this.viewModel.nextMedia(e)}previousMedia(e){return this.viewModel.previousMedia(e)}render(){let{state:e}=this.viewModel,t=c("div",{class:V.container,key:"container"},this._renderTitle(),e==="error"?this._renderError():e==="loading"?this._renderLoading():this._renderContentContainer());return c("div",{class:this.classes(V.base,F.widget)},t)}_renderError(){let{messagesCommon:e,messages:t,visibleElements:i}=this;return c("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0,scale:"s"},i.title?c("div",{key:"error-title",slot:"title"},e.errorMessage):null,c("div",{key:"error-message",slot:"message"},t.loadingError))}_renderLoading(){return c("div",{class:V.loadingSpinnerContainer,key:"loading-container"},c("span",{class:this.classes(Q.loadingIndicator,F.rotating,V.spinner)}))}_renderContentContainer(){let{visibleElements:e}=this;return e.content?c("div",{class:V.main},[this._renderContent(),this._renderLastEditInfo()]):null}_renderTitle(){let{visibleElements:e,title:t}=this;return e.title?c(Ge,{class:V.title,innerHTML:t,level:this.headingLevel}):null}_renderContent(){let e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?c("div",{class:V.contentNode,key:`${t}-content-elements`},e.map(this._renderContentElement,this)):null;if(typeof e=="string"){let i=this._contentWidgets[0];return!i||i.destroyed?null:c("div",{class:this.classes(V.contentNode,V.contentNodeText),key:`${t}-content`},i.render())}return this.renderNodeContent(e)}_renderContentElement(e,t){let{visibleElements:i}=this;if(typeof i.content!="boolean"&&!i.content?.[e.type])return null;switch(e.type){case"attachments":return this._renderAttachments(t);case"custom":return this._renderCustom(e,t);case"fields":return this._renderFields(t);case"media":return this._renderMedia(t);case"text":return this._renderText(e,t);case"expression":return this._renderExpression(t);case"relationship":return this._renderRelationship(t);default:return null}}_renderAttachments(e){let t=this._contentWidgets[e];if(!t||t.destroyed)return null;let{state:i,attachmentInfos:r}=t.viewModel;return i==="loading"||r.length>0?c("div",{class:this.classes(V.contentElement),key:this._buildKey("attachments-element",e)},t.render()):null}_renderRelationship(e){let t=this._contentWidgets[e];return t&&!t.destroyed&&this.flowItems?c("div",{class:V.contentElement,key:this._buildKey("relationship-element",e)},t.render()):null}_renderExpression(e){let t=this._contentWidgets[e];return!t||t.destroyed?null:c("div",{class:V.contentElement,key:this._buildKey("expression-element",e)},t.render())}_renderCustom(e,t){let{creator:i}=e,r=this._contentWidgets[t];return!r||r.destroyed?null:i?c("div",{class:V.contentElement,key:this._buildKey("custom-element",t)},r.render()):null}_renderFields(e){let t=this._contentWidgets[e];return!t||t.destroyed?null:c("div",{class:V.contentElement,key:this._buildKey("fields-element",e)},t.render())}_renderMedia(e){let t=this._contentWidgets[e];return!t||t.destroyed?null:c("div",{class:V.contentElement,key:this._buildKey("media-element",e)},t.render())}_renderLastEditInfo(){let{visibleElements:e,messages:t}=this,{lastEditInfo:i}=this.viewModel;if(!i||!e.lastEditedInfo)return null;let{date:r,user:o}=i,s=i.type==="edit"?o?t.lastEditedByUser:t.lastEdited:o?t.lastCreatedByUser:t.lastCreated,l=X(s,{date:r,user:o});return c("div",{class:this.classes(V.lastEditedInfo,V.contentElement),key:"edit-info-element"},l)}_renderText(e,t){let i=e.text,r=this._contentWidgets[t];return!r||r.destroyed?null:i?c("div",{class:this.classes(V.contentElement,V.text),key:this._buildKey("text-element",t)},r.render()):null}_buildKey(e,...t){return`${e}__${this.viewModel?.graphic?.uid||"0"}-${t.join("-")}`}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this.removeHandles(Io),this._contentWidgets.forEach(e=>this._destroyContentWidget(e)),this._contentWidgets=[]}_addFeatureRelationshipHandles(e){let{flowItems:t,visibleElements:i}=this;this.addHandles([re(()=>e,"select-record",({featureViewModel:r})=>{t&&(r.abilities={relationshipContent:!0},t.push(new Si({flowItems:t,viewModel:r,visibleElements:i})))}),re(()=>e,"show-all-records",()=>{if(!t)return;let{viewModel:r}=e;r.showAllEnabled=!0;let o=new Ri({visibleElements:{title:!1,description:!1},viewModel:r});this._addFeatureRelationshipHandles(o),t.push(o)})],Io)}_setupContentWidgets(){this._destroyContentWidgets();let{headingLevel:e,visibleElements:t}=this,i=this.viewModel?.content,{contentViewModels:r}=this.viewModel;if(Array.isArray(i))i.forEach((o,s)=>{if(o.type==="attachments"&&(this._contentWidgets[s]=new Jr({displayType:o.displayType,headingLevel:t.title?e+1:e,viewModel:r[s]})),o.type==="fields"&&(this._contentWidgets[s]=new jt({viewModel:r[s]})),o.type==="media"&&(this._contentWidgets[s]=new Qt({viewModel:r[s]})),o.type==="text"&&(this._contentWidgets[s]=new Je({viewModel:r[s]})),o.type==="custom"&&(this._contentWidgets[s]=new Je({viewModel:r[s]})),o.type==="expression"&&(this._contentWidgets[s]=new go({viewModel:r[s]})),o.type==="relationship"){let l=new Ri({viewModel:r[s]});this._addFeatureRelationshipHandles(l),this._contentWidgets[s]=l}},this);else{let o=r[0];o&&!o.destroyed&&(this._contentWidgets[0]=new Je({viewModel:o}))}this.scheduleRender()}};n([a()],U.prototype,"graphic",null),n([a()],U.prototype,"defaultPopupTemplateEnabled",null),n([a()],U.prototype,"flowItems",void 0),n([a()],U.prototype,"headingLevel",void 0),n([a({readOnly:!0})],U.prototype,"isTable",null),n([a()],U.prototype,"label",null),n([a(),B("esri/widgets/Feature/t9n/Feature")],U.prototype,"messages",void 0),n([a(),B("esri/t9n/common")],U.prototype,"messagesCommon",void 0),n([a(),B("esri/widgets/support/t9n/uriUtils")],U.prototype,"messagesURIUtils",void 0),n([a()],U.prototype,"spatialReference",null),n([a({readOnly:!0})],U.prototype,"title",null),n([a()],U.prototype,"visibleElements",void 0),n([oe("visibleElements")],U.prototype,"castVisibleElements",null),n([a()],U.prototype,"map",null),n([a()],U.prototype,"view",null),n([a({type:gt})],U.prototype,"viewModel",void 0),U=Si=n([w("esri.widgets.Feature")],U);var Ao=U;var ze=class extends Xi.EventedAccessor{constructor(e){super(e),this.location=null,this.screenLocationEnabled=!1,this.view=null,this.addHandles([Ve(()=>{let t=this.screenLocationEnabled?this.view:null;return t?[t.size,t.type==="3d"?t.camera:t.viewpoint]:null},()=>this.notifyChange("screenLocation")),g(()=>this.screenLocation,(t,i)=>{t!=null&&i!=null&&this.emit("view-change")})])}destroy(){this.view=null}get screenLocation(){let{location:e,view:t,screenLocationEnabled:i}=this;return i&&e!=null&&t!=null&&t.ready?t.toScreen(e):null}};n([a()],ze.prototype,"location",void 0),n([a()],ze.prototype,"screenLocation",null),n([a()],ze.prototype,"screenLocationEnabled",void 0),n([a()],ze.prototype,"view",void 0),ze=n([w("esri.widgets.support.AnchorElementViewModel")],ze);var Yt=ze;var Js="esri.widgets.CompassViewModel",Kt=class extends Yt{constructor(e){super(e),this.visible=!1}};n([a()],Kt.prototype,"visible",void 0),Kt=n([w(Js)],Kt);var Oi=Kt;var Pi="esri-spinner",Ni={base:Pi,spinnerStart:`${Pi}--start`,spinnerFinish:`${Pi}--finish`},We=class extends N{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.viewModel=new Oi}initialize(){this.addHandles(g(()=>this.visible,e=>this._visibleChange(e)))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}show(e){let{location:t,promise:i}=e??{};t&&(this.viewModel.location=t),this.visible=!0;let r=()=>this.hide();i&&i.catch(()=>{}).then(r)}hide(){this.visible=!1}render(){let{visible:e}=this,{screenLocation:t}=this.viewModel,i=!!t,r=e&&i,o=!e&&i,s={[Ni.spinnerStart]:r,[Ni.spinnerFinish]:o},l=this._getPositionStyles();return c("div",{class:this.classes(Ni.base,s),styles:l})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);let t=_t(this._animationDelay);this._animationPromise=t,t.catch(()=>{}).then(()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){let{screenLocation:e,view:t}=this.viewModel;if(t==null||e==null)return{};let{padding:i}=t;return{left:e.x-i.left+"px",top:e.y-i.top+"px"}}};n([a()],We.prototype,"location",null),n([a()],We.prototype,"view",null),n([a({type:Oi})],We.prototype,"viewModel",void 0),n([a()],We.prototype,"visible",null),We=n([w("esri.widgets.Spinner")],We);var Co=We;var Z="esri-features",W={icon:`${Z}__icon`,actionImage:`${Z}__action-image`,base:Z,container:`${Z}__container`,contentContainer:`${Z}__content-container`,contentFeature:`${Z}__content-feature`,flowItemCollapsed:`${Z}__flow-item--collapsed`,header:`${Z}__header`,footer:`${Z}__footer`,featureMenuObserver:`${Z}__feature-menu-observer`,actionExit:`${Z}__action--exit`,loader:`${Z}__loader`,featuresHeading:`${Z}__heading`,paginationActionBar:`${Z}__pagination-action-bar`,paginationPrevious:`${Z}__pagination-previous`,paginationNext:`${Z}__pagination-next`};var Ue=class extends N{constructor(e,t){super(e,t),this.messages=null,this.closed=!1,this.closable=!0,this._handleOpenRelatedFeature=i=>{this.emit("open-related-feature",{feature:i})}}loadDependencies(){return ne({action:()=>import("./chunk-J4TE2HGY.js"),"flow-item":()=>import("./chunk-BC7M36VS.js")})}render(){let{flowItems:e}=this,t=e?.toArray();return c(ir,null,t?.map(i=>this._renderRelatedRecordsFlowItem(i)))}_handleCloseClick(){this.emit("close")}_handleExitClick(){this.emit("exit")}_handleRelatedRecordsBackClick(){let e=this.flowItems?.pop();e&&("showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e&&(e.viewModel=null,e.destroy()))}_renderRelatedRecordsFlowItem(e){let{messages:t,closable:i,closed:r}=this,o="graphic"in e&&!e.isTable;return c("calcite-flow-item",{bind:this,closable:i,closed:r,description:this._getRelatedRecordsFlowItemDescription(e),heading:e.title??"",key:`flow-item-${e.viewModel.uid}`,onCalciteFlowItemBack:this._handleRelatedRecordsBackClick,onCalciteFlowItemClose:this._handleCloseClick},c("calcite-action",{appearance:"transparent",bind:this,class:W.actionExit,icon:"move-up",key:"exit-related-records-action",label:t.exitRelatedRecords,onclick:this._handleExitClick,scale:"m",slot:"header-actions-start",text:t.exitRelatedRecords,title:t.exitRelatedRecords}),o?c("calcite-action",{appearance:"transparent",bind:this,icon:"zoom-to-object",key:"open-related-feature-action",label:t.selectFeature,onclick:()=>this._handleOpenRelatedFeature(e),scale:"m",slot:"header-actions-end",text:t.selectFeature,title:t.selectFeature}):null,c("div",{class:W.container},e.render()))}_getRelatedRecordsFlowItemDescription(e){return"featureCountDescription"in e?e.featureCountDescription:e.viewModel.description??""}};n([a()],Ue.prototype,"flowItems",void 0),n([a(),B("esri/widgets/Features/t9n/Features")],Ue.prototype,"messages",void 0),n([a()],Ue.prototype,"closed",void 0),n([a()],Ue.prototype,"closable",void 0),Ue=n([w("esri.widgets.Features.FeaturesRelatedRecords")],Ue);var xo=Ue;var Jt=class{constructor(){this._set=new Set,this._observable=new Yi}get size(){return Ee(this._observable),this._set.size}add(t){let i=this._set.size;return this._set.add(t),this._set.size!==i&&this._observable.notify(),this}clear(){this._set.size>0&&(this._set.clear(),this._observable.notify())}delete(t){let i=this._set.delete(t);return i&&this._observable.notify(),i}entries(){return Ee(this._observable),this._set.entries()}forEach(t,i){Ee(this._observable),this._set.forEach((r,o)=>t.call(i,r,o,this),i)}has(t){return Ee(this._observable),this._set.has(t)}keys(){return Ee(this._observable),this._set.keys()}values(){return Ee(this._observable),this._set.values()}[Symbol.iterator](){return Ee(this._observable),this._set[Symbol.iterator]()}get[Symbol.toStringTag](){return this._set[Symbol.toStringTag]}};var Eo="OBJECTID";var To="esri-relationship-ramp",tt=`${To}--diamond`,Se=`${To}--square`;var Uf={diamondContainer:`${tt}__container`,diamondLeftCol:`${tt}__left-column`,diamondRightCol:`${tt}__right-column`,diamondMidCol:`${tt}__middle-column`,diamondMidColLabel:`${tt}__middle-column--label`,diamondMidColRamp:`${tt}__middle-column--ramp`,squareTable:`${Se}__table`,squareTableRow:`${Se}__table-row`,squareTableCell:`${Se}__table-cell`,squareTableLabel:`${Se}__table-label`,squareTableLabelLeftBottom:`${Se}__table-label--left-bottom`,squareTableLabelRightBottom:`${Se}__table-label--right-bottom`,squareTableLabelLeftTop:`${Se}__table-label--left-top`,squareTableLabelRightTop:`${Se}__table-label--right-top`};function Lo(e){return e&&"opacity"in e?e.opacity*Lo(e.parent):1}function ko(e,t){return f(this,null,function*(){if(!e)return;let i=e.sourceLayer,r=(t!=null&&t.useSourceLayer?i:e.layer)??i,o=Lo(r);if(e.symbol!=null&&(t==null||t.ignoreGraphicSymbol!==!0)){let I=e.symbol.type==="web-style"?yield Cr(e.symbol,he(v({},t),{cache:t!=null?t.webStyleCache:null})):e.symbol.clone();return Nt(I,null,o),I}let s=(t!=null?t.renderer:null)??(r&&"renderer"in r?r.renderer:null),l=s&&"getSymbolAsync"in s?yield s.getSymbolAsync(e,t):null;if(!l)return;if(l=l.type==="web-style"?yield l.fetchSymbol(he(v({},t),{cache:t!=null?t.webStyleCache:null})):l.clone(),!s||!("visualVariables"in s)||!s.visualVariables?.length)return Nt(l,null,o),l;if("arcadeRequiredForVisualVariables"in s&&s.arcadeRequiredForVisualVariables&&t?.arcade==null){let I=v({},t);I.arcade=yield Ot(),t=I}let{getColor:d,getOpacity:u,getAllSizes:p,getRotationAngle:h}=yield import("./chunk-FXZLSSDR.js"),m=[],y=[],b=[],_=[];for(let I of s.visualVariables)switch(I.type){case"color":m.push(I);break;case"opacity":y.push(I);break;case"rotation":_.push(I);break;case"size":I.target||b.push(I)}let x=!!m.length&&m[m.length-1],T=x?d(x,e,t):null,C=!!y.length&&y[y.length-1],R=C?u(C,e,t):null;if(o!=null&&(R=R!=null?R*o:o),Nt(l,T,R),b.length){let I=p(b,e,t);yield Ir(l,I)}for(let I of _)Ar(l,h(I,e,t),I.axis);return l})}function Vi(e){return e&&typeof e.highlight=="function"}var Ie=ye.ofType({key:"type",defaultKeyValue:"button",base:vr,typeMap:{button:$e,toggle:di}}),Ae=new $e({icon:"magnifying-glass-plus",id:"zoom-to-feature",title:"{messages.zoom}",className:Q.zoomInMagnifyingGlass}),$i=new $e({icon:"trash",id:"remove-selected-feature",title:"{messages.remove}",className:Q.trash}),Oe=new $e({icon:"magnifying-glass-plus",id:"zoom-to-clustered-features",title:"{messages.zoom}",className:Q.zoomInMagnifyingGlass}),we=new di({icon:"table",id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:Q.table,value:!1});var rn="esri.widgets.Popup.PopupViewModel",ei=D.getLogger(rn),Ro=e=>{let{event:t,view:i,viewModel:r}=e,{action:o}=t;if(!o)return Promise.reject(new L("trigger-action:missing-arguments","Event has no action"));let{disabled:s,id:l}=o;if(!l)return Promise.reject(new L("trigger-action:invalid-action","action.id is missing"));if(s)return Promise.reject(new L("trigger-action:invalid-action","Action is disabled"));if(l===Ae.id)return sn(r).catch(ji);if(l===Oe.id)return nn(r);if(l===we.id)return r.browseClusterEnabled=!r.browseClusterEnabled,r.featureMenuOpen=r.browseClusterEnabled,Promise.resolve();if(l===$i.id){r.visible=!1;let{selectedFeature:d}=r;if(!d)return Promise.reject(new L(`trigger-action:${$i.id}`,"selectedFeature is required",{selectedFeature:d}));let{sourceLayer:u}=d;return u?u.remove(d):i?.graphics.remove(d),Promise.resolve()}return Promise.resolve()};function Di(e){let{selectedFeature:t,location:i,view:r}=e;return r?t??i??null:null}function Pe(e){return!!e&&e.isAggregate&&e.sourceLayer?.featureReduction?.type==="cluster"}function on(e,t){return f(this,null,function*(){if(t?.type!=="3d"||!e||e.declaredClass!=="esri.Graphic")return!0;let i=t.getViewForGraphic(e);if(i&&"whenGraphicBounds"in i){let r=null;try{r=yield i.whenGraphicBounds(e,{useViewElevation:!0})}catch{}return!r||!r.boundingBox||r.boundingBox[0]===r.boundingBox[3]&&r.boundingBox[1]===r.boundingBox[4]&&r.boundingBox[2]===r.boundingBox[5]}return!0})}function sn(e){return f(this,null,function*(){let{location:t,selectedFeature:i,view:r,zoomFactor:o}=e,s=Di(e);if(!r||!s){let h=new L("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:s,view:r});throw ei.error(h),h}let l=r.scale/o,d=e.selectedFeature?.geometry,u=d??t,p=u!=null&&u.type==="point"&&(yield on(i,r));Ae.active=!0,Ae.disabled=!0;try{yield e.zoomTo({target:{target:s,scale:p?l:void 0}})}catch{let m=new L("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:i});ei.error(m)}finally{Ae.active=!1,Ae.disabled=!1,e.zoomToLocation=null,p&&(e.location=u)}})}function nn(e){return f(this,null,function*(){let{selectedFeature:t,view:i}=e;if(i?.type!=="2d"){let l=new L("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw ei.error(l),l}if(!t||!Pe(t)){let l=new L("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw ei.error(l),l}let[r,o]=yield Bi(i,t);Oe.active=!0,Oe.disabled=!0;let{extent:s}=yield r.queryExtent(o);yield e.zoomTo({target:s}),Oe.active=!1,Oe.disabled=!1})}function So(e){return f(this,null,function*(){let{view:t,selectedFeature:i}=e;if(!t||!i)return;let[r,o]=yield Bi(t,i),{extent:s}=yield r.queryExtent(o);e.selectedClusterBoundaryFeature.geometry=s,t.graphics.add(e.selectedClusterBoundaryFeature)})}function Oo(e){return f(this,null,function*(){let{selectedFeature:t,view:i}=e;if(!i||!t)return;let[r,o]=yield Bi(i,t);we.active=!0,we.disabled=!0;let{features:s}=yield r.queryFeatures(o);we.active=!1,we.disabled=!1,we.value=!0,e?.open({features:[t].concat(s),featureMenuOpen:!0})})}function Bi(e,t){return f(this,null,function*(){let i=yield e.whenLayerView(t.sourceLayer),r=i.createQuery(),o=t.getObjectId();return r.aggregateIds=o!=null?[o]:[],[i,r]})}function Po(e){we.value=!1;let t=e.features.filter(i=>Pe(i));t.length&&(e.features=t)}function ti(e){if(e==null)return null;switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return null}}var an=()=>[Ae.clone()],ln=()=>[Oe.clone(),we.clone()],A=class extends xr(Yt){constructor(e){super(e),this._pendingPromises=new Jt,this._fetchFeaturesController=null,this._highlightSelectedFeaturePromise=null,this._highlightActiveFeaturePromise=null,this._selectedClusterFeature=null,this.actions=new Ie,this.activeFeature=null,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.defaultPopupTemplateEnabled=!1,this.featurePage=null,this.featuresPerPage=20,this.featureMenuOpen=!1,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new ae({symbol:new pr({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}initialize(){this.addHandles([this.on("view-change",()=>this._autoClose()),g(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),g(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),g(()=>this.view?.animation?.state,e=>this._animationStateChange(e)),g(()=>this.location,e=>this._locationChange(e)),g(()=>this.selectedFeature,e=>this._selectedFeatureChange(e)),g(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),g(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),g(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",e=>Ro({event:e,viewModel:this,view:this.view})),Ve(()=>!this.waitingForResult,()=>this._waitingForResultChange(),Ji),g(()=>[this.features,this.view?.map,this.view?.spatialReference],()=>this._updateFeatureVMs()),g(()=>this.view?.scale,()=>this._viewScaleChange()),Ve(()=>!this.visible,()=>this.browseClusterEnabled=!1),g(()=>this.browseClusterEnabled,e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){let e=this._get("allActions")||new Ie;e.removeAll();let{actions:t,defaultActions:i,defaultPopupTemplateEnabled:r,includeDefaultActions:o,selectedFeature:s}=this,l=o?i.concat(t):t,d=s&&(typeof s.getEffectivePopupTemplate=="function"&&s.getEffectivePopupTemplate(r)||s.popupTemplate),u=d?.actions;return(d?.overwriteActions?u:u?.concat(l)??l)?.filter(Boolean).forEach(h=>e.add(h)),e}get defaultActions(){let e=this._get("defaultActions")||new Ie;return e.removeAll(),e.addMany(Pe(this.selectedFeature)?ln():an()),e}get featureCount(){return this.features.length}set features(e){let t=e||[];this._set("features",t);let{pendingPromisesCount:i,promiseCount:r,selectedFeatureIndex:o}=this,s=r&&t.length;s&&i&&o===-1?this.selectedFeatureIndex=0:s&&o!==-1||(this.selectedFeatureIndex=t.length?0:-1)}set location(e){let t=e,i=this.view?.spatialReference?.isWebMercator;e?.spatialReference?.isWGS84&&i&&(t=nr(e)),this._set("location",t)}get pendingPromisesCount(){return this._pendingPromises.size}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){this._pendingPromises.clear(),this.features=[],Array.isArray(e)&&e.length?(this._set("promises",e),(e=e.slice(0)).forEach(t=>{this._pendingPromises.add(t);let i=o=>{this._pendingPromises.has(t)&&this._updateFeatures(o),this._updatePendingPromises(t)},r=()=>this._updatePendingPromises(t);t.then(i,r)})):this._set("promises",[])}get selectedFeature(){let{features:e,selectedFeatureIndex:t}=this;return t===-1?null:e[t]||null}get selectedFeatureIndex(){let e=this._get("selectedFeatureIndex");return typeof e=="number"?e:-1}set selectedFeatureIndex(e){let{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.view?.ready?"ready":"disabled"}get waitingForContents(){return this.featureViewModels.some(e=>e.waitingForContent)}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||this.featureCount!==0)}centerAtLocation(){let{view:e}=this,t=Di(this);return t&&e?this.callGoTo({target:{target:t,scale:e.scale}}):Promise.reject(new L("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e}))}zoomTo(e){return this.callGoTo(e)}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,t){let{view:i}=this;if(!i||!e)throw new L("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:i});return i.fetchPopupFeatures(e,{event:t?.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t?.signal})}open(e){let t=he(v({updateLocationEnabled:!1,promises:[],fetchFeatures:!1},e),{visible:!0}),{fetchFeatures:i}=t;delete t.fetchFeatures,i&&this._setFetchFeaturesPromises(t.location);let r=["actionsMenuOpen","collapsed"];for(let o of r)delete t[o];this.set(t)}triggerAction(e){let t=this.allActions.at(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex++,this}previous(){return this.selectedFeatureIndex--,this}disableClusterBrowsing(){Po(this),this._clearBrowsedClusterGraphics()}enableClusterBrowsing(){return f(this,null,function*(){let{view:e,selectedFeature:t}=this;e?.type==="2d"?Pe(t)?(yield So(this),yield Oo(this)):D.getLogger(this).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",t):D.getLogger(this).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",t)})}handleViewClick(e){this.autoOpenEnabled&&this._fetchFeaturesAndOpen(e)}_animationStateChange(e){this.zoomToLocation||(Ae.disabled=e==="waiting-for-target")}_clearBrowsedClusterGraphics(){let e=[this.selectedClusterBoundaryFeature,this._selectedClusterFeature].filter(me);this.view?.graphics?.removeMany(e),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(Pe(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}_locationChange(e){let{selectedFeature:t,updateLocationEnabled:i}=this;i&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){let{features:e,featureCount:t,featurePage:i,featuresPerPage:r,featureViewModels:o}=this;if(i===null)return;let s=((i-1)*r+t)%t,l=s+r;o.slice(s,l).forEach((d,u)=>{d&&(d.graphic??=e[s+u])})}_selectedFeatureChange(e){return f(this,null,function*(){let{location:t,updateLocationEnabled:i,view:r}=this;if(e&&r){if(this.browseClusterEnabled)return this._selectedClusterFeature&&(r.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),Pe(e)?void 0:(e.symbol=yield ko(e),this._selectedClusterFeature=e,void r.graphics.add(this._selectedClusterFeature));if(!i&&t||!e.geometry){if(i&&!e.geometry){yield this.centerAtLocation();let o=r.center?.clone();o&&(this.location=o)}}else this.location=ti(e.geometry)}})}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return f(this,null,function*(){let{clientOnlyGraphics:t,promisesPerLayerView:i}=yield this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)),r=Promise.resolve(t),o=i.map(s=>s.promise);this.promises=[r,...o]})}_destroyFeatureVMs(){this.featureViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){let{selectedFeature:e,features:t,featureViewModels:i,view:r}=this;if(Pe(e)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!t?.length)return;let o=i.slice(0),s=[];t.forEach((l,d)=>{if(!l)return;let u=null;if(o.some((p,h)=>(p&&p.graphic===l&&(u=p,o.splice(h,1)),!!u)),u)s[d]=u;else{let p=new gt({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:r?.spatialReference,graphic:l===e?l:null,map:r?.map,view:r});s[d]=p}}),o.forEach(l=>l&&!l.destroyed&&l.destroy()),this._set("featureViewModels",s)}_getScreenPoint(e){let{view:t}=this;return t&&e&&typeof t.toScreen=="function"?t.toScreen(e):null}_cancelFetchingFeatures(){let e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null}_fetchFeaturesWithController(e,t){this._cancelFetchingFeatures();let i=new AbortController,{signal:r}=i;this._fetchFeaturesController=i;let o=this.fetchFeatures(e,{signal:r,event:t});return o.catch(()=>{}).then(()=>{this._fetchFeaturesController=null}),o}_fetchFeaturesAndOpen(e){return f(this,null,function*(){let{screenPoint:t,mapPoint:i}=e,{view:r}=this,{clientOnlyGraphics:o,promisesPerLayerView:s,location:l}=yield this._fetchFeaturesWithController(t,e),d=[Promise.resolve(o),...s.map(u=>u.promise)];r?.popup&&"open"in r.popup&&r.popup.open({location:l||i,promises:d})})}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&this._pendingPromises.delete(e)}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getLayerView(e,t){return f(this,null,function*(){return yield e.when(),e.whenLayerView(t)})}_getHighlightLayer(e){let{layer:t,sourceLayer:i}=e;return i&&"layer"in i&&i.layer?i.layer:i?.type==="map-notes"||i?.type==="subtype-group"?i:t}_getHighlightTarget(e,t){let i=t.type==="imagery"?void 0:"objectIdField"in t?t.objectIdField||Eo:null,r=e.attributes;return r&&i&&r[i]||e}_mapIncludesLayer(e){return!!this.view?.map?.allLayers?.includes(e)}_highlightActiveFeature(){return f(this,null,function*(){let e="highlight-active-feature";this.removeHandles(e);let{highlightEnabled:t,view:i,activeFeature:r,visible:o}=this;if(!(r&&i&&t&&o))return;let s=this._getHighlightLayer(r);if(!(s&&s instanceof pi&&this._mapIncludesLayer(s)))return;let l=this._getLayerView(i,s);this._highlightActiveFeaturePromise=l;let d=yield l;if(!(d&&Vi(d)&&this._highlightActiveFeaturePromise===l&&this.activeFeature&&this.highlightEnabled))return;let u=d.highlight(this._getHighlightTarget(r,s));this.addHandles(u,e)})}_highlightSelectedFeature(){return f(this,null,function*(){let e="highlight-selected-feature";this.removeHandles(e);let{selectedFeature:t,highlightEnabled:i,view:r,visible:o}=this;if(!(t&&r&&i&&o))return;let s=this._getHighlightLayer(t);if(!(s&&s instanceof pi&&this._mapIncludesLayer(s)))return;let l=this._getLayerView(r,s);this._highlightSelectedFeaturePromise=l;let d=yield l;if(!(d&&Vi(d)&&this._highlightSelectedFeaturePromise===l&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;let u=d.highlight(this._getHighlightTarget(t,s));this.addHandles(u,e)})}_updateFeatures(e){let{features:t}=this;if(!e?.length)return;if(!t.length)return void(this.features=e);let i=e.filter(r=>!t.includes(r));this.features=t.concat(i)}};n([a()],A.prototype,"_fetchFeaturesController",void 0),n([a({type:Ie})],A.prototype,"actions",void 0),n([a({readOnly:!0})],A.prototype,"active",null),n([a()],A.prototype,"activeFeature",void 0),n([a({readOnly:!0})],A.prototype,"allActions",null),n([a()],A.prototype,"autoCloseEnabled",void 0),n([a()],A.prototype,"autoOpenEnabled",void 0),n([a()],A.prototype,"browseClusterEnabled",void 0),n([a()],A.prototype,"content",void 0),n([a({type:Ie,readOnly:!0})],A.prototype,"defaultActions",null),n([a({type:Boolean})],A.prototype,"defaultPopupTemplateEnabled",void 0),n([a({readOnly:!0})],A.prototype,"featureCount",null),n([a()],A.prototype,"featurePage",void 0),n([a({value:[]})],A.prototype,"features",null),n([a()],A.prototype,"featuresPerPage",void 0),n([a()],A.prototype,"featureMenuOpen",void 0),n([a()],A.prototype,"featureViewModelAbilities",void 0),n([a({readOnly:!0})],A.prototype,"featureViewModels",void 0),n([a()],A.prototype,"highlightEnabled",void 0),n([a()],A.prototype,"includeDefaultActions",void 0),n([a({type:ar})],A.prototype,"location",null),n([a({readOnly:!0})],A.prototype,"pendingPromisesCount",null),n([a({readOnly:!0})],A.prototype,"promiseCount",null),n([a()],A.prototype,"promises",null),n([a({readOnly:!0})],A.prototype,"selectedClusterBoundaryFeature",void 0),n([a({value:null,readOnly:!0})],A.prototype,"selectedFeature",null),n([a({value:-1})],A.prototype,"selectedFeatureIndex",null),n([a({readOnly:!0})],A.prototype,"selectedFeatureViewModel",null),n([a({readOnly:!0})],A.prototype,"state",null),n([a()],A.prototype,"title",void 0),n([a()],A.prototype,"updateLocationEnabled",void 0),n([a()],A.prototype,"view",void 0),n([a()],A.prototype,"visible",void 0),n([a({readOnly:!0})],A.prototype,"waitingForContents",null),n([a({readOnly:!0})],A.prototype,"waitingForResult",null),n([a()],A.prototype,"zoomFactor",void 0),n([a()],A.prototype,"zoomToLocation",void 0),n([a()],A.prototype,"centerAtLocation",null),A=n([w("esri.widgets.Features.FeaturesViewModel")],A);var yt=A;var Ce=class extends j{constructor(){super(...arguments),this.actionBar=!0,this.closeButton=!0,this.collapseButton=!1,this.featureNavigation=!0,this.heading=!0,this.spinner=!0}};n([a({type:Boolean,nonNullable:!0})],Ce.prototype,"actionBar",void 0),n([a({type:Boolean,nonNullable:!0})],Ce.prototype,"closeButton",void 0),n([a({type:Boolean,nonNullable:!0})],Ce.prototype,"collapseButton",void 0),n([a({type:Boolean,nonNullable:!0})],Ce.prototype,"featureNavigation",void 0),n([a({type:Boolean,nonNullable:!0})],Ce.prototype,"heading",void 0),n([a({type:Boolean,nonNullable:!0})],Ce.prototype,"spinner",void 0),Ce=n([w("esri.widgets.Features.FeaturesVisibleElements")],Ce);var qi=Ce;var No="selected-index",dn=0,Vo="features-spinner",cn=50,O=class extends Xt(N){constructor(e,t){super(e,t),this._featureMenuIntersectionObserverCallback=([i])=>{i?.isIntersecting&&this.viewModel.featurePage!=null&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._featureMenuIntersectionObserverNode=null,this._focusOn=null,this._spinner=null,this._feature=null,this._relatedRecordsFlowItems=new ye,this._relatedRecordsWidget=new xo({flowItems:this._relatedRecordsFlowItems}),this._rootFlowItemNode=null,this._featureMenuViewportNode=null,this.collapsed=!1,this.icon=null,this.featureNavigationTop=!1,this.headerActions=new Ie,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.responsiveActionsEnabled=!1,this.viewModel=new yt,this.visibleElements=new qi,this._renderAction=(i,r)=>{let o=this._getActionTitle(i),{type:s,active:l,uid:d,disabled:u,indicator:p}=i;return i.visible?c("calcite-action",{active:s==="toggle"&&i.value,appearance:"solid",bind:this,"data-action-uid":d,disabled:u,icon:this._getActionIcon(i),indicator:p,key:`action-${r}`,loading:l,onclick:this._triggerAction,scale:"s",text:o,title:this._hideActionText?o:void 0},this._getFallbackIcon(i)):null},this._openFeatureMenu=()=>{this.featureMenuOpen=!0},this._previousFeature=()=>{this.viewModel.selectedFeatureIndex--},this._nextFeature=()=>{this.viewModel.selectedFeatureIndex++},this._handleFeatureMenuBack=()=>{this.featureMenuOpen&&(this._focusOn="root-flow-item",this.featureMenuOpen=!1)},this._focusFlowItemNode=i=>{this._focusOn===i&&requestAnimationFrame(()=>f(this,null,function*(){switch(i){case"menu-flow-item":yield this._featureMenuViewportNode?.setFocus();break;case"root-flow-item":yield this._rootFlowItemNode?.setFocus()}this._focusOn=null}))},this._focusFlowItemNodeThrottled=De(this._focusFlowItemNode,cn),this._displaySpinnerThrottled=De(()=>this._displaySpinner(),dn),this._addSelectedFeatureIndexHandle(),this.addHandles([this._displaySpinnerThrottled,this._focusFlowItemNodeThrottled,g(()=>this.viewModel?.active,()=>this._toggleScreenLocationEnabled()),g(()=>this.viewModel?.active,i=>this._relatedRecordsWidget.closed=!i),g(()=>this.visibleElements?.closeButton,i=>this._relatedRecordsWidget.closable=i),g(()=>this.visibleElements?.spinner,i=>this._spinnerEnabledChange(i)),g(()=>this.viewModel?.view,(i,r)=>this._viewChange(i,r)),g(()=>this.viewModel?.view?.ready,(i,r)=>this._viewReadyChange(i??!1,r??!1)),g(()=>[this.viewModel?.waitingForResult,this.viewModel?.location],()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),g(()=>this.selectedFeatureWidget,()=>this._destroyRelatedRecordsFlowItemWidgets()),g(()=>{let i=this.selectedFeatureWidget?.viewModel;return[i?.title,i?.state]},()=>this._setTitleFromFeatureWidget()),g(()=>{let i=this.selectedFeatureWidget?.viewModel;return[i?.content,i?.state]},()=>this._setContentFromFeatureWidget()),g(()=>this.viewModel?.featureViewModels,()=>this._featureMenuViewportScrollTop()),this._relatedRecordsWidget.on("close",()=>this.close()),this._relatedRecordsWidget.on("exit",()=>this._destroyRelatedRecordsFlowItemWidgets()),this._relatedRecordsWidget.on("open-related-feature",({feature:i})=>this._openRelatedFeature(i))])}loadDependencies(){return ne({action:()=>import("./chunk-J4TE2HGY.js"),"action-bar":()=>import("./chunk-GSUTODBQ.js"),"action-group":()=>import("./chunk-5B72RLJE.js"),button:()=>import("./chunk-IUBUAUH6.js"),flow:()=>import("./chunk-EU5VZACR.js"),"flow-item":()=>import("./chunk-BC7M36VS.js"),list:()=>import("./chunk-5ENHBRFJ.js"),"list-item":()=>import("./chunk-GHCHJZTH.js"),"list-item-group":()=>import("./chunk-ADCVHZF5.js"),loader:()=>import("./chunk-YPO4ZB5I.js")})}destroy(){this._destroyRelatedRecordsFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver?.disconnect(),this._relatedRecordsWidget?.destroy()}get _hideActionText(){if(!this.responsiveActionsEnabled)return!1;let e=this.view?.widthBreakpoint;return e==="xsmall"||e==="small"||e==="medium"}get _featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get _isCollapsed(){return this._collapseEnabled&&this.collapsed}get _collapseEnabled(){return this.visibleElements.collapseButton&&!!this.title&&!!this.content}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(e){this.viewModel.featureMenuOpen=e}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){let{_feature:e,headingLevel:t,_relatedRecordsFlowItems:i}=this,{selectedFeatureViewModel:r}=this.viewModel,o={title:!1};return r?(e?(e.viewModel=r,e.visibleElements=o):this._feature=new Ao({flowItems:i,headingLevel:t+1,viewModel:r,visibleElements:o}),this._feature):null}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}blur(){let{active:e}=this.viewModel;e?this._rootFlowItemNode?.blur():D.getLogger(this).warn("Features can only be blurred when currently active.")}clear(){return this.viewModel.clear()}close(){this.viewModel.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){let{active:e}=this.viewModel;e?this._setFocusOn():D.getLogger(this).warn("Features can only be focused when currently active.")}next(){return this.viewModel.next()}open(e){this.removeHandles(No);let t={collapsed:e?.collapsed??!1};this.set(t),this.viewModel.open(e),this.addHandles(Ve(()=>!this.viewModel.waitingForResult,()=>this._addSelectedFeatureIndexHandle(),{once:!0}))}previous(){return this.viewModel.previous()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){return c("div",{bind:this,class:this.classes(W.base,F.widget,F.panel),onkeydown:this._onMainKeydown},this._renderHeader(),this._renderContentContainer())}_renderFeatureNavigation(){return[this._renderPagination(),this._renderFeatureMenuButton()]}_renderHeader(){return!this.featureMenuOpen&&this.featureNavigationTop&&this._featureNavigationVisible?c("div",{class:W.header,key:"header-actions"},this._renderFeatureNavigation()):null}_renderFooter(){return this.featureMenuOpen||this.featureNavigationTop||!this._featureNavigationVisible?null:c("div",{class:W.footer,key:"footer-actions",slot:"footer"},this._renderFeatureNavigation())}_renderFeatureMenuButton(){let{messages:e,viewModel:t}=this,{featureCount:i,selectedFeatureIndex:r,pendingPromisesCount:o}=t;return c("calcite-action",{appearance:"solid",bind:this,icon:"list",key:"feature-menu-button",label:e.selectFeature,loading:o>0,onclick:this._openFeatureMenu,scale:"s",text:X(e.pageText,{index:ue(r+1),total:ue(i)}),textEnabled:!0,title:e.selectFeature})}_renderPagination(){let{previous:e,next:t}=this.messagesCommon.pagination;return c("calcite-action-bar",{class:W.paginationActionBar,expandDisabled:!0,key:"pagination-action-bar",layout:"horizontal",overflowActionsDisabled:!0,scale:"s"},c("calcite-action-group",{scale:"s"},c("calcite-action",{appearance:"solid",class:W.paginationPrevious,icon:"chevron-left",iconFlipRtl:!0,label:e,onclick:this._previousFeature,scale:"s",text:e,title:e}),c("calcite-action",{appearance:"solid",icon:"chevron-right",iconFlipRtl:!0,label:t,onclick:this._nextFeature,scale:"s",text:t,title:t})))}_renderFeatureMenuItem(e){let{selectedFeatureViewModel:t,featureViewModels:i}=this.viewModel,r=e===t,o=i.indexOf(e);return c("calcite-list-item",{bind:this,"data-feature-index":o,key:`feature-menu-item-${e.uid}`,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onmouseleave:this._removeActiveFeature,onmouseover:this._setActiveFeature,selected:r,onCalciteListItemSelect:this._selectFeature},c("span",{innerHTML:e.title||this.messagesCommon.untitled,slot:"content"}))}_groupResultsByLayer(){let{featureViewModels:e}=this.viewModel,t=new Map;return e.forEach(i=>{let r=i?.graphic;if(!r)return;let o=r.sourceLayer??r.layer,s=t.get(o)??[];t.set(o,[...s,i])}),t}_renderFeatureMenu(){let{featureViewModels:e}=this.viewModel,t=this._groupResultsByLayer();return e.length?c("calcite-list",{selectionAppearance:"icon",selectionMode:"single"},Array.from(t.keys()).map(i=>c("calcite-list-item-group",{heading:i?.title??this.messagesCommon.untitled,key:i?.uid||"untitled"},t.get(i)?.map(r=>this._renderFeatureMenuItem(r))))):null}_renderHeaderAction(e,t){return e.visible?c("calcite-action",{active:e.type==="toggle"&&e.value,appearance:"solid",bind:this,"data-action-uid":e.uid,disabled:e.disabled,icon:e.icon||"",indicator:e.indicator,key:`header-action-${t}`,loading:e.active,onclick:this._triggerHeaderAction,scale:"m",slot:"header-actions-end",text:e.title||"",title:e.title||""}):null}_renderHeaderActions(){return this.headerActions.map((e,t)=>this._renderHeaderAction(e,t)).toArray()}_renderContentFeature(){let{headingLevel:e,visibleElements:t,_isCollapsed:i,_collapseEnabled:r,featureNavigationTop:o}=this,{title:s,active:l}=this.viewModel,d=t.heading&&s?s:"";return c("calcite-flow-item",{afterCreate:this._storeRootFlowItemNode,afterUpdate:this._focusRootFlowItemNode,bind:this,class:this.classes({[W.contentFeature]:!0,[W.flowItemCollapsed]:i}),closable:t.closeButton,closed:!l,collapsed:i,collapseDirection:o?"down":"up",collapsible:r,headingLevel:e,key:"root-flow-item",onCalciteFlowItemClose:this.close,onCalciteFlowItemToggle:this._handleCollapseToggle},d?c(Ge,{class:this.classes(W.featuresHeading,F.heading),innerHTML:d,key:"header-content",level:this.headingLevel,slot:"header-content"}):null,this._renderHeaderActions(),this._renderActionBar(),i?null:c("div",{class:this.classes(W.container,W.contentContainer)},this._renderContent()),this._renderFooter())}_renderFeatureMenuContainer(){let{viewModel:e,featureMenuOpen:t,messages:i,messagesCommon:r}=this,{active:o,featureViewModels:s,pendingPromisesCount:l}=e;return t?c("calcite-flow-item",{afterCreate:this._storeFeatureMenuFlowItemNode,afterUpdate:this._focusFeatureMenuFlowItemNode,bind:this,closable:!1,closed:!o,description:X(i.total,{total:s.length}),heading:i.selectFeature,key:"feature-menu",loading:e.waitingForContents,onCalciteFlowItemBack:this._handleFeatureMenuBack},l>0?c("calcite-loader",{class:W.loader,inline:!0,key:"feature-menu-loader",label:r.loading,scale:"m",slot:"header-actions-end"}):null,c("div",{class:W.container},this._renderFeatureMenu()),c("div",{afterCreate:this._featureMenuIntersectionObserverCreated,bind:this,class:W.featureMenuObserver}),c("calcite-button",{appearance:"transparent",onclick:this._handleFeatureMenuBack,slot:"footer-actions",width:"full"},r.back)):null}_renderContentContainer(){return c("calcite-flow",{key:"content-container"},this._renderContentFeature(),this._renderFeatureMenuContainer(),this._relatedRecordsWidget.render())}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}_getActionImage(e){let{selectedFeature:t}=this,i=t?.attributes,{image:r}=e;return r&&i?X(r,i):r??""}_getFallbackIcon(e){let{className:t,icon:i}=e;if(i)return null;let r=this._getActionImage(e),o={[W.icon]:!!t,[W.actionImage]:!!r};return t&&(o[t]=!0),r||t?c("span",{"aria-hidden":"true",class:this.classes(W.icon,o),key:"icon",styles:r?this._getIconStyles(r):{}}):null}_renderActionBar(){return!this._isCollapsed&&this.visibleElements.actionBar&&this.viewModel.allActions?.length?c("calcite-action-bar",{expandDisabled:!0,expanded:!this._hideActionText,key:"header-action-bar",scale:"s",slot:"action-bar"},c("calcite-action-group",{overlayPositioning:"fixed",scale:"s"},this._renderActions())):null}_renderActions(){return this.viewModel.allActions.toArray().map(this._renderAction)}_renderContent(){let e=this.viewModel?.content;return e?typeof e=="string"?c("div",{class:V.contentNode,innerHTML:e,key:e}):this.renderNodeContent(e):null}_setFocusOn(){this._focusOn=this.featureMenuOpen?"menu-flow-item":"root-flow-item",this.renderNow()}_handleCollapseToggle(){this.collapsed=!this.collapsed}_openRelatedFeature(e){return f(this,null,function*(){yield e.viewModel.updateGeometry();let t=e.graphic,i=t?.geometry;if(i==null||t==null)return;this._destroyRelatedRecordsFlowItemWidgets(),yield this.viewModel.zoomTo({target:i});let r=ti(i);this.open({features:[t],location:r??void 0})})}_focusRootFlowItemNode(){this._focusFlowItemNodeThrottled("root-flow-item")}_focusFeatureMenuFlowItemNode(){this._focusFlowItemNodeThrottled("menu-flow-item")}_storeRootFlowItemNode(e){this._rootFlowItemNode=e,this._focusFlowItemNodeThrottled("root-flow-item")}_storeFeatureMenuFlowItemNode(e){this._featureMenuViewportNode=e,this._focusFlowItemNodeThrottled("menu-flow-item")}_setActiveFeature(e){let{viewModel:t}=this,i=e.currentTarget["data-feature-index"];t.activeFeature=t.features?.[i]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_selectFeature(e){let t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this._handleFeatureMenuBack()}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_getActionIcon(e){return e.icon?e.icon:e.image||e.className?void 0:"question"}_getActionTitle(e){let{messages:t,selectedFeature:i,messagesCommon:r}=this,{id:o}=e,s=i?.attributes,l=e.title??"",d=o==="zoom-to-feature"?X(l,{messages:t}):o==="remove-selected-feature"?X(l,{messages:r}):o==="zoom-to-clustered-features"||o==="browse-clustered-features"?X(l,{messages:t}):e.title;return d&&s?X(d,s):d??""}_onMainKeydown(e){let t=bt(e);t==="ArrowLeft"&&(e.stopPropagation(),this._handleFeatureMenuBack(),this.previous()),t==="ArrowRight"&&(e.stopPropagation(),this._handleFeatureMenuBack(),this.next())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&this._featureMenuViewportNode.scrollContentTo({top:0})}_setContentFromFeatureWidget(){let{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_setTitleFromFeatureWidget(){let{selectedFeatureWidget:e,messagesCommon:t}=this,i=e?.viewModel;e&&(this.viewModel.title=i?.state==="error"?t?.errorMessage:i?.title||"")}_addSelectedFeatureIndexHandle(){let e=g(()=>this.viewModel?.selectedFeatureIndex,(t,i)=>this._selectedFeatureIndexUpdated(t,i));this.addHandles(e,No)}_selectedFeatureIndexUpdated(e,t){let{featureCount:i}=this.viewModel;i&&e!==t&&e!==-1&&(this._destroyRelatedRecordsFlowItemWidgets(),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}_triggerHeaderAction(e){let t=e.currentTarget;if(t.disabled)return;let i=t.dataset.actionUid,r=this.headerActions.find(({uid:o})=>o===i);r&&!r.disabled&&(r?.type==="toggle"&&(r.value=!r.value),this.emit("trigger-header-action",{action:r}))}_triggerAction(e){let t=e.currentTarget;if(t.disabled)return;let i=t.dataset.actionUid,{allActions:r}=this.viewModel,o=r.findIndex(l=>l.uid===i),s=r.at(o);s&&s.type==="toggle"&&(s.value=!s.value),this.viewModel.triggerAction(o)}_createSpinner(e){e&&(this._spinner=new Co({view:e}),e.ui.add(this._spinner,{key:Vo,position:"manual",internal:!0}))}_wireUpView(e){this._destroySpinner(),e&&this.visibleElements?.spinner&&this._createSpinner(e)}_hideSpinner(){let{_spinner:e}=this;e&&(e.location=null,e.hide())}_viewReadyChange(e,t){e?this._wireUpView(this.viewModel?.view):t&&this.viewModel.clear()}_viewChange(e,t){e&&t&&this.viewModel.clear()}_destroySelectedFeatureWidget(){let{_feature:e}=this;e&&(e.viewModel=null,!e.destroyed&&e.destroy()),this._feature=null}_destroyRelatedRecordsFlowItemWidgets(){this._relatedRecordsFlowItems.removeAll().forEach(e=>{"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy()})}_toggleScreenLocationEnabled(){let{viewModel:e}=this;e&&(e.screenLocationEnabled=e.active)}_displaySpinner(){let{_spinner:e}=this;if(!e)return;let{location:t,waitingForResult:i}=this.viewModel;i&&t?e.show({location:t}):e.hide()}_destroySpinner(){let{_spinner:e,view:t}=this;e&&(t?.ui?.remove(e,Vo),e.destroy(),this._spinner=null)}_spinnerEnabledChange(e){this._destroySpinner(),e&&this._createSpinner(this.viewModel?.view)}};n([a()],O.prototype,"_focusOn",void 0),n([a()],O.prototype,"_relatedRecordsFlowItems",void 0),n([a()],O.prototype,"_hideActionText",null),n([a()],O.prototype,"_featureNavigationVisible",null),n([a()],O.prototype,"_isCollapsed",null),n([a()],O.prototype,"_collapseEnabled",null),n([a()],O.prototype,"collapsed",void 0),n([a()],O.prototype,"content",null),n([a()],O.prototype,"icon",void 0),n([a()],O.prototype,"featureMenuOpen",null),n([a()],O.prototype,"featureNavigationTop",void 0),n([a()],O.prototype,"features",null),n([a({type:Ie})],O.prototype,"headerActions",void 0),n([a()],O.prototype,"headingLevel",void 0),n([a()],O.prototype,"location",null),n([a()],O.prototype,"label",null),n([a(),B("esri/widgets/Features/t9n/Features")],O.prototype,"messages",void 0),n([a(),B("esri/t9n/common")],O.prototype,"messagesCommon",void 0),n([a()],O.prototype,"promises",null),n([a()],O.prototype,"responsiveActionsEnabled",void 0),n([a({readOnly:!0})],O.prototype,"selectedFeature",null),n([a()],O.prototype,"selectedFeatureIndex",null),n([a({readOnly:!0})],O.prototype,"selectedFeatureWidget",null),n([a()],O.prototype,"title",null),n([a()],O.prototype,"updateLocationEnabled",null),n([a()],O.prototype,"view",null),n([a({type:yt}),At(["triggerAction","trigger-action"])],O.prototype,"viewModel",void 0),n([a({type:qi,nonNullable:!0})],O.prototype,"visibleElements",void 0),n([a()],O.prototype,"visible",null),O=n([w("esri.widgets.Features")],O);var $o=O;var de="esri-popup",je=`${de}--is-docked`,q={base:de,main:`${de}__main-container`,shadow:`${de}--shadow`,isDocked:je,isDockedTopLeft:`${je}-top-left`,isDockedTopCenter:`${je}-top-center`,isDockedTopRight:`${je}-top-right`,isDockedBottomLeft:`${je}-bottom-left`,isDockedBottomCenter:`${je}-bottom-center`,isDockedBottomRight:`${je}-bottom-right`,alignTopCenter:`${de}--aligned-top-center`,alignBottomCenter:`${de}--aligned-bottom-center`,alignTopLeft:`${de}--aligned-top-left`,alignBottomLeft:`${de}--aligned-bottom-left`,alignTopRight:`${de}--aligned-top-right`,alignBottomRight:`${de}--aligned-bottom-right`,pointer:`${de}__pointer`,pointerDirection:`${de}__pointer-direction`};var Hi=class extends yt{constructor(e){super(e)}};Hi=n([w("esri.widgets.Popup.PopupViewModel")],Hi);var zi=Hi;var vt=class extends j{constructor(){super(...arguments),this.closeButton=!0,this.featureNavigation=!0}};n([a({type:Boolean,nonNullable:!0})],vt.prototype,"closeButton",void 0),n([a({type:Boolean,nonNullable:!0})],vt.prototype,"featureNavigation",void 0),vt=n([w("esri.widgets.Features.PopupVisibleElements")],vt);var Wi=vt;var Do={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},E=class extends N{constructor(e,t){super(e,t),this._dockAction=new $e({id:"popup-dock-action"}),this._featuresWidget=new $o({responsiveActionsEnabled:!0}),this._containerNode=null,this._mainContainerNode=null,this._pointerOffsetInPx=16,this.alignment="auto",this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.headingLevel=2,this.maxInlineActions=3,this.messages=null,this.spinnerEnabled=!0,this.viewModel=new zi,this.visibleElements=new Wi}initialize(){this.addHandles([g(()=>[this.viewModel?.view?.widthBreakpoint,this.dockEnabled],()=>this._handleDockIcon(),{initial:!0}),g(()=>[this.dockEnabled,this.messages?.undock,this.messages?.dock],()=>this._handleDockEnabled(),{initial:!0}),g(()=>this.dockOptions,e=>{let{_dockAction:t}=this,i=this._featuresWidget.headerActions;i.remove(t),e.buttonEnabled&&i.add(t)},{initial:!0}),g(()=>this.viewModel?.screenLocation,()=>this._positionContainer()),g(()=>[this.viewModel?.active,this.dockEnabled],()=>this._toggleScreenLocationEnabled()),g(()=>[this.viewModel?.screenLocation,this.viewModel?.view?.padding,this.viewModel?.view?.size,this.viewModel?.active,this.viewModel?.location,this.alignment],()=>this.reposition()),g(()=>this.viewModel?.view?.size,(e,t)=>this._updateDockEnabledForViewSize(e,t)),g(()=>this.viewModel?.view,(e,t)=>this._viewChange(e,t)),g(()=>this.viewModel?.view?.ready,(e,t)=>this._viewReadyChange(e??!1,t??!1)),g(()=>this.viewModel,()=>this._featuresWidget.viewModel=this.viewModel,{initial:!0}),g(()=>this._featureNavigationTop,e=>this._featuresWidget.featureNavigationTop=e,{initial:!0}),g(()=>this.headingLevel,e=>this._featuresWidget.headingLevel=e,{initial:!0}),g(()=>this.collapseEnabled,e=>this._featuresWidget.visibleElements.collapseButton=e,{initial:!0}),g(()=>this.collapsed,e=>this._featuresWidget.collapsed=e,{initial:!0}),g(()=>this.visibleElements.closeButton,e=>this._featuresWidget.visibleElements.closeButton=!!e,{initial:!0}),g(()=>this.spinnerEnabled,e=>this._featuresWidget.visibleElements.spinner=e,{initial:!0}),g(()=>this.visibleElements.featureNavigation,e=>this._featuresWidget.visibleElements.featureNavigation=!!e,{initial:!0}),re(()=>this._featuresWidget,"trigger-header-action",e=>{e.action===this._dockAction&&(this.dockEnabled=!this.dockEnabled)})])}destroy(){this._dockAction.destroy(),this._featuresWidget?.destroy()}get _featureNavigationTop(){let{currentAlignment:e,currentDockPosition:t}=this;return e==="bottom-left"||e==="bottom-center"||e==="bottom-right"||t==="top-left"||t==="top-center"||t==="top-right"}get actions(){return this.viewModel.actions}set actions(e){this.viewModel.actions=e}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(e){this.viewModel.autoCloseEnabled=e}get autoOpenEnabled(){return oi(D.getLogger(this),"autoOpenEnabled",{replacement:"MapView/SceneView.popupEnabled",version:"4.27"}),this.viewModel.autoOpenEnabled}set autoOpenEnabled(e){oi(D.getLogger(this),"autoOpenEnabled",{replacement:"MapView/SceneView.popupEnabled",version:"4.27"}),this.viewModel.autoOpenEnabled=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get content(){return this.viewModel.content}set content(e){this.viewModel.content=e}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||Do}set dockOptions(e){let t=v({},Do),i=this.viewModel?.view?.breakpoints,r={};i&&(r.width=i.xsmall,r.height=i.xsmall);let o=v(v({},t),e),s=v(v({},t.breakpoint),r),{breakpoint:l}=o;typeof l=="object"?o.breakpoint=v(v({},s),l):l&&(o.breakpoint=s),this._set("dockOptions",o),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(e){this.viewModel.featureMenuOpen=e}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(e){this.viewModel.highlightEnabled=e}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get promises(){return this.viewModel.promises}set promises(e){this.viewModel.promises=e}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(e){this.viewModel.selectedFeatureIndex=e}get selectedFeatureWidget(){return this._featuresWidget.selectedFeatureWidget}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(e){this.viewModel.updateLocationEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}blur(){let{active:e}=this.viewModel;e||D.getLogger(this).warn("Popup can only be blurred when currently active."),this._featuresWidget.blur()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){let{active:e}=this.viewModel;e||D.getLogger(this).warn("Popup can only be focused when currently active."),this.renderNow(),this._featuresWidget.focus()}next(){return this.viewModel.next()}open(e){let t=!!e&&!!e.featureMenuOpen,i={collapsed:!!e&&!!e.collapsed,featureMenuOpen:t};this.set(i),this.viewModel.open(e),this._shouldFocus(e)}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){return this.viewModel.triggerAction(e)}render(){let{dockEnabled:e,currentAlignment:t,currentDockPosition:i}=this,{active:r}=this.viewModel,o=r&&e,s=r&&!e,l=this.selectedFeature?.layer?.title,d=this.selectedFeature?.layer?.id,u={[q.alignTopCenter]:t==="top-center",[q.alignBottomCenter]:t==="bottom-center",[q.alignTopLeft]:t==="top-left",[q.alignBottomLeft]:t==="bottom-left",[q.alignTopRight]:t==="top-right",[q.alignBottomRight]:t==="bottom-right",[q.isDocked]:o,[q.shadow]:s,[q.isDockedTopLeft]:i==="top-left",[q.isDockedTopCenter]:i==="top-center",[q.isDockedTopRight]:i==="top-right",[q.isDockedBottomLeft]:i==="bottom-left",[q.isDockedBottomCenter]:i==="bottom-center",[q.isDockedBottomRight]:i==="bottom-right"};return c("div",{afterCreate:this._positionContainer,afterUpdate:this._positionContainer,bind:this,class:this.classes(q.base,u),"data-layer-id":d,"data-layer-title":l,role:"presentation"},r?[this._renderMainContainer(),this._renderPointer()]:null)}_renderPointer(){return this.dockEnabled?null:c("div",{class:q.pointer,key:"popup-pointer",role:"presentation"},c("div",{class:this.classes(q.pointerDirection,q.shadow)}))}_renderMainContainer(){let{dockEnabled:e}=this,t={[q.shadow]:e};return c("div",{afterCreate:this._setMainContainerNode,afterUpdate:this._setMainContainerNode,bind:this,class:this.classes(q.main,F.widget,t)},this._featuresWidget.render())}_shouldFocus(e){return f(this,null,function*(){e?.shouldFocus&&(yield Ki(()=>this.viewModel?.active===!0),this.focus())})}_isOutsideView(e){let{popupHeight:t,popupWidth:i,screenLocation:r,side:o,view:s}=e;if(isNaN(i)||isNaN(t)||!s||!r)return!1;let l=s.padding;return o==="right"&&r.x+i/2>s.width-l.right||o==="left"&&r.x-i/2<l.left||o==="top"&&r.y-t<l.top||o==="bottom"&&r.y+t>s.height-l.bottom}_calculateAutoAlignment(e){if(e!=="auto")return e;let{_pointerOffsetInPx:t,_containerNode:i,_mainContainerNode:r,viewModel:o}=this,{screenLocation:s,view:l}=o;if(s==null||!l||!i)return"top-center";function d(I){return parseInt(I.replaceAll(/[^-\d\.]/g,""),10)}let u=r?window.getComputedStyle(r,null):null,p=u?d(u.getPropertyValue("max-height")):0,h=u?d(u.getPropertyValue("height")):0,{height:m,width:y}=i.getBoundingClientRect(),b=y+t,_=Math.max(m,p,h)+t,x=this._isOutsideView({popupHeight:_,popupWidth:b,screenLocation:s,side:"right",view:l}),T=this._isOutsideView({popupHeight:_,popupWidth:b,screenLocation:s,side:"left",view:l}),C=this._isOutsideView({popupHeight:_,popupWidth:b,screenLocation:s,side:"top",view:l}),R=this._isOutsideView({popupHeight:_,popupWidth:b,screenLocation:s,side:"bottom",view:l});return T?C?"bottom-right":"top-right":x?C?"bottom-left":"top-left":C?R?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return typeof e=="function"?e.call(this):e}_getCurrentAlignment(){let{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){let t=["left","right"];return se(this.container)&&t.reverse(),e?.replace(/leading/gi,t[0]).replaceAll(/trailing/gi,t[1])}_callDockPosition(e){return typeof e=="function"?e.call(this):e}_getDockPosition(){return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(this.dockOptions?.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_calculateAutoDockPosition(e){if(e!=="auto")return e;let t=this.viewModel?.view,i=se(this.container)?"top-left":"top-right";if(!t)return i;let r=t.padding||{left:0,right:0,top:0,bottom:0},o=t.width-r.left-r.right,{breakpoints:s}=t;return s&&o<=s.xsmall?"bottom-center":i}_getDockIcon(){let e=this._getDockPosition();if(this.dockEnabled)return"minimize";switch(e){case"top-left":case"bottom-left":return"dock-left";case"top-center":return"maximize";case"bottom-center":return"dock-bottom";default:return"dock-right"}}_handleDockIcon(){this._dockAction.icon=this._getDockIcon()}_handleDockEnabled(){this._dockAction.title=this.dockEnabled?this.messages?.undock:this.messages?.dock}_setMainContainerNode(e){this._mainContainerNode=e}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!this._containerNode)return;let{screenLocation:t}=this.viewModel,{width:i}=this._containerNode.getBoundingClientRect(),r=this._calculatePositionStyle(t,i);r&&Object.assign(this._containerNode.style,r)}_calculateFullWidth(e){let{currentAlignment:t,_pointerOffsetInPx:i}=this;return t==="top-left"||t==="bottom-left"||t==="top-right"||t==="bottom-right"?e+i:e}_calculateAlignmentPosition(e,t,i,r){let{currentAlignment:o,_pointerOffsetInPx:s}=this;if(!i)return;let{padding:l}=i,d=r/2,u=i.height-t,p=i.width-e;return o==="bottom-center"?{top:t+s-l.top,left:e-d-l.left}:o==="top-left"?{bottom:u+s-l.bottom,right:p+s-l.right}:o==="bottom-left"?{top:t+s-l.top,right:p+s-l.right}:o==="top-right"?{bottom:u+s-l.bottom,left:e+s-l.left}:o==="bottom-right"?{top:t+s-l.top,left:e+s-l.left}:o==="top-center"?{bottom:u+s-l.bottom,left:e-d-l.left}:void 0}_calculatePositionStyle(e,t){let{dockEnabled:i,view:r}=this;if(!r)return;if(i)return{left:"",top:"",right:"",bottom:""};if(e==null||!t)return;let o=this._calculateFullWidth(t),s=this._calculateAlignmentPosition(e.x,e.y,r,o);return s?{top:s.top!==void 0?`${s.top}px`:"auto",left:s.left!==void 0?`${s.left}px`:"auto",bottom:s.bottom!==void 0?`${s.bottom}px`:"auto",right:s.right!==void 0?`${s.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){e?this._wireUpView():t&&(this.close(),this.clear())}_wireUpView(){this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,i){let[r,o]=e,[s,l]=t,{width:d=0,height:u=0}=i??{};return r<=d&&s>d||r>d&&s<=d||o<=u&&l>u||o>u&&l<=u}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;let i=this.viewModel?.view?.padding||{left:0,right:0,top:0,bottom:0},r=i.left+i.right,o=i.top+i.bottom,s=[],l=[];s[0]=e[0]-r,s[1]=e[1]-o,l[0]=t[0]-r,l[1]=t[1]-o;let{dockOptions:d}=this,u=d.breakpoint;this._dockingThresholdCrossed(s,l,u)&&this._setDockEnabledForViewSize(d),this._setCurrentDockPosition()}_toggleScreenLocationEnabled(){let{dockEnabled:e,viewModel:t}=this;if(!t)return;let i=t.active&&!e;t.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){let t=e.breakpoint,i=this.viewModel?.view?.ui;if(!i)return!1;let{width:r,height:o}=i;if(isNaN(r)||isNaN(o)||!t)return!1;let s=t.hasOwnProperty("width")&&r<=(t.width??0),l=t.hasOwnProperty("height")&&o<=(t.height??0);return s||l}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}};n([a({readOnly:!0})],E.prototype,"_featureNavigationTop",null),n([a()],E.prototype,"actions",null),n([a()],E.prototype,"alignment",void 0),n([a()],E.prototype,"autoCloseEnabled",null),n([a()],E.prototype,"autoOpenEnabled",null),n([a()],E.prototype,"defaultPopupTemplateEnabled",null),n([a()],E.prototype,"content",null),n([a()],E.prototype,"collapsed",void 0),n([a()],E.prototype,"collapseEnabled",void 0),n([a({readOnly:!0})],E.prototype,"currentAlignment",null),n([a({readOnly:!0})],E.prototype,"currentDockPosition",null),n([a()],E.prototype,"dockOptions",null),n([a()],E.prototype,"dockEnabled",void 0),n([a({readOnly:!0})],E.prototype,"featureCount",null),n([a()],E.prototype,"featureMenuOpen",null),n([a()],E.prototype,"features",null),n([a()],E.prototype,"goToOverride",null),n([a()],E.prototype,"headingLevel",void 0),n([a()],E.prototype,"highlightEnabled",null),n([a()],E.prototype,"location",null),n([a()],E.prototype,"label",null),n([a()],E.prototype,"maxInlineActions",void 0),n([a(),B("esri/widgets/Popup/t9n/Popup")],E.prototype,"messages",void 0),n([a()],E.prototype,"promises",null),n([a({readOnly:!0})],E.prototype,"selectedFeature",null),n([a()],E.prototype,"selectedFeatureIndex",null),n([a({readOnly:!0})],E.prototype,"selectedFeatureWidget",null),n([a()],E.prototype,"spinnerEnabled",void 0),n([a()],E.prototype,"title",null),n([a()],E.prototype,"updateLocationEnabled",null),n([a()],E.prototype,"view",null),n([a({type:zi}),At(["triggerAction","trigger-action"])],E.prototype,"viewModel",void 0),n([a()],E.prototype,"visible",null),n([a({type:Wi,nonNullable:!0})],E.prototype,"visibleElements",void 0),E=n([w("esri.widgets.Popup")],E);var Sv=E;export{Sv as default};
