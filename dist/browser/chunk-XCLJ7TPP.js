import{a as w}from"./chunk-LLDE5IQ6.js";import{c as k}from"./chunk-3CZHUHY5.js";import{w as S}from"./chunk-M3GEY4SR.js";import{a as V}from"./chunk-4HXOVZYF.js";import{a as Y}from"./chunk-U2QVIRVP.js";import{a as G,k as O}from"./chunk-CJJRHJ2S.js";import{a as F}from"./chunk-55ESOXMJ.js";import{a as x}from"./chunk-5ETRXDS4.js";import{p as B,r as T}from"./chunk-465DRXTW.js";import{p as A}from"./chunk-AC62Z3FX.js";function v(r,t){return r?t?4:3:t?3:2}function z(r,t,e,s,o){if(!t?.lengths.length)return null;let a=o?.originPosition==="upperLeft"?-1:1;r.lengths.length&&(r.lengths.length=0),r.coords.length&&(r.coords.length=0);let i=r.coords,d=[],u=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:m,coords:g}=t,p=v(e,s),y=0;for(let n of m){let h=Z(u,g,y,n,e,s,a);h&&d.push(h),y+=n*p}if(d.sort((n,h)=>{let f=a*n[2]-a*h[2];return f===0&&e&&(f=n[4]-h[4]),f}),d.length){let n=6*d[0][2];i[0]=d[0][0]/n,i[1]=d[0][1]/n,e&&(n=6*d[0][4],i[2]=n!==0?d[0][3]/n:0),(i[0]<u[0]||i[0]>u[1]||i[1]<u[2]||i[1]>u[3]||e&&(i[2]<u[4]||i[2]>u[5]))&&(i.length=0)}if(!i.length){let n=t.lengths[0]?R(g,0,m[0],e,s):null;if(!n)return null;i[0]=n[0],i[1]=n[1],e&&n.length>2&&(i[2]=n[2])}return r}function Z(r,t,e,s,o,a,i=1){let d=v(o,a),u=e,m=e+d,g=0,p=0,y=0,n=0,h=0;for(let E=0,b=s-1;E<b;E++,u+=d,m+=d){let I=t[u],_=t[u+1],l=t[u+2],c=t[m],C=t[m+1],M=t[m+2],N=I*C-c*_;n+=N,g+=(I+c)*N,p+=(_+C)*N,o&&(N=I*M-c*l,y+=(l+M)*N,h+=N),I<r[0]&&(r[0]=I),I>r[1]&&(r[1]=I),_<r[2]&&(r[2]=_),_>r[3]&&(r[3]=_),o&&(l<r[4]&&(r[4]=l),l>r[5]&&(r[5]=l))}if(n*i>0&&(n*=-1),h*i>0&&(h*=-1),!n)return null;let f=[g,p,.5*n];return o&&(f[3]=y,f[4]=.5*h),f}function R(r,t,e,s,o){let a=v(s,o),i=t,d=t+a,u=0,m=0,g=0,p=0;for(let y=0,n=e-1;y<n;y++,i+=a,d+=a){let h=r[i],f=r[i+1],E=r[i+2],b=r[d],I=r[d+1],_=r[d+2],l=s?q(h,f,E,b,I,_):L(h,f,b,I);if(l)if(u+=l,s){let c=U(h,f,E,b,I,_);m+=l*c[0],g+=l*c[1],p+=l*c[2]}else{let c=Q(h,f,b,I);m+=l*c[0],g+=l*c[1]}}return u>0?s?[m/u,g/u,p/u]:[m/u,g/u]:e>0?s?[r[t],r[t+1],r[t+2]]:[r[t],r[t+1]]:null}function L(r,t,e,s){let o=e-r,a=s-t;return Math.sqrt(o*o+a*a)}function q(r,t,e,s,o,a){let i=s-r,d=o-t,u=a-e;return Math.sqrt(i*i+d*d+u*u)}function Q(r,t,e,s){return[r+.5*(e-r),t+.5*(s-t)]}function U(r,t,e,s,o,a){return[r+.5*(s-r),t+.5*(o-t),e+.5*(a-e)]}var j={getObjectId:r=>r.objectId,getAttributes:r=>r.attributes,getAttribute:(r,t)=>r.attributes[t],cloneWithGeometry:(r,t)=>new V(t,r.attributes,null,r.objectId),getGeometry:r=>r.geometry,getCentroid:(r,t)=>(r.centroid==null&&(r.centroid=z(new Y,r.geometry,t.hasZ,t.hasM)),r.centroid)};var W=G(),P=class{constructor(t){this.geometryInfo=t,this._boundsStore=new w,this._featuresById=new Map,this._markedIds=new Set,this.events=new x,this.featureAdapter=j}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let t=0;return this._featuresById.forEach(e=>{e.geometry!=null&&e.geometry.coords&&(t+=e.geometry.coords.length)}),{featureCount:this._featuresById.size,vertexCount:t/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(t){if(this.fullBounds==null)return null;let[e,s,o,a]=this.fullBounds;return{xmin:e,ymin:s,xmax:o,ymax:a,spatialReference:k(t)}}add(t){this._add(t),this._emitChanged()}addMany(t){for(let e of t)this._add(e);this._emitChanged()}upsertMany(t){let e=t.map(s=>this._upsert(s));return this._emitChanged(),e.filter(A)}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}removeById(t){let e=this._featuresById.get(t);return e?(this._remove(e),this._emitChanged(),e):null}removeManyById(t){this._boundsStore.invalidateIndex();for(let e of t){let s=this._featuresById.get(e);s&&this._remove(s)}this._emitChanged()}forEachBounds(t,e){for(let s of t){let o=this._boundsStore.get(s.objectId);o&&e(O(W,o))}}getFeature(t){return this._featuresById.get(t)}has(t){return this._featuresById.has(t)}forEach(t){this._featuresById.forEach(e=>t(e))}forEachInBounds(t,e){this._boundsStore.forEachInBounds(t,s=>{e(this._featuresById.get(s))})}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}sweep(){let t=!1;this._featuresById.forEach((e,s)=>{this._markedIds.has(s)||(t=!0,this._remove(e))}),this._markedIds.clear(),t&&this._emitChanged()}_emitChanged(){this.events.emit("changed",void 0)}_add(t){if(!t)return;let e=t.objectId;if(e==null)return void B.getLogger("esri.layers.graphics.data.FeatureStore").error(new T("featurestore:invalid-feature","feature id is missing",{feature:t}));let s=this._featuresById.get(e),o;if(this._markedIds.add(e),s?(t.displayId=s.displayId,o=this._boundsStore.get(e),this._boundsStore.delete(e)):this.onFeatureAdd!=null&&this.onFeatureAdd(t),!t.geometry?.coords?.length)return this._boundsStore.set(e,null),void this._featuresById.set(e,t);o=S(o??F(),t.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),o!=null&&this._boundsStore.set(e,o),this._featuresById.set(e,t)}_upsert(t){let e=t?.objectId;if(e==null)return B.getLogger("esri.layers.graphics.data.FeatureStore").error(new T("featurestore:invalid-feature","feature id is missing",{feature:t})),null;let s=this._featuresById.get(e);if(!s)return this._add(t),t;this._markedIds.add(e);let{geometry:o,attributes:a}=t;for(let i in a)s.attributes[i]=a[i];return o&&(s.geometry=o,this._boundsStore.set(e,S(F(),o,this.geometryInfo.hasZ,this.geometryInfo.hasM)??null)),s}_remove(t){this.onFeatureRemove!=null&&this.onFeatureRemove(t);let e=t.objectId;return this._markedIds.delete(e),this._boundsStore.delete(e),this._featuresById.delete(e),t}};export{P as a};
