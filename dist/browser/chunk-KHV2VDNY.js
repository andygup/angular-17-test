import{a as L}from"./chunk-FJMWXCU4.js";import{b as I}from"./chunk-UEH4FZMX.js";import{c as F}from"./chunk-5ZJSZISC.js";import{a as v}from"./chunk-EVB25YXG.js";import{b as T}from"./chunk-IGGE7N7W.js";import{o as N}from"./chunk-EKY6QR7N.js";import{b as M,c as m,h as _,i as A,r as p}from"./chunk-TKTKGUCU.js";import{a as g}from"./chunk-WKOJXXCZ.js";import{b as S}from"./chunk-YEFC7M4L.js";import{c as D,g as O,h as R,i as C,j as E}from"./chunk-7UQPY7PH.js";import{d as b}from"./chunk-MXH75ZNY.js";import{b as y,c as B}from"./chunk-XDTDVCGP.js";var H=Math.PI/180,V=4,f=class extends I{constructor(i){super(),this._program=null,this._vao=null,this._vertexBuffer=null,this._indexBuffer=null,this._dvsMat3=g(),this._localOrigin={x:0,y:0},this._getBounds=i}destroy(){this._vao&&(this._vao.dispose(),this._vao=null,this._vertexBuffer=null,this._indexBuffer=null),this._program=B(this._program)}doRender(i){let{context:t}=i,o=this._getBounds();if(o.length<1)return;this._createShaderProgram(t),this._updateMatricesAndLocalOrigin(i),this._updateBufferData(t,o),t.setBlendingEnabled(!0),t.setDepthTestEnabled(!1),t.setStencilWriteMask(0),t.setStencilTestEnabled(!1),t.setBlendFunction(m.ONE,m.ONE_MINUS_SRC_ALPHA),t.setColorMask(!0,!0,!0,!0);let h=this._program;t.bindVAO(this._vao),t.useProgram(h),h.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),t.gl.lineWidth(1),t.drawElements(M.LINES,8*o.length,_.UNSIGNED_INT,0),t.bindVAO()}_createTransforms(){return{dvs:g()}}_createShaderProgram(i){if(this._program)return;let t=`precision highp float;
        uniform mat3 u_dvsMat3;

        attribute vec2 a_position;

        void main() {
          mediump vec3 pos = u_dvsMat3 * vec3(a_position, 1.0);
          gl_Position = vec4(pos.xy, 0.0, 1.0);
        }`,o=`precision mediump float;
      void main() {
        gl_FragColor = vec4(0.75, 0.0, 0.0, 0.75);
      }`;this._program=i.programCache.acquire(t,o,P().attributes)}_updateMatricesAndLocalOrigin(i){let{state:t}=i,{displayMat3:o,size:h,resolution:c,pixelRatio:a,rotation:n,viewpoint:e}=t,l=H*n,{x:s,y:w}=e.targetGeometry,U=b(s,t.spatialReference);this._localOrigin.x=U,this._localOrigin.y=w;let x=a*h[0],u=a*h[1],j=c*x,k=c*u,d=D(this._dvsMat3);O(d,d,o),R(d,d,S(x/2,u/2)),E(d,d,T(h[0]/j,-u/k,1)),C(d,d,-l)}_updateBufferData(i,t){let{x:o,y:h}=this._localOrigin,c=2*V*t.length,a=new Float32Array(c),n=new Uint32Array(8*t.length),e=0,l=0;for(let s of t)s&&(a[2*e]=s[0]-o,a[2*e+1]=s[1]-h,a[2*e+2]=s[0]-o,a[2*e+3]=s[3]-h,a[2*e+4]=s[2]-o,a[2*e+5]=s[3]-h,a[2*e+6]=s[2]-o,a[2*e+7]=s[1]-h,n[l]=e+0,n[l+1]=e+3,n[l+2]=e+3,n[l+3]=e+2,n[l+4]=e+2,n[l+5]=e+1,n[l+6]=e+1,n[l+7]=e+0,e+=4,l+=8);if(this._vertexBuffer?this._vertexBuffer.setData(a.buffer):this._vertexBuffer=v.createVertex(i,p.DYNAMIC_DRAW,a.buffer),this._indexBuffer?this._indexBuffer.setData(n):this._indexBuffer=v.createIndex(i,p.DYNAMIC_DRAW,n),!this._vao){let s=P();this._vao=new F(i,s.attributes,s.bufferLayouts,{geometry:this._vertexBuffer},this._indexBuffer)}}},P=()=>N("bounds",{geometry:[{location:0,name:"a_position",count:2,type:_.FLOAT}]});var at=class extends L{constructor(r){super(r),this.checkHighlight=()=>!0}destroy(){super.destroy(),this._boundsRenderer=y(this._boundsRenderer)}enableRenderingBounds(r){this._boundsRenderer=new f(r),this.requestRender()}get hasHighlight(){return this.checkHighlight()}onTileData(r,i){r.patch(i),this.contains(r)||this.addChild(r),this.requestRender()}onTileError(r){r.clear(),this.contains(r)||this.addChild(r)}_renderChildren(r,i){for(let t of this.children)t.isReady&&t.hasData&&(t.commit(r),r.context.setStencilFunction(A.EQUAL,t.stencilRef,255),t.getDisplayList().replay(r,t,i))}};export{at as a};
