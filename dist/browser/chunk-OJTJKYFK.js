import{a as u,b as L}from"./chunk-WSUW6W66.js";import{a as y,b as T}from"./chunk-WF5LZUVW.js";import{g as x}from"./chunk-VL6L3PH6.js";import{b as v,e as h}from"./chunk-EGQHBYFL.js";import{a as A,c as R,d as S}from"./chunk-QB3NROF7.js";import{v as I}from"./chunk-6UQ2Y4IC.js";import{a as D}from"./chunk-KZREEH45.js";import{n as w}from"./chunk-4KJ462UD.js";import{w as G}from"./chunk-MYELF7MV.js";import{c as m}from"./chunk-AQ74ANSJ.js";import{a as j}from"./chunk-WUM4JBII.js";import{a as _,f as E}from"./chunk-CBOFHDSC.js";import{a as f}from"./chunk-HBTOKQC5.js";import{a as b}from"./chunk-A52LT7YB.js";import{h as N}from"./chunk-FNDPIYNC.js";import{H as o}from"./chunk-WMYPRHRR.js";import{R as d}from"./chunk-IAMDMFZ7.js";import{a as r}from"./chunk-53MWZ23O.js";import{b as l,i as g}from"./chunk-465DRXTW.js";var F,P="esri.layers.support.FeatureReductionBinning",a=F=class extends y{constructor(i){super(i),this.type="binning",this.binType="geohash",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}writeFields(i,s,t){let e=i.filter(p=>p.statisticType!=="avg_angle").map(p=>p.toJSON());g(t,e,s)}readRenderer(i,s,t){let e=s.drawingInfo?.renderer;return e?h(e,s,t)??void 0:I(s,t)}clone(){return new F({fields:l(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:l(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:l(this.popupTemplate),renderer:l(this.renderer)})}};r([j({binning:"binning"})],a.prototype,"type",void 0),r([j({geohash:"geohash"})],a.prototype,"binType",void 0),r([o({type:Number,range:{min:1,max:9},json:{write:!0}})],a.prototype,"fixedBinLevel",void 0),r([o({type:[x],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],a.prototype,"labelingInfo",void 0),r([o(S)],a.prototype,"labelsVisible",void 0),r([o({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],a.prototype,"maxScale",void 0),r([o(R)],a.prototype,"popupEnabled",void 0),r([o({type:w,json:{name:"popupInfo",write:!0}})],a.prototype,"popupTemplate",void 0),r([o({type:[u],json:{write:!0}})],a.prototype,"fields",void 0),r([b("fields")],a.prototype,"writeFields",null),r([o({types:v,json:{write:{target:"drawingInfo.renderer"}}})],a.prototype,"renderer",void 0),r([f("renderer",["drawingInfo.renderer"])],a.prototype,"readRenderer",null),a=F=r([d(P)],a);var V=a;var z,H="esri.layers.support.FeatureReductionCluster";function B(i){return i.type==="simple"&&!i.visualVariables?.length}var n=z=class extends N{constructor(i){super(i),this.type="cluster",this.clusterRadius=m("80px"),this.clusterMinSize=m("12px"),this.clusterMaxSize=m("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}readRenderer(i,s,t){let e=s.drawingInfo?.renderer;return e?.authoringInfo?.isAutoGenerated?null:e?B(e)?null:h(e,s,t)??void 0:I(s,t)}readSymbol(i,s,t){let e=s.drawingInfo?.renderer;return e?.authoringInfo?.isAutoGenerated?null:e&&B(e)?h(e,s,t)?.symbol:null}writeSymbol(i,s,t,e){let p=this.renderer?.authoringInfo?.isAutoGenerated;if(!this.renderer||p){let c=new D({symbol:i});s.drawingInfo={renderer:c.write({},e)}}}writeFields(i,s,t){let e=i.filter(p=>p.statisticType!=="avg_angle").map(p=>p.toJSON());g(t,e,s)}readFields(i,s,t){return i.filter(e=>!e.isAutoGenerated).map(e=>u.fromJSON(e))}clone(){return new z({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:l(this.labelingInfo),labelsVisible:this.labelsVisible,fields:l(this.fields),maxScale:this.maxScale,renderer:l(this.renderer),symbol:l(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:l(this.popupTemplate)})}};r([o({type:["cluster"],readOnly:!0,json:{write:!0}})],n.prototype,"type",void 0),r([o({type:Number,cast:i=>i==="auto"?i:m(i),json:{write:!0}})],n.prototype,"clusterRadius",void 0),r([o({type:Number,cast:m,json:{write:!0}})],n.prototype,"clusterMinSize",void 0),r([o({type:Number,cast:m,json:{write:!0}})],n.prototype,"clusterMaxSize",void 0),r([o({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],n.prototype,"maxScale",void 0),r([o(R)],n.prototype,"popupEnabled",void 0),r([o({type:w,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],n.prototype,"popupTemplate",void 0),r([o({types:v,json:{write:{target:"drawingInfo.renderer"}}})],n.prototype,"renderer",void 0),r([f("renderer",["drawingInfo.renderer"])],n.prototype,"readRenderer",null),r([o({types:G})],n.prototype,"symbol",void 0),r([f("symbol",["drawingInfo.renderer"])],n.prototype,"readSymbol",null),r([b("symbol")],n.prototype,"writeSymbol",null),r([o({type:[x],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],n.prototype,"labelingInfo",void 0),r([o(S)],n.prototype,"labelsVisible",void 0),r([o({type:[u],json:{write:!0}})],n.prototype,"fields",void 0),r([b("fields")],n.prototype,"writeFields",null),r([f("fields")],n.prototype,"readFields",null),n=z=r([d(H)],n);var M=n;var O={key:"type",base:y,typeMap:{cluster:M,binning:V}},C={types:{key:"type",base:y,typeMap:{selection:T,cluster:M,binning:V}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:O},"portal-item":{types:O},"web-scene":{types:{key:"type",base:y,typeMap:{selection:T}},name:"layerDefinition.featureReduction",write:{layerContainerTypes:A}}}}};var ar=i=>{let s=class extends i{constructor(...t){super(...t),this.addHandles(_(()=>this.renderer,()=>{if(this.featureReduction){let e=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",e)}},E))}set featureReduction(t){let e=this._normalizeFeatureReduction(t);this._set("featureReduction",e)}set renderer(t){}_normalizeFeatureReduction(t){if(t?.type!=="cluster")return t;let e=t.clone(),p=[new u({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],c=(e.fields??[]).filter(k=>!k.isAutoGenerated);if(t.renderer&&!t.renderer.authoringInfo?.isAutoGenerated)return e.fields=[...p,...c],e;if(t.symbol)return e.fields=[...p,...c],e.renderer=null,e;if(!this.renderer)return t;let J=L(p,this.renderer,t,null,!1);return e.fields=[...p,...c],e.renderer=J,e}};return r([o(C)],s.prototype,"featureReduction",null),s=r([d("esri.layers.mixins.FeatureReductionLayer")],s),s};export{ar as a};
