import{g as It}from"./chunk-EJ3VIBAJ.js";import{j as Tt}from"./chunk-6QIKBCPR.js";import{o as Pt}from"./chunk-CZPMRK53.js";import{a as Ut}from"./chunk-2BBIRZVO.js";import{a as vt}from"./chunk-WQAXQD4X.js";import{h as bt}from"./chunk-FNDPIYNC.js";import{H as z}from"./chunk-WMYPRHRR.js";import{R as At}from"./chunk-IAMDMFZ7.js";import{a as W}from"./chunk-53MWZ23O.js";import{i as kt}from"./chunk-PT7S6WNL.js";import{b as yt,p as H,r as Mt}from"./chunk-465DRXTW.js";import{a as Y,b as pt}from"./chunk-AC62Z3FX.js";import{g as at}from"./chunk-ESDYQQXO.js";var ot=class{constructor(e=null,n=null,r=null){this.minValue=e,this.maxValue=n,this.noDataValue=r}};var Jt=9999999e31,Xt=2e-7,zt={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34028234663852886e22,34028234663852886e22],f64:[-Number.MAX_VALUE,Number.MAX_VALUE],unknown:void 0,c64:void 0,c128:void 0};function it(t){return zt[t]??[-34028234663852886e22,34028234663852886e22]}function xe(t,e,n){if(t.depthCount&&t.depthCount>1)return;let{pixels:r,statistics:h,pixelType:s}=t,l=r[0].length,c=t.bandMasks??[],a=t.mask??new Uint8Array(l).fill(255),o=s==="f32"||s==="f64",i=it(s),f=!1;for(let p=0;p<r.length;p++){let u=typeof e=="number"?e:e[p];if(u==null)continue;let m=h?.[p]?.minValue??i[0],d=h?.[p]?.maxValue??i[1];if(m>u+Number.EPSILON||d<u-Number.EPSILON)continue;let g=c[p]||a.slice(),y=r[p],k=n?.customFloatTolerance;if(o&&k!==0){let w=k;w||(w=Math.abs(u)>=Jt?Xt*Math.abs(u):s==="f32"?2**-23:Number.EPSILON);for(let M=0;M<y.length;M++)g[M]&&Math.abs(y[M]-u)<w&&(y[M]=0,g[M]=0,a[M]=0,f=!0)}else for(let w=0;w<y.length;w++)g[w]&&y[w]===u&&(y[w]=0,g[w]=0,a[w]=0,f=!0);c[p]=g}f&&(t.bandMasks=t.bandMasks||t.pixels.length>1?c:null,t.mask=a),f&&"updateStatistics"in t&&t.updateStatistics()}var Z,G=Z=class extends bt{static createEmptyBand(t,e){return new(Z.getPixelArrayConstructor(t))(e)}static getPixelArrayConstructor(t){let e;switch(t){case"u1":case"u2":case"u4":case"u8":e=Uint8Array;break;case"u16":e=Uint16Array;break;case"u32":e=Uint32Array;break;case"s8":e=Int8Array;break;case"s16":e=Int16Array;break;case"s32":e=Int32Array;break;case"f32":case"c64":case"c128":case"unknown":e=Float32Array;break;case"f64":e=Float64Array}return e}constructor(t){super(t),this.width=null,this.height=null,this.pixelType="f32",this.validPixelCount=null,this.mask=null,this.maskIsAlpha=!1,this.premultiplyAlpha=!1,this.statistics=null,this.depthCount=1}castPixelType(t){if(!t)return"f32";let e=t.toLowerCase();return["u1","u2","u4"].includes(e)?e="u8":["unknown","u8","s8","u16","s16","u32","s32","f32","f64"].includes(e)||(e="f32"),e}getPlaneCount(){return this.pixels?.length}addData(t){if(!t.pixels||t.pixels.length!==this.width*this.height)throw new Mt("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]),this.statistics||(this.statistics=[]),this.pixels.push(t.pixels),this.statistics.push(t.statistics??new ot)}getAsRGBA(){let t=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case"s8":case"s16":case"u16":case"s32":case"u32":case"f32":case"f64":this._fillFromNon8Bit(t);break;default:this._fillFrom8Bit(t)}return new Uint8ClampedArray(t)}getAsRGBAFloat(){let t=new Float32Array(this.width*this.height*4);return this._fillFrom32Bit(t),t}updateStatistics(){if(!this.pixels)return;this.statistics=this.pixels.map(n=>this._calculateBandStatistics(n,this.mask));let t=this.mask,e=0;if(t!=null)for(let n=0;n<t.length;n++)t[n]&&e++;else e=this.width*this.height;this.validPixelCount=e}clamp(t){if(!t||t==="f64"||t==="f32"||!this.pixels)return;let[e,n]=it(t),r=this.pixels,h=this.width*this.height,s=r.length,l,c,a,o=[];for(let i=0;i<s;i++){a=Z.createEmptyBand(t,h),l=r[i];for(let f=0;f<h;f++)c=l[f],a[f]=c>n?n:c<e?e:c;o.push(a)}this.pixels=o,this.pixelType=t}extractBands(t){let{pixels:e,statistics:n}=this;if(t==null||t.length===0||!e||e.length===0)return this;let r=e.length,h=t.some(f=>f>=e.length),s=r===t.length&&!t.some((f,p)=>f!==p);if(h||s)return this;let l=this.bandMasks?.length===r?t.map(f=>this.bandMasks[f]):void 0,{mask:c,validPixelCount:a}=this,{width:o,height:i}=this;if(l){if(l.length===1)c=l[0];else{let f=o*i;c=new Uint8Array(f).fill(255);for(let p=0;p<l.length;p++){let u=l[p];for(let m=0;m<f;m++)u[m]||(c[m]=0)}}a=c.filter(f=>!!f).length}return new Z({pixelType:this.pixelType,width:o,height:i,mask:c,bandMasks:l,validPixelCount:a,maskIsAlpha:this.maskIsAlpha,pixels:t.map(f=>e[f]),statistics:n&&t.map(f=>n[f])})}clone(){let t=new Z({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount}),e;this.mask!=null&&(this.mask instanceof Uint8Array?t.mask=new Uint8Array(this.mask):t.mask=this.mask.slice(0)),this.bandMasks&&(t.bandMasks=this.bandMasks.map(r=>new Uint8Array(r)));let n=Z.getPixelArrayConstructor(this.pixelType);if(this.pixels&&this.pixels.length>0){t.pixels=[];let r=!!this.pixels[0].slice;for(e=0;e<this.pixels.length;e++)t.pixels[e]=r?this.pixels[e].slice(0,this.pixels[e].length):new n(this.pixels[e])}if(this.statistics)for(t.statistics=[],e=0;e<this.statistics.length;e++)t.statistics[e]=yt(this.statistics[e]);return t.premultiplyAlpha=this.premultiplyAlpha,t}_fillFrom8Bit(t){let{mask:e,maskIsAlpha:n,premultiplyAlpha:r,pixels:h}=this;if(!t||!h?.length)return void H.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.");let s,l,c,a;s=l=c=h[0],h.length>=3?(l=h[1],c=h[2]):h.length===2&&(l=h[1]);let o=new Uint32Array(t),i=this.width*this.height;if(s.length===i)if(e!=null&&e.length===i)if(n)for(a=0;a<i;a++){let f=e[a];if(f){let p=f/255;o[a]=r?f<<24|c[a]*p<<16|l[a]*p<<8|s[a]*p:f<<24|c[a]<<16|l[a]<<8|s[a]}}else for(a=0;a<i;a++)e[a]&&(o[a]=255<<24|c[a]<<16|l[a]<<8|s[a]);else for(a=0;a<i;a++)o[a]=255<<24|c[a]<<16|l[a]<<8|s[a];else H.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.")}_fillFromNon8Bit(t){let{pixels:e,mask:n,statistics:r}=this;if(!t||!e?.length)return void H.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.");let h=this.pixelType,s=1,l=0,c=1;if(r&&r.length>0){for(let d of r)if(d.minValue!=null&&(l=Math.min(l,d.minValue)),d.maxValue!=null&&d.minValue!=null){let g=d.maxValue-d.minValue;c=Math.max(c,g)}s=255/c}else{let d=255;h==="s8"?(l=-128,d=127):h==="u16"?d=65535:h==="s16"?(l=-32768,d=32767):h==="u32"?d=4294967295:h==="s32"?(l=-2147483648,d=2147483647):h==="f32"?(l=-34e38,d=34e38):h==="f64"&&(l=-Number.MAX_VALUE,d=Number.MAX_VALUE),s=255/(d-l)}let a=new Uint32Array(t),o=this.width*this.height,i,f,p,u,m;if(i=f=p=e[0],i.length!==o)return H.getLogger(this).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(e.length>=2)if(f=e[1],e.length>=3&&(p=e[2]),n!=null&&n.length===o)for(u=0;u<o;u++)n[u]&&(a[u]=255<<24|(p[u]-l)*s<<16|(f[u]-l)*s<<8|(i[u]-l)*s);else for(u=0;u<o;u++)a[u]=255<<24|(p[u]-l)*s<<16|(f[u]-l)*s<<8|(i[u]-l)*s;else if(n!=null&&n.length===o)for(u=0;u<o;u++)m=(i[u]-l)*s,n[u]&&(a[u]=255<<24|m<<16|m<<8|m);else for(u=0;u<o;u++)m=(i[u]-l)*s,a[u]=255<<24|m<<16|m<<8|m}_fillFrom32Bit(t){let{pixels:e,mask:n}=this;if(!t||!e?.length)return H.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");let r,h,s,l;r=h=s=e[0],e.length>=3?(h=e[1],s=e[2]):e.length===2&&(h=e[1]);let c=this.width*this.height;if(r.length!==c)return H.getLogger(this).error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");let a=0;if(n!=null&&n.length===c)for(l=0;l<c;l++)t[a++]=r[l],t[a++]=h[l],t[a++]=s[l],t[a++]=1&n[l];else for(l=0;l<c;l++)t[a++]=r[l],t[a++]=h[l],t[a++]=s[l],t[a++]=1}_calculateBandStatistics(t,e){let n=1/0,r=-1/0,h=t.length,s,l=0;if(e!=null)for(s=0;s<h;s++)e[s]&&(l=t[s],n=l<n?l:n,r=l>r?l:r);else for(s=0;s<h;s++)l=t[s],n=l<n?l:n,r=l>r?l:r;return new ot(n,r)}};W([z({json:{write:!0}})],G.prototype,"width",void 0),W([z({json:{write:!0}})],G.prototype,"height",void 0),W([z({json:{write:!0}})],G.prototype,"pixelType",void 0),W([Ut("pixelType")],G.prototype,"castPixelType",null),W([z({json:{write:!0}})],G.prototype,"validPixelCount",void 0),W([z({json:{write:!0}})],G.prototype,"mask",void 0),W([z({json:{write:!0}})],G.prototype,"maskIsAlpha",void 0),W([z({json:{write:!0}})],G.prototype,"pixels",void 0),W([z()],G.prototype,"premultiplyAlpha",void 0),W([z({json:{write:!0}})],G.prototype,"statistics",void 0),W([z({json:{write:!0}})],G.prototype,"depthCount",void 0),W([z({json:{write:!0}})],G.prototype,"noDataValues",void 0),W([z({json:{write:!0}})],G.prototype,"bandMasks",void 0),G=Z=W([At("esri.layers.support.PixelBlock")],G);var D=G;var Bt,St;(function(t){t[t.matchAny=0]="matchAny",t[t.matchAll=1]="matchAll"})(Bt||(Bt={})),function(t){t[t.bestMatch=0]="bestMatch",t[t.fail=1]="fail"}(St||(St={}));var Ce=6;function R(t){return t!=null&&t.declaredClass==="esri.layers.support.PixelBlock"&&t.pixels&&t.pixels.length>0}function _e(t){if(!t?.length||t.some(i=>!R(i)))return null;if(t.length===1)return t[0]?.clone()??null;let e=t,{width:n,height:r,pixelType:h}=e[0];if(e.some(i=>i.width!==n||i.height!==r))return null;let s=e.map(({mask:i})=>i).filter(i=>i!=null),l=null;s.length&&(l=new Uint8Array(n*r),l.set(s[0]),s.length>1&&Dt(s.slice(1),l));let c=[];e.forEach(({pixels:i})=>c.push(...i));let a=e.map(({statistics:i})=>i).filter(i=>i?.length),o=[];return a.forEach(i=>o.push(...i)),new D({pixelType:h,width:n,height:r,mask:l,pixels:c,statistics:o.length?o:null})}function De(t){if(!t)return;let e=t.colormap;if(!e||e.length===0)return;let n=e.sort((f,p)=>f[0]-p[0]),r=0;n[0][0]<0&&(r=n[0][0]);let h=Math.max(256,n[n.length-1][0]-r+1),s=new Uint8Array(4*h),l=[],c,a=0,o=0,i=n[0].length===5;if(h>65536)return n.forEach(f=>{l[f[0]-r]=i?f.slice(1):f.slice(1).concat([255])}),{indexed2DColormap:l,offset:r,alphaSpecified:i};if(t.fillUnspecified)for(c=n[o],a=c[0]-r;a<h;a++)s[4*a]=c[1],s[4*a+1]=c[2],s[4*a+2]=c[3],s[4*a+3]=i?c[4]:255,a===c[0]-r&&(c=o===n.length-1?c:n[++o]);else for(a=0;a<n.length;a++)c=n[a],o=4*(c[0]-r),s[o]=c[1],s[o+1]=c[2],s[o+2]=c[3],s[o+3]=i?c[4]:255;return{indexedColormap:s,offset:r,alphaSpecified:i}}function Le(t,e){if(!R(t)||!e||!e.indexedColormap&&!e.indexed2DColormap)return t;let n=t.clone(),r=n.pixels,h=n.mask,s=n.width*n.height;if(r.length!==1)return t;let{indexedColormap:l,indexed2DColormap:c,offset:a,alphaSpecified:o}=e,i=0,f=r[0],p=new Uint8Array(f.length),u=new Uint8Array(f.length),m=new Uint8Array(f.length),d,g=0;if(l){let y=l.length-1;if(h!=null)for(i=0;i<s;i++)h[i]&&(g=4*(f[i]-a),g<a||g>y?h[i]=0:(p[i]=l[g],u[i]=l[g+1],m[i]=l[g+2],h[i]=l[g+3]));else{for(h=new Uint8Array(s),i=0;i<s;i++)g=4*(f[i]-a),g<a||g>y?h[i]=0:(p[i]=l[g],u[i]=l[g+1],m[i]=l[g+2],h[i]=l[g+3]);n.mask=h}}else if(c)if(h!=null)for(i=0;i<s;i++)h[i]&&(d=c[f[i]],p[i]=d[0],u[i]=d[1],m[i]=d[2],h[i]=d[3]);else{for(h=new Uint8Array(s),i=0;i<s;i++)d=c[f[i]],p[i]=d[0],u[i]=d[1],m[i]=d[2],h[i]=d[3];n.mask=h}return n.pixels=[p,u,m],n.statistics=null,n.pixelType="u8",n.maskIsAlpha=o,n}function Re(t,e){if(!R(t))return null;let{pixels:n,mask:r}=t,h=n.length,s=e.lut,{offset:l}=e;s&&s[0].length===1&&(s=n.map(()=>s));let c=[],a=e.outputPixelType||"u8";for(let i=0;i<h;i++){let f=_t(n[i],r,s[i],l||0,a);c.push(f)}let o=new D({width:t.width,height:t.height,pixels:c,mask:r,pixelType:a});return o.updateStatistics(),o}function _t(t,e,n,r,h){let s=t.length,l=D.createEmptyBand(h,s);if(e)for(let c=0;c<s;c++)e[c]&&(l[c]=n[t[c]-r]);else for(let c=0;c<s;c++)l[c]=n[t[c]-r];return l}function Ne(t,e){if(!R(t))return null;let n=t.clone(),{pixels:r}=n,h=n.width*n.height,s=e.length,l=Math.floor(s/2),c=e[Math.floor(l)],a=r[0],o,i,f,p,u,m,d=!1,g=new Uint8Array(h),y=new Uint8Array(h),k=new Uint8Array(h),w=n.mask,M=e[0].mappedColor.length===4;for(w||(w=new Uint8Array(h),w.fill(M?255:1),n.mask=w),u=0;u<h;u++)if(w[u]){for(o=a[u],d=!1,m=l,i=c,f=0,p=s-1;p-f>1;){if(o===i.value){d=!0;break}o>i.value?f=m:p=m,m=Math.floor((f+p)/2),i=e[Math.floor(m)]}d||(o===e[f].value?(i=e[f],d=!0):o===e[p].value?(i=e[p],d=!0):o<e[f].value?(d=!1,i=null):o>e[f].value&&(o<e[p].value?(i=e[f],d=!0):p===s-1?(d=!1,i=null):(i=e[p],d=!0))),d?(g[u]=i.mappedColor[0],y[u]=i.mappedColor[1],k[u]=i.mappedColor[2],w[u]=i.mappedColor[3]):g[u]=y[u]=k[u]=w[u]=0}return n.pixels=[g,y,k],n.mask=w,n.pixelType="u8",n.maskIsAlpha=M,n}function Ee(t,e){if(!R(t))return null;let{width:n,height:r}=t,{inputRanges:h,outputValues:s,outputPixelType:l,noDataRanges:c,allowUnmatched:a,isLastInputRangeInclusive:o}=e,i=t.pixels[0],f=D.createEmptyBand(l,i.length),p=t.mask,u=new Uint8Array(n*r);p?u.set(p):u.fill(255);let m=t.pixelType.startsWith("f")?1e-6:0,d=h.map(M=>M-m);d[0]=h[0],d[d.length-1]=h[h.length-1]+(o?1e-6:0);let g=h.length/2,[y,k]=it(l);for(let M=0;M<r;M++)for(let x=0;x<n;x++){let A=M*n+x;if(u[A]){let b=i[A],v=!1;for(let T=g-1;T>=0;T--)if(b===d[2*T]||b>d[2*T]&&b<d[2*T+1]){f[A]=s[T],v=!0;break}v||(a?f[A]=b>k?k:b<y?y:b:u[A]=0)}}let w=c?.length;if(w)for(let M=0;M<r;M++)for(let x=0;x<n;x++){let A=M*n+x;if(!p||p[A]){let b=i[A];for(let v=0;v<w;v+=2)if(b>=c[v]&&b<=c[v+1]){f[A]=0,u[A]=0;break}}}return new D({width:n,height:r,pixelType:l,pixels:[f],mask:u})}function Vt(t,e,n,r){let h=n!=null&&n.length>=2?new Set(n):null,s=n?.length===1?n[0]:null,l=!!e?.length;for(let c=0;c<t.length;c++)if(r[c]){let a=t[c];if(l){let o=!1;for(let i=0;i<e.length;i+=2)if(a>=e[i]&&a<=e[i+1]){o=!0;break}o||(r[c]=0)}r[c]&&(a===s||h?.has(a))&&(r[c]=0)}}function Ft(t,e){let n=t[0].length;for(let r=0;r<n;r++)if(e[r]){let h=!1;for(let s=0;s<t.length;s++)if(t[s][r]){h=!0;break}h||(e[r]=0)}}function Dt(t,e){let n=t[0].length;for(let r=0;r<n;r++)if(e[r]){let h=!1;for(let s=0;s<t.length;s++)if(t[s][r]===0){h=!0;break}h&&(e[r]=0)}}function Oe(t,e){if(!R(t))return null;let{width:n,height:r,pixels:h}=t,s=n*r,l=new Uint8Array(s);t.mask?l.set(t.mask):l.fill(255);let c=h.length,{includedRanges:a,noDataValues:o,outputPixelType:i,matchAll:f,lookups:p}=e;if(p){let u=[];for(let m=0;m<c;m++){let d=p[m],g=_t(h[m],l,d.lut,d.offset||0,"u8");u.push(g)}u.length===1?l.set(u[0]):f?Ft(u,l):Dt(u,l)}else if(f){let u=[];for(let m=0;m<c;m++){let d=new Uint8Array(s);d.set(l),Vt(h[m],a?.slice(2*m,2*m+2),o?.[m],d),u.push(d)}u.length===1?l.set(u[0]):Ft(u,l)}else for(let u=0;u<c;u++)Vt(h[u],a?.slice(2*u,2*u+2),o?.[u],l);return new D({width:n,height:r,pixelType:i,pixels:h,mask:l})}function je(t){let{srcPixelType:e,inputRanges:n,outputValues:r,allowUnmatched:h,noDataRanges:s,isLastInputRangeInclusive:l,outputPixelType:c}=t;if(e!=="u8"&&e!=="s8"&&e!=="u16"&&e!=="s16")return null;let a=e.includes("16")?65536:256,o=e.includes("s")?-a/2:0,i=D.createEmptyBand(c,a),f=new Uint8Array(a);h&&f.fill(255);let[p,u]=it(c);if(n?.length&&r?.length){let d=n.map(g=>g-1e-6);d[0]=n[0],l&&(d[d.length-1]=n[n.length-1]);for(let g=0;g<d.length;g++){let y=r[g]>u?u:r[g]<p?p:r[g],k=Math.ceil(d[2*g]-o),w=Math.floor(d[2*g+1]-o);for(let M=k;M<=w;M++)i[M]=y,f[M]=255}}if(s?.length)for(let m=0;m<s.length;m++){let d=Math.ceil(s[2*m]-o),g=Math.floor(s[2*m+1]-o);for(let y=d;y<=g;y++)f[y]=0}return{lut:i,offset:o,mask:f}}function Ge(t,e,n){if(t!=="u8"&&t!=="s8"&&t!=="u16"&&t!=="s16")return null;let r=t.includes("16")?65536:256,h=t.includes("s")?-r/2:0,s=new Uint8Array(r);if(e)for(let l=0;l<e.length;l++){let c=Math.ceil(e[2*l]-h),a=Math.floor(e[2*l+1]-h);for(let o=c;o<=a;o++)s[o]=255}else s.fill(255);if(n)for(let l=0;l<n.length;l++)s[n[l]-h]=0;return{lut:s,offset:h}}function Kt(t,e,n,r,h,s,l,c){return{xmin:h<=n*t?0:h<n*t+t?h-n*t:t,ymin:s<=r*e?0:s<r*e+e?s-r*e:e,xmax:h+l<=n*t?0:h+l<n*t+t?h+l-n*t:t,ymax:s+c<=r*e?0:s+c<r*e+e?s+c-r*e:e}}function qe(t,e){if(!t||t.length===0)return null;let n=t.find(m=>m.pixelBlock);if(n?.pixelBlock==null)return null;let r=(n.extent.xmax-n.extent.xmin)/n.pixelBlock.width,h=(n.extent.ymax-n.extent.ymin)/n.pixelBlock.height,s=.01*Math.min(r,h),l=t.sort((m,d)=>Math.abs(m.extent.ymax-d.extent.ymax)>s?d.extent.ymax-m.extent.ymax:Math.abs(m.extent.xmin-d.extent.xmin)>s?m.extent.xmin-d.extent.xmin:0),c=Math.min.apply(null,l.map(m=>m.extent.xmin)),a=Math.min.apply(null,l.map(m=>m.extent.ymin)),o=Math.max.apply(null,l.map(m=>m.extent.xmax)),i=Math.max.apply(null,l.map(m=>m.extent.ymax)),f={x:Math.round((e.xmin-c)/r),y:Math.round((i-e.ymax)/h)},p={width:Math.round((o-c)/r),height:Math.round((i-a)/h)},u={width:Math.round((e.xmax-e.xmin)/r),height:Math.round((e.ymax-e.ymin)/h)};return Math.round(p.width/n.pixelBlock.width)*Math.round(p.height/n.pixelBlock.height)!==l.length||f.x<0||f.y<0||p.width<u.width||p.height<u.height?null:{extent:e,pixelBlock:$t(l.map(m=>m.pixelBlock),p,{clipOffset:f,clipSize:u})}}function mt(t,e,n,r,h,s){let{width:l,height:c}=n.block,{x:a,y:o}=n.offset,{width:i,height:f}=n.mosaic,p=Kt(l,c,r,h,a,o,i,f),u=0,m=0;if(s){let d=s.hasGCSSShiftTransform?360:s.halfWorldWidth??0,g=l*s.resolutionX,y=s.startX+r*g;y<d&&y+g>d?m=s.rightPadding:y>=d&&(u=s.leftMargin-s.rightPadding,m=0)}if(p.xmax-=m,typeof e!="number")for(let d=p.ymin;d<p.ymax;d++){let g=(h*c+d-o)*i+(r*l-a)+u,y=d*l;for(let k=p.xmin;k<p.xmax;k++)t[g+k]=e[y+k]}else for(let d=p.ymin;d<p.ymax;d++){let g=(h*c+d-o)*i+(r*l-a)+u;for(let y=p.xmin;y<p.xmax;y++)t[g+y]=e}}function $t(t,e,n={}){let{clipOffset:r,clipSize:h,alignmentInfo:s,blockWidths:l}=n;if(l)return Ht(t,e,{blockWidths:l});let c=t.find(P=>R(P));if(c==null)return null;let a=h?h.width:e.width,o=h?h.height:e.height,i=c.width,f=c.height,p=e.width/i,u=e.height/f,m={offset:r||{x:0,y:0},mosaic:h||e,block:{width:i,height:f}},d=c.pixelType,g=D.getPixelArrayConstructor(d),y=c.pixels.length,k=[],w,M;for(let P=0;P<y;P++){M=new g(a*o);for(let I=0;I<u;I++)for(let U=0;U<p;U++){let B=t[I*p+U];R(B)&&(w=B.pixels[P],mt(M,w,m,U,I,s))}k.push(M)}let x=t.some(P=>P==null||P.mask!=null&&P.mask.length>0),A=t.some(P=>P?.bandMasks&&P.bandMasks.length>1),b=x?new Uint8Array(a*o):void 0,v=A?[]:void 0;if(b){for(let P=0;P<u;P++)for(let I=0;I<p;I++){let U=t[P*p+I],B=U!=null?U.mask:null;mt(b,B??(U?255:0),m,I,P,s)}if(v)for(let P=0;P<y;P++){let I=new Uint8Array(a*o);for(let U=0;U<u;U++)for(let B=0;B<p;B++){let C=t[U*p+B],V=C?.bandMasks?.[P]??C?.mask;mt(I,V??(C?255:0),m,B,U,s)}v.push(I)}}let T=new D({width:a,height:o,pixels:k,pixelType:d,bandMasks:v,mask:b});return T.updateStatistics(),T}function Ht(t,e,n){let r=t.find(g=>g!=null);if(r==null)return null;let h=t.some(g=>g==null||!!g.mask),{width:s,height:l}=e,c=h?new Uint8Array(s*l):null,{blockWidths:a}=n,o=[],i=r.getPlaneCount(),f=D.getPixelArrayConstructor(r.pixelType);if(h)for(let g=0,y=0;g<t.length;y+=a[g],g++){let k=t[g];if(!R(k))continue;let w=k.mask;for(let M=0;M<l;M++)for(let x=0;x<a[g];x++)c[M*s+x+y]=w==null?255:w[M*k.width+x]}let p=t.some(g=>g?.bandMasks&&g.bandMasks.length>1),u=p?[]:void 0,m=s*l;for(let g=0;g<i;g++){let y=new f(m),k=p?new Uint8Array(m):void 0;for(let w=0,M=0;w<t.length;M+=a[w],w++){let x=t[w];if(!R(x))continue;let A=x.pixels[g];if(A!=null){for(let b=0;b<l;b++)for(let v=0;v<a[w];v++)y[b*s+v+M]=A[b*x.width+v];if(k){let b=x.bandMasks?.[g]??x.mask;for(let v=0;v<l;v++)for(let T=0;T<a[w];T++)k[v*s+T+M]=b?b[v*x.width+T]:255}}}o.push(y),u&&k&&u.push(k)}let d=new D({width:s,height:l,mask:c,bandMasks:u,pixels:o,pixelType:r.pixelType});return d.updateStatistics(),d}function We(t,e,n){if(!R(t))return null;let{width:r,height:h}=t,s=e.x,l=e.y,c=n.width+s,a=n.height+l;if(s<0||l<0||c>r||a>h||s===0&&l===0&&c===r&&a===h)return t;t.mask||(t.mask=new Uint8Array(r*h));let o=t.mask;for(let i=0;i<h;i++){let f=i*r;for(let p=0;p<r;p++)o[f+p]=i<l||i>=a||p<s||p>=c?0:1}return t.updateStatistics(),t}function Qt(t){if(!R(t))return null;let e=t.clone(),{width:n,height:r,pixels:h}=t,s=h[0],l=e.pixels[0],c=t.mask;for(let a=2;a<r-1;a++){let o=new Map;for(let f=a-2;f<a+2;f++)for(let p=0;p<4;p++){let u=f*n+p;rt(o,s[u],c?c[u]:1)}l[a*n]=Ct(o),l[a*n+1]=l[a*n+2]=l[a*n];let i=3;for(;i<n-1;i++){let f=(a-2)*n+i+1;rt(o,s[f],c?c[f]:1),f=(a-1)*n+i+1,rt(o,s[f],c?c[f]:1),f=a*n+i+1,rt(o,s[f],c?c[f]:1),f=(a+1)*n+i+1,rt(o,s[f],c?c[f]:1),f=(a-2)*n+i-3,ht(o,s[f],c?c[f]:1),f=(a-1)*n+i-3,ht(o,s[f],c?c[f]:1),f=a*n+i-3,ht(o,s[f],c?c[f]:1),f=(a+1)*n+i-3,ht(o,s[f],c?c[f]:1),l[a*n+i]=Ct(o)}l[a*n+i+1]=l[a*n+i]}for(let a=0;a<n;a++)l[a]=l[n+a]=l[2*n+a],l[(r-1)*n+a]=l[(r-2)*n+a];return e.updateStatistics(),e}function Ct(t){if(t.size===0)return 0;let e=0,n=-1,r=0,h=t.keys(),s=h.next();for(;!s.done;)r=t.get(s.value),r>e&&(n=s.value,e=r),s=h.next();return n}function ht(t,e,n){if(n===0)return;let r=t.get(e);r===1?t.delete(e):t.set(e,r-1)}function rt(t,e,n){n!==0&&t.set(e,t.has(e)?t.get(e)+1:1)}function Yt(t,e,n){let{x:r,y:h}=e,{width:s,height:l}=n;if(r===0&&h===0&&l===t.height&&s===t.width)return t;let{width:c,height:a}=t,o=Math.max(0,h),i=Math.max(0,r),f=Math.min(r+s,c),p=Math.min(h+l,a);if(f<0||p<0||!R(t))return null;r=Math.max(0,-r),h=Math.max(0,-h);let{pixels:u}=t,m=s*l,d=u.length,g=[];for(let M=0;M<d;M++){let x=u[M],A=D.createEmptyBand(t.pixelType,m);for(let b=o;b<p;b++){let v=b*c,T=(b+h-o)*s+r;for(let P=i;P<f;P++)A[T++]=x[v+P]}g.push(A)}let y=new Uint8Array(m),k=t.mask;for(let M=o;M<p;M++){let x=M*c,A=(M+h-o)*s+r;for(let b=i;b<f;b++)y[A++]=k?k[x+b]:1}let w=new D({width:n.width,height:n.height,pixelType:t.pixelType,pixels:g,mask:y});return w.updateStatistics(),w}function Zt(t,e=!0){if(!R(t))return null;let{pixels:n,width:r,height:h,mask:s,pixelType:l}=t,c=[],a=Math.round(r/2),o=Math.round(h/2),i=h-1,f=r-1;for(let u=0;u<n.length;u++){let m=n[u],d=D.createEmptyBand(l,a*o),g=0;for(let y=0;y<h;y+=2)for(let k=0;k<r;k+=2){let w=m[y*r+k];if(e){let M=k===f?w:m[y*r+k+1],x=y===i?w:m[y*r+k+r],A=k===f?x:y===i?M:m[y*r+k+r+1];d[g++]=(w+M+x+A)/4}else d[g++]=w}c.push(d)}let p=null;if(s!=null){p=new Uint8Array(a*o);let u=0;for(let m=0;m<h;m+=2)for(let d=0;d<r;d+=2){let g=s[m*r+d];if(e){let y=d===f?g:s[m*r+d+1],k=m===i?g:s[m*r+d+r],w=d===f?k:m===i?y:s[m*r+d+r+1];p[u++]=g*y*k*w?1:0}else p[u++]=g}}return new D({width:a,height:o,pixelType:l,pixels:c,mask:p})}function Je(t,e,n){if(!R(t))return null;let{width:r,height:h}=e,{width:s,height:l}=t,c=new Map,a={x:0,y:0},o=n==null?1:1+n,i=t;for(let f=0;f<o;f++){let p=Math.ceil(s/r),u=Math.ceil(l/h);for(let m=0;m<u;m++){a.y=m*h;for(let d=0;d<p;d++){a.x=d*r;let g=Yt(i,a,e);c.set(`${f}/${m}/${d}`,g)}}f<o-1&&(i=Zt(i)),s=Math.round(s/2),l=Math.round(l/2)}return c}function Lt(t,e,n,r,h=0){let{width:s,height:l}=t,{width:c,height:a}=e,o=r.cols,i=r.rows,f=Math.ceil(c/o-.1/o),p=Math.ceil(a/i-.1/i),u,m,d,g,y,k,w,M=f*o,x=M*p*i,A=new Float32Array(x),b=new Float32Array(x),v=new Uint32Array(x),T=new Uint32Array(x),P,I,U=0;for(let B=0;B<p;B++)for(let C=0;C<f;C++){u=12*(B*f+C),m=n[u],d=n[u+1],g=n[u+2],y=n[u+3],k=n[u+4],w=n[u+5];for(let V=0;V<i;V++){U=(B*i+V)*M+C*o,I=(V+.5)/i;for(let S=0;S<V;S++)P=(S+.5)/o,A[U+S]=(m*P+d*I+g)*s+h,b[U+S]=(y*P+k*I+w)*l+h,v[U+S]=Math.floor(A[U+S]),T[U+S]=Math.floor(b[U+S])}u+=6,m=n[u],d=n[u+1],g=n[u+2],y=n[u+3],k=n[u+4],w=n[u+5];for(let V=0;V<i;V++){U=(B*i+V)*M+C*o,I=(V+.5)/i;for(let S=V;S<o;S++)P=(S+.5)/o,A[U+S]=(m*P+d*I+g)*s+h,b[U+S]=(y*P+k*I+w)*l+h,v[U+S]=Math.floor(A[U+S]),T[U+S]=Math.floor(b[U+S])}}return{offsets_x:A,offsets_y:b,offsets_xi:v,offsets_yi:T,gridWidth:M}}function Xe(t,e){let{coefficients:n,spacing:r}=e,{offsets_x:h,offsets_y:s,gridWidth:l}=Lt(t,t,n,{rows:r[0],cols:r[1]}),{width:c,height:a}=t,o=new Float32Array(c*a),i=180/Math.PI;for(let f=0;f<a;f++)for(let p=0;p<c;p++){let u=f*l+p,m=f===0?u:u-l,d=f===a-1?u:u+l,g=h[m]-h[d],y=s[d]-s[m];if(isNaN(g)||isNaN(y))o[f*c+p]=90;else{let k=Math.atan2(y,g)*i;k=(360+k)%360,o[f*c+p]=k}}return o}function ze(t,e,n,r,h="nearest"){if(!R(t))return null;h==="majority"&&(t=Qt(t));let{pixels:s,mask:l,bandMasks:c,pixelType:a}=t,o=t.width,i=t.height,f=D.getPixelArrayConstructor(a),p=s.length,{width:u,height:m}=e,d=!1;for(let U=0;U<n.length;U+=3)n[U]===-1&&n[U+1]===-1&&n[U+2]===-1&&(d=!0);let{offsets_x:g,offsets_y:y,offsets_xi:k,offsets_yi:w,gridWidth:M}=Lt({width:o,height:i},e,n,r,h==="majority"?.5:0),x,A=(U,B,C,V)=>{let S=U instanceof Float32Array||U instanceof Float64Array?0:.5;for(let F=0;F<m;F++){x=F*M;for(let _=0;_<u;_++){if(g[x]<0||y[x]<0)U[F*u+_]=0;else if(V)U[F*u+_]=B[k[x]+w[x]*o];else{let O=Math.floor(g[x]),J=Math.floor(y[x]),N=Math.ceil(g[x]),q=Math.ceil(y[x]),X=g[x]-O,$=y[x]-J;if(!C||C[O+J*o]&&C[N+J*o]&&C[O+q*o]&&C[N+q*o]){let nt=(1-X)*B[O+J*o]+X*B[N+J*o],Q=(1-X)*B[O+q*o]+X*B[N+q*o];U[F*u+_]=(1-$)*nt+$*Q+S}else U[F*u+_]=B[k[x]+w[x]*o]}x++}}},b=[],v,T=c?.length===p,P=[];for(let U=0;U<p;U++){if(T){let B=new Uint8Array(u*m);A(B,c[U],c[U],!0),P.push(B)}v=new f(u*m),A(v,s[U],T?c[U]:l,h==="nearest"||h==="majority"),b.push(v)}let I=new D({width:u,height:m,pixelType:a,pixels:b,bandMasks:T?P:void 0});if(l!=null)I.mask=new Uint8Array(u*m),A(I.mask,l,l,!0);else if(d){I.mask=new Uint8Array(u*m);for(let U=0;U<u*m;U++)I.mask[U]=g[U]<0||y[U]<0?0:1}return I.updateStatistics(),I}var et=new Map;et.set("meter-per-second",1),et.set("kilometer-per-hour",.277778),et.set("knots",.514444),et.set("feet-per-second",.3048),et.set("mile-per-hour",.44704);var gt=180/Math.PI,xt=5,ft=new vt({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function wt(t,e){return et.get(t)/et.get(e)||1}function Nt(t){return(450-t)%360}function Et(t,e="geographic"){let[n,r]=t,h=Math.sqrt(n*n+r*r),s=Math.atan2(r,n)*gt;return s=(360+s)%360,e==="geographic"&&(s=Nt(s)),[h,s]}function Ot(t,e="geographic"){let n=t[1];e==="geographic"&&(n=Nt(n)),n%=360;let r=t[0];return[r*Math.cos(n/gt),r*Math.sin(n/gt)]}function Ye(t,e,n,r="geographic"){if(!R(t)||n==null)return t;let h=e==="vector-magdir"?t.clone():Rt(t,e),s=h.pixels[1];for(let l=0;l<s.length;l++)s[l]=r==="geographic"?(s[l]+n[l]+270)%360:(s[l]+360-n[l])%360;return e==="vector-magdir"?h:Rt(h,"vector-magdir")}function Rt(t,e,n="geographic",r=1){if(!R(t))return t;let{pixels:h,width:s,height:l}=t,c=s*l,a=h[0],o=h[1],i=t.pixelType.startsWith("f")?t.pixelType:"f32",f=D.createEmptyBand(i,c),p=D.createEmptyBand(i,c),u=0;for(let d=0;d<l;d++)for(let g=0;g<s;g++)e==="vector-uv"?([f[u],p[u]]=Et([a[u],o[u]],n),f[u]*=r):([f[u],p[u]]=Ot([a[u],o[u]],n),f[u]*=r,p[u]*=r),u++;let m=new D({pixelType:i,width:t.width,height:t.height,mask:t.mask,validPixelCount:t.validPixelCount,maskIsAlpha:t.maskIsAlpha,pixels:[f,p]});return m.updateStatistics(),m}function Ze(t,e,n=1){if(n===1||!R(t))return t;let r=t.clone(),{pixels:h,width:s,height:l}=r,c=h[0],a=h[1],o=0;for(let i=0;i<l;i++)for(let f=0;f<s;f++)e==="vector-uv"?(c[o]*=n,a[o]*=n):c[o]*=n,o++;return r.updateStatistics(),r}function tn(t,e,n,r,h){if(h==null||!h.spatialReference.equals(t.spatialReference))return{extent:t,width:Math.round(e/r),height:Math.round(n/r),resolution:t.width/e};let s=h.xmin,l=h.ymax,c=(t.xmax-t.xmin)/e*r,a=(t.ymax-t.ymin)/n*r,o=(c+a)/2;return t.xmin=s+Math.floor((t.xmin-s)/c)*c,t.xmax=s+Math.ceil((t.xmax-s)/c)*c,t.ymin=l+Math.floor((t.ymin-l)/a)*a,t.ymax=l+Math.ceil((t.ymax-l)/a)*a,{extent:t,width:Math.round(t.width/c),height:Math.round(t.height/a),resolution:o}}var te=jt(0,0,0);function jt(t=0,e=0,n=Math.PI,r=!0){r&&(n=(2*Math.PI-n)%(2*Math.PI));let h=r?-1:1,s=13*h,l=-7*h,c=-2*h,a=-16*h,o=21.75,[i,f]=j(0,e+s,n,o),[p,u]=j(t-5.5,e+l,n,o),[m,d]=j(t+5.5,e+l,n,o),[g,y]=j(t-1.5,e+c,n,o),[k,w]=j(t+1.5,e+c,n,o),[M,x]=j(t-1.5,e+a,n,o),[A,b]=j(t+1.5,e+a,n,o);return[i,f,p,u,g,y,k,w,m,d,M,x,A,b]}function ee(t=0,e=Math.PI,n=!0){n&&(e=(2*Math.PI-e)%(2*Math.PI));let r=10,h=n?-1:1,s=5*h,l=20*h,c=25*h,a=45,o=0,i=0,f=2,p=0,u=f*h,m=n?1:-1,d=r/2*m,[g,y]=[o+d,i-l],[k,w]=[g+f*m,y],[M,x]=[k-p*m,w+u],[A,b]=[o-d,i-c],[v,T]=[A+p*m,b-u],P=Math.ceil(t/xt),I=Math.floor(P/10);P-=8*I;let U=[],B=[];for(let X=0;X<P/2;X++,I--){I<=0&&P%2==1&&X===(P-1)/2&&(A=o,v=A+p*m,b=(b+y)/2,T=b-u);let[$,nt]=j(A,b,e,a);if(I>0){let[Q,st]=j(k,b,e,a),[lt,L]=j(g,y,e,a);U.push(Q),U.push(st),U.push($),U.push(nt),U.push(lt),U.push(L)}else{let[Q,st]=j(k,w,e,a),[lt,L]=j(M,x,e,a),[E,ut]=j(v,T,e,a);B.push($),B.push(nt),B.push(E),B.push(ut),B.push(lt),B.push(L),B.push(Q),B.push(st)}b+=s,y+=s,w+=s,x+=s,T+=s}let[C,V]=j(o+d,i+l,e,a),S=(r/2+f)*m,[F,_]=j(o+S,i+l,e,a),[O,J]=j(o+d,i-c,e,a),[N,q]=j(o+S,i-c,e,a);return{pennants:U,barbs:B,shaft:[C,V,F,_,O,J,N,q]}}function j(t,e,n,r=1){let h=Math.sqrt(t*t+e*e)/r,s=(2*Math.PI+Math.atan2(e,t))%(2*Math.PI);return[h,(2*Math.PI+s-n)%(2*Math.PI)]}var ct=[0,1,3,6,10,16,21,27,33,40,47,55,63],ne=[0,.5,1,1.5,2],ie=[0,.25,.5,1,1.5,2,2.5,3,3.5,4];function tt(t,e,n,r){let h=wt(r||"knots",n),s;for(s=1;s<e.length;s++)if(s===e.length-1){if(t<e[s]*h)break}else if(t<=e[s]*h)break;return Math.min(s-1,e.length-2)}function se(t,e,n,r,h){let s=0;switch(e){case"beaufort_kn":s=tt(t,ct,"knots",n);break;case"beaufort_km":s=tt(t,ct,"kilometer-per-hour",n);break;case"beaufort_ft":s=tt(t,ct,"feet-per-second",n);break;case"beaufort_m":s=tt(t,ct,"meter-per-second",n);break;case"classified_arrow":s=tt(t,h??[],r,n);break;case"ocean_current_m":s=tt(t,ne,"meter-per-second",n);break;case"ocean_current_kn":s=tt(t,ie,"knots",n)}return s}function le(t,e){let{style:n,inputUnit:r,outputUnit:h,breakValues:s}=e,l=ft.fromJSON(r),c=ft.fromJSON(h),a=7*6,o=15,i=0,f=0,{width:p,height:u,mask:m}=t,d=t.pixels[0],g=t.pixels[1],y=m!=null?m.filter(x=>x>0).length:p*u,k=new Float32Array(y*a),w=new Uint32Array(o*y),M=e.invertDirection?jt(0,0,0,!1):te;for(let x=0;x<u;x++)for(let A=0;A<p;A++){let b=x*p+A;if(!m||m[x*p+A]){let v=(g[b]+360)%360/180*Math.PI,T=se(d[b],n,l,c,s);for(let I=0;I<M.length;I+=2)k[i++]=(A+.5)/p,k[i++]=(x+.5)/u,k[i++]=M[I],k[i++]=M[I+1]+v,k[i++]=T,k[i++]=d[b];let P=7*(i/a-1);w[f++]=P,w[f++]=P+1,w[f++]=P+2,w[f++]=P+0,w[f++]=P+4,w[f++]=P+3,w[f++]=P+0,w[f++]=P+2,w[f++]=P+3,w[f++]=P+2,w[f++]=P+5,w[f++]=P+3,w[f++]=P+5,w[f++]=P+6,w[f++]=P+3}}return{vertexData:k,indexData:w}}var dt=[];function oe(t,e){if(dt.length===0)for(let u=0;u<30;u++)dt.push(ee(5*u,0,!e.invertDirection));let n=wt(ft.fromJSON(e.inputUnit),"knots"),{width:r,height:h,mask:s}=t,l=t.pixels[0],c=t.pixels[1],a=6,o=[],i=[],f=0,p=0;for(let u=0;u<h;u++)for(let m=0;m<r;m++){let d=u*r+m,g=l[d]*n;if((!s||s[u*r+m])&&g>=xt){let y=(c[d]+360)%360/180*Math.PI,{pennants:k,barbs:w,shaft:M}=dt[Math.min(Math.floor(g/5),29)];if(k.length+w.length===0)continue;let x=o.length/a,A=(m+.5)/r,b=(u+.5)/h;for(let v=0;v<k.length;v+=2)o[f++]=A,o[f++]=b,o[f++]=k[v],o[f++]=k[v+1]+y,o[f++]=0,o[f++]=g;for(let v=0;v<w.length;v+=2)o[f++]=A,o[f++]=b,o[f++]=w[v],o[f++]=w[v+1]+y,o[f++]=0,o[f++]=g;for(let v=0;v<M.length;v+=2)o[f++]=A,o[f++]=b,o[f++]=M[v],o[f++]=M[v+1]+y,o[f++]=0,o[f++]=g;for(let v=0;v<k.length/6;v++)i[p++]=x,i[p++]=x+1,i[p++]=x+2,x+=3;for(let v=0;v<w.length/8;v++)i[p++]=x,i[p++]=x+1,i[p++]=x+2,i[p++]=x+1,i[p++]=x+2,i[p++]=x+3,x+=4;i[p++]=x+0,i[p++]=x+1,i[p++]=x+2,i[p++]=x+1,i[p++]=x+3,i[p++]=x+2,x+=4}}return{vertexData:new Float32Array(o),indexData:new Uint32Array(i)}}function re(t,e){let r=0,h=0,{width:s,height:l,mask:c}=t,a=t.pixels[0],o=[],i=[],f=wt(ft.fromJSON(e.inputUnit),"knots"),p=e.style==="wind_speed"?xt:Number.MAX_VALUE;for(let u=0;u<l;u++)for(let m=0;m<s;m++){let d=a[u*s+m]*f;if((!c||c[u*s+m])&&d<p){for(let y=0;y<4;y++)o[r++]=(m+.5)/s,o[r++]=(u+.5)/l,o[r++]=y<2?-.5:.5,o[r++]=y%2==0?-.5:.5,o[r++]=0,o[r++]=d;let g=4*(r/24-1);i[h++]=g,i[h++]=g+1,i[h++]=g+2,i[h++]=g+1,i[h++]=g+2,i[h++]=g+3}}return{vertexData:new Float32Array(o),indexData:new Uint32Array(i)}}function en(t,e){return e.style==="simple_scalar"?re(t,e):e.style==="wind_speed"?oe(t,e):le(t,e)}function nn(t,e,n,r=[0,0],h=.5){let{width:s,height:l,mask:c}=t,[a,o]=t.pixels,[i,f]=r,p=Math.round((s-i)/n),u=Math.round((l-f)/n),m=p*u,d=new Float32Array(m),g=new Float32Array(m),y=new Uint8Array(m),k=e==="vector-uv";for(let M=0;M<u;M++)for(let x=0;x<p;x++){let A=0,b=M*p+x,v=Math.max(0,M*n+f),T=Math.max(0,x*n+i),P=Math.min(l,v+n),I=Math.min(s,T+n);for(let U=v;U<P;U++)for(let B=T;B<I;B++){let C=U*s+B;if(!c||c[C]){A++;let V=k?[a[C],o[C]]:[a[C],(360+o[C])%360],[S,F]=k?V:Ot(V);d[b]+=S,g[b]+=F}}if(A>=(P-v)*(I-T)*(1-h)){y[b]=1;let[U,B]=Et([d[b]/A,g[b]/A]);d[b]=U,g[b]=B}else y[b]=0,d[b]=0,g[b]=0}let w=new D({width:p,height:u,pixels:[d,g],mask:y});return w.updateStatistics(),w}var K=H.getLogger("esri.views.2d.engine.flow.dataUtils"),ae=10;function pn(t,e,n,r){return at(this,null,function*(){let h=performance.now(),s=he(e,n),l=performance.now(),c=fe(e,s,n.width,n.height),a=performance.now(),o=pe(c,!0),i=performance.now(),f=t==="Streamlines"?me(o,ae):de(o),p=performance.now();return Y("esri-2d-profiler")&&(K.info("I.1","_createFlowFieldFromData (ms)",Math.round(l-h)),K.info("I.2","_getStreamlines (ms)",Math.round(a-l)),K.info("I.3","createAnimatedLinesData (ms)",Math.round(i-a)),K.info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(p-i)),K.info("I.5","createFlowMesh (ms)",Math.round(p-h)),K.info("I.6","Mesh size (bytes)",f.vertexData.buffer.byteLength+f.indexData.buffer.byteLength)),yield Promise.resolve(),kt(r),f})}function he(t,e){let n=ue(e.data,e.width,e.height,t.smoothing);return t.interpolate?(r,h)=>{let s=Math.floor(r),l=Math.floor(h);if(s<0||s>=e.width)return[0,0];if(l<0||l>=e.height)return[0,0];let c=r-s,a=h-l,o=s,i=l,f=s<e.width-1?s+1:s,p=l<e.height-1?l+1:l,u=n[2*(i*e.width+o)],m=n[2*(i*e.width+f)],d=n[2*(p*e.width+o)],g=n[2*(p*e.width+f)],y=n[2*(i*e.width+o)+1],k=n[2*(i*e.width+f)+1];return[(u*(1-a)+d*a)*(1-c)+(m*(1-a)+g*a)*c,(y*(1-a)+n[2*(p*e.width+o)+1]*a)*(1-c)+(k*(1-a)+n[2*(p*e.width+f)+1]*a)*c]}:(r,h)=>{let s=Math.round(r),l=Math.round(h);return s<0||s>=e.width||l<0||l>=e.height?[0,0]:[n[2*(l*e.width+s)],n[2*(l*e.width+s)+1]]}}function ce(t,e,n,r,h,s,l,c,a){let o=[],i=n,f=r,p=0,[u,m]=e(i,f);u*=t.velocityScale,m*=t.velocityScale;let d=Math.sqrt(u*u+m*m),g,y;o.push({x:i,y:f,t:p,speed:d});for(let k=0;k<t.verticesPerLine;k++){let[w,M]=e(i,f);w*=t.velocityScale,M*=t.velocityScale;let x=Math.sqrt(w*w+M*M);if(x<t.minSpeedThreshold)return o;let A=w/x,b=M/x;if(i+=A*t.segmentLength,f+=b*t.segmentLength,p+=t.segmentLength/x,Math.acos(A*g+b*y)>t.maxTurnAngle)return o;if(t.collisions){let v=Math.round(i*a),T=Math.round(f*a);if(v<0||v>l-1||T<0||T>c-1)return o;let P=s[T*l+v];if(P!==-1&&P!==h)return o;s[T*l+v]=h}o.push({x:i,y:f,t:p,speed:x}),g=A,y=b}return o}function fe(t,e,n,r){let h=[],s=new pt,l=1/Math.max(t.lineCollisionWidth,1),c=Math.round(n*l),a=Math.round(r*l),o=new Int32Array(c*a);for(let f=0;f<o.length;f++)o[f]=-1;let i=[];for(let f=0;f<r;f+=t.lineSpacing)for(let p=0;p<n;p+=t.lineSpacing)i.push({x:p,y:f,sort:s.getFloat()});i.sort((f,p)=>f.sort-p.sort);for(let{x:f,y:p}of i)if(s.getFloat()<t.density){let u=ce(t,e,f,p,h.length,o,c,a,l);if(u.length<2)continue;h.push(u)}return h}function ue(t,e,n,r){if(r===0)return t;let h=Math.round(3*r),s=new Array(2*h+1),l=0;for(let o=-h;o<=h;o++){let i=Math.exp(-o*o/(r*r));s[o+h]=i,l+=i}for(let o=-h;o<=h;o++)s[o+h]/=l;let c=new Float32Array(t.length);for(let o=0;o<n;o++)for(let i=0;i<e;i++){let f=0,p=0;for(let u=-h;u<=h;u++){if(i+u<0||i+u>=e)continue;let m=s[u+h];f+=m*t[2*(o*e+(i+u))],p+=m*t[2*(o*e+(i+u))+1]}c[2*(o*e+i)]=f,c[2*(o*e+i)+1]=p}let a=new Float32Array(t.length);for(let o=0;o<e;o++)for(let i=0;i<n;i++){let f=0,p=0;for(let u=-h;u<=h;u++){if(i+u<0||i+u>=n)continue;let m=s[u+h];f+=m*c[2*((i+u)*e+o)],p+=m*c[2*((i+u)*e+o)+1]}a[2*(i*e+o)]=f,a[2*(i*e+o)+1]=p}return a}function pe(t,e){let n=new pt,r=t.reduce((a,o)=>a+o.length,0),h=new Float32Array(4*r),s=new Array(t.length),l=0,c=0;for(let a of t){let o=l;for(let i of a)h[4*l]=i.x,h[4*l+1]=i.y,h[4*l+2]=i.t,h[4*l+3]=i.speed,l++;s[c++]={startVertex:o,numberOfVertices:a.length,totalTime:a[a.length-1].t,timeSeed:e?n.getFloat():0}}return{lineVertices:h,lineDescriptors:s}}function me(t,e){let{lineVertices:r,lineDescriptors:h}=t,s=0,l=0;for(let u of h)s+=2*u.numberOfVertices,l+=6*(u.numberOfVertices-1);let c=new Float32Array(s*9),a=new Uint32Array(l),o=0,i=0;function f(){a[i++]=o-2,a[i++]=o,a[i++]=o-1,a[i++]=o,a[i++]=o+1,a[i++]=o-1}function p(u,m,d,g,y,k,w,M){let x=o*9,A=0;c[x+A++]=u,c[x+A++]=m,c[x+A++]=1,c[x+A++]=d,c[x+A++]=k,c[x+A++]=w,c[x+A++]=g/2,c[x+A++]=y/2,c[x+A++]=M,o++,c[x+A++]=u,c[x+A++]=m,c[x+A++]=-1,c[x+A++]=d,c[x+A++]=k,c[x+A++]=w,c[x+A++]=-g/2,c[x+A++]=-y/2,c[x+A++]=M,o++}for(let u of h){let{totalTime:m,timeSeed:d}=u,g=null,y=null,k=null,w=null,M=null,x=null;for(let A=0;A<u.numberOfVertices;A++){let b=r[4*(u.startVertex+A)],v=r[4*(u.startVertex+A)+1],T=r[4*(u.startVertex+A)+2],P=r[4*(u.startVertex+A)+3],I=null,U=null,B=null,C=null;if(A>0){I=b-g,U=v-y;let V=Math.sqrt(I*I+U*U);if(I/=V,U/=V,A>1){let S=I+M,F=U+x,_=Math.sqrt(S*S+F*F);S/=_,F/=_;let O=Math.min(1/(S*I+F*U),e);S*=O,F*=O,B=-F,C=S}else B=-U,C=I;B!==null&&C!==null&&(p(g,y,k,B,C,m,d,P),f())}g=b,y=v,k=T,M=I,x=U,w=P}p(g,y,k,-x,M,m,d,w)}return{vertexData:c,indexData:a}}function de(t){let{lineVertices:h,lineDescriptors:s}=t,l=0,c=0;for(let V of s){let S=V.numberOfVertices-1;l+=4*S*2,c+=6*S*2}let a=new Float32Array(l*16),o=new Uint32Array(c),i,f,p,u,m,d,g,y,k,w,M,x,A,b,v=0,T=0;function P(){o[T++]=v-8,o[T++]=v-7,o[T++]=v-6,o[T++]=v-7,o[T++]=v-5,o[T++]=v-6,o[T++]=v-4,o[T++]=v-3,o[T++]=v-2,o[T++]=v-3,o[T++]=v-1,o[T++]=v-2}function I(V,S,F,_,O,J,N,q,X,$,nt,Q,st,lt){let L=v*16,E=0;for(let ut of[1,2])for(let Wt of[1,2,3,4])a[L+E++]=V,a[L+E++]=S,a[L+E++]=F,a[L+E++]=_,a[L+E++]=N,a[L+E++]=q,a[L+E++]=X,a[L+E++]=$,a[L+E++]=ut,a[L+E++]=Wt,a[L+E++]=st,a[L+E++]=lt,a[L+E++]=O/2,a[L+E++]=J/2,a[L+E++]=nt/2,a[L+E++]=Q/2,v++}function U(V,S){let F=k+M,_=w+x,O=Math.sqrt(F*F+_*_);F/=O,_/=O;let J=k*F+w*_;F/=J,_/=J;let N=M+A,q=x+b,X=Math.sqrt(N*N+q*q);N/=X,q/=X;let $=M*N+x*q;N/=$,q/=$,I(i,f,p,u,-_,F,m,d,g,y,-q,N,V,S),P()}function B(V,S,F,_,O,J){if(k=M,w=x,M=A,x=b,k==null&&w==null&&(k=M,w=x),m!=null&&d!=null){A=V-m,b=S-d;let N=Math.sqrt(A*A+b*b);A/=N,b/=N}k!=null&&w!=null&&U(O,J),i=m,f=d,p=g,u=y,m=V,d=S,g=F,y=_}function C(V,S){k=M,w=x,M=A,x=b,k==null&&w==null&&(k=M,w=x),k!=null&&w!=null&&U(V,S)}for(let V of s){i=null,f=null,p=null,u=null,m=null,d=null,g=null,y=null,k=null,w=null,M=null,x=null,A=null,b=null;let{totalTime:S,timeSeed:F}=V;for(let _=0;_<V.numberOfVertices;_++)B(h[4*(V.startVertex+_)],h[4*(V.startVertex+_)+1],h[4*(V.startVertex+_)+2],h[4*(V.startVertex+_)+3],S,F);C(S,F)}return{vertexData:a,indexData:o}}function Gt(t,e){let n=e.pixels,{width:r,height:h}=e,s=new Float32Array(r*h*2),l=e.mask||new Uint8Array(r*h*2);if(e.mask||l.fill(255),t==="vector-uv")for(let c=0;c<r*h;c++)s[2*c]=n[0][c],s[2*c+1]=-n[1][c];else if(t==="vector-magdir")for(let c=0;c<r*h;c++){let a=n[0][c],o=It(n[1][c]),i=Math.cos(o-Math.PI/2),f=Math.sin(o-Math.PI/2);s[2*c]=i*a,s[2*c+1]=f*a}return{data:s,mask:l,width:r,height:h}}function mn(t,e,n,r,h,s){return at(this,null,function*(){let l=performance.now(),c=Pt(e.spatialReference);if(!c){let M=yield qt(t,e,n,r,h,s);return Y("esri-2d-profiler")&&K.info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-l)),Y("esri-2d-profiler")&&K.info("I.9","Number of parts",1),M}let[a,o]=c.valid,i=o-a,f=Math.ceil(e.width/i),p=e.width/f,u=Math.round(n/f),m=e.xmin,d=[],g=performance.now();for(let M=0;M<f;M++){let x=new Tt({xmin:m,xmax:m+p,ymin:e.ymin,ymax:e.ymax,spatialReference:e.spatialReference});d.push(qt(t,x,u,r,h,s)),m+=p}let y=yield Promise.all(d);Y("esri-2d-profiler")&&K.info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-g)),Y("esri-2d-profiler")&&K.info("I.9","Number of parts",y.length);let k={data:new Float32Array(n*r*2),mask:new Uint8Array(n*r),width:n,height:r},w=0;for(let M of y){for(let x=0;x<M.height;x++)for(let A=0;A<M.width;A++)w+A>=n||(k.data[2*(x*n+w+A)]=M.data[2*(x*M.width+A)],k.data[2*(x*n+w+A)+1]=M.data[2*(x*M.width+A)+1],k.mask[x*n+w+A]=M.mask[x*M.width+A]);w+=M.width}return Y("esri-2d-profiler")&&K.info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-l)),k})}function qt(t,e,n,r,h,s){return at(this,null,function*(){let l={requestProjectedLocalDirections:!0,signal:s};if(h!=null&&(l.timeExtent=h),t.type==="imagery"){yield t.load({signal:s});let o=t.rasterInfo.dataType,i=yield t.fetchImage(e,n,r,l);return i?.pixelData?.pixelBlock==null?{data:new Float32Array(n*r*2),mask:new Uint8Array(n*r),width:n,height:r}:Gt(o,i.pixelData.pixelBlock)}yield t.load({signal:s});let c=t.rasterInfo.dataType,a=yield t.fetchPixels(e,n,r,l);return a?.pixelBlock==null?{data:new Float32Array(n*r*2),mask:new Uint8Array(n*r),width:n,height:r}:Gt(c,a.pixelBlock)})}export{it as a,xe as b,D as c,Bt as d,St as e,Ce as f,R as g,_e as h,De as i,Le as j,Re as k,_t as l,Ne as m,Ee as n,Oe as o,je as p,Ge as q,qe as r,$t as s,We as t,Je as u,Xe as v,ze as w,ft as x,wt as y,Et as z,Ye as A,Rt as B,Ze as C,tn as D,re as E,en as F,nn as G,pn as H,mn as I};
