import{a as T,b as rt}from"./chunk-OUYMSSKU.js";import{a as st}from"./chunk-Q4M7XPFX.js";import{a as F}from"./chunk-VWU5IX5V.js";import{e as nt}from"./chunk-ZREXZJBZ.js";import{a as v}from"./chunk-PYQFEBZL.js";import{a as S}from"./chunk-IL3PPCCF.js";import{a as tt,c as it}from"./chunk-OCBWGGCR.js";import{b as et,d as k}from"./chunk-6B6VO6EC.js";import{C as X,D as V,E as Z,K as $,a as g,b as D,c as K,k as Q,m as O,n as _,o as U,v as x,y as W}from"./chunk-4LHUJTP5.js";import{B as J}from"./chunk-WMYPRHRR.js";import{s as G}from"./chunk-IAMDMFZ7.js";import{D as q,G as Y,y as R}from"./chunk-AC62Z3FX.js";import{a as C,b as E}from"./chunk-ESDYQQXO.js";function at(n){if(n.length<Y)return Array.from(n);if(q(n))return Float64Array.from(n);if(!("BYTES_PER_ELEMENT"in n))return Array.from(n);switch(n.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(n);case 2:return R(n)?Uint16Array.from(n):Int16Array.from(n);case 4:return Float32Array.from(n);default:return Float64Array.from(n)}}var z=class n{constructor(t,e,r){this.primitiveIndices=t,this._numIndexPerPrimitive=e,this.position=r,this._children=void 0,v(t.length>=1),v(r.size===3||r.size===4);let{data:a,size:h,indices:o}=r;v(o.length%this._numIndexPerPrimitive==0),v(o.length>=t.length*this._numIndexPerPrimitive);let c=t.length,s=h*o[this._numIndexPerPrimitive*t[0]];y.clear(),y.push(s);let u=K(a[s],a[s+1],a[s+2]),i=D(u);for(let f=0;f<c;++f){let p=this._numIndexPerPrimitive*t[f];for(let I=0;I<this._numIndexPerPrimitive;++I){s=h*o[p+I],y.push(s);let d=a[s];u[0]=Math.min(d,u[0]),i[0]=Math.max(d,i[0]),d=a[s+1],u[1]=Math.min(d,u[1]),i[1]=Math.max(d,i[1]),d=a[s+2],u[2]=Math.min(d,u[2]),i[2]=Math.max(d,i[2])}}this.bbMin=u,this.bbMax=i;let m=V(g(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(i[0]-u[0],i[1]-u[1]),i[2]-u[2]);let A=this.radius*this.radius;for(let f=0;f<y.length;++f){s=y.at(f);let p=a[s]-m[0],I=a[s+1]-m[1],d=a[s+2]-m[2],M=p*p+I*I+d*d;if(M<=A)continue;let j=Math.sqrt(M),L=.5*(j-this.radius);this.radius=this.radius+L,A=this.radius*this.radius;let w=L/j;m[0]+=p*w,m[1]+=I*w,m[2]+=d*w}this.center=m,y.clear()}getChildren(){if(this._children||W(this.bbMin,this.bbMax)<=1)return this._children;let t=V(g(),this.bbMin,this.bbMax,.5),e=this.primitiveIndices.length,r=new Uint8Array(e),a=new Array(8);for(let i=0;i<8;++i)a[i]=0;let{data:h,size:o,indices:c}=this.position;for(let i=0;i<e;++i){let m=0,A=this._numIndexPerPrimitive*this.primitiveIndices[i],f=o*c[A],p=h[f],I=h[f+1],d=h[f+2];for(let M=1;M<this._numIndexPerPrimitive;++M){f=o*c[A+M];let j=h[f],L=h[f+1],w=h[f+2];j<p&&(p=j),L<I&&(I=L),w<d&&(d=w)}p<t[0]&&(m|=1),I<t[1]&&(m|=2),d<t[2]&&(m|=4),r[i]=m,++a[m]}let s=0;for(let i=0;i<8;++i)a[i]>0&&++s;if(s<2)return;let u=new Array(8);for(let i=0;i<8;++i)u[i]=a[i]>0?new Uint32Array(a[i]):void 0;for(let i=0;i<8;++i)a[i]=0;for(let i=0;i<e;++i){let m=r[i];u[m][a[m]++]=this.primitiveIndices[i]}this._children=new Array;for(let i=0;i<8;++i)u[i]!==void 0&&this._children.push(new n(u[i],this._numIndexPerPrimitive,this.position));return this._children}static prune(){y.prune()}},y=new G({deallocator:null});function gt(n){return n?{p0:D(n.p0),p1:D(n.p1),p2:D(n.p2)}:{p0:g(),p1:g(),p2:g()}}function ht(n,t,e){return U(H,t,n),U(ot,e,n),Q(X(H,H,ot))/2}var Et=new F(st),zt=new F(()=>gt()),H=g(),ot=g();function ct(n,t){if(!n)return!1;let{size:e,data:r,indices:a}=n;O(t,0,0,0),O(b,0,0,0);let h=0,o=0;for(let c=0;c<a.length-2;c+=3){let s=a[c]*e,u=a[c+1]*e,i=a[c+2]*e;O(l,r[s],r[s+1],r[s+2]),O(P,r[u],r[u+1],r[u+2]),O(B,r[i],r[i+1],r[i+2]);let m=ht(l,P,B);m?(_(l,l,P),_(l,l,B),x(l,l,1/3*m),_(t,t,l),h+=m):(_(b,b,l),_(b,b,P),_(b,b,B),o+=3)}return(o!==0||h!==0)&&(h!==0?(x(t,t,1/h),!0):o!==0&&(x(t,b,1/o),!0))}function ut(n,t){if(!n)return!1;let{size:e,data:r,indices:a}=n;O(t,0,0,0);let h=-1,o=0;for(let c=0;c<a.length;c++){let s=a[c]*e;h!==s&&(t[0]+=r[s],t[1]+=r[s+1],t[2]+=r[s+2],o++),h=s}return o>1&&x(t,t,1/o),o>0}function mt(n,t,e){if(!n)return!1;O(e,0,0,0),O(b,0,0,0);let r=0,a=0,{size:h,data:o,indices:c}=n,s=c.length-1,u=s+(t?2:0);for(let i=0;i<u;i+=2){let m=i<s?i+1:0,A=c[i<s?i:s]*h,f=c[m]*h;l[0]=o[A],l[1]=o[A+1],l[2]=o[A+2],P[0]=o[f],P[1]=o[f+1],P[2]=o[f+2],x(l,_(l,l,P),.5);let p=$(l,P);p>0?(_(e,e,x(l,l,p)),r+=p):r===0&&(_(b,b,l),a++)}return r!==0?(x(e,e,1/r),!0):a!==0&&(x(e,b,1/a),!0)}var l=g(),P=g(),B=g(),b=g();var N=class{constructor(t){this.channel=t,this.id=J()}};function lt(n,t){return n==null&&(n=[]),n.push(t),n}function ft(n,t){if(n==null)return null;let e=n.filter(r=>r!==t);return e.length===0?null:e}var Gt=g(),Jt=new Float32Array(6);var dt=class n extends rt{constructor(t,e,r=null,a=T.Mesh,h=null,o=-1){super(),this.material=t,this.mapPositions=r,this.type=a,this.objectAndLayerIdColor=h,this.edgeIndicesLength=o,this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(let[c,s]of e)this._attributes.set(c,E(C({},s),{indices:tt(s.indices)})),c===S.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(c).indices.length:this.edgeIndicesLength)}instantiate(t={}){let e=new n(t.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._attributes.forEach((r,a)=>{r.exclusive=!1,e._attributes.set(a,r)}),e._boundingInfo=this._boundingInfo,e.transformation=t.transformation||this.transformation,e}get attributes(){return this._attributes}getMutableAttribute(t){let e=this._attributes.get(t);return e&&!e.exclusive&&(e=E(C({},e),{exclusive:!0,data:at(e.data)}),this._attributes.set(t,e)),e}setAttributeData(t,e){let r=this._attributes.get(t);r&&this._attributes.set(t,E(C({},r),{exclusive:!0,data:e}))}get indexCount(){return this._attributes.values().next().value.indices?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(t){return!!(this.type===T.Mesh?this._computeAttachmentOriginTriangles(t):this.type===T.Line?this._computeAttachmentOriginLines(t):this._computeAttachmentOriginPoints(t))&&(this._transformation!=null&&Z(t,t,this._transformation),!0)}_computeAttachmentOriginTriangles(t){let e=this.attributes.get(S.POSITION);return ct(e,t)}_computeAttachmentOriginLines(t){let e=this.attributes.get(S.POSITION);return mt(e,pt(this.material.parameters,e),t)}_computeAttachmentOriginPoints(t){let e=this.attributes.get(S.POSITION);return ut(e,t)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){let t=this.attributes.get(S.POSITION);if(!t||t.indices.length===0)return null;let e=this.type===T.Mesh?3:1;v(t.indices.length%e==0,"Indexing error: "+t.indices.length+" not divisible by "+e);let r=it(t.indices.length/e);return new z(r,e,t)}get transformation(){return this._transformation??k}set transformation(t){this._transformation=t&&t!==k?et(t):null}addHighlight(){let t=new N(nt.Highlight);return this.highlights=lt(this.highlights,t),t}removeHighlight(t){this.highlights=ft(this.highlights,t)}};function pt(n,t){return!(!("isClosed"in n)||!n.isClosed)&&t.indices.length>2}export{dt as a};
