import"./chunk-TFSPQFEF.js";import"./chunk-OUYMSSKU.js";import"./chunk-PTXLSCMJ.js";import"./chunk-YQNUGDFH.js";import"./chunk-Q4M7XPFX.js";import{a as It,b as Nt}from"./chunk-SBBOWK5S.js";import"./chunk-VWU5IX5V.js";import{a as Tt,b as Lt,c as Xe,d as Ot,e as Dt}from"./chunk-5AOXTKCW.js";import{a as oe,b as _}from"./chunk-OV6MEP2Z.js";import"./chunk-TSVLN2FF.js";import"./chunk-ZREXZJBZ.js";import{a as We}from"./chunk-VK2CQJOC.js";import{a as Ze}from"./chunk-N6TWFTPQ.js";import"./chunk-PYQFEBZL.js";import"./chunk-IL3PPCCF.js";import{a as Be}from"./chunk-OCBWGGCR.js";import{a as Ee,b as fe,c as vt,d as At,e as bt,f as O,g as k,h as z,i as q,j as K,k as Q,l as ee,m as te,n as re,o as St,r as Ft,s as Pt,u as Ce}from"./chunk-HVNUX2QA.js";import{a as H,b as Re}from"./chunk-TN7F2BKT.js";import{a as $e,b as xt,c as yt,f as J}from"./chunk-XF2DBGTH.js";import"./chunk-J43N2ESR.js";import"./chunk-Y4SWPZQY.js";import{a as Y}from"./chunk-DUAAYE7V.js";import{a as Me}from"./chunk-BFFOE56J.js";import"./chunk-QJR6XTTM.js";import{a as Fe}from"./chunk-6B6VO6EC.js";import"./chunk-PV5D5XIZ.js";import"./chunk-YW3L7OMP.js";import"./chunk-TQXEOG45.js";import{a as Mt}from"./chunk-YEFTRNE3.js";import{a as Et,b as Ct,e as jt}from"./chunk-7EQBH2NW.js";import{a as Rt}from"./chunk-CN5O6E6T.js";import"./chunk-4KJ462UD.js";import"./chunk-HSB35X5B.js";import"./chunk-MYELF7MV.js";import"./chunk-MS3ZOARX.js";import"./chunk-KCKP7FIY.js";import"./chunk-7K4WIBFN.js";import"./chunk-C7M5MSEL.js";import"./chunk-HPJ6EQFO.js";import"./chunk-ZOTIMGGE.js";import{a as Pe}from"./chunk-7UQPY7PH.js";import"./chunk-OHIIU6WS.js";import"./chunk-O5K35OSE.js";import{b as wt}from"./chunk-D6LLE2YP.js";import"./chunk-O5IGEGOS.js";import"./chunk-YH4Z47PR.js";import"./chunk-CJJRHJ2S.js";import"./chunk-JOYABHZZ.js";import"./chunk-VDN3XKL2.js";import"./chunk-SVEGZVCP.js";import"./chunk-AQ74ANSJ.js";import"./chunk-SAOUSUZE.js";import"./chunk-6MGDEI2H.js";import"./chunk-QSGARGRB.js";import"./chunk-SREKDU6P.js";import{j as gt}from"./chunk-IXIJFOEL.js";import"./chunk-QZ4L25WE.js";import"./chunk-4ATIL3QV.js";import"./chunk-WUM4JBII.js";import"./chunk-URUYU25U.js";import"./chunk-3S2DT2SI.js";import{i as dt}from"./chunk-7PPV2CP7.js";import{f as be,s as Ve}from"./chunk-U62SHMHB.js";import"./chunk-55ESOXMJ.js";import{a as C}from"./chunk-BCREO4Q5.js";import{g as ht}from"./chunk-EJ3VIBAJ.js";import{A as ft,E as ut,F as $,a as g,c as mt,f as Se,m as X,n as N,o as U,v as Ge}from"./chunk-4LHUJTP5.js";import"./chunk-NBRBW7H5.js";import{a as ot,c as nt}from"./chunk-CBOFHDSC.js";import"./chunk-HB7BVTLV.js";import"./chunk-WZKL6OPG.js";import"./chunk-WF37UVOV.js";import"./chunk-UZQ577CU.js";import{b as rt}from"./chunk-FC3MPJI4.js";import"./chunk-5ETRXDS4.js";import"./chunk-QDNKD3H5.js";import"./chunk-B4PK7RBX.js";import{a as it}from"./chunk-6J4Y65BV.js";import{a as st}from"./chunk-RXHILZH7.js";import"./chunk-PEPXQ7N3.js";import"./chunk-VU5W7W6Y.js";import{j as Z}from"./chunk-6QIKBCPR.js";import{a as pt,i as T}from"./chunk-AHKJJNRE.js";import"./chunk-HBTOKQC5.js";import{b as ct}from"./chunk-A52LT7YB.js";import{P as at,R as lt}from"./chunk-CZPMRK53.js";import"./chunk-IDSF2RZ6.js";import"./chunk-2BBIRZVO.js";import"./chunk-WQAXQD4X.js";import"./chunk-IUPUERVS.js";import{G as tt,q as et}from"./chunk-XF4NUYV7.js";import"./chunk-FNDPIYNC.js";import{H as b}from"./chunk-WMYPRHRR.js";import{R as Ae,u as _e}from"./chunk-IAMDMFZ7.js";import{a as y}from"./chunk-53MWZ23O.js";import{h as qe,i as we,j as Ke,o as ve,t as Qe}from"./chunk-PT7S6WNL.js";import"./chunk-XDTDVCGP.js";import"./chunk-JPDAKIWT.js";import{p as h,r as E}from"./chunk-465DRXTW.js";import"./chunk-AC62Z3FX.js";import{a as xe,b as ye,g as R}from"./chunk-ESDYQQXO.js";var G=class extends E{constructor(){super("mesh-not-loaded","Mesh must be loaded before applying operations")}},je=class extends E{constructor(){super("component-not-found","Provided component is not part of the list of components")}},Te=class extends E{constructor(){super("invalid-polygon","expected polygon to be a Polygon instance")}},D=class extends E{constructor(){super("invalid-input:location","Expected location to be a Point instance")}},Le=class extends E{constructor(){super("invalid-input:no-layer","A layer is needed to convert the files")}},Oe=class extends E{constructor(){super("invalid-input:no-model","No supported model found")}},De=class extends E{constructor(){super("invalid-input:multiple-models","Multiple supported models found")}};function vr(e,t,o,r){let n=(i=>!Array.isArray(i[0]))(t)?(i,l)=>t[3*i+l]:(i,l)=>t[i][l],s=r?lt(r)/at(r):1;return Nt(e,(i,l)=>X(i,n(l,0)*s,n(l,1)*s,n(l,2)),o)}function kt(e,t,o){let r=vr(Ut,e,t,o)?Ut:[0,0,1];return Math.abs(r[2])>Math.cos(ht(80))?C.Z:Math.abs(r[1])>Math.abs(r[0])?C.Y:C.X}var Ut=It();function zt(e){let t=br(e.rings,e.hasZ,Ne.CCW_IS_HOLE,e.spatialReference),o=new Array,r=0,n=0;for(let l of t.polygons){let c=l.count,a=l.index,p=yt(t.position,3*a,3*c),m=l.holeIndices.map(u=>u-a),f=Be(We(p,m,3));o.push({position:p,faces:f}),r+=p.length,n+=f.length}let s=Ar(o,r,n),i=Array.isArray(s.position)?Ze(s.position,3,{originalIndices:s.faces}):Ze(s.position.buffer,6,{originalIndices:s.faces});return s.position=xt(new Float64Array(i.buffer)),s.faces=i.indices,s}function Ar(e,t,o){if(e.length===1)return e[0];let r=$e(t),n=new Array(o),s=0,i=0,l=0;for(let c of e){for(let a=0;a<c.position.length;a++)r[s++]=c.position[a];for(let a of c.faces)n[i++]=a+l;l=s/3}return{position:r,faces:Be(n)}}function br(e,t,o,r){let n=e.length,s=new Array(n),i=new Array(n),l=new Array(n),c=0,a=0,p=0,m=0;for(let w=0;w<n;++w)m+=e[w].length;let f=$e(3*m),u=0;for(let w=n-1;w>=0;w--){let d=e[w],F=o===Ne.CCW_IS_HOLE&&Sr(d,t,r);if(F&&n!==1)s[c++]=d;else{let L=d.length;for(let x=0;x<c;++x)L+=s[x].length;let A={index:u,pathLengths:new Array(c+1),count:L,holeIndices:new Array(c)};A.pathLengths[0]=d.length,d.length>0&&(l[p++]={index:u,count:d.length}),u=F?Ie(d,d.length-1,-1,f,u,d.length,t):Ie(d,0,1,f,u,d.length,t);for(let x=0;x<c;++x){let P=s[x];A.holeIndices[x]=u,A.pathLengths[x+1]=P.length,P.length>0&&(l[p++]={index:u,count:P.length}),u=Ie(P,0,1,f,u,P.length,t)}c=0,A.count>0&&(i[a++]=A)}}for(let w=0;w<c;++w){let d=s[w];d.length>0&&(l[p++]={index:u,count:d.length}),u=Ie(d,0,1,f,u,d.length,t)}return i.length=a,l.length=p,{position:f,polygons:i,outlines:l}}function Ie(e,t,o,r,n,s,i){n*=3;for(let l=0;l<s;++l){let c=e[t];r[n++]=c[0],r[n++]=c[1],r[n++]=i?c[2]:0,t+=o}return n/3}function Sr(e,t,o){if(t){let r=e.length-1,n=kt(e,r,o);if(n===C.X)return!be(e,C.Y,C.Z);if(n===C.Y)return!be(e,C.X,C.Z)}return!be(e,C.X,C.Y)}var Ne;(function(e){e[e.NONE=0]="NONE",e[e.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(Ne||(Ne={}));function Gt({xmin:e,xmax:t,ymin:o,ymax:r,zmin:n,zmax:s},i,l,c){n??=0,s??=0,_t??=new Float64Array(24);let a=_t;return a[0]=e,a[1]=o,a[2]=n,a[3]=e,a[4]=r,a[5]=n,a[6]=t,a[7]=r,a[8]=n,a[9]=t,a[10]=o,a[11]=n,a[12]=e,a[13]=o,a[14]=s,a[15]=e,a[16]=r,a[17]=s,a[18]=t,a[19]=r,a[20]=s,a[21]=t,a[22]=o,a[23]=s,Ce({positions:a,transform:i,vertexSpace:l,inSpatialReference:c,outSpatialReference:c,outPositions:a}),ue(a,c)}var _t=null;function ue(e,t){let o=1/0,r=1/0,n=1/0,s=-1/0,i=-1/0,l=-1/0,c=e.length,a=0;for(;a<c;){let p=e[a++],m=e[a++],f=e[a++];o=Math.min(o,p),r=Math.min(r,m),n=Math.min(n,f),s=Math.max(s,p),i=Math.max(i,m),l=Math.max(l,f)}return new Z({xmin:o,ymin:r,zmin:n,xmax:s,ymax:i,zmax:l,spatialReference:t})}function j(e,t,o,r=0){Ue[0]=e.x,Ue[1]=e.y;let n=e.z;return Ue[2]=n!==void 0?n:r,dt(Ue,e.spatialReference,0,t,o,0,1)}var Ue=g();var he="esri.geometry.support.meshUtils.centerAt";function Vt(e,t,o){if(!e.vertexAttributes?.position)return;let{vertexSpace:r}=e,n=o?.origin??e.origin;r.isRelative?(z(r,he,o),Fr(e,t,n)):k(e.spatialReference,o)?Pr(e,t,n):Rr(e,t,n)}function Fr(e,t,o){let{vertexSpace:r}=e;if(!r.isRelative)return;let n=Zt,s=Bt;if(!j(t,s,e.spatialReference))return void h.getLogger(he).error(`Failed to project centerAt location (wkid:${t.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}). Projection may be possible after calling projection.load().`);if(!j(o,n,e.spatialReference)){let c=e.origin;n[0]=c.x,n[1]=c.y,n[2]=c.z,h.getLogger(he).error(`Failed to project specified origin (wkid:${o.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}let i=U(Er,s,n),l=r.origin;r.origin=N(g(),l,i)}function Pr(e,t,o){let r=Pt(e.vertexAttributes,o,{geographic:!0}),{position:n,normal:s,tangent:i}=St(r,t,{geographic:!0});e.vertexAttributes.position=n,e.vertexAttributes.normal=s,e.vertexAttributes.tangent=i,e.vertexAttributesChanged()}function Rr(e,t,o){let r=Zt,n=Bt;if(j(t,n,e.spatialReference)){if(!j(o,r,e.spatialReference)){let s=e.origin;r[0]=s.x,r[1]=s.y,r[2]=s.z,h.getLogger(he).error(`Failed to project specified origin (wkid:${o.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}Mr(e.vertexAttributes.position,n,r),e.vertexAttributesChanged()}else h.getLogger(he).error(`Failed to project centerAt location (wkid:${t.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}function Mr(e,t,o){if(e)for(let r=0;r<e.length;r+=3)for(let n=0;n<3;n++)e[r+n]+=t[n]-o[n]}var Bt=g(),Zt=g(),Er=g();function $t(e,t,o){return R(this,null,function*(){let{source:r}=t,{loadGLTFMesh:n}=yield ve(import("./chunk-YO4WODR4.js"),o),s=yield jr(r,o);we(o);let i=n(new T({x:0,y:0,z:0,spatialReference:e.spatialReference}),s.url,{resolveFile:Cr(s),requestFile:void 0,useTransform:!0,signal:o?.signal,expectedType:s.type});i.then(()=>s.dispose(),()=>s.dispose());let{vertexAttributes:l,components:c}=yield i;e.vertexAttributes=l,e.components=c})}function Cr(e){let t=tt(e.url);return o=>{let r=et(o,t,t),n=r?r.replace(/^ *\.\//,""):null;return(n?e.files.get(n):null)??o}}function jr(e,t){return R(this,null,function*(){if(Array.isArray(e)){if(!e.length)throw new E("mesh-load-external:missing-assets","There must be at least one file to load");return e[0]instanceof File?Lr(e):Or(e,t)}return Wt(e)})}function Tr(e,t){return R(this,null,function*(){let{parts:o,assetMimeType:r,assetName:n}=e;if(o.length===1)return new ne(o[0].partUrl);let s=yield e.toBlob(t);return we(t),ne.fromBlob(s,Jt(n,r))})}function Wt(e){return ne.fromBlob(e,Jt(e.name,e.type))}function Lr(e){return Ht(e.map(t=>({name:t.name,mimeType:t.type,source:Wt(t)})))}function Or(e,t){return R(this,null,function*(){let o=yield Qe(e.map(r=>R(this,null,function*(){let n=yield Tr(r);return we(t),{name:r.assetName,mimeType:r.assetMimeType,source:n}})));if(Ke(t))throw o.forEach(r=>r.source.dispose()),qe();return Ht(o)})}var Xt=/^model\/gltf\+json$/,Yt=/^model\/gltf-binary$/,Ye=/\.gltf$/i,Dr=/\.glb$/i;function Ht(e){let t=new Map,o,r=null;for(let{name:n,mimeType:s,source:i}of e)r===null&&(Xt.test(s)||Ye.test(n)?(r=i.url,o="gltf"):(Yt.test(s)||Dr.test(n))&&(r=i.url,o="glb")),t.set(n,i.url),i.files.forEach((l,c)=>t.set(c,l));if(r==null)throw new E("mesh-load-external:missing-files","Missing files to load external mesh source");return new ne(r,()=>e.forEach(({source:n})=>n.dispose()),t,o)}var ne=class e{constructor(t,o=()=>{},r=new Map,n){this.url=t,this.dispose=o,this.files=r,this.type=n}static fromBlob(t,o){let r=URL.createObjectURL(t);return new e(r,()=>URL.revokeObjectURL(r),void 0,o)}};function Jt(e,t){return Xt.test(t)||Ye.test(e)?"gltf":Yt.test(t)||Ye.test(e)?"glb":void 0}var I=class extends wt{constructor(){super(),this.externalSources=new rt,this._explicitDisplaySource=null,this.addHandles(nt(()=>this.externalSources,"after-remove",({item:e})=>{e===this._explicitDisplaySource&&(this._explicitDisplaySource=null)},{sync:!0,onListenerRemove:()=>this._explicitDisplaySource=null}))}get displaySource(){return this._explicitDisplaySource??this._implicitDisplaySource}set displaySource(e){if(e!=null&&!Xe(e))throw new Error("Cannot use this source for display: it is not in a supported format.");this._explicitDisplaySource=e,e&&this.externalSources.every(t=>!Dt(t,e))&&this.externalSources.add(e)}clearSources(){this.externalSources.removeAll()}getExternalSourcesOnService(e){return this.externalSources.items.filter(t=>Ot(t,e))}get _implicitDisplaySource(){return this.externalSources.find(Xe)}};y([b()],I.prototype,"externalSources",void 0),y([b()],I.prototype,"displaySource",null),y([b()],I.prototype,"_implicitDisplaySource",null),y([b()],I.prototype,"_explicitDisplaySource",void 0),I=y([Ae("esri.geometry.support.meshUtils.Metadata")],I);var Ir="esri.geometry.support.meshUtils.offset";function Qt(e,t,o){if(!e.vertexAttributes?.position)return;let{vertexSpace:r}=e;r.isRelative?(z(r,Ir,o),Nr(r,t)):k(e.spatialReference,o)?Ur(e,t):kr(e,t)}function Nr(e,t){let o=e.origin;e.origin=N(g(),o,t)}function Ur(e,t){let o=e.spatialReference,r=e.vertexAttributes.position,n=e.vertexAttributes.normal,s=e.vertexAttributes.tangent,i=new Float64Array(r.length),l=n!=null?new Float32Array(n.length):null,c=s!=null?new Float32Array(s.length):null,a=e.extent.center,p=zr;Re(o,[a.x,a.y,a.z],qt,H(o)),Pe(Kt,qt),$(p,t,Kt),Q(r,o,i),n!=null&&l!=null&&q(n,r,i,o,l),s!=null&&c!=null&&te(s,r,i,o,c),er(i,p),ee(i,r,o),n!=null&&l!=null&&K(l,r,i,o,n),s!=null&&c!=null&&re(c,r,i,o,s),e.vertexAttributesChanged()}function kr(e,t){er(e.vertexAttributes.position,t),e.vertexAttributesChanged()}function er(e,t){if(e)for(let o=0;o<e.length;o+=3)for(let r=0;r<3;r++)e[o+r]+=t[r]}var zr=g(),qt=Fe(),Kt=Y();function tr(){let{faceDescriptions:e,faceVertexOffsets:t,uvScales:o}=Vr,r=4*e.length,n=new Float64Array(3*r),s=new Float32Array(3*r),i=new Float32Array(2*r),l=new Uint32Array(2*e.length*3),c=0,a=0,p=0,m=0;for(let f=0;f<e.length;f++){let u=e[f],w=c/3;for(let F of t)l[m++]=w+F;let d=u.corners;for(let F=0;F<4;F++){let L=d[F],A=0;i[p++]=.25*o[F][0]+u.uvOrigin[0],i[p++]=u.uvOrigin[1]-.25*o[F][1];for(let x=0;x<3;x++)u.axis[x]!==0?(n[c++]=.5*u.axis[x],s[a++]=u.axis[x]):(n[c++]=.5*L[A++],s[a++]=0)}}return{position:n,normal:s,uv:i,faces:l}}function rr(e,t){let o=e.components[0],r=o.faces,n=Br[t],s=6*n,i=new Array(6),l=new Array(r.length-6),c=0,a=0;for(let p=0;p<r.length;p++)p>=s&&p<s+6?i[c++]=r[p]:l[a++]=r[p];if(e.vertexAttributes.uv!=null){let p=new Float32Array(e.vertexAttributes.uv),m=4*n*2,f=[0,1,1,1,1,0,0,0];for(let u=0;u<f.length;u++)p[m+u]=f[u];e.vertexAttributes.uv=p}return e.components=[new _({faces:i,material:o.material}),new _({faces:l})],e}function or(e=0){let t=Math.round(8*2**e),o=2*t,r=(t-1)*(o+1)+2*o,n=new Float64Array(3*r),s=new Float32Array(3*r),i=new Float32Array(2*r),l=new Uint32Array(3*((t-1)*o*2)),c=0,a=0,p=0,m=0;for(let f=0;f<=t;f++){let u=f/t*Math.PI+.5*Math.PI,w=Math.cos(u),d=Math.sin(u);v[2]=d;let F=f===0||f===t,L=F?o-1:o;for(let A=0;A<=L;A++){let x=A/L*2*Math.PI;v[0]=-Math.sin(x)*w,v[1]=Math.cos(x)*w;for(let P=0;P<3;P++)n[c]=.5*v[P],s[c]=v[P],++c;i[a++]=(A+(F?.5:0))/o,i[a++]=f/t,f!==0&&A!==o&&(f!==t&&(l[p++]=m,l[p++]=m+1,l[p++]=m-o),f!==1&&(l[p++]=m,l[p++]=m-o,l[p++]=m-o-1)),m++}}return{position:n,normal:s,uv:i,faces:l}}function nr(e=0){let o=Math.round(16*2**e),r=(5-1)*(o+1)+2*o,n=new Float64Array(3*r),s=new Float32Array(3*r),i=new Float32Array(2*r),l=new Uint32Array(3*(4*o)),c=0,a=0,p=0,m=0,f=0;for(let u=0;u<=5;u++){let w=u===0||u===5,d=u<=1||u>=5-1,F=u===2||u===4,L=w?o-1:o;for(let A=0;A<=L;A++){let x=A/L*2*Math.PI,P=w?0:.5;v[0]=P*Math.sin(x),v[1]=P*-Math.cos(x),v[2]=u<=2?.5:-.5;for(let W=0;W<3;W++)n[c++]=v[W],s[a++]=d?W===2?u<=1?1:-1:0:W===2?0:v[W]/P;i[p++]=(A+(w?.5:0))/o,i[p++]=u<=1?1*u/3:u<=3?1*(u-2)/3+1/3:1*(u-4)/3+2/3,F||u===0||A===o||(u!==5&&(l[m++]=f,l[m++]=f+1,l[m++]=f-o),u!==1&&(l[m++]=f,l[m++]=f-o,l[m++]=f-o-1)),f++}}return{position:n,normal:s,uv:i,faces:l}}function sr(e,t){let o=typeof t=="number"?t:t!=null?t.width:1,r=typeof t=="number"?t:t!=null?t.height:1;switch(e){case"up":case"down":return{width:o,depth:r};case"north":case"south":return{width:o,height:r};case"east":case"west":return{depth:o,height:r}}}function ir(e){let t=ge.facingAxisOrderSwap[e],o=ge.position,r=ge.normal,n=new Float64Array(o.length),s=new Float32Array(r.length),i=0;for(let l=0;l<4;l++){let c=i;for(let a=0;a<3;a++){let p=t[a],m=Math.abs(p)-1,f=p>=0?1:-1;n[i]=o[c+m]*f,s[i]=r[c+m]*f,i++}}return{position:n,normal:s,uv:new Float32Array(ge.uv),faces:new Uint32Array(ge.faces),isPlane:!0}}var se=1,ie=2,ae=3,ge={position:[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],normal:[0,0,1,0,0,1,0,0,1,0,0,1],uv:[0,1,1,1,1,0,0,0],faces:[0,1,2,0,2,3],facingAxisOrderSwap:{east:[ae,se,ie],west:[-ae,-se,ie],north:[-se,ae,ie],south:[se,-ae,ie],up:[se,ie,ae],down:[se,-ie,-ae]}};function de(e,t,o){e.isPlane||_r(e),Gr(e,o?.size);let{vertexAttributes:r,vertexSpace:n,transform:s}=Ft(e,t,o);return{vertexAttributes:new oe(ye(xe({},r),{uv:e.uv})),vertexSpace:n,transform:s,components:[new _({faces:e.faces,material:o?.material||null})],spatialReference:t.spatialReference}}function _r(e){for(let t=0;t<e.position.length;t+=3)e.position[t+2]+=.5}function Gr(e,t){if(t==null)return;let o=typeof t=="number"?[t,t,t]:[t.width!=null?t.width:1,t.depth!=null?t.depth:1,t.height!=null?t.height:1];V[0]=o[0],V[4]=o[1],V[8]=o[2];for(let r=0;r<e.position.length;r+=3){for(let n=0;n<3;n++)v[n]=e.position[r+n];$(v,v,V);for(let n=0;n<3;n++)e.position[r+n]=v[n]}if(o[0]!==o[1]||o[1]!==o[2]){V[0]=1/o[0],V[4]=1/o[1],V[8]=1/o[2];for(let r=0;r<e.normal.length;r+=3){for(let n=0;n<3;n++)v[n]=e.normal[r+n];$(v,v,V),ft(v,v);for(let n=0;n<3;n++)e.normal[r+n]=v[n]}}}var Vr={faceDescriptions:[{axis:[0,-1,0],uvOrigin:[0,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[1,0,0],uvOrigin:[.25,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,1,0],uvOrigin:[.5,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[-1,0,0],uvOrigin:[.75,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[0,0,1],uvOrigin:[0,.375],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,0,-1],uvOrigin:[0,.875],corners:[[-1,1],[1,1],[1,-1],[-1,-1]]}],uvScales:[[0,0],[1,0],[1,1],[0,1]],faceVertexOffsets:[0,1,2,0,2,3]},Br={south:0,east:1,north:2,west:3,up:4,down:5},v=g(),V=Y();var pr="esri.geometry.support.meshUtils.rotate";function mr(e,t,o){if(!e.vertexAttributes?.position||t[3]===0)return;let{spatialReference:r,vertexSpace:n}=e;if(n.isRelative){z(n,pr,o);let s=o?.origin??e.origin;e.transform??=new O,Zr(e.transform,n,t,s)}else{let s=o?.origin??e.origin;k(r,o)?$r(e,t,s):Wr(e,t,s)}}function Zr(e,t,o,r){let n=t.origin,s=X(le,r.x,r.y,r.z??0),i=U(le,s,n);e.applyLocalInverse(i,ar),e.rotation=vt(e.rotation,o,fe()),e.applyLocalInverse(i,i),U(i,i,ar),e.translation=N(g(),e.translation,i)}function $r(e,t,o){let r=e.spatialReference,n=H(r),s=fr;j(o,s,n)||j(e.origin,s,n);let i=e.vertexAttributes.position,l=e.vertexAttributes.normal,c=e.vertexAttributes.tangent,a=new Float64Array(i.length),p=l!=null?new Float32Array(l.length):null,m=c!=null?new Float32Array(c.length):null;Re(n,s,ke,n),Pe(cr,ke);let f=lr;$(lr,t,cr),f[3]=t[3],Q(i,r,a),l!=null&&p!=null&&q(l,i,a,r,p),c!=null&&m!=null&&te(c,i,a,r,m),ce(a,f,3,s),ee(a,i,r),l!=null&&p!=null&&(ce(p,f,3),K(p,i,a,r,l)),c!=null&&m!=null&&(ce(m,f,4),re(m,i,a,r,c)),e.vertexAttributesChanged()}function Wr(e,t,o){let r=fr;if(!j(o,r,e.spatialReference)){let n=e.origin;r[0]=n.x,r[1]=n.y,r[2]=n.z,h.getLogger(pr).error(`Failed to project specified origin (wkid:${o.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}ce(e.vertexAttributes.position,t,3,r),ce(e.vertexAttributes.normal,t,3),ce(e.vertexAttributes.tangent,t,4),e.vertexAttributesChanged()}function ce(e,t,o,r=Se){if(e!=null){gt(ke,bt(t),t);for(let n=0;n<e.length;n+=o){for(let s=0;s<3;s++)le[s]=e[n+s]-r[s];ut(le,le,ke);for(let s=0;s<3;s++)e[n+s]=le[s]+r[s]}}}var le=g(),ar=g(),lr=fe(),ke=Fe(),cr=Y(),fr=g();var hr="esri.geometry.support.meshUtils.scale";function gr(e,t,o){if(!e.vertexAttributes?.position)return;let{spatialReference:r,vertexSpace:n}=e;if(n.isRelative){z(n,hr,o);let s=o?.origin??e.origin;e.transform??=new O,Xr(e.transform,n,t,s)}else{let s=k(r,o),i=o?.origin??e.origin;s?Yr(e,t,i):Hr(e,t,i)}}function Xr(e,t,o,r){let n=t.origin,s=X(pe,r.x,r.y,r.z),i=U(pe,s,n);e.applyLocalInverse(i,ur);let l=Ge(g(),e.scale,o);e.scale=l,e.applyLocalInverse(i,i),U(i,i,ur),e.translation=N(g(),e.translation,i)}function Yr(e,t,o){let r=e.spatialReference,n=H(r),s=xr;j(o,s,n)||j(e.origin,s,n);let i=e.vertexAttributes.position,l=e.vertexAttributes.normal,c=e.vertexAttributes.tangent,a=new Float64Array(i.length),p=l!=null?new Float32Array(l.length):null,m=c!=null?new Float32Array(c.length):null;Q(i,r,a),l!=null&&p!=null&&q(l,i,a,r,p),c!=null&&m!=null&&te(c,i,a,r,m),dr(a,t,s),ee(a,i,r),l!=null&&p!=null&&K(p,i,a,r,l),c!=null&&m!=null&&re(m,i,a,r,c),e.vertexAttributesChanged()}function Hr(e,t,o){let r=xr;if(!j(o,r,e.spatialReference)){let n=e.origin;r[0]=n.x,r[1]=n.y,r[2]=n.z,h.getLogger(hr).error(`Failed to project specified origin (wkid:${o.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}). Projection may be possible after calling projection.load().`)}dr(e.vertexAttributes.position,t,r),e.vertexAttributesChanged()}function dr(e,t,o=Se){if(e)for(let r=0;r<e.length;r+=3){for(let n=0;n<3;n++)pe[n]=e[r+n]-o[n];Ge(pe,pe,t);for(let n=0;n<3;n++)e[r+n]=pe[n]+o[n]}}var pe=g(),ur=g(),xr=g();function yr(e){return R(this,null,function*(){let t=[];for(let o of e)o.name.toLowerCase().endsWith(".zip")?t.push(Jr(o)):t.push(Promise.resolve(o));return(yield Promise.all(t)).flat()})}function Jr(e){return R(this,null,function*(){let{BlobReader:t,ZipReader:o,BlobWriter:r}=yield import("./chunk-PF6PJSFL.js"),n=[];return(yield new o(new t(e)).getEntries()).forEach(i=>{if(i.directory||/^__MACOS/i.test(i.filename))return;let l=new r,c=i.getData?.(l).then(a=>new File([a],i.filename));c&&n.push(c)}),Promise.all(n)})}var M,B="esri.geometry.Mesh",qr={base:null,key:"type",defaultKeyValue:"georeferenced",typeMap:{georeferenced:Ee,"georeferenced-relative":Me,local:J}},S=M=class extends it.LoadableMixin(st(pt)){constructor(e){super(e),this.components=null,this.vertexSpace=new Ee,this.transform=null,this.metadata=new I,this.hasZ=!0,this.hasM=!1,this.vertexAttributes=new oe,this.type="mesh"}initialize(){(this.metadata.externalSources.length===0||this.vertexAttributes.position.length)&&(this.loadStatus="loaded"),this.when(()=>{this.addHandles(ot(()=>({vertexAttributes:this.vertexAttributes,components:this.components?.map(e=>e.clone())}),()=>this._clearSources(),{once:!0,sync:!0}))})}get hasExtent(){return this.loaded?this.vertexAttributes.position.length>0&&(!this.components||this.components.length>0):this.metadata.displaySource?.extent!=null}get _transformedExtent(){let{components:e,spatialReference:t,vertexAttributes:o,vertexSpace:r}=this,n=o.position;if(n.length===0||e&&e.length===0)return new Z({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:t});if(r.type==="local"){let{_untransformedExtent:s,transform:i}=this;return Gt(s,i,r,t)}if(r.type==="georeferenced-relative"){let{transform:s}=this,i=Ce({positions:n,transform:s,vertexSpace:r,inSpatialReference:t,outSpatialReference:t});return ue(i,t)}return ue(n,t)}get _untransformedExtent(){return ue(this.vertexAttributes.position,this.spatialReference)}get anchor(){let{vertexSpace:e}=this;if(e.isRelative)return e.getOriginPoint(this.spatialReference);let{center:t,zmin:o}=this._transformedExtent;return new T({x:t.x,y:t.y,z:o,spatialReference:this.spatialReference})}get origin(){let{vertexSpace:e}=this;return e.isRelative?e.getOriginPoint(this.spatialReference):this._transformedExtent.center}get extent(){return this.loaded||this.metadata?.displaySource?.extent==null?this._transformedExtent:this.metadata.displaySource.extent.clone()}addComponent(e){if(!this.loaded)return h.getLogger(this).error("addComponent()",new G().message);this.components||(this.components=[]),this.components.push(_.from(e)),this.notifyChange("components")}removeComponent(e){if(!this.loaded)return h.getLogger(this).error("removeComponent()",new G().message);if(this.components){let t=this.components.indexOf(e);if(t!==-1)return this.components.splice(t,1),void this.notifyChange("components")}h.getLogger(this).error("removeComponent()",new je().message)}rotate(e,t,o,r){return At(e,t,o,wr),mr(this,wr,r),this}offset(e,t,o,r){return this.loaded?(ze[0]=e,ze[1]=t,ze[2]=o,Qt(this,ze,r),this):(h.getLogger(this).error("offset()",new G().message),this)}scale(e,t){return this.loaded?(gr(this,e,t),this):(h.getLogger(this).error("scale()",new G().message),this)}centerAt(e,t){return this.loaded?(Vt(this,e,t),this):(h.getLogger(this).error("centerAt()",new G().message),this)}load(e){let{metadata:{displaySource:t}}=this;return t&&this.addResolvingPromise($t(this,t,e)),Promise.resolve(this)}addExternalSources(e){this.metadata.externalSources.addMany(e)}updateDisplaySource(e){this.metadata.displaySource=e}clone(){return this.cloneWithVertexSpace(this.vertexSpace.clone())}cloneWithVertexSpace(e){let t=null;if(this.components){let r=new Map,n=new Map;t=this.components.map(s=>s.cloneWithDeduplication(r,n))}let o={components:t,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes.clone(),vertexSpace:e,transform:this.transform?.clone()??null,metadata:this.metadata.clone()};return new M(o)}cloneShallow(){return new M({components:this.components,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes,vertexSpace:this.vertexSpace.clone(),transform:this.transform,metadata:this.metadata})}vertexAttributesChanged(){this.notifyChange("vertexAttributes")}toBinaryGLTF(e){return R(this,null,function*(){let t=import("./chunk-DAYQAP4I.js"),o=this.load(),r=yield Promise.all([t,o]),{toBinaryGLTF:n}=r[0];return n(this,e)})}get memoryUsage(){let e=0;if(e+=this.vertexAttributes.memoryUsage,this.components!=null)for(let t of this.components)e+=t.memoryUsage;return e}_clearSources(){this.metadata.clearSources()}static createBox(e,t){if(!(e instanceof T))return h.getLogger(B).error(".createBox()",new D().message),null;let o=new M(de(tr(),e,t));return t?.imageFace&&t.imageFace!=="all"?rr(o,t.imageFace):o}static createSphere(e,t){return e instanceof T?new M(de(or(t?.densificationFactor||0),e,t)):(h.getLogger(B).error(".createSphere()",new D().message),null)}static createCylinder(e,t){return e instanceof T?new M(de(nr(t?.densificationFactor||0),e,t)):(h.getLogger(B).error(".createCylinder()",new D().message),null)}static createPlane(e,t){if(!(e instanceof T))return h.getLogger(B).error(".createPlane()",new D().message),null;let o=t?.facing??"up",r=sr(o,t?.size);return new M(de(ir(o),e,ye(xe({},t),{size:r})))}static createFromPolygon(e,t){if(!(e instanceof Ve))return h.getLogger(B).error(".createFromPolygon()",new Te().message),null;let o=zt(e);return new M({vertexAttributes:new oe({position:o.position}),components:[new _({faces:o.faces,shading:"flat",material:t?.material??null})],spatialReference:e.spatialReference,vertexSpace:new Ee})}static createFromGLTF(e,t,o){return R(this,null,function*(){if(!(e instanceof T)){let n=new D;throw h.getLogger(B).error(".createfromGLTF()",n.message),n}let{loadGLTFMesh:r}=yield ve(import("./chunk-YO4WODR4.js"),o);return new M(yield r(e,t,o))})}static createFromFiles(e,t,o){return R(this,null,function*(){let r=a=>h.getLogger(B).error(".createFromFiles()",a.message);if(!(e instanceof T)){let a=new D;throw r(a),a}let n=o?.layer;if(!n){let a=new Le;throw r(a),a}let s=yield M.extractAndFilterFiles(t,n),i=s.reduce((a,p)=>Ct(n.infoFor3D,p)?a+1:a,0);if(i===0){let a=new Oe;throw r(a),a}if(i>1){let a=new De;throw r(a),a}let l=M.createWithExternalSource(e,s),[c]=yield n.uploadAssets([l],o);return c})}static extractAndFilterFiles(e,t){return R(this,null,function*(){let o=t?.infoFor3D;return o?(yield yr(e)).filter(r=>Et(o,r)):e})}static createWithExternalSource(e,t,o){let r=o?.extent??null,{x:n,y:s,z:i,spatialReference:l}=e,c=o?.transform?.clone()??new O,a=o?.vertexSpace??new J({origin:[n,s,i??0]}),p={source:t,extent:r},m=new I;return m.externalSources.push(p),new M({metadata:m,transform:c,vertexSpace:a,spatialReference:l})}static createIncomplete(e,t){let{x:o,y:r,z:n,spatialReference:s}=e,i=t?.transform?.clone()??new O,l=t?.vertexSpace??new J({origin:[o,r,n??0]}),c=new M({transform:i,vertexSpace:l,spatialReference:s});return c.addResolvingPromise(Promise.reject(new E("mesh-incomplete","Mesh resources are not complete"))),c}};y([b({type:[_],json:{write:!0}})],S.prototype,"components",void 0),y([b({nonNullable:!0,types:qr,constructOnly:!0,json:{write:!0}})],S.prototype,"vertexSpace",void 0),y([b({type:O,json:{write:!0}})],S.prototype,"transform",void 0),y([b({constructOnly:!0})],S.prototype,"metadata",void 0),y([b()],S.prototype,"hasExtent",null),y([b()],S.prototype,"_transformedExtent",null),y([b()],S.prototype,"_untransformedExtent",null),y([b()],S.prototype,"anchor",null),y([b()],S.prototype,"origin",null),y([b({readOnly:!0,json:{read:!1}})],S.prototype,"extent",null),y([b({readOnly:!0,json:{read:!1,write:!0,default:!0}})],S.prototype,"hasZ",void 0),y([b({readOnly:!0,json:{read:!1,write:!0,default:!1}})],S.prototype,"hasM",void 0),y([b({type:oe,nonNullable:!0,json:{write:!0}})],S.prototype,"vertexAttributes",void 0),S=M=y([Ae(B)],S);var ze=g(),wr=fe(),He=S;var Je=()=>h.getLogger("esri.rest.support.meshFeatureSet");function mi(e,t,o){let r=o.features;o.features=[],delete o.geometryType;let n=Mt.fromJSON(o);if(n.geometryType="mesh",!o.assetMaps)return n;let s=ro(t,o.assetMaps),i=e.sourceSpatialReference??ct.WGS84,l=o.globalIdFieldName,{outFields:c}=e,a=c!=null&&c.length>0?Kr(c.includes("*")?null:new Set(c)):()=>({});for(let p of r){let m=Qr(p,l,i,t,s);m!=null&&n.features.push(new Rt({geometry:m,attributes:a(p)}))}return n}function Kr(e){return({attributes:t})=>{if(!t)return{};if(!e)return t;for(let o in t)e.has(o)||delete t[o];return t}}function Qr(e,t,o,r,n){let s=e.attributes[t],i=n.get(s);if(i==null)return Je().error("mesh-feature-set:asset-not-found","Service returned a feature which was not found in the asset map",e),null;if(!e.geometry)return Je().error("mesh-feature-set:no-geometry","Service returned a feature without geometry",e),null;let{originPoint:l,originVector:c}=eo(e,o,r),a=Z.fromJSON(e.geometry);a.spatialReference=o;let p=to(e.attributes,r),m=i.projectVertices?new Me({origin:c}):new J({origin:c}),f=oo(i);return f?He.createWithExternalSource(l,f,{extent:a,transform:p,vertexSpace:m}):He.createIncomplete(l,{extent:a,transform:p,vertexSpace:m})}function eo({attributes:e},t,{transformFieldRoles:o}){let r=e[o.originX],n=e[o.originY],s=e[o.originZ];return{originPoint:new T({x:r,y:n,z:s,spatialReference:t}),originVector:mt(r,n,s)}}function to(e,{transformFieldRoles:t}){return new O({translation:[e[t.translationX],-e[t.translationZ],e[t.translationY]],rotationAxis:[e[t.rotationX],-e[t.rotationZ],e[t.rotationY]],rotationAngle:e[t.rotationDeg],scale:[e[t.scaleX],e[t.scaleZ],e[t.scaleY]]})}var me;function ro(e,t){let o=new Map;for(let r of t){let n=r.parentGlobalId;if(n==null)continue;let s=r.assetName,i=r.assetType,l=r.assetHash,c=r.assetURL,a=r.conversionStatus,p=r.seqNo,m=jt(i,e.supportedFormats);if(!m){Je().error("mesh-feature-set:unknown-format",`Service returned an asset of type ${i}, but it does not list it as a supported type`);continue}let f=_e(o,n,()=>({projectVertices:so(r.flags).projectVertices,files:new Map}));_e(f.files,s,()=>({name:s,type:i,mimeType:m,status:no(a),parts:[]})).parts[p]={hash:l,url:c}}return o}function oo(e){let t=Array.from(e.files.values()),o=new Array;for(let r of t){if(r.status!==me.COMPLETED)return null;let n=new Array;for(let s of r.parts){if(!s)return null;n.push(new Lt(s.url,s.hash))}o.push(new Tt(r.name,r.mimeType,n))}return o}function no(e){switch(e){case"COMPLETED":case"SUBMITTED":return me.COMPLETED;case"INPROGRESS":return me.PENDING;default:return me.FAILED}}function so(e){return{projectVertices:e.includes("PROJECT_VERTICES")}}(function(e){e[e.FAILED=0]="FAILED",e[e.PENDING=1]="PENDING",e[e.COMPLETED=2]="COMPLETED"})(me||(me={}));export{ro as assetMapFromAssetMapsJSON,Qr as extractMesh,mi as meshFeatureSetFromJSON};
