import{a as u}from"./chunk-S4GXXOVS.js";import{a as v}from"./chunk-4TZNIQOB.js";import{a as h}from"./chunk-UV6MZLVE.js";import{b as m}from"./chunk-FBHJEXCM.js";import{a as y}from"./chunk-IEXZWAIE.js";import{a as S}from"./chunk-F72O5PVM.js";import{r as N}from"./chunk-465DRXTW.js";import{a as L,b as I,g as n}from"./chunk-ESDYQQXO.js";var p=class{constructor(){this._serviceMetadatas=new Map}fetchServiceMetadata(a,t){return n(this,null,function*(){let r=this._serviceMetadatas.get(a);if(r)return r;let s=yield v(a,t);return this._serviceMetadatas.set(a,s),s})}};function l(e){let a={id:e.id,name:e.name};return e.type==="Oriented Imagery Layer"&&(a.layerType="OrientedImageryLayer"),a}function b(e,a,t){return n(this,null,function*(){if(e?.layers==null||e?.tables==null){let r=yield t.fetchServiceMetadata(a);(e=e||{}).layers=e.layers||r?.layers?.map(l),e.tables=e.tables||r?.tables?.map(l)}return e})}function g(e){let a=e.layers;if(a?.length)return a[0].id;let t=e.tables;return t?.length?t[0].id:null}function f(e){return(e?.layers?.length??0)+(e?.tables?.length??0)}function M(e){let a=[];return e?.layers?.forEach(t=>{t.layerType==="SubtypeGroupLayer"&&a.push(t.id)}),a}function T(e){return e?.layers?.filter(({layerType:a})=>a==="OrientedImageryLayer").map(({id:a})=>a)}function F(e,a,t){return n(this,null,function*(){if(!e?.url)return a??{};if(a??={},!a.layers){let c=yield t.fetchServiceMetadata(e.url);a.layers=c.layers?.map(l)}let{serverUrl:r,portalItem:s}=yield u(e.url,{sceneLayerItem:e}).catch(()=>({serverUrl:null,portalItem:null}));if(r==null)return a.tables=[],a;if(!a.tables&&s){let c=yield s.fetchData();if(c?.tables)a.tables=c.tables.map(l);else{let i=yield t.fetchServiceMetadata(r);a.tables=i?.tables?.map(l)}}if(a.tables)for(let c of a.tables)c.url=`${r}/${c.id}`;return a})}function le(e){return n(this,null,function*(){!e.portalItem||e.portalItem instanceof S||(e=I(L({},e),{portalItem:new S(e.portalItem)}));let a=yield O(e.portalItem);return new a.constructor(L({portalItem:e.portalItem},a.properties))})}function O(e){return n(this,null,function*(){yield e.load();let a=new p;return x(yield D(e,a))})}function D(e,a){return n(this,null,function*(){switch(e.type){case"Map Service":return A(e,a);case"Feature Service":return K(e,a);case"Feature Collection":return W(e);case"Scene Service":return V(e,a);case"Image Service":return $(e,a);case"Stream Service":return j();case"Vector Tile Service":return k();case"GeoJson":return U();case"CSV":return J();case"KML":return _();case"WFS":return E();case"WMTS":return P();case"WMS":return R();case"Feed":return q();case"Group Layer":return z();default:throw new N("portal:unknown-item-type","Unknown item type '${type}'",{type:e.type})}})}function x(e){return n(this,null,function*(){let a=e.className,t=h[a];return{constructor:yield t(),properties:e.properties}})}function A(e,a){return n(this,null,function*(){return(yield B(e,a))?{className:"TileLayer"}:{className:"MapImageLayer"}})}function K(e,a){return n(this,null,function*(){let t=yield G(e,a);if(typeof t=="object"){let r={};return t.id!=null&&(r.layerId=t.id),{className:t.className||"FeatureLayer",properties:r}}return{className:"GroupLayer"}})}function V(e,a){return n(this,null,function*(){let t=yield G(e,a,()=>n(this,null,function*(){try{if(!e.url)return[];let{serverUrl:r}=yield u(e.url,{sceneLayerItem:e});return(yield a.fetchServiceMetadata(r))?.tables??[]}catch{return[]}}));if(typeof t=="object"){let r={},s;if(t.id!=null?(r.layerId=t.id,s=`${e.url}/layers/${t.id}`):s=e.url,e.typeKeywords?.length){for(let i of Object.keys(y))if(e.typeKeywords.includes(i))return{className:y[i]}}let c=yield a.fetchServiceMetadata(s);return{className:y[c?.layerType]||"SceneLayer",properties:r}}return t===!1&&(yield a.fetchServiceMetadata(e.url))?.layerType==="Voxel"?{className:"VoxelLayer"}:{className:"GroupLayer"}})}function W(e){return n(this,null,function*(){yield e.load();let a=m(e,"Map Notes"),t=m(e,"Markup");if(a||t)return{className:"MapNotesLayer"};if(m(e,"Route Layer"))return{className:"RouteLayer"};let r=yield e.fetchData();return f(r)===1?{className:"FeatureLayer"}:{className:"GroupLayer"}})}function $(e,a){return n(this,null,function*(){yield e.load();let t=e.typeKeywords?.map(d=>d.toLowerCase())??[];if(t.includes("elevation 3d layer"))return{className:"ElevationLayer"};if(t.includes("tiled imagery"))return{className:"ImageryTileLayer"};let r=yield e.fetchData(),s=r?.layerType;if(s==="ArcGISTiledImageServiceLayer")return{className:"ImageryTileLayer"};if(s==="ArcGISImageServiceLayer")return{className:"ImageryLayer"};let c=yield a.fetchServiceMetadata(e.url),i=c.cacheType?.toLowerCase(),o=c.capabilities?.toLowerCase().includes("tilesonly");return i==="map"||o?{className:"ImageryTileLayer"}:{className:"ImageryLayer"}})}function j(){return{className:"StreamLayer"}}function k(){return{className:"VectorTileLayer"}}function U(){return{className:"GeoJSONLayer"}}function J(){return{className:"CSVLayer"}}function _(){return{className:"KMLLayer"}}function E(){return{className:"WFSLayer"}}function R(){return{className:"WMSLayer"}}function P(){return{className:"WMTSLayer"}}function q(){return{className:"StreamLayer"}}function z(){return{className:"GroupLayer"}}function B(e,a){return n(this,null,function*(){return(yield a.fetchServiceMetadata(e.url)).tileInfo})}function G(e,a,t){return n(this,null,function*(){let r=e.url;if(!r||/\/\d+$/.test(r))return{};yield e.load();let s=yield e.fetchData();if(e.type==="Feature Service"){let i=yield b(s,r,a),o=w(i);if(typeof o=="object"){let d=M(i),C=T(i);o.className=o.id!=null&&d.includes(o.id)?"SubtypeGroupLayer":o.id!=null&&C?.includes(o.id)?"OrientedImageryLayer":"FeatureLayer"}return o}if(e.type==="Scene Service"&&(s=yield F(e,s,a)),f(s)>0)return w(s);let c=yield a.fetchServiceMetadata(r);return t&&(c.tables=yield t()),w(c)})}function w(e){return f(e)===1&&{id:g(e)}}export{p as a,l as b,b as c,g as d,f as e,M as f,T as g,F as h,le as i,D as j};
