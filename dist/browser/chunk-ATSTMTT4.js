import{a as _}from"./chunk-OVKL2WYY.js";import{a as W,b as H}from"./chunk-JKNGMCUA.js";import{b as R}from"./chunk-VXOK76QV.js";import{a as w}from"./chunk-2APWMENK.js";import{g as L,h as Y}from"./chunk-ZWFVPWKA.js";import{z as Z}from"./chunk-VDN3XKL2.js";import{a as G}from"./chunk-AQ74ANSJ.js";import{a as Q}from"./chunk-6MGDEI2H.js";import{i as A}from"./chunk-AHKJJNRE.js";import{b as P}from"./chunk-A52LT7YB.js";import{o as q,y as B}from"./chunk-CZPMRK53.js";import{a as k,b as U,g as j}from"./chunk-ESDYQQXO.js";var le="<Null>",ie="equal-interval",ae=1,re=5,oe=10,se=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,ue=new Set(["esriFieldTypeDate","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeOID","esriFieldTypeBigInteger"]),ce=new Set(["esriFieldTypeTimeOnly","esriFieldTypeDateOnly"]),me=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function v(e){return e==null||typeof e=="string"&&!e?le:e}function fe(e){let t=e.normalizationField!=null||e.normalizationType!=null,n=e.minValue!=null||e.maxValue!=null,l=!!e.sqlExpression&&e.supportsSQLExpression;return!t&&!n&&!l}function Oe(e){let t=e.returnDistinct?[...new Set(e.values)]:e.values,n=t.filter(a=>a!=null).sort(),l=n.length,i={count:l,min:n[0],max:n[l-1]};return e.supportsNullCount&&(i.nullcount=t.length-l),e.percentileParams&&(i.median=X(t,e.percentileParams)),i}function de(e){let{values:t,useSampleStdDev:n,supportsNullCount:l}=e,i=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,r=null,o=null,s=null,m=null,u=0,p=e.minValue==null?-1/0:e.minValue,c=e.maxValue==null?1/0:e.maxValue;for(let f of t)Number.isFinite(f)?f>=p&&f<=c&&(r=r===null?f:r+f,i=Math.min(i,f),a=Math.max(a,f),u++):typeof f=="string"&&u++;if(u&&r!=null){o=r/u;let f=0;for(let y of t)Number.isFinite(y)&&y>=p&&y<=c&&(f+=(y-o)**2);m=n?u>1?f/(u-1):0:u>0?f/u:0,s=Math.sqrt(m)}else i=null,a=null;let h={avg:o,count:u,max:a,min:i,stddev:s,sum:r,variance:m};return l&&(h.nullcount=t.length-u),e.percentileParams&&(h.median=X(t,e.percentileParams)),h}function X(e,t){let{fieldType:n,value:l,orderBy:i,isDiscrete:a}=t,r=pe(n,i==="desc");if((e=[...e].filter(h=>h!=null).sort((h,f)=>r(h,f))).length===0)return null;if(l<=0)return e[0];if(l>=1)return e[e.length-1];let o=(e.length-1)*l,s=Math.floor(o),m=s+1,u=o%1,p=e[s],c=e[m];return m>=e.length||a||typeof p=="string"||typeof c=="string"?p:p*(1-u)+c*u}function pe(e,t){if(e){if(ue.has(e))return K(t);if(ce.has(e))return E(t,!1);if(e==="esriFieldTypeTimestampOffset")return ve(t);let a=E(t,!0);if(e==="esriFieldTypeString")return a;if(e==="esriFieldTypeGUID"||e==="esriFieldTypeGlobalID")return(r,o)=>a(J(r),J(o))}let n=t?1:-1,l=K(t),i=E(t,!0);return(a,r)=>typeof a=="number"&&typeof r=="number"?l(a,r):typeof a=="string"&&typeof r=="string"?i(a,r):n}var S=(e,t)=>e==null?t==null?0:1:t==null?-1:null,M=(e,t)=>e==null?t==null?0:-1:t==null?1:null;function he(e){return e?S:M}var ye=(e,t)=>M(e,t)??(e===t?0:new Date(e).getTime()-new Date(t).getTime()),ge=(e,t)=>S(e,t)??(e===t?0:new Date(t).getTime()-new Date(e).getTime());function ve(e){return e?ge:ye}var Fe=(e,t)=>M(e,t)??(e===t?0:e<t?-1:1),be=(e,t)=>S(e,t)??(e===t?0:e<t?1:-1);function E(e,t){if(!t)return e?be:Fe;let n=he(e);return e?(l,i)=>{let a=n(l,i);return a??((l=l.toUpperCase())>(i=i.toUpperCase())?-1:l<i?1:0)}:(l,i)=>{let a=n(l,i);return a??((l=l.toUpperCase())<(i=i.toUpperCase())?-1:l>i?1:0)}}var Te=(e,t)=>S(e,t)??t-e,xe=(e,t)=>M(e,t)??e-t;function K(e){return e?Te:xe}function J(e){return e.substr(24,12)+e.substr(19,4)+e.substr(16,2)+e.substr(14,2)+e.substr(11,2)+e.substr(9,2)+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)+e.substr(0,2)}function ke(e,t){let n;for(n in e)me.includes(n)&&(Number.isFinite(e[n])||(e[n]=null));return t&&["avg","stddev","variance"].forEach(l=>{e[l]!=null&&(e[l]=Math.ceil(e[l]??0))}),e}function Ue(e){let t={};for(let n of e)(n==null||typeof n=="string"&&n.trim()==="")&&(n=null),t[n]==null?t[n]={count:1,data:n}:t[n].count++;return{count:t}}function O(e){return e?.type!=="coded-value"?[]:e.codedValues.map(t=>t.code)}function je(e,t,n,l){let i=e.count,a=[];if(n&&t){let r=[],o=O(t[0]);for(let s of o)if(t[1]){let m=O(t[1]);for(let u of m)if(t[2]){let p=O(t[2]);for(let c of p)r.push(`${v(s)}${l}${v(u)}${l}${v(c)}`)}else r.push(`${v(s)}${l}${v(u)}`)}else r.push(s);for(let s of r)i.hasOwnProperty(s)||(i[s]={data:s,count:0})}for(let r in i){let o=i[r];a.push({value:o.data,count:o.count,label:o.label})}return{uniqueValueInfos:a}}function ee(e,t,n,l){let i=null;switch(t){case"log":e!==0&&(i=Math.log(e)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(l)&&l!==0&&(i=e/l*100);break;case"field":Number.isFinite(n)&&n!==0&&(i=e/n);break;case"natural-log":e>0&&(i=Math.log(e));break;case"square-root":e>0&&(i=e**.5)}return i}function Ie(e,t){let n=Ne({field:t.field,normalizationType:t.normalizationType,normalizationField:t.normalizationField,classificationMethod:t.classificationMethod,standardDeviationInterval:t.standardDeviationInterval,breakCount:t.numClasses||re});return e=Ve(e,t.minValue,t.maxValue),H({definition:n,values:e,normalizationTotal:t.normalizationTotal})}function Ve(e,t,n){let l=t??-1/0,i=n??1/0;return e.filter(a=>Number.isFinite(a)&&a>=l&&a<=i)}function Ne(e){let{breakCount:t,field:n,normalizationField:l,normalizationType:i}=e,a=e.classificationMethod||ie,r=a==="standard-deviation"?e.standardDeviationInterval||ae:void 0;return new W({breakCount:t,classificationField:n,classificationMethod:a,normalizationField:i==="field"?l:void 0,normalizationType:i,standardDeviationInterval:r})}function qe(e,t){let n=e.classBreaks,l=n.length,i=n[0]?.minValue,a=n[l-1]?.maxValue,r=t==="standard-deviation",o=se;return n=n.map(s=>{let m=s.label,u={minValue:s.minValue,maxValue:s.maxValue,label:m};if(r&&m){let p=m.match(o),c=p?.map(h=>+h.trim())??[];c.length===2?(u.minStdDev=c[0],u.maxStdDev=c[1],c[0]<0&&c[1]>0&&(u.hasAvg=!0)):c.length===1&&(m.includes("<")?(u.minStdDev=null,u.maxStdDev=c[0]):m.includes(">")&&(u.minStdDev=c[0],u.maxStdDev=null))}return u}),{minValue:i,maxValue:a,classBreakInfos:n,normalizationTotal:e.normalizationTotal}}function Be(e,t){let n=$e(e,t);if(n.min==null&&n.max==null)return{bins:[],minValue:n.min,maxValue:n.max,normalizationTotal:t.normalizationTotal};let l=n.intervals,i=n.min??0,a=n.max??0,r=l.map((o,s)=>({minValue:l[s][0],maxValue:l[s][1],count:0}));for(let o of e)if(o!=null&&o>=i&&o<=a){let s=ze(l,o);s>-1&&r[s].count++}return{bins:r,minValue:i,maxValue:a,normalizationTotal:t.normalizationTotal}}function $e(e,t){let{field:n,classificationMethod:l,standardDeviationInterval:i,normalizationType:a,normalizationField:r,normalizationTotal:o,minValue:s,maxValue:m}=t,u=t.numBins||oe,p=null,c=null,h=null;if((!l||l==="equal-interval")&&!a){if(s!=null&&m!=null)p=s,c=m;else{let f=de({values:e,minValue:s,maxValue:m,useSampleStdDev:!a,supportsNullCount:fe({normalizationType:a,normalizationField:r,minValue:s,maxValue:m})});p=f.min??null,c=f.max??null}h=De(p??0,c??0,u)}else{let{classBreaks:f}=Ie(e,{field:n,normalizationType:a,normalizationField:r,normalizationTotal:o,classificationMethod:l,standardDeviationInterval:i,minValue:s,maxValue:m,numClasses:u});p=f[0].minValue,c=f[f.length-1].maxValue,h=f.map(y=>[y.minValue,y.maxValue])}return{min:p,max:c,intervals:h}}function ze(e,t){let n=-1;for(let l=e.length-1;l>=0;l--)if(t>=e[l][0]){n=l;break}return n}function De(e,t,n){let l=(t-e)/n,i=[],a,r=e;for(let o=1;o<=n;o++)a=r+l,a=Number(a.toFixed(16)),i.push([r,o===n?t:a]),r=a;return i}var x=null,we=/^(?<hh>([0-1][0-9])|([2][0-3])):(?<mm>[0-5][0-9])(:(?<ss>[0-5][0-9]))?([.](?<ms>\d+))?$/;function Se(e,t,n){return e.x<0?e.x+=t:e.x>n&&(e.x-=t),e}function tt(e,t,n,l){let i=B(n)?q(n):null,a=i?Math.round((i.valid[1]-i.valid[0])/t.scale[0]):null;return e.map(r=>{let o=new A(r.geometry);return R(t,o,o,o.hasZ,o.hasM),r.geometry=i?Se(o,a??0,l[0]):o,r})}function nt(e,t=18,n,l,i,a){let r=new Float64Array(i*a);t=Math.round(G(t));let o=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,m=0,u=0,p=0,c=0,h=Y(l,n);for(let{geometry:y,attributes:V}of e){let{x:F,y:I}=y,N=Math.max(0,F-t),$=Math.max(0,I-t),z=Math.min(a,I+t),g=Math.min(i,F+t),b=+h(V);for(let d=$;d<z;d++)for(let T=N;T<g;T++){let D=d*i+T,te=L(T-F,d-I,t),ne=r[D];m=r[D]+=te*b;let C=m-ne;u+=C,p+=C*C,m<o&&(o=m),m>s&&(s=m),c++}}if(!c)return{mean:0,stddev:0,min:0,max:0,mid:0,count:0};let f=(s-o)/2;return{mean:u/c,stdDev:Math.sqrt((p-u*u/c)/c),min:o,max:s,mid:f,count:c}}function Me(e){let t=we.exec(e);if(!t)return null;let{hh:n,mm:l,ss:i,ms:a}=t.groups;return Number(n)*w.hours+Number(l)*w.minutes+Number(i)*w.seconds+Number(a||0)}function lt(e,t,n=!0){return j(this,null,function*(){if(!t)return[];let{field:l,field2:i,field3:a,fieldDelimiter:r,fieldInfos:o,timeZone:s}=e,m=l&&o?.find(g=>g.name.toLowerCase()===l.toLowerCase()),u=!!m&&Z(m),p=!!m&&_(m),c=e.valueExpression,h=e.normalizationType,f=e.normalizationField,y=e.normalizationTotal,V=[],F=e.viewInfoParams,I=null,N=null;if(c){if(!x){let{arcadeUtils:g}=yield Q();x=g}x.hasGeometryOperations(c)&&(yield x.enableGeometryOperations()),I=x.createFunction(c),N=F?x.getViewInfo({viewingMode:F.viewingMode,scale:F.scale,spatialReference:new P(F.spatialReference)}):null}let $=e.fieldInfos,z=!(t[0]&&"declaredClass"in t[0]&&t[0].declaredClass==="esri.Graphic")&&$?{fields:$}:null;return t.forEach(g=>{let b=g.attributes,d;if(c){let T=z?U(k({},g),{layer:z}):g,D=x.createExecContext(T,N,s);d=x.executeFunction(I,D)}else b&&(d=b[l],i?(d=`${v(d)}${r}${v(b[i])}`,a&&(d=`${d}${r}${v(b[a])}`)):typeof d=="string"&&n&&(p?d=d?new Date(d).getTime():null:u&&(d=d?Me(d):null)));if(h&&typeof d=="number"&&isFinite(d)){let T=b&&parseFloat(b[f]);d=ee(d,h,T,y)}V.push(d)}),V})}export{v as a,fe as b,Oe as c,de as d,X as e,pe as f,ke as g,Ue as h,je as i,ee as j,Ie as k,qe as l,Be as m,tt as n,nt as o,Me as p,lt as q};
