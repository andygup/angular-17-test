import{a as q}from"./chunk-DWZPFSNU.js";import{f as w}from"./chunk-OHIIU6WS.js";import{H as y,K as T}from"./chunk-WMYPRHRR.js";import{R as k}from"./chunk-IAMDMFZ7.js";import{a as l}from"./chunk-53MWZ23O.js";import{b as f}from"./chunk-XDTDVCGP.js";function v(t,e){return t.length=0,e.forEach(o=>t.push(o)),t}var g=new Set,I=[],m=new Map,M=[0,0],a=class extends T{constructor(t){super(t),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){let{concurrency:t,process:e,strategy:o}=this;this._queue=new q({concurrency:t,process:(s,r)=>{let p=this._keyToItem.get(s);return e(p,{signal:r})},peeker:o==="scale-first"?s=>this._peekByScaleFirst(s):s=>this._peekByCenterFirst(s)})}destroy(){this.clear(),this._queue=f(this._queue)}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}abort(t){let e=typeof t=="string"?t:t.id;this._queue.abort(e)}clear(){this._queue.clear(),this._keyToItem.clear()}has(t){return typeof t=="string"?this._keyToItem.has(t):this._keyToItem.has(t.id)}isOngoing(t){let e=typeof t=="string"?t:t.id;return this.has(e)&&this._queue.isOngoing(e)}pause(){this._queue.pause()}push(t){let e=t.key.id;if(this._queue.has(e))return this._queue.get(e);let o=this._queue.push(e),s=()=>{this._keyToItem.delete(e)};return this._keyToItem.set(e,t),o.then(s,s),o}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(t){if(!this.state)return t.values().next().value;let e=this.tileInfoView,o=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY;t.forEach(n=>{let i=this._keyToItem.get(n),u=this.tileInfoView.getTileScale(i.key);m.has(u)||(m.set(u,[]),o=Math.max(u,o),s=Math.min(u,s)),m.get(u).push(i.key),g.add(u)});let r=this.state.scale;m.has(r)||(v(I,g),I.sort((n,i)=>n-i),r=I.reduce((n,i)=>Math.abs(i-r)<Math.abs(n-r)?i:n,I[0])),r=Math.min(r,o),r=Math.max(r,s);let p=m.get(r),c=e.getClosestInfoForScale(r),h=c.getColumnForX(this.state.center[0]),_=c.getRowForY(this.state.center[1]);return p.sort((n,i)=>{let u=c.denormalizeCol(n.col,n.world),d=c.denormalizeCol(i.col,i.world);return Math.sqrt((h-u)*(h-u)+(_-n.row)*(_-n.row))-Math.sqrt((h-d)*(h-d)+(_-i.row)*(_-i.row))}),g.clear(),m.clear(),p[0].id}_peekByCenterFirst(t){if(!this.state)return t.values().next().value;let e=this.tileInfoView,o=this.state.center,s,r=Number.POSITIVE_INFINITY;return t.forEach(p=>{let c=this._keyToItem.get(p);e.getTileCoords(M,c.key);let h=w(M,o);h<r&&(r=h,s=c.key)}),s.id}};l([y({constructOnly:!0})],a.prototype,"concurrency",void 0),l([y({constructOnly:!0})],a.prototype,"process",void 0),l([y()],a.prototype,"state",void 0),l([y({constructOnly:!0})],a.prototype,"strategy",void 0),l([y({constructOnly:!0})],a.prototype,"tileInfoView",void 0),a=l([k("esri.views.2d.tiling.TileQueue")],a);var B=a;export{B as a};
