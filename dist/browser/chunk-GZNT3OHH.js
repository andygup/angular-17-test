import{a as ke}from"./chunk-U3QAV4TV.js";import{a as Ue}from"./chunk-HZAVPHHR.js";import{a as Ee}from"./chunk-ZODUYFSC.js";import{a as I}from"./chunk-DJKXVE6T.js";import{a as Ne}from"./chunk-QCHQODPK.js";import{a as we}from"./chunk-URPONBMS.js";import{a as oe}from"./chunk-6UQ2Y4IC.js";import{a as te,c as W,d as Ie,e as Se,f as re,h as se}from"./chunk-6JYX4V7N.js";import{a as ve}from"./chunk-CN5O6E6T.js";import{c as Te}from"./chunk-TJ3KO5EG.js";import{b as ee}from"./chunk-HI2T2YSZ.js";import{f as be}from"./chunk-4ATIL3QV.js";import{a as K}from"./chunk-WUM4JBII.js";import{a as Z}from"./chunk-F72O5PVM.js";import{a as B}from"./chunk-6J4Y65BV.js";import{j as ge}from"./chunk-6QIKBCPR.js";import{b as X}from"./chunk-A52LT7YB.js";import{a as he,b as Y}from"./chunk-WQAXQD4X.js";import{$ as S,g as fe}from"./chunk-XF4NUYV7.js";import{f as ye,h as z}from"./chunk-FNDPIYNC.js";import{H as a,K as ce}from"./chunk-WMYPRHRR.js";import{R as h}from"./chunk-IAMDMFZ7.js";import{a as i}from"./chunk-53MWZ23O.js";import{h as H,p as pe}from"./chunk-PT7S6WNL.js";import{p as me,r as J}from"./chunk-465DRXTW.js";import{a as b,b as A,f as de,g as u}from"./chunk-ESDYQQXO.js";var Je=Y()({Pending:"job-waiting",InProgress:"job-executing",Completed:"job-succeeded"}),C=class extends ke{constructor(r){super(r),this.statusUrl=null,this.status=null,this.submissionTime=null,this.lastUpdatedTime=null,this._timer=void 0}destroy(){clearInterval(this._timer)}checkJobStatus(r){return u(this,null,function*(){let e=A(b({},r),{query:{f:"json"}}),{data:o}=yield S(this.statusUrl,e);return this.read(o),this.editsResolver&&this.editsResolver.resolve({edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],exceededTransferLimit:!0,historicMoment:null}),this})}waitForJobCompletion(){return u(this,arguments,function*(r={}){let{interval:e=1e3,statusCallback:o}=r;return new Promise((t,s)=>{this._clearTimer();let l=setInterval(()=>{this._timer||s(H()),this.checkJobStatus().then(n=>{let{status:d}=n;switch(this.status=d,d){case"job-succeeded":this._clearTimer(),t(this);break;case"job-waiting":case"job-executing":o&&o(this)}},n=>{this._clearTimer(),s(n)})},e);this._timer=l})})}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};i([a()],C.prototype,"editsResolver",void 0),i([a({type:String,json:{write:!0}})],C.prototype,"statusUrl",void 0),i([K(Je)],C.prototype,"status",void 0),i([a({type:Date,json:{type:Number,write:{writer:(r,e)=>{e.submissionTime=r?r.getTime():null}}}})],C.prototype,"submissionTime",void 0),i([a({type:Date,json:{type:Number,write:{writer:(r,e)=>{e.lastUpdatedTime=r?r.getTime():null}}}})],C.prototype,"lastUpdatedTime",void 0),C=i([h("esri.networks.support.TopologyValidationJobInfo")],C);var Oe=C;function Re(r,e){return u(this,null,function*(){if(r==="Utility Network Layer"){let{default:o}=yield import("./chunk-GMLGF4PA.js");return new o({layerUrl:e})}return null})}function Ae(r){return u(this,null,function*(){let e="portalItem"in r?r:{portalItem:r};!e.portalItem||e.portalItem instanceof Z||(e=A(b({},e),{portalItem:new Z(e.portalItem)}));let o=e.portalItem;if(yield o.load(),o.type!=="Feature Service")throw new J("portal:unknown-item-type","Unknown item type '${type}'",{type:o.type});let t=o.url,s=yield S(t,{responseType:"json",query:{f:"json"}}),l="Network Layer";if(s.data.type?.includes(l))return Re(s.data.type,t);if(s.data.layers){let n=s.data.layers.find(d=>d.type.includes(l));if(n){let d=`${t}/${n.id}`;return Re(n.type,d)}}return null})}var p=class extends we(B){static fromPortalItem(r){return Ae(r)}constructor(r){super(r),this.id=null,this.title=null,this.layerUrl=null,this.dataElement=null,this.fullExtent=null,this.spatialReference=null,this.type=null,this.sourceJSON=null,this.gdbVersion=null,this.historicMoment=null,this._applyEditsHandler=e=>{let{serviceUrl:o,gdbVersion:t,result:s}=e,l=o===this.featureServiceUrl,n=se(o,t,this.gdbVersion);l&&n&&s.then(d=>{W(o,t)&&(this.historicMoment=d.historicMoment)})},this._updateMomentHandler=e=>{let{serviceUrl:o,gdbVersion:t,moment:s}=e,l=o===this.featureServiceUrl,n=se(o,t,this.gdbVersion);l&&n&&(this.historicMoment=s)},this.when().then(()=>{this.addHandles([Ie(this._applyEditsHandler),Se(this._updateMomentHandler)])},()=>{})}initialize(){this.when().catch(r=>{pe(r)||me.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:r})})}get datasetName(){return this.dataElement?.name??null}get owner(){return this.dataElement?.userIdentity??null}get schemaGeneration(){return this.dataElement?.schemaGeneration??null}get parsedUrl(){return fe(this.layerUrl)}get featureServiceUrl(){return ee(this.parsedUrl.path).url.path}get networkServiceUrl(){return this.featureServiceUrl.replace(/\/FeatureServer/i,"/UtilityNetworkServer")}get layerId(){return ee(this.parsedUrl.path).sublayer}get networkSystemLayers(){return null}load(r){return u(this,null,function*(){return this.addResolvingPromise(this._fetchDataElement(this.featureServiceUrl,this.layerId.toString(),r)),this.addResolvingPromise(this._fetchLayerMetaData(this.layerUrl,r)),this})}getLayerIdBySourceId(r){if(this.dataElement){let e=this.dataElement.domainNetworks;for(let o of e){for(let t of o.edgeSources??[])if(t.sourceId===r)return t.layerId;for(let t of o.junctionSources??[])if(t.sourceId===r)return t.layerId}return null}return null}queryNamedTraceConfigurations(r,e){return u(this,null,function*(){let[{queryNamedTraceConfigurations:o},{default:t}]=yield Promise.all([import("./chunk-2WRE27WF.js"),import("./chunk-KU6SYYEU.js")]),s=this.networkServiceUrl,l=t.from(r);return(yield o(s,l,b({},e)))?.namedTraceConfigurations})}validateTopology(r,e){return u(this,null,function*(){if(!r.validateArea)throw new J("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");let[{validateNetworkTopology:o},{default:t}]=yield Promise.all([import("./chunk-KWZSMUL5.js"),import("./chunk-BUE3FLQP.js")]),s=t.from(r);W(this.featureServiceUrl,this.gdbVersion||null)&&(s.sessionID=te),s.gdbVersion=this.gdbVersion;let l=this.networkServiceUrl,n=this.featureServiceUrl,d=re(n,null,this.gdbVersion,!0),g=yield o(l,s,b({},e));if(g?.serviceEdits){let f=[];for(let m of g.serviceEdits){let{editedFeatures:c}=m,T=c?.spatialReference?new X(c.spatialReference):null;f.push({layerId:m.layerId,editedFeatures:{adds:c?.adds?.map(w=>this._createEditedFeature(w,T))||[],updates:c?.updates?.map(w=>({original:this._createEditedFeature(w[0],T),current:this._createEditedFeature(w[1],T)}))||[],deletes:c?.deletes?.map(w=>this._createEditedFeature(w,T))||[],spatialReference:T}})}d.resolve({edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],editedFeatures:f,exceededTransferLimit:!1,historicMoment:g.moment})}return g})}submitTopologyValidationJob(r,e){return u(this,null,function*(){if(!r.validateArea)throw new J("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");if(!this.gdbVersion)throw new J("network:undefined-gdb-version","version must be defined");let[{submitValidateNetworkTopologyJob:o},{default:t}]=yield Promise.all([import("./chunk-KWZSMUL5.js"),import("./chunk-BUE3FLQP.js")]),s=t.from(r);W(this.featureServiceUrl,this.gdbVersion||null)&&(s.sessionID=te),s.gdbVersion=this.gdbVersion;let l=this.networkServiceUrl,n=this.featureServiceUrl?re(this.featureServiceUrl,null,this.gdbVersion,!0):void 0,d=yield o(l,s,b({},e));return new Oe({statusUrl:d,editsResolver:n})})}_createEditedFeature(r,e){return new ve({attributes:r.attributes,geometry:be(A(b({},r.geometry),{spatialReference:e}))})}_fetchLayerMetaData(r,e){return u(this,null,function*(){let o=yield S(r,b({responseType:"json",query:{f:"json"}},e));this.sourceJSON=o.data,this.read(o.data,{origin:"service"})})}_fetchDataElement(r,e,o){return u(this,null,function*(){if(this.dataElement)return;let t=yield S(`${r}/queryDataElements`,b({responseType:"json",query:{layers:JSON.stringify([e]),f:"json"}},o)).then(s=>s.data.layerDataElements?.[0]);t&&this.read(t,{origin:"service"})})}};i([a({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:!0}},read:!1}})],p.prototype,"id",void 0),i([a({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:{source:"name"}}},read:!1}})],p.prototype,"title",void 0),i([a({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"url"},write:{target:"url",isRequired:!0}}},read:!1}})],p.prototype,"layerUrl",void 0),i([a({type:Object,json:{origins:{service:{read:!0}},read:!1}})],p.prototype,"dataElement",void 0),i([a({type:ge,json:{origins:{service:{read:{source:"extent"}}},read:!1}})],p.prototype,"fullExtent",void 0),i([a({type:X,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:!1}})],p.prototype,"spatialReference",void 0),i([a({type:["utility","trace"],readOnly:!0,json:{read:!1,write:!1}})],p.prototype,"type",void 0),i([a({readOnly:!0})],p.prototype,"datasetName",null),i([a({readOnly:!0})],p.prototype,"owner",null),i([a({readOnly:!0})],p.prototype,"schemaGeneration",null),i([a({readOnly:!0})],p.prototype,"parsedUrl",null),i([a({readOnly:!0})],p.prototype,"featureServiceUrl",null),i([a({readOnly:!0})],p.prototype,"networkServiceUrl",null),i([a({readOnly:!0})],p.prototype,"layerId",null),i([a()],p.prototype,"sourceJSON",void 0),i([a({readOnly:!0})],p.prototype,"networkSystemLayers",null),i([a()],p.prototype,"gdbVersion",void 0),i([a({type:Date})],p.prototype,"historicMoment",void 0),p=i([h("esri.networks.Network")],p);var Ce=p;var V=class extends ye(B){constructor(r){super(r),this.request=S}initialize(){}load(r){return u(this,null,function*(){let e=this.layer.load(r).then(()=>this._initializeRulesTable());return this.addResolvingPromise(e),this})}getFeatureSQL(r,e){let o=r.layerId.toString(),t=r.fieldsIndex?.normalizeFieldName("assetGroup"),s=r.fieldsIndex?.normalizeFieldName("assetType"),l=t?e.attributes[t]:null,n=s?e.attributes[s]:null,d=this.rulesHash[o];if(d){let g=d.assetGroupHash[l];if(g)return g.assetTypeHash[n]||null}return null}_initializeRulesTable(){return u(this,null,function*(){let r={},e;(function(t){t[t.from=0]="from",t[t.to=1]="to",t[t.via=2]="via"})(e||(e={}));let o=[{networkSourceId:"fromNetworkSource",assetGroupId:"fromAssetGroup",assetTypeId:"fromAssetType"},{networkSourceId:"toNetworkSource",assetGroupId:"toAssetGroup",assetTypeId:"toAssetType"},{networkSourceId:"viaNetworkSource",assetGroupId:"viaAssetGroup",assetTypeId:"viaAssetType"}];for(let t of this.rules){if(t.ruleType!==I.RTJunctionJunctionConnectivity&&t.ruleType!==I.RTJunctionEdgeConnectivity&&t.ruleType!==I.RTEdgeJunctionEdgeConnectivity)continue;let s=[[e.from,e.to],[e.to,e.from]];t.ruleType===I.RTEdgeJunctionEdgeConnectivity&&(s=[[e.from,e.via],[e.via,e.from],[e.to,e.via],[e.via,e.to]]);for(let l of s){let n=l.shift(),d=l.shift(),g=!1;switch(t.ruleType){case I.RTEdgeJunctionEdgeConnectivity:g=n===e.from||n===e.to;break;case I.RTJunctionEdgeConnectivity:g=n===e.to}let f=o[n],m=t[f.networkSourceId]?.layerId.toString()??"",c=t[f.assetGroupId]?.assetGroupCode?.toString(),T=t[f.assetTypeId],w=T?.assetTypeCode?.toString(),F=o[d],N=t[F.networkSourceId]?.layerId.toString()??"",$=t[F.assetGroupId]?.assetGroupCode?.toString(),P=t[F.assetTypeId],D=P?.assetTypeCode?.toString(),E=r[m]??{assetGroupHash:{}};if(!(c&&w&&$&&D))continue;let G=E.assetGroupHash[c]??{assetTypeHash:{}},y=G.assetTypeHash[w]??{};if(y[N]=y[N]??{},g){y[m]=y[m]??{};let R=`(assetgroup = ${c} AND assettype = ${w})`;y[m].anyVertex=y[m].anyVertex?`${y[m].anyVertex}`:`${R}`,P?.connectivityPolicy==="esriNECPEndVertex"&&(y[m].endVertex=y[m]?.endVertex?`${y[m].endVertex}`:`${R}`)}let v=`(assetgroup = ${$} AND assettype = ${D})`;y[N].anyVertex=y[N]?.anyVertex?`${y[N].anyVertex} OR ${v}`:`${v}`,P?.connectivityPolicy==="esriNECPEndVertex"&&(y[N].endVertex=y[N]?.endVertex?`${y[N].endVertex} OR ${v}`:`${v}`),G.assetTypeHash[w]=y,E.assetGroupHash[c]=G,r[m]=E}}this.rulesHash=r})}};i([a({constructOnly:!0})],V.prototype,"layer",void 0),i([a({constructOnly:!0})],V.prototype,"rules",void 0),i([a()],V.prototype,"rulesHash",void 0),i([a({constructOnly:!0})],V.prototype,"request",void 0),V=i([h("esri.networks.RulesTable")],V);var je=V;var U=class extends ce{constructor(r){super(r),this.rulesTableId=null,this.rulesTableUrl=null,this.subnetworksTableId=null,this.subnetworksTableUrl=null,this.dirtyAreasLayerId=null,this.dirtyAreasLayerUrl=null}};i([a({constructOnly:!0})],U.prototype,"rulesTableId",void 0),i([a({constructOnly:!0})],U.prototype,"rulesTableUrl",void 0),i([a({constructOnly:!0})],U.prototype,"subnetworksTableId",void 0),i([a({constructOnly:!0})],U.prototype,"subnetworksTableUrl",void 0),i([a({constructOnly:!0})],U.prototype,"dirtyAreasLayerId",void 0),i([a({constructOnly:!0})],U.prototype,"dirtyAreasLayerUrl",void 0),U=i([h("esri.networks.support.NetworkSystemLayers")],U);var _e=U;var L=class extends z{constructor(r){super(r),this.id=null,this.name=null}};i([a({type:Number,json:{read:{source:"terminalId"},write:{target:"terminalId"}}})],L.prototype,"id",void 0),i([a({type:String,json:{read:{source:"terminalName"},write:{target:"terminalName"}}})],L.prototype,"name",void 0),i([a({type:Boolean,json:{write:!0}})],L.prototype,"isUpstreamTerminal",void 0),L=i([h("esri.networks.support.Terminal")],L);var Ve=L;var Q=new he({esriUNTMBidirectional:"bidirectional",esriUNTMDirectional:"directional"}),j=class extends z{constructor(r){super(r),this.defaultConfiguration=null,this.id=null,this.name=null,this.terminals=[],this.traversabilityModel=null}};i([a({type:String,json:{write:!0}})],j.prototype,"defaultConfiguration",void 0),i([a({type:Number,json:{read:{source:"terminalConfigurationId"},write:{target:"terminalConfigurationId"}}})],j.prototype,"id",void 0),i([a({type:String,json:{read:{source:"terminalConfigurationName"},write:{target:"terminalConfigurationName"}}})],j.prototype,"name",void 0),i([a({type:[Ve],json:{write:!0}})],j.prototype,"terminals",void 0),i([a({type:Q.apiValues,json:{type:Q.jsonValues,read:Q.read,write:Q.write}})],j.prototype,"traversabilityModel",void 0),j=i([h("esri.networks.support.TerminalConfiguration")],j);var ie=j;var Le=Y()({Pending:"job-waiting",InProgress:"job-executing",Completed:"job-succeeded"}),x=class extends Ue{constructor(r){super(r),this.statusUrl=null,this.status=null,this.submissionTime=null,this.lastUpdatedTime=null,this._timer=void 0}destroy(){clearInterval(this._timer)}checkJobStatus(r){return u(this,null,function*(){let e=A(b({},r),{query:{f:"json"}}),{data:o}=yield S(this.statusUrl,e),t=o.traceResults?b(b({},o.traceResults),o):o;return this.read(t),this})}waitForJobCompletion(){return u(this,arguments,function*(r={}){let{interval:e=1e3,statusCallback:o}=r;return new Promise((t,s)=>{this._clearTimer();let l=setInterval(()=>{this._timer||s(H()),this.checkJobStatus().then(n=>{let{status:d}=n;switch(this.status=d,d){case"job-succeeded":this._clearTimer(),t(this);break;case"job-waiting":case"job-executing":o&&o(this)}},n=>{this._clearTimer(),s(n)})},e);this._timer=l})})}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};i([a({type:String,json:{write:!0}})],x.prototype,"statusUrl",void 0),i([K(Le)],x.prototype,"status",void 0),i([a({type:Date,json:{type:Number,write:{writer:(r,e)=>{e.submissionTime=r?r.getTime():null}}}})],x.prototype,"submissionTime",void 0),i([a({type:Date,json:{type:Number,write:{writer:(r,e)=>{e.lastUpdatedTime=r?r.getTime():null}}}})],x.prototype,"lastUpdatedTime",void 0),x=i([h("esri.networks.support.TraceJobInfo")],x);var xe=x;var O=class r extends Ce{constructor(e){super(e),this.sharedNamedTraceConfigurations=[],this.type="utility"}get serviceTerritoryFeatureLayerId(){return this.dataElement?.serviceTerritoryFeatureLayerId??null}get networkSystemLayers(){return new _e({rulesTableId:this.sourceJSON?.systemLayers.rulesTableId,rulesTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.rulesTableId}`:null,subnetworksTableId:this.sourceJSON?.systemLayers.subnetworksTableId,subnetworksTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.subnetworksTableId}`:null,dirtyAreasLayerId:this.sourceJSON?.systemLayers.dirtyAreasLayerId,dirtyAreasLayerUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.dirtyAreasLayerId}`:null})}get terminalConfigurations(){return this.dataElement?.terminalConfigurations.map(e=>ie.fromJSON(e))||[]}get domainNetworkNames(){return this.dataElement?.domainNetworks.map(e=>e.domainNetworkName)||[]}get _utilityLayerList(){let e=new Set;return this.dataElement?.domainNetworks?.map(o=>{o.edgeSources.map(t=>{e.add(t.layerId)}),o.junctionSources.map(t=>{e.add(t.layerId)})}),e}load(e){return u(this,null,function*(){return this.addResolvingPromise(de(r.prototype,this,"load").call(this,e)),this.addResolvingPromise(this._loadNamedTraceConfigurationsFromNetwork(e)),this})}getTerminalConfiguration(e){let o=null,t=null,s=e.layer,l=null;if(s?.type==="feature"){if(l=s.layerId,l===null)return null}else if(s?.type!=="subtype-sublayer"||(l=s?.parent?.layerId??null,l===null))return null;let n=e.attributes;if(n==null)return null;for(let f of Object.keys(n))f.toUpperCase()==="ASSETGROUP"&&(o=e.getAttribute(f)),f.toUpperCase()==="ASSETTYPE"&&(t=e.getAttribute(f));if(!this.dataElement)return null;let d=null,g=this.dataElement.domainNetworks;for(let f of g){let m=f.junctionSources?.find(c=>c.layerId===l);if(m){let c=m.assetGroups?.find(T=>T.assetGroupCode===o);if(c){let T=c.assetTypes?.find(w=>w.assetTypeCode===t);if(T){d=T.terminalConfigurationId;break}}}}if(d!=null){let f=this.dataElement.terminalConfigurations,m=f?.find(c=>c.terminalConfigurationId===d);return m?ie.fromJSON(m):null}return null}getTierNames(e){return this.dataElement?.domainNetworks.find(t=>t.domainNetworkName===e)?.tiers.map(t=>t.name)||[]}getRulesTable(){return u(this,null,function*(){return this._sharedRulesTable||(this._sharedRulesTable=this._createRulesTable()),yield this._sharedRulesTable})}isUtilityLayer(e){return this._utilityLayerList.has(e.layerId)}queryAssociations(e){return u(this,null,function*(){let[{queryAssociations:o},{default:t}]=yield Promise.all([import("./chunk-ANA6RMB7.js"),import("./chunk-B4L5TO2D.js")]),s=t.from(e);return s.gdbVersion=this.gdbVersion,s.moment=this.historicMoment,(yield o(this.networkServiceUrl,s)).associations})}synthesizeAssociationGeometries(e){return u(this,null,function*(){let[{synthesizeAssociationGeometries:o},{default:t}]=yield Promise.all([import("./chunk-7MKPSX3D.js"),import("./chunk-FVLENL6Y.js")]),s=t.from(e);return s.gdbVersion=this.gdbVersion,s.moment=this.historicMoment,o(this.networkServiceUrl,s)})}trace(e){return u(this,null,function*(){let[{trace:o},{default:t}]=yield Promise.all([import("./chunk-RKFQDOGU.js"),import("./chunk-MQVEHBYN.js")]),s=t.from(e);return s.gdbVersion=this.gdbVersion,s.moment=this.historicMoment,o(this.networkServiceUrl,s)})}submitTraceJob(e){return u(this,null,function*(){let[{submitTraceJob:o},{default:t}]=yield Promise.all([import("./chunk-RKFQDOGU.js"),import("./chunk-MQVEHBYN.js")]),s=t.from(e);s.gdbVersion=this.gdbVersion,s.moment=this.historicMoment;let l=yield o(this.networkServiceUrl,s);return new xe({statusUrl:l})})}_loadNamedTraceConfigurationsFromNetwork(e){return u(this,null,function*(){if(this.sharedNamedTraceConfigurations?.length===0)return;let o=this.sharedNamedTraceConfigurations.map(s=>s.globalId),t=yield this.queryNamedTraceConfigurations({globalIds:o},e);for(let s of this.sharedNamedTraceConfigurations){let l=t?.find(n=>n.globalId===s.globalId);if(l){let n=l.write({},{origin:"service"});s.read(n,{origin:"service"})}}})}_createRulesTable(){return u(this,null,function*(){let e=this.networkSystemLayers.rulesTableUrl,o=new Ne({url:e});yield o.load();let t=this.dataElement?.domainNetworks;if(!t)return null;let s=t.flatMap(n=>[...n.edgeSources,...n.junctionSources]),l=(yield this._queryRulesTable(o)).map(n=>this._hydrateRuleInfo(o,s,n));return new je({layer:o,rules:l})})}_queryRulesTable(e){return u(this,null,function*(){let o=new Te({where:"1=1",outFields:["*"]});return(yield oe(e,o)).features})}_hydrateRuleInfo(e,o,t){let s=e.fieldsIndex,l=s.get("RULETYPE"),n=s.get("CREATIONDATE"),d=s.get("FROMNETWORKSOURCEID"),g=s.get("FROMASSETGROUP"),f=s.get("FROMASSETTYPE"),m=s.get("FROMTERMINALID"),c=s.get("TONETWORKSOURCEID"),T=s.get("TOASSETGROUP"),w=s.get("TOASSETTYPE"),F=s.get("TOTERMINALID"),N=s.get("VIANETWORKSOURCEID"),$=s.get("VIAASSETGROUP"),P=s.get("VIAASSETTYPE"),D=s.get("VIATERMINALID"),E=t.attributes[l.name],G=new Date(t.attributes[n.name]),y=[{networkSourceId:t.attributes[d.name],assetGroupId:t.attributes[g.name],assetTypeId:t.attributes[f.name],terminalId:t.attributes[m.name]},{networkSourceId:t.attributes[c.name],assetGroupId:t.attributes[T.name],assetTypeId:t.attributes[w.name],terminalId:t.attributes[F.name]},{networkSourceId:t.attributes[N.name],assetGroupId:t.attributes[$.name],assetTypeId:t.attributes[P.name],terminalId:t.attributes[D.name]}],v;(function(k){k[k.from=0]="from",k[k.to=1]="to",k[k.via=2]="via"})(v||(v={}));let R={ruleType:E,creationDate:G};for(let k of[v.from,v.to,v.via]){if(E!==I.RTEdgeJunctionEdgeConnectivity&&k===v.via)continue;let q=y[k],ae=o.find(M=>M.sourceId===q.networkSourceId),ne=ae?.assetGroups.find(M=>M.assetGroupCode===q.assetGroupId),le=ne?.assetTypes.find(M=>M.assetTypeCode===q.assetTypeId),ue=this._getTerminal(E,le,q);E!==I.RTContainment&&E!==I.RTAttachment||(ue=null);let _="";switch(k){case v.from:_="from";break;case v.to:_="to";break;case v.via:_="via"}R[`${_}NetworkSource`]=ae,R[`${_}AssetGroup`]=ne,R[`${_}AssetType`]=le,R[`${_}Terminal`]=ue?.toJSON()}return R}_getTerminal(e,o,t){if(e===I.RTAttachment||e===I.RTContainment)return null;let s=o?.terminalConfigurationId;return this.terminalConfigurations?.find(n=>n.id===s)?.terminals?.find(n=>n.id===t.terminalId)??null}};i([a({type:[Ee],json:{origins:{"web-map":{read:{source:"traceConfigurations"},write:{target:"traceConfigurations"}},service:{read:{source:"traceConfigurations"}}},read:!1}})],O.prototype,"sharedNamedTraceConfigurations",void 0),i([a({type:["utility"],readOnly:!0,json:{read:!1,write:!1}})],O.prototype,"type",void 0),i([a({readOnly:!0})],O.prototype,"serviceTerritoryFeatureLayerId",null),i([a({readOnly:!0})],O.prototype,"networkSystemLayers",null),i([a({readOnly:!0})],O.prototype,"terminalConfigurations",null),i([a({readOnly:!0})],O.prototype,"domainNetworkNames",null),O=i([h("esri.networks.UtilityNetwork")],O);var Wr=O;export{Wr as a};
