import{a as x,b as w}from"./chunk-AQ74ANSJ.js";import{a as b}from"./chunk-SREKDU6P.js";import{b as g}from"./chunk-EJ3VIBAJ.js";import{m as I}from"./chunk-NBRBW7H5.js";var D=2.4;function k(t){return w(t*D)}function q(t){return x(t)/D}function v(t,r,a,e){let{color:s,ratio:o}=r,{color:u,ratio:n}=a;n===o&&(n===1?o-=1e-6:n+=1e-6);let i=g((e-o)/(n-o),0,1);I(t,s.toArray(),u.toArray(),i)}function L(t){let a=new Uint8ClampedArray(2048);if(t=t.filter(({ratio:n})=>n>=0&&n<=1).sort((n,i)=>n.ratio-i.ratio).map(({color:n,ratio:i})=>({color:n,ratio:Math.max(i,.001)})),t.length<1)return a;let e=t[0],s=t[0],o=1,u=b();for(let n=0;n<512;n++){let i=(n+.5)/512;for(;i>s.ratio&&o<t.length;)e=s,s=t[o++];v(u,e,s,i),a.set(u,4*n)}return a}function S(t,r,a,e){let{radius:s,fieldOffset:o,field:u}=r,n=Math.round(x(s)),i=new Float64Array(a*e),f,l=Number.NEGATIVE_INFINITY,p=V(u,o),A=new Set;for(let R of t){let m=R.getCursor();for(;m.next();){let M=m.getObjectId();if(A.has(M))continue;A.add(M);let c=m.readLegacyPointGeometry(),d=128;if(c.x<-d||c.x>=a+d||c.y<-d||c.y>e+d)continue;let F=+p(m),P=Math.max(0,Math.round(c.x)-n),U=Math.max(0,Math.round(c.y)-n),C=Math.min(e,Math.round(c.y)+n),G=Math.min(a,Math.round(c.x)+n);for(let y=U;y<C;y++)for(let h=P;h<G;h++){let N=y*a+h,T=K(c.x-h,c.y-y,n);f=i[N]+=T*F,f>l&&(l=f)}}}return{matrix:i.buffer,max:l}}function Y(t,r,a,e,s,o){t.canvas.width=t.canvas.height=r,t.clearRect(0,0,r,r);let u=t.getImageData(0,0,r,r);a&&e&&u.data.set(new Uint8ClampedArray(H(r,a,e,s,o))),t.putImageData(u,0,0)}function H(t,r,a,e,s){let o=new Uint32Array(t*t),u="buffer"in r?r:new Float64Array(r),n="buffer"in a?new Uint32Array(a.buffer):new Uint32Array(new Uint8Array(a).buffer),i=n.length/(s-e);for(let f=0;f<u.length;f++){let l=u[f],p=Math.floor((l-e)*i);o[f]=n[g(p,0,n.length-1)]}return o.buffer}function K(t,r,a){let e=Math.sqrt(t**2+r**2)/a;return e>1?0:3/(Math.PI*a**2)*(1-e**2)**2}function _(t,r){return typeof t=="function"?t:t?typeof r=="string"?a=>-1*+a[t]:a=>+a[t]+r:()=>1}function V(t,r){return t!=null?typeof r=="string"?a=>-1*+a.readAttribute(t):a=>+a.readAttribute(t)+r:a=>1}export{D as a,k as b,q as c,L as d,S as e,Y as f,K as g,_ as h};
