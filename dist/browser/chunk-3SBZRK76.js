import{a as J}from"./chunk-VQYBEDDM.js";import{a as Se}from"./chunk-ODTKH54W.js";import{a as Ae}from"./chunk-ZJOOUTMZ.js";import{a as re,b as le,c as X,d as K,e as Ne,f as Z,g as v,h as xe,i as Le,j as ve,k as $e,m as Pe,n as q,o as Re,p as Me,s as Ue,t as oe}from"./chunk-OXDEURMC.js";import{o as se,t as Ce}from"./chunk-HWOPIVMN.js";import"./chunk-UTYBZIWT.js";import{a as be}from"./chunk-SB4X3KWN.js";import"./chunk-QNDNFXN2.js";import{c as P}from"./chunk-RUOXPMWE.js";import{$ as L,Ba as Ee,Ma as ie,P as _,Q as Ie,S as x,U as $,Z as S,_ as B,b as m,c as p,ca as U,da as ae,ea as Q,fa as De,ga as A,m as Fe,ma as E,pa as O,qa as Te,r as V,ra as z}from"./chunk-WMY3KSI4.js";import"./chunk-H7RZ7XQC.js";import"./chunk-V3FR6PF5.js";import"./chunk-URSNN2E3.js";import"./chunk-BIAW42RV.js";import"./chunk-4573E3RZ.js";import"./chunk-BSQ5TFLX.js";import"./chunk-DDZ3KR2Q.js";import"./chunk-JHWJLQOC.js";import"./chunk-DTWRSK4M.js";import"./chunk-HURWQVHY.js";import"./chunk-M3GEY4SR.js";import"./chunk-7QY3BMVN.js";import"./chunk-4HXOVZYF.js";import"./chunk-U2QVIRVP.js";import{a as Y}from"./chunk-QCHQODPK.js";import"./chunk-KYW34JK7.js";import"./chunk-4R7MTAA6.js";import"./chunk-YH5YGPKQ.js";import"./chunk-OJTJKYFK.js";import"./chunk-WSUW6W66.js";import"./chunk-WF5LZUVW.js";import"./chunk-E4G7B7K5.js";import"./chunk-RZU6EEB3.js";import"./chunk-WHNNLNN4.js";import"./chunk-2YMAK36I.js";import"./chunk-ZVPHD6FG.js";import"./chunk-BHUF7DXK.js";import"./chunk-VYBYHQTJ.js";import"./chunk-YKLD6O7Z.js";import"./chunk-2SRHEZDP.js";import"./chunk-4YLYZGNM.js";import"./chunk-PHG7WLHF.js";import"./chunk-3AY2ZIM4.js";import"./chunk-XFFNQH2H.js";import"./chunk-VL6L3PH6.js";import"./chunk-EGQHBYFL.js";import"./chunk-MXNDRZNB.js";import"./chunk-XWKYTQFT.js";import"./chunk-RAIGRXV3.js";import"./chunk-UULYHJV4.js";import"./chunk-WDTJILD4.js";import"./chunk-6J7DCVWC.js";import"./chunk-CIQJCIGH.js";import"./chunk-RI77TKRA.js";import"./chunk-UW2TVJUN.js";import"./chunk-LGUXUFJ7.js";import"./chunk-Z7MKEISX.js";import"./chunk-5L5TH44W.js";import"./chunk-URPONBMS.js";import"./chunk-QB3NROF7.js";import"./chunk-5WCYRI4X.js";import"./chunk-DR5NPQZL.js";import"./chunk-5P24QCNC.js";import"./chunk-6UF7N5AK.js";import"./chunk-6UQ2Y4IC.js";import"./chunk-KZREEH45.js";import"./chunk-N3XRI3RU.js";import"./chunk-BGARZEEH.js";import"./chunk-B3I4XIHJ.js";import"./chunk-6EFGHIXX.js";import"./chunk-DZ3DW7ED.js";import"./chunk-3XRT3SNQ.js";import"./chunk-YEFTRNE3.js";import"./chunk-5OGCWDP4.js";import"./chunk-JBJTQF7V.js";import"./chunk-5JBKPHFU.js";import"./chunk-6JYX4V7N.js";import"./chunk-7EQBH2NW.js";import"./chunk-CN5O6E6T.js";import"./chunk-4KJ462UD.js";import"./chunk-HSB35X5B.js";import"./chunk-7BGNDY2B.js";import"./chunk-FBHJEXCM.js";import"./chunk-IFUI4HFB.js";import"./chunk-JOOJSGLF.js";import"./chunk-MYELF7MV.js";import"./chunk-MS3ZOARX.js";import"./chunk-KCKP7FIY.js";import"./chunk-BQABCLW6.js";import"./chunk-HTB4QCFJ.js";import"./chunk-7K4WIBFN.js";import"./chunk-45GFWXQC.js";import"./chunk-AUVYUYNK.js";import"./chunk-C7M5MSEL.js";import"./chunk-HPJ6EQFO.js";import"./chunk-5MJXKSZ4.js";import"./chunk-TJ3KO5EG.js";import"./chunk-FC6HKZZX.js";import"./chunk-LGGJOMLJ.js";import"./chunk-VVAIF23J.js";import"./chunk-6N5DPLFH.js";import"./chunk-HI2T2YSZ.js";import"./chunk-O5K35OSE.js";import"./chunk-D6LLE2YP.js";import"./chunk-I3S324BU.js";import{c as W}from"./chunk-O5IGEGOS.js";import"./chunk-2UDQ3IWX.js";import"./chunk-MXH75ZNY.js";import"./chunk-PQKTT6AH.js";import"./chunk-OM24DGCK.js";import"./chunk-YQRTHGFD.js";import"./chunk-EDSVJRYE.js";import"./chunk-QAVDKCSH.js";import"./chunk-H2AOS66Z.js";import"./chunk-YH4Z47PR.js";import"./chunk-CJJRHJ2S.js";import"./chunk-ZYPPRX53.js";import"./chunk-574KRDZU.js";import"./chunk-2APWMENK.js";import"./chunk-ZWFVPWKA.js";import"./chunk-JOYABHZZ.js";import"./chunk-IEXZWAIE.js";import"./chunk-VDN3XKL2.js";import"./chunk-SVEGZVCP.js";import"./chunk-AQ74ANSJ.js";import"./chunk-SAOUSUZE.js";import"./chunk-6MGDEI2H.js";import"./chunk-QSGARGRB.js";import"./chunk-SREKDU6P.js";import"./chunk-IXIJFOEL.js";import"./chunk-QZ4L25WE.js";import"./chunk-4ATIL3QV.js";import"./chunk-WUM4JBII.js";import"./chunk-URUYU25U.js";import"./chunk-3S2DT2SI.js";import"./chunk-7PPV2CP7.js";import"./chunk-U62SHMHB.js";import"./chunk-55ESOXMJ.js";import"./chunk-BCREO4Q5.js";import"./chunk-EJ3VIBAJ.js";import"./chunk-4LHUJTP5.js";import"./chunk-NBRBW7H5.js";import"./chunk-V2KSICSA.js";import"./chunk-CBOFHDSC.js";import"./chunk-HB7BVTLV.js";import"./chunk-WZKL6OPG.js";import"./chunk-WF37UVOV.js";import"./chunk-UZQ577CU.js";import"./chunk-FC3MPJI4.js";import"./chunk-5ETRXDS4.js";import"./chunk-QDNKD3H5.js";import"./chunk-F72O5PVM.js";import{c as fe}from"./chunk-B4PK7RBX.js";import"./chunk-6J4Y65BV.js";import"./chunk-RXHILZH7.js";import{f as D}from"./chunk-REI3KXR7.js";import{a as ge}from"./chunk-URPCXPAW.js";import"./chunk-KBFIYTBH.js";import"./chunk-PEPXQ7N3.js";import"./chunk-VU5W7W6Y.js";import"./chunk-6QIKBCPR.js";import"./chunk-AHKJJNRE.js";import"./chunk-HBTOKQC5.js";import"./chunk-A52LT7YB.js";import"./chunk-CZPMRK53.js";import"./chunk-IDSF2RZ6.js";import"./chunk-2BBIRZVO.js";import"./chunk-WQAXQD4X.js";import"./chunk-IUPUERVS.js";import"./chunk-XF4NUYV7.js";import"./chunk-FNDPIYNC.js";import"./chunk-WMYPRHRR.js";import"./chunk-IAMDMFZ7.js";import"./chunk-53MWZ23O.js";import{w as he}from"./chunk-PT7S6WNL.js";import"./chunk-XDTDVCGP.js";import"./chunk-JPDAKIWT.js";import"./chunk-465DRXTW.js";import"./chunk-AC62Z3FX.js";import{g as N}from"./chunk-ESDYQQXO.js";function We(s,n,r,d){if(d.length===1){if(S(d[0]))return J(s,d[0],-1);if(U(d[0]))return J(s,d[0].toArray(),-1)}return J(s,d,-1)}function ue(s,n,r){return N(this,null,function*(){let d=s.getVariables();if(d.length>0){let g=[];for(let t=0;t<d.length;t++){let i={name:d[t]};g.push(yield n.evaluateIdentifier(r,i))}let e={};for(let t=0;t<d.length;t++)e[d[t]]=g[t];return s.parameters=e,s}return s})}function c(s,n,r=null){for(let d in s)if(d.toLowerCase()===n.toLowerCase())return s[d];return r}function Ze(s){if(s===null)return null;let n={type:c(s,"type",""),name:c(s,"name","")};if(n.type==="range")n.range=c(s,"range",[]);else{n.codedValues=[];for(let r of c(s,"codedValues",[]))n.codedValues.push({name:c(r,"name",""),code:c(r,"code",null)})}return n}function ce(s){if(s===null)return null;let n={},r=c(s,"wkt",null);r!==null&&(n.wkt=r);let d=c(s,"wkid",null);return d!==null&&(n.wkid=d),n}function ke(s){if(s===null)return null;let n={hasZ:c(s,"hasz",!1),hasM:c(s,"hasm",!1)},r=c(s,"spatialreference",null);r&&(n.spatialReference=ce(r));let d=c(s,"x",null);if(d!==null)return n.x=d,n.y=c(s,"y",null),n;let g=c(s,"rings",null);if(g!==null)return n.rings=g,n;let e=c(s,"paths",null);if(e!==null)return n.paths=e,n;let t=c(s,"points",null);if(t!==null)return n.points=t,n;for(let i of["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"]){let u=c(s,i,null);u!==null&&(n[i]=u)}return n}function je(s,n){for(let r of n)if(r===s)return!0;return!1}function He(s){return!!s.layerDefinition&&!!s.featureSet&&je(s.layerDefinition.geometryType,["",null,"esriGeometryNull","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])!==!1&&S(s.layerDefinition.fields)!==!1&&S(s.featureSet.features)!==!1}function j(s){return s?.toLowerCase()==="utc"?"UTC":s?.toLowerCase()==="unknown"?"Unknown":s}function wn(s){s.mode==="async"&&(s.functions.timezone=function(n,r){return s.standardFunctionAsync(n,r,(d,g,e)=>N(this,null,function*(){if(A(e,1,2,n,r),De(e[0])||Q(e[0]))return"Unknown";if(L(e[0])){if(yield e[0].load(),e.length===1||e[1]===null)return e[0].datesInUnknownTimezone?j("unknown"):j(e[0].dateFieldsTimeZone);if(!(e[1]instanceof P)||e[1].hasField("type")===!1)throw new p(n,m.InvalidParameter,r);let u=e[1].field("type");if($(u)===!1)throw new p(n,m.InvalidParameter,r);switch(E(u).toLowerCase()){case"preferredtimezone":return j(e[0].preferredTimeZone);case"editfieldsinfo":return j(e[0].editFieldsInfo?.timeZone??null);case"timeinfo":return j(e[0].timeInfo?.timeZone??null);case"field":if(e[1].hasField("fieldname")&&$(e[1].field("fieldname")))return j(e[0].fieldTimeZone(E(e[1].field("fieldname"))))}throw new p(n,m.InvalidParameter,r)}let t=Te(e[0],ie(n));if(t===null)return null;let i=t.timeZone;return i==="system"?ge.systemTimeZoneCanonicalName:i.toLowerCase()==="utc"?"UTC":i.toLowerCase()==="unknown"?"Unknown":i}))},s.functions.sqltimestamp=function(n,r){return s.standardFunctionAsync(n,r,(d,g,e)=>N(this,null,function*(){A(e,1,3,n,r);let t=e[0];if(ae(t)){if(e.length===1)return t.toSQLWithKeyword();if(e.length===2)return t.changeTimeZone(E(e[1])).toSQLWithKeyword();throw new p(n,m.InvalidParameter,r)}if(Q(t))return t.toSQLWithKeyword();if(L(t)){if(e.length!==3)throw new p(n,m.InvalidParameter,r);yield t.load();let i=E(e[1]);if(Q(e[2]))return e[2].toSQLWithKeyword();if(ae(e[2])===!1)throw new p(n,m.InvalidParameter,r);let u=t.fieldTimeZone(i);return u===null?e[2].toSQLWithKeyword():e[2].changeTimeZone(u).toSQLWithKeyword()}throw new p(n,m.InvalidParameter,r)}))},s.signatures.push({name:"sqltimestamp",min:2,max:4}),s.functions.featuresetbyid=function(n,r){return s.standardFunctionAsync(n,r,(d,g,e)=>{if(A(e,2,4,n,r),e[0]instanceof re){let t=E(e[1]),i=x(e[2],null),u=z(x(e[3],!0));if(i===null&&(i=["*"]),S(i)===!1)throw new p(n,m.InvalidParameter,r);return e[0].featureSetById(t,u,i)}throw new p(n,m.InvalidParameter,r)})},s.signatures.push({name:"featuresetbyid",min:2,max:4}),s.functions.getfeatureset=function(n,r){return s.standardFunctionAsync(n,r,(d,g,e)=>{if(A(e,1,2,n,r),B(e[0])){let t=x(e[1],"datasource");return t===null&&(t="datasource"),t=E(t).toLowerCase(),Ue(e[0].fullSchema(),t,n.lrucache,n.interceptor,n.spatialReference)}throw new p(n,m.InvalidParameter,r)})},s.signatures.push({name:"getfeatureset",min:1,max:2}),s.functions.featuresetbyportalitem=function(n,r){return s.standardFunctionAsync(n,r,(d,g,e)=>{if(A(e,2,5,n,r),e[0]===null)throw new p(n,m.PortalRequired,r);if(e[0]instanceof Ae){let o=E(e[1]),a=E(e[2]),l=x(e[3],null),f=z(x(e[4],!0));if(l===null&&(l=["*"]),S(l)===!1)throw new p(n,m.InvalidParameter,r);let F=null;return F=n.services?.portal?n.services.portal:fe.getDefault(),F=Se(e[0],F),oe(o,a,n.spatialReference,l,f,F,n.lrucache,n.interceptor)}if($(e[0])===!1)throw new p(n,m.PortalRequired,r);let t=E(e[0]),i=E(e[1]),u=x(e[2],null),y=z(x(e[3],!0));if(u===null&&(u=["*"]),S(u)===!1)throw new p(n,m.InvalidParameter,r);return oe(t,i,n.spatialReference,u,y,n.services?.portal??fe.getDefault(),n.lrucache,n.interceptor)})},s.signatures.push({name:"featuresetbyportalitem",min:2,max:5}),s.functions.featuresetbyname=function(n,r){return s.standardFunctionAsync(n,r,(d,g,e)=>{if(A(e,2,4,n,r),e[0]instanceof re){let t=E(e[1]),i=x(e[2],null),u=z(x(e[3],!0));if(i===null&&(i=["*"]),S(i)===!1)throw new p(n,m.InvalidParameter,r);return e[0].featureSetByName(t,u,i)}throw new p(n,m.InvalidParameter,r)})},s.signatures.push({name:"featuresetbyname",min:2,max:4}),s.functions.featureset=function(n,r){return s.standardFunction(n,r,(d,g,e)=>{A(e,1,1,n,r);let t=e[0],i={layerDefinition:{geometryType:"",objectIdField:"",hasM:!1,hasZ:!1,globalIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if($(t))t=JSON.parse(t),t.layerDefinition!==void 0?(i.layerDefinition=t.layerDefinition,i.featureSet=t.featureSet,t.layerDefinition.spatialReference&&(i.layerDefinition.spatialReference=t.layerDefinition.spatialReference)):(i.featureSet.features=t.features,i.featureSet.geometryType=t.geometryType,i.layerDefinition.geometryType=i.featureSet.geometryType,i.layerDefinition.objectIdField=t.objectIdFieldName??"",i.layerDefinition.typeIdField=t.typeIdFieldName,i.layerDefinition.globalIdField=t.globalIdFieldName,i.layerDefinition.fields=t.fields,t.spatialReference&&(i.layerDefinition.spatialReference=t.spatialReference));else{if(!(e[0]instanceof P))throw new p(n,m.InvalidParameter,r);{t=JSON.parse(e[0].castToText(!0));let u=c(t,"layerdefinition");if(u!==null){i.layerDefinition.geometryType=c(u,"geometrytype",""),i.featureSet.geometryType=i.layerDefinition.geometryType,i.layerDefinition.globalIdField=c(u,"globalidfield",""),i.layerDefinition.objectIdField=c(u,"objectidfield",""),i.layerDefinition.typeIdField=c(u,"typeidfield",""),i.layerDefinition.hasZ=c(u,"hasz",!1)===!0,i.layerDefinition.hasM=c(u,"hasm",!1)===!0;let y=c(u,"spatialreference",null);y&&(i.layerDefinition.spatialReference=ce(y));for(let a of c(u,"fields",[])){let l={name:c(a,"name",""),alias:c(a,"alias",""),type:c(a,"type",""),nullable:c(a,"nullable",!0),editable:c(a,"editable",!0),length:c(a,"length",null),domain:Ze(c(a,"domain"))};i.layerDefinition.fields.push(l)}let o=c(t,"featureset",null);if(o){let a={};for(let l of i.layerDefinition.fields)a[l.name.toLowerCase()]=l.name;for(let l of c(o,"features",[])){let f={},F=c(l,"attributes",{});for(let T in F)f[a[T.toLowerCase()]]=F[T];i.featureSet.features.push({attributes:f,geometry:ke(c(l,"geometry",null))})}}}else{i.layerDefinition.hasZ=c(t,"hasz",!1)===!0,i.layerDefinition.hasM=c(t,"hasm",!1)===!0,i.layerDefinition.geometryType=c(t,"geometrytype",""),i.featureSet.geometryType=i.layerDefinition.geometryType,i.layerDefinition.objectIdField=c(t,"objectidfieldname",""),i.layerDefinition.typeIdField=c(t,"typeidfieldname","");let y=c(t,"spatialreference",null);y&&(i.layerDefinition.spatialReference=ce(y));let o=c(t,"fields",null);if(S(o))for(let f of o){let F={name:c(f,"name",""),alias:c(f,"alias",""),type:c(f,"type",""),nullable:c(f,"nullable",!0),editable:c(f,"editable",!0),length:c(f,"length",null),domain:Ze(c(f,"domain"))};i.layerDefinition.fields.push(F)}else o=null,i.layerDefinition.fields=o;let a={};for(let f of i.layerDefinition.fields)a[f.name.toLowerCase()]=f.name;let l=c(t,"features",null);if(S(l))for(let f of l){let F={},T=c(f,"attributes",{});for(let I in T)F[a[I.toLowerCase()]]=T[I];i.featureSet.features.push({attributes:F,geometry:ke(c(f,"geometry",null))})}else l=null,i.featureSet.features=l}}}if(He(i)===!1)throw new p(n,m.InvalidParameter,r);return i.layerDefinition.geometryType||(i.layerDefinition.geometryType="esriGeometryNull"),$e.create(i,n.spatialReference)})},s.signatures.push({name:"featureset",min:1,max:1}),s.functions.filter=function(n,r){return s.standardFunctionAsync(n,r,(d,g,e)=>N(this,null,function*(){if(A(e,2,2,n,r),S(e[0])||U(e[0])){let t=[],i=e[0];i instanceof Fe&&(i=i.toArray());let u=null;if(!Ie(e[1]))throw new p(n,m.InvalidParameter,r);u=e[1].createFunction(n);for(let y of i){let o=u(y);he(o)?(yield o)===!0&&t.push(y):o===!0&&t.push(y)}return t}if(L(e[0])){let t=yield e[0].load(),i=D.create(e[1],t.getFieldsIndex(),t.dateFieldsTimeZoneDefaultUTC),u=i.getVariables();if(u.length>0){let y=[];for(let a=0;a<u.length;a++){let l={name:u[a]};y.push(yield s.evaluateIdentifier(n,l))}let o={};for(let a=0;a<u.length;a++)o[u[a]]=y[a];return i.parameters=o,new le({parentfeatureset:e[0],whereclause:i})}return new le({parentfeatureset:e[0],whereclause:i})}throw new p(n,m.InvalidParameter,r)}))},s.signatures.push({name:"filter",min:2,max:2}),s.functions.orderby=function(n,r){return s.standardFunctionAsync(n,r,(d,g,e)=>N(this,null,function*(){if(A(e,2,2,n,r),L(e[0])){let t=new xe(e[1]);return new Le({parentfeatureset:e[0],orderbyclause:t})}throw new p(n,m.InvalidParameter,r)}))},s.signatures.push({name:"orderby",min:2,max:2}),s.functions.top=function(n,r){return s.standardFunctionAsync(n,r,(d,g,e)=>N(this,null,function*(){if(A(e,2,2,n,r),L(e[0]))return new ve({parentfeatureset:e[0],topnum:e[1]});if(S(e[0]))return O(e[1])>=e[0].length?e[0].slice(0):e[0].slice(0,O(e[1]));if(U(e[0]))return O(e[1])>=e[0].length()?e[0].slice(0):e[0].slice(0,O(e[1]));throw new p(n,m.InvalidParameter,r)}))},s.signatures.push({name:"top",min:2,max:2}),s.functions.first=function(n,r){return s.standardFunctionAsync(n,r,(d,g,e)=>N(this,null,function*(){if(A(e,1,1,n,r),L(e[0])){let t=yield e[0].first(d.abortSignal);if(t!==null){let i=be.createFromGraphicLikeObject(t.geometry,t.attributes,e[0],n.timeZone);return i._underlyingGraphic=t,i}return t}return S(e[0])?e[0].length===0?null:e[0][0]:U(e[0])?e[0].length()===0?null:e[0].get(0):null}))},s.signatures.push({name:"first",min:1,max:1}),s.functions.attachments=function(n,r){return s.standardFunctionAsync(n,r,(d,g,e)=>N(this,null,function*(){A(e,1,2,n,r);let t={minsize:-1,maxsize:-1,types:null,returnMetadata:!1};if(e.length>1){if(e[1]instanceof P){if(e[1].hasField("minsize")&&(t.minsize=O(e[1].field("minsize"))),e[1].hasField("metadata")&&(t.returnMetadata=z(e[1].field("metadata"))),e[1].hasField("maxsize")&&(t.maxsize=O(e[1].field("maxsize"))),e[1].hasField("types")){let i=Ee(e[1].field("types"),!1);i.length>0&&(t.types=i)}}else if(e[1]!==null)throw new p(n,m.InvalidParameter,r)}if(B(e[0])){let i=e[0]._layer;return i instanceof Y&&(i=q(i,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),i===null?[]:L(i)===!1?[]:(yield i.load(),i.queryAttachments(e[0].field(i.objectIdField),t.minsize,t.maxsize,t.types,t.returnMetadata))}if(e[0]===null)return[];throw new p(n,m.InvalidParameter,r)}))},s.signatures.push({name:"attachments",min:1,max:2}),s.functions.featuresetbyrelationshipname=function(n,r){return s.standardFunctionAsync(n,r,(d,g,e)=>N(this,null,function*(){A(e,2,4,n,r);let t=e[0],i=E(e[1]),u=x(e[2],null),y=z(x(e[3],!0));if(u===null&&(u=["*"]),S(u)===!1)throw new p(n,m.InvalidParameter,r);if(e[0]===null)return null;if(!B(e[0]))throw new p(n,m.InvalidParameter,r);let o=t._layer;if(o instanceof Y&&(o=q(o,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),o===null||L(o)===!1)return null;o=yield o.load();let a=o.relationshipMetaData().filter(I=>I.name===i);if(a.length===0)return null;if(a[0].relationshipTableId!==void 0&&a[0].relationshipTableId!==null&&a[0].relationshipTableId>-1)return Me(o,a[0],t.field(o.objectIdField),o.spatialReference,u,y,n.lrucache,n.interceptor);let l=o.serviceUrl();if(!l)return null;l=l.charAt(l.length-1)==="/"?l+a[0].relatedTableId.toString():l+"/"+a[0].relatedTableId.toString();let f=yield Pe(l,o.spatialReference,u,y,n.lrucache,n.interceptor);yield f.load();let F=f.relationshipMetaData();if(F=F.filter(I=>I.id===a[0].id),t.hasField(a[0].keyField)===!1||t.field(a[0].keyField)===null){let I=yield o.getFeatureByObjectId(t.field(o.objectIdField),[a[0].keyField]);if(I){let b=D.create(F[0].keyField+"= @id",f.getFieldsIndex(),f.dateFieldsTimeZoneDefaultUTC);return b.parameters={id:I.attributes[a[0].keyField]},f.filter(b)}return new Ce({parentfeatureset:f})}let T=D.create(F[0].keyField+"= @id",f.getFieldsIndex(),f.dateFieldsTimeZoneDefaultUTC);return T.parameters={id:t.field(a[0].keyField)},f.filter(T)}))},s.signatures.push({name:"featuresetbyrelationshipname",min:2,max:4}),s.functions.featuresetbyassociation=function(n,r){return s.standardFunctionAsync(n,r,(d,g,e)=>N(this,null,function*(){A(e,2,3,n,r);let t=e[0],i=E(x(e[1],"")).toLowerCase(),u=$(e[2])?E(e[2]):null;if(e[0]===null)return null;if(!B(e[0]))throw new p(n,m.InvalidParameter,r);let y=t._layer;if(y instanceof Y&&(y=q(y,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),y===null||L(y)===!1)return null;yield y.load();let o=y.serviceUrl(),a=yield Re(o,n.spatialReference),l=null,f=null,F=!1;if(u!==null&&u!==""&&u!==void 0){for(let h of a.terminals)h.terminalName===u&&(f=h.terminalId);f===null&&(F=!0)}let T=a.associations.getFieldsIndex(),I=T.get("TOGLOBALID").name,b=T.get("FROMGLOBALID").name,ee=T.get("TOTERMINALID").name,ne=T.get("FROMTERMINALID").name,H=T.get("FROMNETWORKSOURCEID").name,G=T.get("TONETWORKSOURCEID").name,k=T.get("ASSOCIATIONTYPE").name,Oe=T.get("ISCONTENTVISIBLE").name,ze=T.get("OBJECTID").name;for(let h of y.fields)if(h.type==="global-id"){l=t.field(h.name);break}let R=null,de=new Z(new W({name:"percentalong",alias:"percentalong",type:"double"}),D.create("0",a.associations.getFieldsIndex(),a.associations.dateFieldsTimeZoneDefaultUTC)),me=new Z(new W({name:"side",alias:"side",type:"string"}),D.create("''",a.associations.getFieldsIndex(),a.associations.dateFieldsTimeZoneDefaultUTC)),C="globalid",pe="globalId",ye={};for(let h in a.lkp)ye[h]=a.lkp[h].sourceId;let M=new Ne(new W({name:"classname",alias:"classname",type:"string"}),null,ye),w="";switch(i){case"midspan":{w=`((${I}='${l}') OR ( ${b}='${l}')) AND (${k} IN (5))`,M.codefield=D.create(`CASE WHEN (${I}='${l}') THEN ${H} ELSE ${G} END`,a.associations.getFieldsIndex(),a.associations.dateFieldsTimeZoneDefaultUTC);let h=V(v.findField(a.associations.fields,b));h.name=C,h.alias=C,R=new Z(h,D.create(`CASE WHEN (${b}='${l}') THEN ${I} ELSE ${b} END`,a.associations.getFieldsIndex(),a.associations.dateFieldsTimeZoneDefaultUTC)),de=a.unVersion>=4?new X(v.findField(a.associations.fields,T.get("PERCENTALONG").name)):new Z(new W({name:"percentalong",alias:"percentalong",type:"double"}),D.create("0",a.associations.getFieldsIndex(),a.associations.dateFieldsTimeZoneDefaultUTC));break}case"junctionedge":{w=`((${I}='${l}') OR ( ${b}='${l}')) AND (${k} IN (4,6))`,M.codefield=D.create(`CASE WHEN (${I}='${l}') THEN ${H} ELSE ${G} END`,a.associations.getFieldsIndex(),a.associations.dateFieldsTimeZoneDefaultUTC);let h=V(v.findField(a.associations.fields,b));h.name=C,h.alias=C,R=new Z(h,D.create(`CASE WHEN (${b}='${l}') THEN ${I} ELSE ${b} END`,a.associations.getFieldsIndex(),a.associations.dateFieldsTimeZoneDefaultUTC)),me=new Z(new W({name:"side",alias:"side",type:"string"}),D.create(`CASE WHEN (${k}=4) THEN 'from' ELSE 'to' END`,a.associations.getFieldsIndex(),a.associations.dateFieldsTimeZoneDefaultUTC));break}case"connected":{let h=`${I}='@T'`,we=`${b}='@T'`;f!==null&&(h+=` AND ${ee}=@A`,we+=` AND ${ne}=@A`),w="(("+h+") OR ("+we+"))",w=_(w,"@T",l??""),h=_(h,"@T",l??""),f!==null&&(h=_(h,"@A",f.toString()),w=_(w,"@A",f.toString())),M.codefield=D.create("CASE WHEN "+h+` THEN ${H} ELSE ${G} END`,a.associations.getFieldsIndex(),a.associations.dateFieldsTimeZoneDefaultUTC);let te=V(v.findField(a.associations.fields,b));te.name=C,te.alias=C,R=new Z(te,D.create("CASE WHEN "+h+` THEN ${b} ELSE ${I} END`,a.associations.getFieldsIndex(),a.associations.dateFieldsTimeZoneDefaultUTC));break}case"container":w=`${I}='${l}' AND ${k} = 2`,f!==null&&(w+=` AND ${ee} = `+f.toString()),M.codefield=H,w="( "+w+" )",R=new K(v.findField(a.associations.fields,b),C,C);break;case"content":w=`(${b}='${l}' AND ${k} = 2)`,f!==null&&(w+=` AND ${ne} = `+f.toString()),M.codefield=G,w="( "+w+" )",R=new K(v.findField(a.associations.fields,I),C,C);break;case"structure":w=`(${I}='${l}' AND ${k} = 3)`,f!==null&&(w+=` AND ${ee} = `+f.toString()),M.codefield=H,w="( "+w+" )",R=new K(v.findField(a.associations.fields,b),C,pe);break;case"attached":w=`(${b}='${l}' AND ${k} = 3)`,f!==null&&(w+=` AND ${ne} = `+f.toString()),M.codefield=G,w="( "+w+" )",R=new K(v.findField(a.associations.fields,I),C,pe);break;default:throw new p(n,m.InvalidParameter,r)}return F&&(w="1 <> 1"),new v({parentfeatureset:a.associations,adaptedFields:[new X(v.findField(a.associations.fields,ze)),new X(v.findField(a.associations.fields,Oe)),R,me,M,de],extraFilter:w?D.create(w,a.associations.getFieldsIndex(),a.associations.dateFieldsTimeZoneDefaultUTC):null})}))},s.signatures.push({name:"featuresetbyassociation",min:2,max:6}),s.functions.groupby=function(n,r){return s.standardFunctionAsync(n,r,(d,g,e)=>N(this,null,function*(){if(A(e,3,3,n,r),!L(e[0]))throw new p(n,m.InvalidParameter,r);let t=yield e[0].load(),i=[],u=[],y=!1,o=[];if($(e[1]))o.push(e[1]);else if(e[1]instanceof P)o.push(e[1]);else if(S(e[1]))o=e[1];else{if(!U(e[1]))throw new p(n,m.InvalidParameter,r);o=e[1].toArray()}for(let a of o)if($(a)){let l=D.create(E(a),t.getFieldsIndex(),t.dateFieldsTimeZoneDefaultUTC),f=se(l)===!0?E(a):"%%%%FIELDNAME";i.push({name:f,expression:l}),f==="%%%%FIELDNAME"&&(y=!0)}else{if(!(a instanceof P))throw new p(n,m.InvalidParameter,r);{let l=a.hasField("name")?a.field("name"):"%%%%FIELDNAME",f=a.hasField("expression")?a.field("expression"):"";if(l==="%%%%FIELDNAME"&&(y=!0),!l)throw new p(n,m.InvalidParameter,r);i.push({name:l,expression:D.create(f||l,t.getFieldsIndex(),t.dateFieldsTimeZoneDefaultUTC)})}}if(o=[],$(e[2]))o.push(e[2]);else if(S(e[2]))o=e[2];else if(U(e[2]))o=e[2].toArray();else{if(!(e[2]instanceof P))throw new p(n,m.InvalidParameter,r);o.push(e[2])}for(let a of o){if(!(a instanceof P))throw new p(n,m.InvalidParameter,r);{let l=a.hasField("name")?a.field("name"):"",f=a.hasField("statistic")?a.field("statistic"):"",F=a.hasField("expression")?a.field("expression"):"";if(!l||!f||!F)throw new p(n,m.InvalidParameter,r);u.push({name:l,statistic:f.toLowerCase(),expression:D.create(F,t.getFieldsIndex(),t.dateFieldsTimeZoneDefaultUTC)})}}if(y){let a={};for(let f of t.fields)a[f.name.toLowerCase()]=1;for(let f of i)f.name!=="%%%%FIELDNAME"&&(a[f.name.toLowerCase()]=1);for(let f of u)f.name!=="%%%%FIELDNAME"&&(a[f.name.toLowerCase()]=1);let l=0;for(let f of i)if(f.name==="%%%%FIELDNAME"){for(;a["field_"+l.toString()]===1;)l++;a["field_"+l.toString()]=1,f.name="FIELD_"+l.toString()}}for(let a of i)yield ue(a.expression,s,n);for(let a of u)yield ue(a.expression,s,n);return e[0].groupby(i,u)}))},s.signatures.push({name:"groupby",min:3,max:3}),s.functions.distinct=function(n,r){return s.standardFunctionAsync(n,r,(d,g,e)=>N(this,null,function*(){if(L(e[0])){A(e,2,2,n,r);let t=yield e[0].load(),i=[],u=[];if($(e[1]))u.push(e[1]);else if(e[1]instanceof P)u.push(e[1]);else if(S(e[1]))u=e[1];else{if(!U(e[1]))throw new p(n,m.InvalidParameter,r);u=e[1].toArray()}let y=!1;for(let o of u)if($(o)){let a=D.create(E(o),t.getFieldsIndex(),t.dateFieldsTimeZoneDefaultUTC),l=se(a)===!0?E(o):"%%%%FIELDNAME";i.push({name:l,expression:a}),l==="%%%%FIELDNAME"&&(y=!0)}else{if(!(o instanceof P))throw new p(n,m.InvalidParameter,r);{let a=o.hasField("name")?o.field("name"):"%%%%FIELDNAME",l=o.hasField("expression")?o.field("expression"):"";if(a==="%%%%FIELDNAME"&&(y=!0),!a)throw new p(n,m.InvalidParameter,r);i.push({name:a,expression:D.create(l||a,t.getFieldsIndex(),t.dateFieldsTimeZoneDefaultUTC)})}}if(y){let o={};for(let l of t.fields)o[l.name.toLowerCase()]=1;for(let l of i)l.name!=="%%%%FIELDNAME"&&(o[l.name.toLowerCase()]=1);let a=0;for(let l of i)if(l.name==="%%%%FIELDNAME"){for(;o["field_"+a.toString()]===1;)a++;o["field_"+a.toString()]=1,l.name="FIELD_"+a.toString()}}for(let o of i)yield ue(o.expression,s,n);return e[0].groupby(i,[])}return We("distinct",d,g,e)}))}),s.functions.getfeaturesetinfo=function(n,r){return s.standardFunctionAsync(n,r,(d,g,e)=>N(this,null,function*(){if(A(e,1,1,n,r),!L(e[0]))return null;let t=yield e[0].getFeatureSetInfo();return t?P.convertObjectToArcadeDictionary({layerId:t.layerId,layerName:t.layerName,itemId:t.itemId,serviceLayerUrl:t.serviceLayerUrl,webMapLayerId:t.webMapLayerId??null,webMapLayerTitle:t.webMapLayerTitle??null,className:null,objectClassId:null},ie(n),!1,!1):null}))},s.signatures.push({name:"getfeaturesetinfo",min:1,max:1})}export{wn as registerFunctions};
