import{a as O}from"./chunk-SVEGZVCP.js";import{a as V}from"./chunk-6MGDEI2H.js";import{d as f}from"./chunk-PEPXQ7N3.js";import{w as D}from"./chunk-WMYPRHRR.js";import{h as v,i as S,r as T}from"./chunk-465DRXTW.js";import{a as g,b as F,g as r}from"./chunk-ESDYQQXO.js";function s(e){return typeof e=="string"||e instanceof String}var B="yyyy-MM-dd",X="TT",u;(function(e){e.HM="HH:mm",e.HMS="HH:mm:ss",e.HMS_MS="HH:mm:ss.SSS"})(u||(u={}));var J=[u.HMS_MS,u.HMS,u.HM,X];function I(e){return f.fromFormat(e,B)}function b(e){let n=null;return J.find(t=>(n=f.fromFormat(e,t),n.isValid)),n}function x(e){return f.fromISO(e)}var o;(function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(o||(o={}));var W=new Set(["integer","small-integer","big-integer","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"]);function Y(e){return e!=null&&W.has(e.type)}function E(e){return e!=null&&(e.type==="date-only"||e.type==="esriFieldTypeDateOnly")}function M(e){return e!=null&&(e.type==="timestamp-offset"||e.type==="esriFieldTypeTimestampOffset")}function N(e){return e!=null&&(e.type==="time-only"||e.type==="esriFieldTypeTimeOnly")}function A(e,n){let t=e?.domain;if(!t)return null;switch(t.type){case"range":{let{min:i,max:l}=_(e);if(i!=null&&+n<i||l!=null&&+n>l)return o.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(t.codedValues==null||t.codedValues.every(i=>i==null||i.code!==n))return o.INVALID_CODED_VALUE}return null}function _(e,n){let t=n??e?.domain;if(!t||t.type!=="range")return;let i="range"in t?t.range[0]:t.minValue,l="range"in t?t.range[1]:t.maxValue,a=Y(e);return E(e)||N(e)||M(e)?F(g({},q(e,l,i)),{isInteger:a}):{min:i!=null&&typeof i=="number"?i:null,max:l!=null&&typeof l=="number"?l:null,rawMin:i,rawMax:l,isInteger:a}}function q(e,n,t){return E(e)?{min:t!=null&&s(t)?I(t).toMillis():null,max:n!=null&&s(n)?I(n).toMillis():null,rawMin:t,rawMax:n}:N(e)?{min:t!=null&&s(t)?b(t).toMillis():null,max:n!=null&&s(n)?b(n).toMillis():null,rawMin:t,rawMax:n}:M(e)?{min:t!=null&&s(t)?x(t).toMillis():null,max:n!=null&&s(n)?x(n).toMillis():null,rawMin:t,rawMax:n}:{max:null,min:null}}var K=/^([0-9_])/,Q=/[^a-z0-9_\u0080-\uffff]+/gi;function fn(e){return e==null?null:e.trim().replaceAll(Q,"_").replace(K,"F$1")||null}var ee=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],ne=["field","normalizationField"];function mn(e,n){if(e!=null&&n!=null){for(let t of Array.isArray(e)?e:[e])if(L(ee,t,n),"visualVariables"in t&&t.visualVariables)for(let i of t.visualVariables)L(ne,i,n)}}function L(e,n,t){if(e)for(let i of e){let l=v(i,n),a=l&&typeof l!="function"&&t.get(l);a&&S(i,a.name,n)}}function cn(e,n){if(e!=null&&n?.fields?.length)if("startField"in e){let t=n.get(e.startField),i=n.get(e.endField);e.startField=t?.name??null,e.endField=i?.name??null}else{let t=n.get(e.startTimeField),i=n.get(e.endTimeField);e.startTimeField=t?.name??null,e.endTimeField=i?.name??null}}var w=new Set;function R(e,n){return e&&n?(w.clear(),m(w,e,n),Array.from(w).sort()):[]}function m(e,n,t){if(t)if(n?.fields?.length)if(t.includes("*"))for(let{name:i}of n.fields)e.add(i);else for(let i of t)y(e,n,i);else{if(t.includes("*"))return e.clear(),void e.add("*");for(let i of t)i!=null&&e.add(i)}}function y(e,n,t){if(typeof t=="string")if(n){let i=n.get(t);i&&e.add(i.name)}else e.add(t)}function pn(e,n){return n==null||e==null?[]:n.includes("*")?(e.fields??[]).map(t=>t.name):n}function d(e,n,t){return r(this,null,function*(){if(!t)return;let{arcadeUtils:i}=yield V(),l=i.extractFieldNames(t,n?.fields?.map(a=>a.name));for(let a of l)y(e,n,a)})}function C(e,n,t){return r(this,null,function*(){if(t&&t!=="1=1"){let i=yield O(t,n);if(!i.isStandardized)throw new T("fieldUtils:collectFilterFields","Where clause is not standardized",{where:t});m(e,n,i.fieldNames)}})}function yn({displayField:e,fields:n}){return e||(n?.length?h(n,"name-or-title")||h(n,"unique-identifier")||h(n,"type-or-category")||te(n):null)}function te(e){for(let n of e){if(!n?.name)continue;let t=n.name.toLowerCase();if(t.includes("name")||t.includes("title"))return n.name}return null}function h(e,n){for(let t of e)if(t?.valueType&&t.valueType===n)return t.name;return null}function gn(e,n){return r(this,null,function*(){if(!n)return;let t=n.elevationInfo?.featureExpressionInfo;return t?t.collectRequiredFields(e,n.fieldsIndex):void 0})}function ie(e,n,t){t.onStatisticExpression?d(e,n,t.onStatisticExpression.expression):e.add(t.onStatisticField)}function Fn(e,n,t){return r(this,null,function*(){if(!n||!t||!("fields"in t))return;let i=[],l=t.popupTemplate;i.push(le(e,n,l)),t.fields&&i.push(...t.fields.map(a=>r(this,null,function*(){return ie(e,n.fieldsIndex,a)}))),yield Promise.all(i)})}function le(e,n,t){return r(this,null,function*(){let i=[];t?.expressionInfos&&i.push(...t.expressionInfos.map(a=>d(e,n.fieldsIndex,a.expression)));let l=t?.content;if(Array.isArray(l))for(let a of l)a.type==="expression"&&a.expressionInfo&&i.push(d(e,n.fieldsIndex,a.expressionInfo.expression));yield Promise.all(i)})}function Tn(e,n,t){return r(this,null,function*(){n&&(n.timeInfo&&t?.timeExtent&&m(e,n.fieldsIndex,[n.timeInfo.startField,n.timeInfo.endField]),n.floorInfo&&m(e,n.fieldsIndex,[n.floorInfo.floorField]),t?.where!=null&&(yield C(e,n.fieldsIndex,t.where)))})}function In(e,n,t){return r(this,null,function*(){n&&t&&(yield Promise.all(t.map(i=>ae(e,n,i))))})}function ae(e,n,t){return r(this,null,function*(){n&&t&&(t.valueExpression?yield d(e,n.fieldsIndex,t.valueExpression):t.field&&y(e,n.fieldsIndex,t.field))})}function bn(e){return e?R(e.fieldsIndex,$(e)):[]}function re(e){if(!e)return[];let n=e.geometryFieldsInfo;return n?R(e.fieldsIndex,[n.shapeAreaField,n.shapeLengthField]):[]}var se=new Set(["oid","global-id","guid"]),oe=new Set(["oid","global-id"]),ue=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i];function de(e){let n=new Set;U(e).forEach(i=>n.add(i)),re(e).forEach(i=>n.add(i.toLowerCase()));let t=e&&"infoFor3D"in e?e.infoFor3D:void 0;return t&&(Object.values(t.assetMapFieldRoles).forEach(i=>n.add(i.toLowerCase())),Object.values(t.transformFieldRoles).forEach(i=>n.add(i.toLowerCase()))),Array.from(n)}function $(e){if(!e)return[];let n="editFieldsInfo"in e&&e.editFieldsInfo;if(!n)return[];let{creationDateField:t,creatorField:i,editDateField:l,editorField:a}=n;return[t,i,l,a].filter(Boolean)}function U(e){return $(e).map(n=>n.toLowerCase())}function xn(e,n){return e.editable&&!se.has(e.type)&&!U(n).includes(e.name?.toLowerCase()??"")}function wn(e,n){let t=e.name?.toLowerCase()??"";return!(n?.objectIdField!=null&&t===n.objectIdField.toLowerCase()||n?.globalIdField!=null&&t===n.globalIdField.toLowerCase()||de(n).includes(t)||oe.has(e.type)||ue.some(i=>i.test(t)))}function hn(e,n){return r(this,null,function*(){let{labelingInfo:t,fieldsIndex:i}=n;t?.length&&(yield Promise.all(t.map(l=>fe(e,i,l))))})}function fe(e,n,t){return r(this,null,function*(){if(!t)return;let i=t.getLabelExpression(),l=t.where;if(i.type==="arcade")yield d(e,n,i.expression);else{let a=i.expression.match(/{[^}]*}/g);a&&a.forEach(Z=>{y(e,n,Z.slice(1,-1))})}yield C(e,n,l)})}function vn(e){let n=e.defaultValue;return n!==void 0&&z(e,n)?n:e.nullable?null:void 0}function Sn(e){let n=typeof e=="string"?{type:e}:e;return we(n)?255:n.type==="esriFieldTypeDate"||n.type==="date"?8:void 0}function k(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)}function me(e){return e===null||k(e)}function ce(e){return e===null||Number.isInteger(e)}function H(e){return e!=null&&typeof e=="string"}function pe(e){return e===null||H(e)}function ye(){return!0}function z(e,n){let t;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"big-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":case"esriFieldTypeBigInteger":t=e.nullable?ce:Number.isInteger;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":t=e.nullable?me:k;break;case"string":case"esriFieldTypeString":t=e.nullable?pe:H;break;default:t=ye}return arguments.length===1?t:t(n)}var G=["integer","small-integer","big-integer"],j=["single","double"],Dn=[...G,...j],ge=["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeBigInteger"],Fe=["esriFieldTypeSingle","esriFieldTypeDouble"],Te=new Set([...G,...ge]),Ie=new Set([...j,...Fe]),be=D(Te,Ie);function xe(e){return e!=null&&be.has(e.type)}function we(e){return e!=null&&(e.type==="string"||e.type==="esriFieldTypeString")}function On(e){return e!=null&&(e.type==="date"||e.type==="esriFieldTypeDate")}function Vn(e){return e!=null&&(e.type==="date-only"||e.type==="esriFieldTypeDateOnly")}function En(e){return e!=null&&(e.type==="timestamp-offset"||e.type==="esriFieldTypeTimestampOffset")}function Mn(e){return e!=null&&(e.type==="time-only"||e.type==="esriFieldTypeTimeOnly")}function Nn(e){return e!=null&&(e.type==="oid"||e.type==="esriFieldTypeOID")}function An(e){return e!=null&&(e.type==="global-id"||e.type==="esriFieldTypeGlobalID")}function _n(e,n){return he(e,n)===null}var c,p;function Ln(e){return e==null||typeof e=="number"&&isNaN(e)?null:e}function he(e,n){return e==null||e.nullable&&n===null?null:xe(e)&&!ve(e.type,Number(n))?c.OUT_OF_RANGE:z(e,n)?e.domain?A(e,n):null:p.INVALID_TYPE}function ve(e,n){let t=typeof e=="string"?P(e):e;if(!t)return!1;let i=t.min,l=t.max;return t.isInteger?Number.isInteger(n)&&n>=i&&n<=l:n>=i&&n<=l}function P(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return Se;case"esriFieldTypeInteger":case"integer":return De;case"esriFieldTypeBigInteger":case"big-integer":return Oe;case"esriFieldTypeSingle":case"single":return Ve;case"esriFieldTypeDouble":case"double":return Ee}}(function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(c||(c={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(p||(p={}));var Se={min:-32768,max:32767,isInteger:!0,rawMin:-32768,rawMax:32767},De={min:-2147483648,max:2147483647,isInteger:!0,rawMin:-2147483648,rawMax:2147483647},Oe={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0,rawMin:-Number.MAX_SAFE_INTEGER,rawMax:Number.MAX_SAFE_INTEGER},Ve={min:-34e37,max:12e37,isInteger:!1,rawMin:-34e37,rawMax:12e37},Ee={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1,rawMin:-Number.MAX_VALUE,rawMax:Number.MAX_VALUE};function Rn(e,n,t){switch(e){case o.INVALID_CODED_VALUE:return`Value ${t} is not in the coded domain - field: ${n.name}, domain: ${JSON.stringify(n.domain)}`;case o.VALUE_OUT_OF_RANGE:return`Value ${t} is out of the range of valid values - field: ${n.name}, domain: ${JSON.stringify(n.domain)}`;case p.INVALID_TYPE:return`Value ${t} is not a valid value for the field type - field: ${n.name}, type: ${n.type}, nullable: ${n.nullable}`;case c.OUT_OF_RANGE:{let{min:i,max:l}=P(n.type);return`Value ${t} is out of range for the number type - field: ${n.name}, type: ${n.type}, value range is ${i} to ${l}`}}}function Cn(e,n){return!Me(e,n,null)}function Me(e,n,t){if(!n?.attributes||!e){if(t!=null)for(let a of e??[])t.add(a);return!0}let i=new Set(Object.keys(n.attributes)),l=!1;for(let a of e)if(!i.has(a)){if(l=!0,t==null)break;t.add(a)}return l}function $n(e){return!!e&&["raster.itempixelvalue","raster.servicepixelvalue"].some(n=>e.toLowerCase().startsWith(n))}export{_ as a,fn as b,mn as c,cn as d,R as e,m as f,y as g,pn as h,d as i,yn as j,gn as k,Fn as l,Tn as m,In as n,bn as o,xn as p,wn as q,hn as r,vn as s,Sn as t,xe as u,we as v,On as w,Vn as x,En as y,Mn as z,Nn as A,An as B,_n as C,Ln as D,he as E,Rn as F,Cn as G,$n as H};
