import{d as Z}from"./chunk-DY5KXHAV.js";import{a as Qe,d as Yt}from"./chunk-PQYE2TOR.js";import{a as Bt}from"./chunk-XCLJ7TPP.js";import"./chunk-LLDE5IQ6.js";import{a as Wt}from"./chunk-C3SRECOD.js";import"./chunk-MCO7DSFO.js";import"./chunk-3CZHUHY5.js";import"./chunk-G7LWVLCX.js";import"./chunk-HHJJPMV6.js";import"./chunk-EHWWHYDE.js";import{o as V}from"./chunk-M3GEY4SR.js";import"./chunk-7QY3BMVN.js";import{a as Et}from"./chunk-4HXOVZYF.js";import{a as xt}from"./chunk-U2QVIRVP.js";import"./chunk-ATSTMTT4.js";import"./chunk-OVKL2WYY.js";import"./chunk-JKNGMCUA.js";import"./chunk-VXOK76QV.js";import"./chunk-FYZRIMPP.js";import{a as Vt}from"./chunk-OJTJKYFK.js";import"./chunk-WSUW6W66.js";import"./chunk-WF5LZUVW.js";import"./chunk-RZU6EEB3.js";import"./chunk-WHNNLNN4.js";import{a as Zt}from"./chunk-PHG7WLHF.js";import"./chunk-VL6L3PH6.js";import{b as Jt,d as ze}from"./chunk-EGQHBYFL.js";import{a as Xt}from"./chunk-RAIGRXV3.js";import"./chunk-UULYHJV4.js";import{a as Ht}from"./chunk-CIQJCIGH.js";import{a as Oe}from"./chunk-RI77TKRA.js";import"./chunk-UW2TVJUN.js";import"./chunk-LGUXUFJ7.js";import{a as je}from"./chunk-Z7MKEISX.js";import"./chunk-QB3NROF7.js";import{a as Ue}from"./chunk-5WCYRI4X.js";import{g as er}from"./chunk-DR5NPQZL.js";import"./chunk-6UQ2Y4IC.js";import"./chunk-KZREEH45.js";import"./chunk-N3XRI3RU.js";import"./chunk-BGARZEEH.js";import"./chunk-B3I4XIHJ.js";import"./chunk-6EFGHIXX.js";import"./chunk-DZ3DW7ED.js";import"./chunk-3XRT3SNQ.js";import{a as Kt}from"./chunk-YEFTRNE3.js";import"./chunk-5OGCWDP4.js";import"./chunk-JBJTQF7V.js";import"./chunk-5JBKPHFU.js";import"./chunk-CN5O6E6T.js";import{n as $t}from"./chunk-4KJ462UD.js";import"./chunk-HSB35X5B.js";import"./chunk-IFUI4HFB.js";import"./chunk-JOOJSGLF.js";import"./chunk-MYELF7MV.js";import"./chunk-MS3ZOARX.js";import"./chunk-KCKP7FIY.js";import"./chunk-BQABCLW6.js";import"./chunk-HTB4QCFJ.js";import"./chunk-7K4WIBFN.js";import"./chunk-45GFWXQC.js";import"./chunk-AUVYUYNK.js";import"./chunk-C7M5MSEL.js";import"./chunk-HPJ6EQFO.js";import"./chunk-5MJXKSZ4.js";import{c as re}from"./chunk-TJ3KO5EG.js";import"./chunk-LGGJOMLJ.js";import"./chunk-VVAIF23J.js";import"./chunk-6N5DPLFH.js";import"./chunk-O5K35OSE.js";import"./chunk-D6LLE2YP.js";import"./chunk-I3S324BU.js";import{c as _t}from"./chunk-O5IGEGOS.js";import"./chunk-2UDQ3IWX.js";import"./chunk-MXH75ZNY.js";import"./chunk-PQKTT6AH.js";import"./chunk-OM24DGCK.js";import"./chunk-YQRTHGFD.js";import"./chunk-EDSVJRYE.js";import"./chunk-TQYOVOJO.js";import"./chunk-QAVDKCSH.js";import"./chunk-H2AOS66Z.js";import"./chunk-VGGNZXSE.js";import"./chunk-YH4Z47PR.js";import"./chunk-CJJRHJ2S.js";import"./chunk-HZP7XBNB.js";import"./chunk-YUZT5LSA.js";import"./chunk-725QQXBM.js";import"./chunk-ZYPPRX53.js";import"./chunk-574KRDZU.js";import"./chunk-2APWMENK.js";import"./chunk-ZWFVPWKA.js";import"./chunk-JOYABHZZ.js";import"./chunk-IEXZWAIE.js";import{c as tr}from"./chunk-VDN3XKL2.js";import{a as bt}from"./chunk-SVEGZVCP.js";import"./chunk-AQ74ANSJ.js";import"./chunk-SAOUSUZE.js";import"./chunk-6MGDEI2H.js";import"./chunk-QSGARGRB.js";import"./chunk-SREKDU6P.js";import"./chunk-IXIJFOEL.js";import{a as se}from"./chunk-QZ4L25WE.js";import{f as qt}from"./chunk-4ATIL3QV.js";import"./chunk-WUM4JBII.js";import{e as Me,p as Ae}from"./chunk-URUYU25U.js";import"./chunk-3S2DT2SI.js";import"./chunk-7PPV2CP7.js";import{a as Fe,s as K,t as H}from"./chunk-U62SHMHB.js";import"./chunk-55ESOXMJ.js";import"./chunk-BCREO4Q5.js";import"./chunk-EJ3VIBAJ.js";import"./chunk-4LHUJTP5.js";import"./chunk-NBRBW7H5.js";import"./chunk-CBOFHDSC.js";import"./chunk-HB7BVTLV.js";import"./chunk-WZKL6OPG.js";import"./chunk-WF37UVOV.js";import"./chunk-UZQ577CU.js";import{b as Tt}from"./chunk-FC3MPJI4.js";import"./chunk-5ETRXDS4.js";import"./chunk-QDNKD3H5.js";import"./chunk-F72O5PVM.js";import"./chunk-B4PK7RBX.js";import"./chunk-6J4Y65BV.js";import"./chunk-RXHILZH7.js";import"./chunk-REI3KXR7.js";import"./chunk-URPCXPAW.js";import"./chunk-KBFIYTBH.js";import"./chunk-PEPXQ7N3.js";import"./chunk-VU5W7W6Y.js";import{j as te}from"./chunk-6QIKBCPR.js";import{a as ce,i as J}from"./chunk-AHKJJNRE.js";import"./chunk-HBTOKQC5.js";import{b as Pe}from"./chunk-A52LT7YB.js";import{A as ne}from"./chunk-CZPMRK53.js";import"./chunk-IDSF2RZ6.js";import"./chunk-2BBIRZVO.js";import"./chunk-WQAXQD4X.js";import{a as ke}from"./chunk-IUPUERVS.js";import{$ as me,V as Ut}from"./chunk-XF4NUYV7.js";import{h as F}from"./chunk-FNDPIYNC.js";import{H as p,K as q}from"./chunk-WMYPRHRR.js";import{R as T,u as wt}from"./chunk-IAMDMFZ7.js";import{a as n}from"./chunk-53MWZ23O.js";import{i as zt}from"./chunk-PT7S6WNL.js";import"./chunk-XDTDVCGP.js";import"./chunk-JPDAKIWT.js";import{p as Y,r as f}from"./chunk-465DRXTW.js";import{a as Qt}from"./chunk-AC62Z3FX.js";import{a as ue,b as At,g as y}from"./chunk-ESDYQQXO.js";var Qr="ESRI__DESTINATION_ID",zr="ESRI__ORIGIN_ID",ye=class e{constructor(){this._featureLookup=new Map}static getInstance(){return e.instance||(e.instance=new e),e.instance}static resetInstance(){e.instance&&(e.instance=null)}deleteFromStore(t){t.forEach(r=>{this._featureLookup.delete(r)})}readFromStoreByList(t){let r=[];return t.forEach(o=>{let i=this.readFromStoreById(o);i&&r.push(i)}),r}readFromStoreById(t){return this._featureLookup.get(t)??null}writeToStore(t,r,o){let i=[];return t.forEach(a=>{if(!a?.id)return;a.properties||(a.properties=[]);let s,d=null;if(o&&a.properties[o]&&(d=V(a.properties[o])),"originId"in a&&"destinationId"in a&&(a.properties[zr]=a.originId,a.properties[Qr]=a.destinationId),a.properties[r]=a.id,a.id&&this._featureLookup.has(a.id)&&this._featureLookup.get(a.id).attributes){let l=this._featureLookup.get(a.id),m=JSON.parse(JSON.stringify(Object.assign(l.attributes,a.properties)));o&&a.properties[o]&&(m[o]=qt(a.properties[o])),s=new Et(d?JSON.parse(JSON.stringify(d)):l?.geometry?JSON.parse(JSON.stringify(l.geometry)):null,m,null,a.properties[r])}else s=new Et(d?JSON.parse(JSON.stringify(d)):null,a.properties,null,a.properties[r]);this._featureLookup.set(a.id,s),i.push(s)}),i}};var qe=class extends q{constructor(e){super(e),this.resultRows=[]}};n([p()],qe.prototype,"resultRows",void 0),qe=n([T("esri.rest.knowledgeGraph.GraphQueryResult")],qe);var kt=qe;var He=class extends q{constructor(e){super(e),this.resultRowsStream=new ReadableStream}};n([p()],He.prototype,"resultRowsStream",void 0),He=n([T("esri.rest.knowledgeGraph.GraphQueryResult")],He);var Mt=He;var oe=class extends F{constructor(e){super(e),this.name=null,this.unique=null,this.ascending=null,this.description=null,this.fieldNames=null}};n([p({type:String,json:{write:!0}})],oe.prototype,"name",void 0),n([p({type:Boolean,json:{write:!0}})],oe.prototype,"unique",void 0),n([p({type:Boolean,json:{write:!0}})],oe.prototype,"ascending",void 0),n([p({type:String,json:{write:!0}})],oe.prototype,"description",void 0),n([p({type:[String],json:{write:!0}})],oe.prototype,"fieldNames",void 0),oe=n([T("esri.rest.knowledgeGraph.FieldIndex")],oe);var Be=oe;var O=class extends F{constructor(e){super(e),this.name=null,this.alias=null,this.fieldType=null,this.geometryType=null,this.hasM=null,this.hasZ=null,this.nullable=null,this.editable=null,this.required=null,this.defaultVisibility=null,this.systemMaintained=null,this.role=null,this.defaultValue=null}};n([p({type:String,json:{write:!0}})],O.prototype,"name",void 0),n([p({type:String,json:{write:!0}})],O.prototype,"alias",void 0),n([p({type:String,json:{write:!0}})],O.prototype,"fieldType",void 0),n([p({type:String,json:{write:!0}})],O.prototype,"geometryType",void 0),n([p({type:Boolean,json:{write:!0}})],O.prototype,"hasM",void 0),n([p({type:Boolean,json:{write:!0}})],O.prototype,"hasZ",void 0),n([p({type:Boolean,json:{write:!0}})],O.prototype,"nullable",void 0),n([p({type:Boolean,json:{write:!0}})],O.prototype,"editable",void 0),n([p({type:Boolean,json:{write:!0}})],O.prototype,"required",void 0),n([p({type:Boolean,json:{write:!0}})],O.prototype,"defaultVisibility",void 0),n([p({type:Boolean,json:{write:!0}})],O.prototype,"systemMaintained",void 0),n([p()],O.prototype,"role",void 0),n([p({type:Object,json:{type:String,write:{writer:(e,t)=>{t.defaultValue=e!=null?e.toString():null}}}})],O.prototype,"defaultValue",void 0),O=n([T("esri.rest.knowledgeGraph.GraphProperty")],O);var We=O;var X=class extends F{constructor(e){super(e),this.name=null,this.alias=null,this.role=null,this.strict=null,this.properties=null,this.fieldIndexes=null}};n([p({type:String,json:{write:!0}})],X.prototype,"name",void 0),n([p({type:String,json:{write:!0}})],X.prototype,"alias",void 0),n([p({type:String,json:{write:!0}})],X.prototype,"role",void 0),n([p({type:Boolean,json:{write:!0}})],X.prototype,"strict",void 0),n([p({type:[We],json:{write:!0}})],X.prototype,"properties",void 0),n([p({type:[Be],json:{write:!0}})],X.prototype,"fieldIndexes",void 0),X=n([T("esri.rest.knowledgeGraph.GraphObjectType")],X);var Ce=X;var Ct=class extends Ce{constructor(e){super(e)}};Ct=n([T("esri.rest.knowledgeGraph.EntityType")],Ct);var he=Ct;var Ye=class extends Ce{constructor(e){super(e),this.endPoints=[]}};n([p()],Ye.prototype,"endPoints",void 0),Ye=n([T("esri.rest.knowledgeGraph.RelationshipType")],Ye);var fe=Ye;var U=class extends F{constructor(e){super(e),this.timestamp=null,this.spatialReference=null,this.strict=null,this.objectIdField=null,this.globalIdField=null,this.arcgisManaged=null,this.identifierInfo=null,this.searchIndexes=null,this.entityTypes=null,this.relationshipTypes=null}};n([p({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.timestamp=e?.getTime()}}}})],U.prototype,"timestamp",void 0),n([p({type:Pe,json:{write:!0}})],U.prototype,"spatialReference",void 0),n([p({type:Boolean,json:{write:!0}})],U.prototype,"strict",void 0),n([p({type:String,json:{write:!0}})],U.prototype,"objectIdField",void 0),n([p({type:String,json:{write:!0}})],U.prototype,"globalIdField",void 0),n([p()],U.prototype,"arcgisManaged",void 0),n([p()],U.prototype,"identifierInfo",void 0),n([p()],U.prototype,"searchIndexes",void 0),n([p({type:[he],json:{write:!0}})],U.prototype,"entityTypes",void 0),n([p({type:[fe],json:{write:!0}})],U.prototype,"relationshipTypes",void 0),U=n([T("esri.rest.knowledgeGraph.DataModel")],U);var $e=U;var N=class extends F{constructor(e){super(e),this.capabilities=[],this.supportsSearch=!1,this.supportedQueryFormats=[],this.allowGeometryUpdates=!1,this.searchMaxRecordCount=null,this.serviceCapabilities=null,this.maxRecordCount=null,this.description="",this.copyrightText="",this.units="",this.spatialReference=null,this.currentVersion=null,this.dateFieldsTimeReference=null,this.serviceItemId="",this.supportsDocuments=!1,this.dataEditingNotSupported=!1,this.schemaEditingNotSupported=!1}};n([p({type:[String],json:{write:!0}})],N.prototype,"capabilities",void 0),n([p({type:Boolean,json:{write:!0}})],N.prototype,"supportsSearch",void 0),n([p({type:[String],json:{write:!0}})],N.prototype,"supportedQueryFormats",void 0),n([p({type:Boolean,json:{write:!0}})],N.prototype,"allowGeometryUpdates",void 0),n([p({type:Number,json:{write:!0}})],N.prototype,"searchMaxRecordCount",void 0),n([p({type:Object,json:{write:!0}})],N.prototype,"serviceCapabilities",void 0),n([p({type:Number,json:{write:!0}})],N.prototype,"maxRecordCount",void 0),n([p({type:String,json:{write:!0}})],N.prototype,"description",void 0),n([p({type:String,json:{write:!0}})],N.prototype,"copyrightText",void 0),n([p({type:String,json:{write:!0}})],N.prototype,"units",void 0),n([p({type:Object,json:{write:!0}})],N.prototype,"spatialReference",void 0),n([p({type:Number,json:{write:!0}})],N.prototype,"currentVersion",void 0),n([p({type:Object,json:{write:!0}})],N.prototype,"dateFieldsTimeReference",void 0),n([p({type:String,json:{write:!0}})],N.prototype,"serviceItemId",void 0),n([p({type:Boolean,json:{write:!0}})],N.prototype,"supportsDocuments",void 0),n([p({type:Boolean,json:{write:!0}})],N.prototype,"dataEditingNotSupported",void 0),n([p({type:Boolean,json:{write:!0}})],N.prototype,"schemaEditingNotSupported",void 0),N=n([T("esri.rest.knowledgeGraph.ServiceDefinition")],N);var Je=N;var ge=class extends F{constructor(e){super(e),this.dataModel=null,this.serviceDefinition=null}};n([p({type:String,json:{write:!0}})],ge.prototype,"url",void 0),n([p({type:$e,json:{write:!0}})],ge.prototype,"dataModel",void 0),n([p({type:Je,json:{write:!0}})],ge.prototype,"serviceDefinition",void 0),ge=n([T("esri.rest.knowledgeGraph.KnowledgeGraph")],ge);var rr=ge;var or="esri/rest/knowledgeGraph/wasmInterface/",Lt,Ur=null;function ee(){return y(this,null,function*(){let e=Ur??Lt;if(e)return e;let t=Qt("wasm-simd");return Lt=qr(t),Lt})}function qr(e){return y(this,null,function*(){if(e){let{default:r}=yield import("./chunk-VULAPHQE.js").then(o=>o.a);return r({locateFile:o=>ke(or+o)})}let{default:t}=yield import("./chunk-A7TGBVFY.js").then(r=>r.a);return t({locateFile:r=>ke(or+r)})})}function It(e,t){let r=new t.ArrayValue;return r.deleteLater(),e.forEach(o=>{r.add_value(vt(o,t))}),r}function Gt(e,t){let r=new t.ObjectValue;r.deleteLater();for(let[o,i]of Object.entries(e))r.set_key_value(o,vt(i,t));return r}function Le(e,t){if(e instanceof Fe)return Br(e,t);if(e instanceof J)return Wr(e,t);if(e instanceof H||e instanceof K)return Hr(e,t);throw new f("knowledge-graph:unsupported-geometry","Only Point, Multipoint, Polyline, and Polygon geometry are supported by ArcGIS Knowledge",{geometry:e})}function ir(e,t){t.input_quantization_parameters={xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}function ar(e,t,r){if(!e.extent)throw new f("knowledge-graph:illegal-output-quantization","The Output quantization provided to the encoder had an illegal value as part of its extent",e.extent);if(!e.quantizeMode)throw new f("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal mode setting",e.quantizeMode);if(!e.tolerance)throw new f("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal tolerance setting",e.quantizeMode);t.output_quantization_parameters={extent:{xmax:e.extent.xmax,ymax:e.extent.ymax,xmin:e.extent.xmin,ymin:e.extent.ymin},quantize_mode:r.esriQuantizeMode[e.quantizeMode],tolerance:e.tolerance}}function vt(e,t){if(e==null)return"";if(typeof e!="object"||e instanceof Date)return e;if(e instanceof ce)return Le(e,t);if(Array.isArray(e)){let r=new t.ArrayValue;return r.deleteLater(),e.forEach(o=>{r.add_value(vt(o,t))}),r}return Gt(e,t)}function Hr(e,t){let r=new t.GeometryValue;r.deleteLater(),r.has_z=e.hasZ,r.has_m=e.hasM;let o=[],i=[],a=[];e instanceof H?(r.geometry_type=t.esriGeometryType.esriGeometryPolyline,a=e.paths):e instanceof K&&(r.geometry_type=t.esriGeometryType.esriGeometryPolygon,a=e.rings);let s=0,d=0;return a.forEach(l=>{let m=0;l.forEach(h=>{m++,h.forEach(E=>{o[d]=E,d++})}),i[s]=m,s++}),r.coords=new Float64Array(o),r.lengths=new Uint32Array(i),r}function Br(e,t){let r=new t.GeometryValue;r.deleteLater(),r.geometry_type=r.geometry_type=t.esriGeometryType.esriGeometryMultipoint,r.has_z=e.hasZ,r.has_m=e.hasM;let o=[],i=[];i[0]=e.points.length;let a=0;return e.points.forEach(s=>{s.forEach(d=>{o[a]=d,a++})}),r.coords=new Float64Array(o),r.lengths=new Uint32Array(i),r}function Wr(e,t){let r=new t.GeometryValue;r.deleteLater(),r.geometry_type=t.esriGeometryType.esriGeometryPoint,r.has_z=e.hasZ,r.has_m=e.hasM;let o=[],i=[];i[0]=1,o[0]=e.x,o[1]=e.y;let a=2;return e.hasZ&&(o[a]=e.z,a++),e.hasM&&(o[a]=e.m,a++),r.coords=new Float64Array(o),r.lengths=new Uint32Array(i),r}var Ke=class extends F{constructor(e){super(e),this.properties=null}};n([p({json:{write:!0}})],Ke.prototype,"properties",void 0),Ke=n([T("esri.rest.knowledgeGraph.GraphObject")],Ke);var pe=Ke;var Ie=class extends pe{constructor(e){super(e),this.typeName=null,this.id=null}};n([p({type:String,json:{write:!0}})],Ie.prototype,"typeName",void 0),n([p({type:String,json:{write:!0}})],Ie.prototype,"id",void 0),Ie=n([T("esri.rest.knowledgeGraph.GraphNamedObject")],Ie);var Ve=Ie;var Ze=class extends Ve{constructor(e){super(e),this.layoutGeometry=null}};n([p({type:J,json:{write:!0}})],Ze.prototype,"layoutGeometry",void 0),Ze=n([T("esri.rest.knowledgeGraph.Entity")],Ze);var Xe=Ze;var we=class extends Ve{constructor(e){super(e),this.originId=null,this.destinationId=null,this.layoutGeometry=null}};n([p({type:String,json:{write:!0}})],we.prototype,"originId",void 0),n([p({type:String,json:{write:!0}})],we.prototype,"destinationId",void 0),n([p({type:H,json:{write:!0}})],we.prototype,"layoutGeometry",void 0),we=n([T("esri.rest.Relationship.Relationship")],we);var et=we;function Ge(e,t){if(!e.typeName)throw new f("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits");if(e instanceof Xe){let r=new t.EntityValue;r.deleteLater(),r.type_name=e.typeName;for(let[o,i]of Object.entries(e.properties))r.set_key_value(o,nr(i,t));return e.id&&r.set_id(e.id),r}if(e instanceof et){let r=new t.RelationshipValue;r.deleteLater(),r.type_name=e.typeName;for(let[o,i]of Object.entries(e.properties))r.set_key_value(o,nr(i,t));return e.id&&r.set_id(e.id),e.originId&&e.destinationId&&r.set_related_entity_ids(e.originId,e.destinationId),r}throw new f("knowledge-graph:applyEdits-encoding-failure","Could not determine the type of a named graph object passed to the encoder")}function sr(e){return{xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}function nr(e,t){return e==null?"":typeof e!="object"||e instanceof Date?e:e instanceof ce?Le(e,t):""}var le=class extends q{constructor(e){super(e),this.name=null,this.supportedCategory=null,this.analyzers=[],this.searchProperties=new Map}};n([p()],le.prototype,"name",void 0),n([p()],le.prototype,"supportedCategory",void 0),n([p()],le.prototype,"analyzers",void 0),n([p()],le.prototype,"searchProperties",void 0),le=n([T("esri.rest.knowledgeGraph.SearchIndex")],le);var pr=le;var ve,De,Se,tt,rt,ot,it;(function(e){e[e.Regular=0]="Regular",e[e.Provenance=1]="Provenance",e[e.Document=2]="Document"})(ve||(ve={})),function(e){e[e.esriFieldTypeSmallInteger=0]="esriFieldTypeSmallInteger",e[e.esriFieldTypeInteger=1]="esriFieldTypeInteger",e[e.esriFieldTypeSingle=2]="esriFieldTypeSingle",e[e.esriFieldTypeDouble=3]="esriFieldTypeDouble",e[e.esriFieldTypeString=4]="esriFieldTypeString",e[e.esriFieldTypeDate=5]="esriFieldTypeDate",e[e.esriFieldTypeOID=6]="esriFieldTypeOID",e[e.esriFieldTypeGeometry=7]="esriFieldTypeGeometry",e[e.esriFieldTypeBlob=8]="esriFieldTypeBlob",e[e.esriFieldTypeRaster=9]="esriFieldTypeRaster",e[e.esriFieldTypeGUID=10]="esriFieldTypeGUID",e[e.esriFieldTypeGlobalID=11]="esriFieldTypeGlobalID",e[e.esriFieldTypeXML=12]="esriFieldTypeXML",e[e.esriFieldTypeBigInteger=13]="esriFieldTypeBigInteger",e[e.esriFieldTypeDateOnly=14]="esriFieldTypeDateOnly",e[e.esriFieldTypeTimeOnly=15]="esriFieldTypeTimeOnly",e[e.esriFieldTypeTimestampOffset=16]="esriFieldTypeTimestampOffset"}(De||(De={})),function(e){e[e.esriGeometryNull=0]="esriGeometryNull",e[e.esriGeometryPoint=1]="esriGeometryPoint",e[e.esriGeometryMultipoint=2]="esriGeometryMultipoint",e[e.esriGeometryPolyline=3]="esriGeometryPolyline",e[e.esriGeometryPolygon=4]="esriGeometryPolygon",e[e.esriGeometryEnvelope=5]="esriGeometryEnvelope",e[e.esriGeometryAny=6]="esriGeometryAny",e[e.esriGeometryMultiPatch=7]="esriGeometryMultiPatch"}(Se||(Se={})),function(e){e[e.esriMethodHintUNSPECIFIED=0]="esriMethodHintUNSPECIFIED",e[e.esriUUIDESRI=1]="esriUUIDESRI",e[e.esriUUIDRFC4122=2]="esriUUIDRFC4122"}(tt||(tt={})),function(e){e[e.esriTypeUNSPECIFIED=0]="esriTypeUNSPECIFIED",e[e.esriTypeEntity=1]="esriTypeEntity",e[e.esriTypeRelationship=2]="esriTypeRelationship",e[e.esriTypeBoth=4]="esriTypeBoth"}(rt||(rt={})),function(e){e[e.esriGraphPropertyUNSPECIFIED=0]="esriGraphPropertyUNSPECIFIED",e[e.esriGraphPropertyRegular=1]="esriGraphPropertyRegular",e[e.esriGraphPropertyDocumentName=2]="esriGraphPropertyDocumentName",e[e.esriGraphPropertyDocumentTitle=3]="esriGraphPropertyDocumentTitle",e[e.esriGraphPropertyDocumentUrl=4]="esriGraphPropertyDocumentUrl",e[e.esriGraphPropertyDocumentText=5]="esriGraphPropertyDocumentText",e[e.esriGraphPropertyDocumentKeywords=6]="esriGraphPropertyDocumentKeywords",e[e.esriGraphPropertyDocumentContentType=7]="esriGraphPropertyDocumentContentType",e[e.esriGraphPropertyDocumentMetadata=8]="esriGraphPropertyDocumentMetadata",e[e.esriGraphPropertyDocumentFileExtension=9]="esriGraphPropertyDocumentFileExtension"}(ot||(ot={})),function(e){e[e.esriIdentifierInfoTypeUNSPECIFIED=0]="esriIdentifierInfoTypeUNSPECIFIED",e[e.esriIdentifierInfoTypeDatabaseNative=1]="esriIdentifierInfoTypeDatabaseNative",e[e.esriIdentifierInfoTypeUniformProperty=2]="esriIdentifierInfoTypeUniformProperty"}(it||(it={}));function lr(e){return e.deleteLater(),new $e({timestamp:e.timestamp,spatialReference:new Pe(e.spatial_reference),strict:e.strict,objectIdField:e.objectid_property,globalIdField:e.globalid_property,arcgisManaged:e.arcgis_managed,identifierInfo:{identifierMappingInfo:{identifierInfoType:it[e.identifier_info?.identifier_mapping_info?.identifier_info_type?.value],databaseNativeIdentifier:e.identifier_info?.identifier_mapping_info?.database_native_identifier,uniformPropertyIdentifier:{identifierPropertyName:e.identifier_info?.identifier_mapping_info?.uniform_property_identifier?.identifier_property_name}},identifierGenerationInfo:{uuidMethodHint:tt[e.identifier_info?.identifier_generation_info?.uuid_method_hint?.value]}},searchIndexes:ro(e.search_indexes),entityTypes:Vr(e.entity_types),relationshipTypes:to(e.relationship_types)})}function Yr(e){return e.deleteLater(),new he(dr(e))}function $r(e){return e.deleteLater(),new Be({name:e.name,unique:e.unique,ascending:e.ascending,description:e.description,fieldNames:Zr(e.fields)})}function dr(e){return{name:e.name,alias:e.alias,role:ve[e.role.value]?ve[e.role.value]:null,strict:e.strict,properties:Xr(e.properties),fieldIndexes:eo(e.field_indexes)}}function Jr(e){return e.deleteLater(),new We({alias:e.alias,name:e.name,fieldType:De[e.field_type.value]?De[e.field_type.value]:null,geometryType:Se[e.geometry_type.value]?Se[e.geometry_type.value]:null,hasM:e.has_m,hasZ:e.has_z,nullable:e.nullable,editable:e.editable,required:e.required,defaultVisibility:e.default_visibility,systemMaintained:e.system_maintained,role:ot[e.role.value],defaultValue:e.default_value})}function Kr(e){e.deleteLater();let t=dr(e),r=[];for(let o=0;o<e.end_points.size();o++){let i=e.end_points.get(o);r.push({originEntityType:i.origin_entity_type,destinationEntityType:i.dest_entity_type})}return new fe(Object.assign({endPoints:r},t))}function Vr(e){let t=[];for(let r=0;r<e.size();r++)t.push(Yr(e.get(r)));return t}function Zr(e){let t=[];for(let r=0;r<e.size();r++)t.push(e.get(r));return t}function Xr(e){let t=[];for(let r=0;r<e.size();r++)t.push(Jr(e.get(r)));return t}function eo(e){let t=[];for(let r=0;r<e.size();r++)t.push($r(e.get(r)));return t}function to(e){let t=[];for(let r=0;r<e.size();r++)t.push(Kr(e.get(r)));return t}function ro(e){let t=[];for(let r=0;r<e.size();r++){let o=new pr,i=e.get(0);o.name=i.name,o.supportedCategory=rt[i.supported_category.value];let a=i.analyzers.size();for(let s=0;s<a;s++)o.analyzers.push({name:i.analyzers.get(s).name});for(let s=0;s<i.search_properties.keys().size();s++){let d=i.search_properties.keys().get(s),l=i.search_properties.get(d),m=[];for(let h=0;h<l.property_names.size();h++)m.push(l.property_names.get(h));o.searchProperties.set(d,{propertyNames:m})}t.push(o)}return t}var Dt=class extends pe{constructor(e){super(e)}};Dt=n([T("esri.rest.knowledgeGraph.ObjectValue")],Dt);var ur=Dt;var at=class extends F{constructor(e){super(e),this.path=null}};n([p({type:[pe],json:{write:!0}})],at.prototype,"path",void 0),at=n([T("esri.rest.knowledgeGraph.Path")],at);var mr=at;var z;(function(e){e[e.ESRI_GEOMETRY_NULL=0]="ESRI_GEOMETRY_NULL",e[e.ESRI_GEOMETRY_POINT=1]="ESRI_GEOMETRY_POINT",e[e.ESRI_GEOMETRY_MULTIPOINT=2]="ESRI_GEOMETRY_MULTIPOINT",e[e.ESRI_GEOMETRY_POLYLINE=3]="ESRI_GEOMETRY_POLYLINE",e[e.ESRI_GEOMETRY_POLYGON=4]="ESRI_GEOMETRY_POLYGON",e[e.ESRI_GEOMETRY_ENVELOPE=5]="ESRI_GEOMETRY_ENVELOPE",e[e.ESRI_GEOMETRY_ANY=6]="ESRI_GEOMETRY_ANY",e[e.ESRI_GEOMETRY_MULTI_PATCH=7]="ESRI_GEOMETRY_MULTI_PATCH"})(z||(z={}));var ie,cr;(function(e){e[e.OBJECT=0]="OBJECT",e[e.ENTITY=1]="ENTITY",e[e.RELATIONSHIP=2]="RELATIONSHIP",e[e.PATH=3]="PATH",e[e.ARRAY=4]="ARRAY"})(ie||(ie={})),function(e){e[e.view=0]="view",e[e.edit=1]="edit"}(cr||(cr={}));function yr(e){let t={},r=St(e,t),o=e.lengths,i=e.coords,a=o[0];t.points=[];let s=0;for(let d=0;d<a;d++){let l=[];for(let m=0;m<r;m++)l[m]=i[s],s++;t.points.push(l)}return new Fe(t)}function hr(e){let t={},r=2;St(e,t);let o=e.coords;return t.x=o[0],t.y=o[1],e.has_z&&(t.z=o[r],r++),e.has_m&&(t.m=o[r]),new J(t)}function fr(e){return new H(wr(e))}function gr(e){return new K(wr(e))}function wr(e){let t={},r=St(e,t),o=e.lengths,i=e.coords,a="";if(e.geometry_type.value===z.ESRI_GEOMETRY_POLYGON)a="rings";else{if(e.geometry_type.value!==z.ESRI_GEOMETRY_POLYLINE)throw new f("KnowledgeGraph:illegal-geometry-type","Illegal Geometry type for multipath conversion");a="paths"}t[a]=[];let s=0;return o.forEach(d=>{let l=[];for(let m=0;m<d;m++){let h=[];for(let E=0;E<r;E++)h[E]=i[s],s++;l.push(h)}t[a].push(l)}),t}function St(e,t){let r=2;return e.has_z?(t.hasZ=e.has_z,r++):t.hasZ=!1,e.has_m?(t.hasM=e.has_m,r++):t.hasM=!1,r}var nt=Y.getLogger("esri.rest.knowledgeGraph.WasmToQueryResponseObjConstructors"),oo={decodedWasmObjToQueryResponseObj:(e,t)=>{if(e==null)return null;if(typeof e!="object"||"getDate"in e)return e;if("geometry_type"in e)switch(e.geometry_type.value){case null:return null;case z.ESRI_GEOMETRY_POINT:return hr(e);case z.ESRI_GEOMETRY_MULTIPOINT:return yr(e);case z.ESRI_GEOMETRY_POLYLINE:return fr(e);case z.ESRI_GEOMETRY_POLYGON:return gr(e);case z.ESRI_GEOMETRY_ENVELOPE:case z.ESRI_GEOMETRY_MULTI_PATCH:return nt.warnOnce("Envelope and Multipatch are not supported on knowledge entities, but one of those geometry types was detected. Result interpreted as null"),null;case z.ESRI_GEOMETRY_NULL:case z.ESRI_GEOMETRY_ANY:default:return nt.warnOnce("Unknown or blank geometry type returned - Result interpreted as null"),null}else{if(!("object_value_type"in e))return nt.warnOnce("A decoded value came back of a type that is not supported. Result interpreted as null"),null;switch(e.object_value_type.value){case ie.OBJECT:return ao(e,t);case ie.ENTITY:return Tr(e,t);case ie.RELATIONSHIP:return br(e,t);case ie.PATH:return no(e,t);case ie.ARRAY:return io(e,t);default:return nt.warnOnce("Unknown graph object type detected!  Result interpreted as null"),null}}}};function io(e,t){let r=[],o=e.count();for(let i=0;i<o;i++){let a=e.get_value_at(i);r.push(st(a,t))}return r}function st(e,t){return oo.decodedWasmObjToQueryResponseObj(e,t)}function Tr(e,t){let r=e.type_name,o=Rt(e,t),i=e.get_id();return new Xe(Object.assign({typeName:r,id:i},o))}function Rt(e,t){let r={},o=e.key_count();for(let i=0;i<o;i++)r[e.get_key_at(i)]=st(e.get_value_at(i),t);return{properties:r}}function ao(e,t){return new ur(Rt(e,t))}function no(e,t){let r=e.entity_count(),o=e.relationship_count(),i=[];for(let a=0;a<r;a++)i.push(Tr(e.get_entity_at(a),t)),a<o&&i.push(br(e.get_relationship_at(a),t));return new mr({path:i})}function br(e,t){let r=e.type_name,o=Rt(e,t);return new et(Object.assign({typeName:r,id:e.get_id(),originId:e.get_origin_entity_id(),destinationId:e.get_destination_entity_id()},o))}var Te=class extends q{constructor(e){super(e),this.hasError=null,this.error=null,this.editResults=[]}};n([p()],Te.prototype,"hasError",void 0),n([p()],Te.prototype,"error",void 0),n([p()],Te.prototype,"editResults",void 0),Te=n([T("esri.rest.knowledgeGraph.GraphApplyEdits")],Te);var _r=Te;function Er(e){let t=new _r;t.hasError=e.has_error(),t.hasError&&(t.error={errorCode:e.error.error_code,errorMessage:e.error.error_message});let r=e.get_edit_results_count();for(let o=0;o<r;o++){let i=e.get_edit_results_at(o),a=e.get_edit_results_type_name_at(o),s=[],d=[],l=[],m=i.get_add_results_count(),h=i.get_update_results_count(),E=i.get_delete_results_count();for(let g=0;g<m;g++){let c=i.get_add_result_at(g);s.push({id:c.id,error:{errorCode:c.error.error_code,errorMessage:c.error.error_message}})}for(let g=0;g<h;g++){let c=i.get_update_result_at(g);d.push({id:c.id,error:{errorCode:c.error.error_code,errorMessage:c.error.error_message}})}for(let g=0;g<E;g++){let c=i.get_delete_result_at(g);l.push({id:c.id,error:{errorCode:c.error.error_code,errorMessage:c.error.error_message}})}t.editResults.push({typeName:a,adds:s,updates:d,deletes:l})}return t}var Ne={fetchKnowledgeGraph:e=>y(void 0,null,function*(){let t=new rr({url:e}),r=[];return r.push(pt(t)),r.push(so(t)),yield Promise.all(r),t}),refreshDataModel:e=>y(void 0,null,function*(){e.dataModel=yield Mr(e)}),refreshServiceDefinition:e=>y(void 0,null,function*(){let t=(yield me(e.url,{query:{f:"json"}})).data;return t.capabilities=t?.capabilities?.split(","),t.supportedQueryFormats=t?.supportedQueryFormats?.split(","),e.serviceDefinition=new Je(t),e.serviceDefinition}),executeQueryStreaming:(e,t,r)=>y(void 0,null,function*(){let o=`${e.url}/graph/query`;yield Pt(e);let i=yield Ft(o,r);i.data.body=yield uo(t,e);let a=yield Nt(i.data.url,i.data);if(e.dataModel)return new Mt({resultRowsStream:yield xr(a,e.dataModel)});throw new f("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}),executeApplyEdits:(e,t,r)=>y(void 0,null,function*(){if(e.serviceDefinition?.dataEditingNotSupported)throw new f("knowledge-graph:data-editing-not-supported","The Knowledge Graph Service definition indicated that data editing is not supported");let o=`${e.url}/graph/applyEdits`;yield Pt(e);let i=yield Ft(o,r);return i.data.body=yield lo(t,e),co(yield Nt(i.data.url,i.data))}),executeQuery:(e,t,r)=>y(void 0,null,function*(){let o=`${e.url}/graph/query`,i=yield me(o,{responseType:"array-buffer",query:ue({f:"pbf",openCypherQuery:t.openCypherQuery},r?.query),signal:r?.signal,timeout:r?.timeout}),a=i.getHeader?.("content-type"),s=i.data;if(a?.includes("application/x-protobuf")){let d=new(yield ee()).GraphQueryDecoder;if(d.deleteLater(),e.dataModel)return new kt({resultRows:Ot(d,s,e.dataModel)});throw new f("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}throw new f("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:a,data:i.data})}),executeSearch:(e,t,r)=>y(void 0,null,function*(){let o=t.typeCategoryFilter,i=`${e.url}/graph/search`,a=yield me(i,{responseType:"array-buffer",query:ue({f:"pbf",searchQuery:`"${t.searchQuery}"`,typeCategoryFilter:o},r?.query),signal:r?.signal,timeout:r?.timeout}),s=a.getHeader?.("content-type"),d=a.data;if(s?.includes("application/x-protobuf")){let l=new(yield ee()).GraphQueryDecoder;if(l.deleteLater(),e.dataModel)return new kt({resultRows:Ot(l,d,e.dataModel)});throw new f("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}throw new f("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:s,data:a.data})}),executeSearchStreaming:(e,t,r)=>y(void 0,null,function*(){let o=`${e.url}/graph/search`;yield Pt(e);let i=yield Ft(o,r);i.data.body=yield mo(t);let a=yield Nt(i.data.url,i.data);if(e.dataModel)return new Mt({resultRowsStream:yield xr(a,e.dataModel)});throw new f("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model")}),_fetchWrapper:(e,t)=>y(void 0,null,function*(){return fetch(e,t)})};function be(e,t,r){return y(this,null,function*(){return Ne.executeQueryStreaming(e,t,r)})}function kr(e){return y(this,null,function*(){return Ne.fetchKnowledgeGraph(e)})}function pt(e){return y(this,null,function*(){return Ne.refreshDataModel(e)})}function so(e){return y(this,null,function*(){return Ne.refreshServiceDefinition(e)})}function Nt(e,t){return y(this,null,function*(){return Ne._fetchWrapper(e,t)})}function Pt(e){return y(this,null,function*(){Ut?.findCredential(e.url)||(e.dataModel?yield Mr(e):yield pt(e))})}function Re(e,t,r){if(e.error_code!==0)throw new f(t,r,{errorCode:e.error_code,errorMessage:e.error_message})}function po(e,t,r,o){t==null?r.set_param_key_value(e,""):typeof t!="object"||t instanceof Date?r.set_param_key_value(e,t):t instanceof ce?r.set_param_key_value(e,Le(t,o)):t instanceof Array?r.set_param_key_value(e,It(t,o)):r.set_param_key_value(e,Gt(t,o))}function lo(e,t){return y(this,null,function*(){if(t.dataModel||(yield pt(t)),!t.dataModel)throw new f("knowledge-graph:data-model-undefined","Encoding could not proceed because a data model was not provided and it could not be determined from the service");let r=yield ee(),o=!!e.options?.cascadeDelete,i=new r.GraphApplyEditsEncoder(r.SpatialReferenceUtil.WGS84(),e.options?.inputQuantizationParameters?sr(e.options?.inputQuantizationParameters):r.InputQuantizationUtil.WGS84_lossless());i.deleteLater(),i.cascade_delete=o;try{let s;e.entityAdds?.forEach(d=>{s=i.add_entity(Ge(d,r)),Re(s,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")}),e.relationshipAdds?.forEach(d=>{if(!d.originId||!d.destinationId)throw new f("knowledge-graph:relationship-origin-destination-missing","When adding a new relationship, you must provide both an origin and destination id on the appropriate class property");s=i.add_relationship(Ge(d,r)),Re(s,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")}),e.entityUpdates?.forEach(d=>{if(!d.id)throw new f("knowledge-graph:entity-id-missing","When updating an entity or relationship, you must specify the id on the class level property");s=i.update_entity(Ge(d,r)),Re(s,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")}),e.relationshipUpdates?.forEach(d=>{if(!d.id)throw new f("knowledge-graph:relationship-id-missing","When updating an entity or relationship, you must specify the id on the class level property");s=i.update_relationship(Ge(d,r)),Re(s,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")}),e.entityDeletes?.forEach(d=>{if(!d.typeName)throw new f("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");let l=i.make_delete_helper(d.typeName,!0);l.deleteLater(),d.ids?.forEach(m=>{l.delete_by_id(m)})}),e.relationshipDeletes?.forEach(d=>{if(!d.typeName)throw new f("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");let l=i.make_delete_helper(d.typeName,!1);d.ids?.forEach(m=>{l.delete_by_id(m)})}),i.encode()}catch(s){throw new f("knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed",{error:s})}let a=i.get_encoding_result();return Re(a.error,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed"),a.get_byte_buffer()})}function uo(e,t){return y(this,null,function*(){let r=yield ee(),o=new r.GraphQueryRequestEncoder;if(o.deleteLater(),o.output_spatial_reference=r.SpatialReferenceUtil.WGS84(),o.open_cypher_query=e.openCypherQuery,e.bindParameters)for(let[a,s]of Object.entries(e.bindParameters))po(a,s,o,r);if(e.bindGeometryQuantizationParameters)ir(e.bindGeometryQuantizationParameters,o);else{if(t.dataModel||(yield pt(t)),t.dataModel?.spatialReference?.wkid!==4326)throw new f("knowledge-graph:SR-quantization-mismatch","If the DataModel indicates a coordinate system other than WGS84, inputQuantizationParameters must be provided to the query encoder");o.input_quantization_parameters=r.InputQuantizationUtil.WGS84_lossless()}e.outputQuantizationParameters&&ar(e.outputQuantizationParameters,o,r);try{o.encode()}catch(a){throw new f("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{error:a})}let i=o.get_encoding_result();if(i.error.error_code!==0)throw new f("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{errorCode:i.error.error_code,errorMessage:i.error.error_message});return i.get_byte_buffer()})}function mo(e){return y(this,null,function*(){let t=yield ee(),r=new t.GraphSearchRequestEncoder;if(r.deleteLater(),r.search_query=e.searchQuery,r.type_category_filter=t.esriNamedTypeCategory[e.typeCategoryFilter],e.returnSearchContext===!0&&(r.return_search_context=e.returnSearchContext),e.start!=null&&e.start>0&&(r.start_index=e.start),e.num!=null&&(r.max_num_results=e.num),e.idsFilter!=null&&Array.isArray(e.idsFilter)&&e.idsFilter.length>0)try{r.set_ids_filter(It(e.idsFilter,t))}catch(i){throw new f("knowledge-graph:ids-format-error","Attempting to set ids filter failed.  This is usually caused by an incorrectly formatted UUID string",{error:i})}e.namedTypesFilter?.forEach(i=>{r.add_named_type_filter(i)});try{r.encode()}catch(i){throw new f("knowledge-graph:search-encoding-failed","Attempting to encode the search failed",{error:i})}let o=r.get_encoding_result();if(o.error.error_code!==0)throw new f("knowledge-graph:search-encoding-failed","Attempting to get encoding result from the query failed",{errorCode:o.error.error_code,errorMessage:o.error.error_message});return o.get_byte_buffer()})}function Ft(e,t){return y(this,null,function*(){return me(e,{responseType:"native-request-init",method:"post",query:ue({f:"pbf"},t?.query),body:"x",headers:{"Content-Type":"application/octet-stream"},signal:t?.signal,timeout:t?.timeout})})}function co(e){return y(this,null,function*(){let t=e.headers.get("content-type");if(t?.includes("application/x-protobuf")){let r=yield e.arrayBuffer(),o=new(yield ee()).GraphApplyEditsDecoder;return o.deleteLater(),o.decode(new Uint8Array(r)),Er(o)}throw new f("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:t,data:e.text()})})}function Ot(e,t,r){e.push_buffer(new Uint8Array(t));let o=[],i=0;for(;e.next_row();){i||(i=e.get_header_keys().size());let a=new Array(i);for(let s=0;s<i;s++){let d=e.get_value(s);a[s]=st(d,r)}o.push(a)}if(e.has_error())throw new f("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded",{errorCode:e.error.error_code,errorMessage:e.error.error_message});return o}function xr(e,t){return y(this,null,function*(){let r=e.headers.get("content-type");if(e.headers.get("content-length")&&Y.getLogger("esri.rest.knowledgeGraph.knowledgeGraphService").warnOnce("Found `Content-Length` header when expecting a streaming HTTP response! Please investigate whether all intermediate HTTP proxies and/or load balancers are configured such that they don't forcefully buffer the entire response before returning it to the client. A valid HTTP streaming response should use Chunked Transfer Encoding and not have a Content Length defined."),r?.includes("application/x-protobuf")){let a,o=e.body?.getReader(),i=new(yield ee()).GraphQueryDecoder;return i.deleteLater(),new ReadableStream({start(s){return y(this,null,function*(){try{return d()}catch(l){o?.releaseLock(),s.error(new f("knowledge-graph:stream-decoding-error","The server returned a valid response, but there was an error decoding the response stream",{error:l})),s.close()}function d(){return o?.read().then(({done:l,value:m})=>{if(l){let E;if(i.has_error()&&(E=new f("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded",{errorCode:i.error.error_code,errorMessage:i.error.error_message})),o.releaseLock(),E)throw s.error(E),E;return void s.close()}let h=Ot(i,m,t);return h.length>0&&s.enqueue(h),d()})}})}})}throw new f("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:r,data:e.text()})})}function Mr(e){return y(this,null,function*(){let t=`${e.url}/dataModel/queryDataModel`,r=yield me(t,{responseType:"array-buffer",query:{f:"pbf"}}),o=r.getHeader?.("content-type"),i=r.data;if(o?.includes("application/x-protobuf")){let a=(yield ee()).decode_data_model_from_protocol_buffer(new Uint8Array(i));if(!a)throw new f("knowledge-graph:data-model-decode-failure","The server responded to the data model query, but the response failed to be decoded.  This typically occurs when the Knowledge JS API (4.26 or later) is used with an unsupported backend (11.0 or earlier)");return lr(a)}throw new f("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:o,data:r.data})})}var lt=class extends q{constructor(e){super(e),this.openCypherQuery=""}};n([p()],lt.prototype,"openCypherQuery",void 0),lt=n([T("esri.rest.knowledgeGraph.GraphQuery")],lt);var Cr=lt;var _e=class extends Cr{constructor(e){super(e),this.bindParameters=null,this.bindGeometryQuantizationParameters=null,this.outputQuantizationParameters=null}};n([p()],_e.prototype,"bindParameters",void 0),n([p()],_e.prototype,"bindGeometryQuantizationParameters",void 0),n([p()],_e.prototype,"outputQuantizationParameters",void 0),_e=n([T("esri.rest.knowledgeGraph.GraphQueryStreaming")],_e);var de=_e;function Lr(e){if(!e.spatialReference.isWGS84)throw new f("knowledge-graph:layer-support-utils","The extentToInBoundsRings function only supports WGS84 spatial references.");let t;return t=e.xmax>180&&e.xmin<180?[[[e.xmin,e.ymin],[e.xmin,e.ymax],[180,e.ymax],[180,e.ymin],[e.xmin,e.ymin]],[[-180,e.ymin],[-180,e.ymax],[e.xmax-360,e.ymax],[e.xmax-360,e.ymin],[-180,e.ymin]]]:e.xmax>180&&e.xmin>180?[[[e.xmin-360,e.ymin],[e.xmin-360,e.ymax],[e.xmax-360,e.ymax],[e.xmax-360,e.ymin],[e.xmin-360,e.ymin]]]:e.xmax>-180&&e.xmin<-180?[[[e.xmin+360,e.ymin],[e.xmin+360,e.ymax],[180,e.ymax],[180,e.ymin],[e.xmin+360,e.ymin]],[[-180,e.ymin],[-180,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[-180,e.ymin]]]:e.xmax<-180&&e.xmin<-180?[[[e.xmin+360,e.ymin],[e.xmin+360,e.ymax],[e.xmax+360,e.ymax],[e.xmax+360,e.ymin],[e.xmin+360,e.ymin]]]:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]],t}function Ir(e,t){return y(this,null,function*(){let r=[],o=new Map,i=[];if(t.dataModel?.relationshipTypes)for(let a of t.dataModel.relationshipTypes)a.name&&o.set(a.name,[]);for(let a of e)o.has(a.typeName)&&o.get(a.typeName)?.push(a.id);for(let[a,s]of o){if(s.length<1)continue;let d=new de({openCypherQuery:`MATCH (n)-[r:${a}]->(m) WHERE id(r) in $ids RETURN id(n), labels(n)[0], id(m), labels(m)[0]`,bindParameters:{ids:s}});i.push(be(t,d).then(l=>y(this,null,function*(){let m=l.resultRowsStream.getReader();for(;;){let{done:h,value:E}=yield m.read();if(h)break;for(let g of E)r.push({id:g[0],typeName:g[1]}),r.push({id:g[2],typeName:g[3]})}})))}return yield Promise.all(i),r})}var I="ESRI__ID",Ee="ESRI__ORIGIN_ID",dt="ESRI__DESTINATION_ID",S="ESRI__LAYOUT_GEOMETRY",ae=12,Gr=Y.getLogger("esri.rest.knowledgeGraph.knowledgeGraphLayer.KnowledgeGraphLayerDataManager"),B=class extends q{constructor(e){super(e),this.inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},this.entityTypeNames=new Set,this.relationshipTypeNames=new Set,this.geographicLookup=new Map,this.sublayerCaches=new Map,this.nodeConnectionsLookup=new Map,this.memberIdTypeLookup=new Map,this._processingCacheUpdatesLookup=new Map;let t=new Map;e.knowledgeGraph.dataModel.entityTypes?.forEach(r=>{r.name&&(t.set(r.name,"entity"),this._processingCacheUpdatesLookup.set(r.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.entityTypeNames.add(r.name),r.properties?.forEach(o=>{o.geometryType&&o.geometryType!=="esriGeometryNull"&&this.geographicLookup.set(r.name,{name:o.name??"",geometryType:o.geometryType})}))}),e.knowledgeGraph.dataModel.relationshipTypes?.forEach(r=>{r.name&&(t.set(r.name,"relationship"),this._processingCacheUpdatesLookup.set(r.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.relationshipTypeNames.add(r.name),r.properties?.forEach(o=>{o.geometryType&&o.geometryType!=="esriGeometryNull"&&this.geographicLookup.set(r.name,{name:o.name??"",geometryType:o.geometryType})}))}),e.inclusionModeDefinition?.namedTypeDefinitions.forEach((r,o)=>{if(t.get(o)==="entity")this.entityTypeNames.add(o);else{if(t.get(o)!=="relationship")return Gr.warn(`A named type, ${o}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(o);this.relationshipTypeNames.add(o)}let i=new Map;r.members?.forEach(a=>{this.memberIdTypeLookup.set(a.id,o);let s=this.getById(a.id);s&&i.set(a.id,s)}),this.sublayerCaches.set(o,i)})}addToLayer(e){e.forEach(({typeName:t,id:r})=>{if(!this.inclusionModeDefinition)throw new f("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(this.inclusionModeDefinition.namedTypeDefinitions.has(t)){if(this.inclusionModeDefinition.namedTypeDefinitions.has(t)){let o=this.inclusionModeDefinition.namedTypeDefinitions.get(t);o.members||(o.members=new Map),o.members.set(r,{id:r}),this.memberIdTypeLookup.set(r,t)}}else{let o=new Map;o.set(r,{id:r}),this.inclusionModeDefinition.namedTypeDefinitions.set(t,{useAllData:!1,members:o}),this.memberIdTypeLookup.set(r,t)}})}getById(e){return ye.getInstance().readFromStoreById(e)}getData(e,t,r){return y(this,null,function*(){if(t.objectType.name&&this.inclusionModeDefinition?.namedTypeDefinitions&&this.inclusionModeDefinition.namedTypeDefinitions.size>0&&!this.inclusionModeDefinition.namedTypeDefinitions.has(t.objectType.name))return[];let o;if(o=e||new re({where:"1=1",outFields:["*"]}),t.parentCompositeLayer.type==="link-chart"){let i=t.parentCompositeLayer,a=this._processingCacheUpdatesLookup.get(t.objectType.name??""),s=o.outFields,d=o.geometry,l="",m="";d&&d.extent&&(l=Z(d.extent.ymin,d.extent.xmin,ae),m=Z(d.extent.ymax,d.extent.xmax,ae)),s&&s.length===1&&s[0]===I&&o.where==="1=1"||(yield Promise.all(a??[]));let h=this.sublayerCaches.has(t.objectType.name??"")?Array.from(this.sublayerCaches.get(t.objectType.name)?.values()):[],E=[];return h.forEach(g=>{if(g.geometry=i.linkChartDiagramLookup.get(g.attributes[t.objectIdField]),g.attributes[S]=g.geometry,l&&m){let c=i.linkChartGeohashLookup.get(g.attributes[t.objectIdField]);c?c>=l&&c<=m&&E.push(g):E.push(g)}else E.push(g)}),E}return this.retrieveDataFromService(o,t,r)})}getConnectedRecordIds(e){return y(this,null,function*(){let t=[],r=[],o=new Map;return e.forEach(i=>{if(this.memberIdTypeLookup.has(i)){let a=this.memberIdTypeLookup.get(i);if(!this.entityTypeNames.has(a))return;o.has(a)?o.get(a)?.push(i):o.set(a,[i])}}),o.forEach((i,a)=>{let s=`MATCH (n:${a})-[r]-(m) WHERE id(n) IN $ids RETURN id(r), type(r), id(m), labels(m)[0]`,d=new Promise(l=>{(()=>y(this,null,function*(){let m=(yield be(this.knowledgeGraph,new de({openCypherQuery:s,bindParameters:{ids:i}}))).resultRowsStream.getReader();try{for(;;){let{done:h,value:E}=yield m.read();if(h)break;for(let g=0;g<E.length;g++){let c=E[g];t.push({id:c[0],typeName:c[1]}),t.push({id:c[2],typeName:c[3]})}}}catch(h){if(h.name!=="AbortError")throw h;Gr.info("Request aborted as expected")}}))().then(()=>{l()})});r.push(d)}),yield Promise.all(r),t})}refreshCacheContent(e,t,r,o=!0){return y(this,null,function*(){let i=ye.getInstance(),a=[],s=new Map,d=new Map;this.knowledgeGraph.dataModel.entityTypes?.forEach(l=>{l.name&&d.set(l.name,l)}),this.knowledgeGraph.dataModel.relationshipTypes?.forEach(l=>{l.name&&d.set(l.name,l)}),e||this.inclusionModeDefinition?e?e.forEach(l=>{if(this.memberIdTypeLookup.has(l)){let m=this.memberIdTypeLookup.get(l);s.has(m)?s.get(m)?.push(l):s.set(m,[l])}}):this.inclusionModeDefinition?.namedTypeDefinitions?.forEach((l,m)=>{l.useAllData?s.set(m,null):l.members&&l.members.forEach(h=>{s.has(m)&&s.get(m)!==null?s.get(m)?.push(h.id):s.set(m,[h.id])})}):(this.knowledgeGraph.dataModel.entityTypes?.forEach(l=>{l.name&&s.set(l.name,null)}),this.knowledgeGraph.dataModel.entityTypes?.forEach(l=>{l.name&&s.set(l.name,null)}));for(let[l,m]of s){let h=new Promise(E=>{(()=>y(this,null,function*(){let c=new Set,L=[],b,G="",M=!1;if(t||d.get(l)?.properties?.forEach(x=>{x.name&&c.add(x.name)}),r&&this.geographicLookup.has(l)){let x=this.geographicLookup.get(l)?.name;x&&c.add(x)}if(this.entityTypeNames.has(l))G=`MATCH (n:${l}) ${m?"WHERE id(n) IN $ids ":""}return ID(n)`,c.forEach(x=>{G+=`, n.${x}`,L.push(x)});else{if(!this.relationshipTypeNames.has(l))throw new f("knowledge-graph:layer-data-manager",`The graph type of ${l} could not be determined. Was this type set in the KG data model and inclusion definition?`);M=!0,G=`MATCH ()-[n:${l}]->() ${m?"WHERE id(n) IN $ids ":""}return ID(n), id(startNode(n)), id(endNode(n))`,c.forEach(x=>{G+=`, n.${x}`,L.push(x)})}b=new de(m?{openCypherQuery:G,bindParameters:{ids:m}}:{openCypherQuery:G});let v=(yield be(this.knowledgeGraph,b)).resultRowsStream.getReader();for(;;){let{done:x,value:w}=yield v.read();if(x)break;let D=[];for(let _=0;_<w.length;_++){let C=w[_],P=0,$=0,A={properties:{}};for(A.id=C[P],P++,$++,M&&(A.originId=C[P],P++,$++,A.destinationId=C[P],P++,$++,wt(this.nodeConnectionsLookup,A.originId,()=>new Set).add(A.id),wt(this.nodeConnectionsLookup,A.destinationId,()=>new Set).add(A.id));P<C.length;P++)A.properties[L[P-$]]=C[P];D.push(A)}let k=i.writeToStore(D,I,this.geographicLookup.get(l)?.name);this.sublayerCaches.has(l)||this.sublayerCaches.set(l,new Map),o&&!this.inclusionModeDefinition?.namedTypeDefinitions.has(l)&&this.inclusionModeDefinition?.namedTypeDefinitions.set(l,{useAllData:!1,members:new Map}),o&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(l).members&&(this.inclusionModeDefinition.namedTypeDefinitions.get(l).members=new Map);let u=this.sublayerCaches.get(l);k.forEach(_=>{u?.set(_.attributes[I],_),o&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(l).members.has(_.attributes[I])&&(this.inclusionModeDefinition?.namedTypeDefinitions.get(l).members.set(_.attributes[I],{id:_.attributes[I]}),this.memberIdTypeLookup.set(_.attributes[I],l))})}}))().then(()=>{E(null)})});a.push(h),this._processingCacheUpdatesLookup.get(l)?.push(h)}yield Promise.all(a)})}removeFromLayer(e){let t=new Set,r=new Set(e.map(o=>o.id));for(let o of e)t.add(o.typeName),this.memberIdTypeLookup.delete(o.id),this.inclusionModeDefinition?.namedTypeDefinitions.forEach(i=>{i.members?.has(o.id)&&i.members.delete(o.id)});t.forEach(o=>{this.sublayerCaches.get(o)?.forEach((i,a)=>{r.has(a)&&this.sublayerCaches.get(o)?.delete(a)})})}retrieveDataFromService(e,t,r){return y(this,null,function*(){let o=ye.getInstance(),i=new Set,a=[],s,d="",l=[],m=t.graphType==="relationship",h=this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData,E=t.parentCompositeLayer.sublayerIdsCache.get(t.objectType.name),g=!h&&E?Array.from(E).sort():null;if(this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData)this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData&&e.objectIds!=null&&(g=e.objectIds);else if(e.objectIds!=null&&g&&g.length>0){let L=e.objectIds;e.objectIds=g.filter(b=>L.includes(b))}else if(e.objectIds!=null)g=e.objectIds;else{if(this.inclusionModeDefinition?.namedTypeDefinitions.has(t.objectType.name)&&(!this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members||this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members?.size<1))return e.objectIds=[],[];e.objectIds=g}if(e.outFields!=null){let L=e.outFields;L.includes("*")?t.fields.forEach(b=>{i.add(b.name)}):L.forEach(b=>{b!==I&&b!==t.geometryFieldName&&i.add(b)})}if(e.geometry!=null){let L=e.geometry,b,G=t.parentCompositeLayer.dataManager.knowledgeGraph.serviceDefinition,M=G?.spatialReference,v=G?.serviceCapabilities?.geometryCapabilities,x=v?.geometryMaxBoundingRectangleSizeX,w=v?.geometryMaxBoundingRectangleSizeY;if(L?.extent?.spatialReference&&!L.spatialReference?.isWGS84?(yield Ae(L.extent.spatialReference,ne),b=Me(L.extent,ne)):b=L.extent,x&&w&&M){if(M.wkid!==4326){let D=new te({spatialReference:M,xmax:x,ymax:w}),k=Me(D,ne);x=k.xmax,w=k.ymax}if(b.xmax-b.xmin>x)throw new f("knowledge-graph:layer-data-manager",`Extent x bounds should be within ${x}\xB0 latitude, limit exceeded`);if(b.ymax-b.ymin>w)throw new f("knowledge-graph:layer-data-manager",`Extent y bounds should be within ${w}\xB0 longitude, limit exceeded`)}if(e.where!=null&&e.where!=="1=1"){let D=yield bt(e.where.toUpperCase(),t.fieldsIndex);t.fields.forEach(k=>{D.fieldNames.includes(k.name)&&i.add(k.name)})}d=m?`Match ()-[n:${t.objectType.name}]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n), id(startNode(r)), id(endNode(r))`:`Match (n:${t.objectType.name}) WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n)`,t.geometryFieldName&&i.add(t.geometryFieldName),i.forEach(D=>{d+=`, n.${D}`,a.push(D)}),s=new de({openCypherQuery:d,bindParameters:{param_filter_geom:new K({rings:Lr(b)})}})}else{let L="";if(e.where!=null&&e.where!=="1=1"){let M=yield bt(e.where,t.fieldsIndex);t.fields.forEach(k=>{M.fieldNames.includes(k.name)&&i.add(k.name)});let v=new Set(["column-reference","string","number","binary-expression"]),x=new Set(["=","<","<=","<>",">",">=","AND","OR","LIKE"]),w=!1,D=k=>{if(k.type==="column-reference")return`n.${k.column}`;if(k.type==="string")return`'${k.value}'`;if(k.type==="number")return`${k.value}`;if(k.type==="binary-expression"&&v.has(k.left.type)&&v.has(k.right.type)&&x.has(k.operator))return`${D(k.left)} ${k.operator} ${D(k.right)}`;if(k.type==="binary-expression"&&k.operator==="LIKE"){let u="";if(k.left.type==="function"&&k.left.args.value[0].type==="column-reference")u+=`lower(n.${k.left.args.value[0].column})`;else{if(k.left.type!=="column-reference")return w=!0,"";u+=`lower(n.${k.left.column})`}if(u+=" CONTAINS (",k.right.type!=="string")return w=!0,"";{let _=k.right.value;_.charAt(0)==="%"&&(_=_.slice(1)),_.charAt(_.length-1)==="%"&&(_=_.slice(0,-1)),u+=`'${_.toLowerCase()}')`}return u}return w=!0,""};L=D(M.parseTree),w&&(L="")}let b="";b=m?`Match ()-[n:${t.objectType.name}]->()`:`Match (n:${t.objectType.name})`;let G=!1;g&&(G=!0,b+=" WHERE ID(n) IN $ids"),L&&(b+=G?" AND":" WHERE",b+=` ${L}`),b+=" return ID(n)",m&&(b+=", id(startNode(n)), id(endNode(n))"),e.returnGeometry&&t.geometryFieldName&&i.add(t.geometryFieldName),i.forEach(M=>{b+=`, n.${M}`,a.push(M)}),s=new de(g?{openCypherQuery:b,bindParameters:{ids:g}}:{openCypherQuery:b})}let c=(yield be(t.parentCompositeLayer.dataManager.knowledgeGraph,s,r)).resultRowsStream.getReader();for(;;){let{done:L,value:b}=yield c.read();if(L)break;let G=[];for(let M=0;M<b.length;M++){let v=b[M],x=0,w=0,D={properties:{}};for(D.id=v[x],x++,w++,m&&(D.originId=v[x],x++,w++,D.destinationId=v[x],x++,w++);x<v.length;x++)D.properties[a[x-w]]=v[x];G.push(D)}l=l.concat(o.writeToStore(G,I,t.parentCompositeLayer.dataManager.geographicLookup.get(t.objectType.name)?.name))}return l})}};n([p()],B.prototype,"knowledgeGraph",void 0),n([p()],B.prototype,"inclusionModeDefinition",void 0),n([p()],B.prototype,"entityTypeNames",void 0),n([p()],B.prototype,"relationshipTypeNames",void 0),n([p()],B.prototype,"geographicLookup",void 0),n([p()],B.prototype,"sublayerCaches",void 0),n([p()],B.prototype,"nodeConnectionsLookup",void 0),n([p()],B.prototype,"memberIdTypeLookup",void 0),B=n([T("esri.rest.knowledgeGraph.knowledgeGraphLayer.KnowledgeGraphLayerDataManager")],B);var vr=Zt(),Dr=e=>{let t=class extends e{constructor(){super(...arguments),this.fields=[],this.fieldsIndex=null}};return n([p(vr.fields)],t.prototype,"fields",void 0),n([p(vr.fieldsIndex)],t.prototype,"fieldsIndex",void 0),t=n([T("esri.layers.knowledgeGraphLayer.KnowledgeGraphSublayerBase")],t),t};var R=class extends Vt(Dr(Oe(je(Ht(Ue))))){constructor(e){if(super(e),this.capabilities=Yt(!1,!1),this.definitionExpression="",this.displayField="",this.elevationInfo=null,this.geometryType=null,this.geometryFieldName=null,this.graphType=null,this.hasM=!1,this.hasZ=!1,this.labelsVisible=null,this.labelingInfo=null,this.objectIdField=I,this.objectType=null,this.parentCompositeLayer=null,this.popupTemplate=null,this.source={openPorts:()=>this.load().then(()=>{let t=new MessageChannel;return new er(t.port1,{channel:t,client:{queryFeatures:(r,o={})=>{let i=re.fromJSON(r);return this.queryFeaturesJSON(i,o)}}}),[t.port2]})},this.type="knowledge-graph-sublayer",e.parentCompositeLayer.type==="link-chart")e.graphType==="relationship"?this.geometryType="polyline":this.geometryType="point",this.geometryFieldName=S;else if(e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name)?.geometryType&&e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name)?.geometryType!=="esriGeometryNull"){let t=e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name);this.geometryFieldName=t?.name??null,this.geometryType=t?.geometryType?se.fromJSON(t.geometryType):null;let r=t?.name,o=r?e.objectType.properties?.[r]:null;o?(this.hasM=o.hasM??!1,this.hasZ=o.hasZ??!1):(this.hasM=!1,this.hasZ=!1)}else this.geometryType=null;e.objectType.properties?.forEach(t=>{let r=null,o=t.fieldType;o==="esriFieldTypeOID"&&(o="esriFieldTypeInteger"),this.fields.push(_t.fromJSON({name:t.name,type:o,alias:t.alias,defaultValue:r,editable:t.editable,nullable:t.nullable}))}),this.fields.push(_t.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1})),this._set("fields",[...this.fields]),e.parentCompositeLayer.dataManager.knowledgeGraph.dataModel?.spatialReference&&(this.spatialReference=e.parentCompositeLayer.dataManager.knowledgeGraph.dataModel.spatialReference),e.parentCompositeLayer.type==="link-chart"?e.graphType==="relationship"?this.renderer=ze(Qe(se.toJSON("polyline")).renderer):this.renderer=ze(Qe(se.toJSON("point")).renderer):this.renderer=ze(Qe(se.toJSON(this.geometryType)).renderer)}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){tr(e,this.fieldsIndex),this._set("renderer",e)}createPopupTemplate(e){return Xt(this,e)}createQuery(){return new re({where:"1=1",outFields:["*"]})}getField(e){for(let t=0;t<this.fields.length;t++)if(this.fields[t].name===e)return this.fields[t];throw new Error("Field not found")}getFieldDomain(e,t){return null}queryFeatures(e,t){return y(this,null,function*(){let{resolvedQuery:r,queryEngine:o}=yield this._setupQueryObjects(e),i=Kt.fromJSON(yield o.executeQuery(r.toJSON(),t?.signal));return i.features.forEach(a=>{a.sourceLayer=this}),i})}queryFeaturesJSON(e,t){return y(this,null,function*(){let{resolvedQuery:r,queryEngine:o}=yield this._setupQueryObjects(e);return yield o.executeQuery(r.toJSON(),t?.signal)})}queryFeatureCount(e,t){return y(this,null,function*(){let{resolvedQuery:r,queryEngine:o}=yield this._setupQueryObjects(e);return o.executeQueryForCount(r.toJSON(),t?.signal)})}queryExtent(){return y(this,arguments,function*(e={},t){let r=At(ue({},e),{returnGeometry:!0}),{resolvedQuery:o,queryEngine:i}=yield this._setupQueryObjects(r),a=yield i.executeQueryForExtent(o.toJSON(),t?.signal),s;return s=a.extent?.xmin!=null&&a.extent?.xmax!=null&&a.extent?.ymin!=null&&a.extent?.ymax!=null?new te(a.extent):new te,{count:a.count,extent:s}})}queryObjectIds(e,t){return y(this,null,function*(){let r=re.from(e),o;if(this.parentCompositeLayer.type==="link-chart"&&this._cachedQueryEngine)o=this._cachedQueryEngine;else{let i=yield this.parentCompositeLayer.dataManager.getData(r,this,t);o=this.loadQueryEngine(i)}return o.executeQueryForIds(r.toJSON(),t?.signal)})}loadQueryEngine(e){let t=new Bt({geometryType:se.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),r=new Wt({fieldsIndex:this.fieldsIndex.toJSON(),geometryType:se.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:this.spatialReference.toJSON(),timeInfo:null,featureStore:t});return r.featureStore.addMany(e),r}refreshCachedQueryEngine(){return y(this,null,function*(){let e=yield this.parentCompositeLayer.dataManager.getData(new re({where:"1=1",outFields:[I]}),this);this._cachedQueryEngine=this.loadQueryEngine(e)})}_setupQueryObjects(e,t){return y(this,null,function*(){let r=re.from(e),o=r.geometry,i;if(o&&!o.spatialReference?.isWGS84&&(yield Ae(o.spatialReference,ne),r.geometry=Me(o instanceof K||o instanceof H?o:o.extent,ne)),this.parentCompositeLayer.type==="link-chart"&&this._cachedQueryEngine)i=this._cachedQueryEngine;else{let a=yield this.parentCompositeLayer.dataManager.getData(r,this,t);i=this.loadQueryEngine(a)}return{resolvedQuery:r,queryEngine:i}})}};n([p()],R.prototype,"capabilities",void 0),n([p({readOnly:!0})],R.prototype,"defaultPopupTemplate",null),n([p()],R.prototype,"definitionExpression",void 0),n([p()],R.prototype,"displayField",void 0),n([p()],R.prototype,"elevationInfo",void 0),n([p()],R.prototype,"geometryType",void 0),n([p()],R.prototype,"geometryFieldName",void 0),n([p()],R.prototype,"graphType",void 0),n([p()],R.prototype,"hasM",void 0),n([p()],R.prototype,"hasZ",void 0),n([p()],R.prototype,"labelsVisible",void 0),n([p()],R.prototype,"labelingInfo",void 0),n([p()],R.prototype,"objectIdField",void 0),n([p()],R.prototype,"objectType",void 0),n([p()],R.prototype,"parentCompositeLayer",void 0),n([p({type:$t,json:{name:"popupInfo",write:!0}})],R.prototype,"popupTemplate",void 0),n([p({types:Jt,json:{write:{target:"layerDefinition.drawingInfo.renderer"}}})],R.prototype,"renderer",null),n([p()],R.prototype,"source",void 0),n([p({json:{read:!1}})],R.prototype,"type",void 0),R=n([T("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],R);var ut=R;var jt,Q=null;function Or(){return jt||(jt=import("./chunk-UVVFZOFK.js").then(e=>e.l).then(({default:e})=>e({locateFile:t=>ke(`esri/libs/linkchartlayout/${t}`)})).then(e=>{yo(e)}),jt)}function yo(e){Q=e}var W;function xe(e,t,r,o,i,a){let s=r.length,d=i.length,l=Float64Array.BYTES_PER_ELEMENT,m=Uint32Array.BYTES_PER_ELEMENT,h=Uint8Array.BYTES_PER_ELEMENT,E=16,g=E-1+s*(h+2*l)+d*(2*m),c=Q._malloc(g);try{let L=c+E-c%E,b=L+s*l,G=b+s*l,M=G+d*m,v=M+d*m,x=()=>[Q.HEAPF64.subarray(L>>3,(L>>3)+s),Q.HEAPF64.subarray(b>>3,(b>>3)+s),Q.HEAPU32.subarray(G>>2,(G>>2)+d),Q.HEAPU32.subarray(M>>2,(M>>2)+d),Q.HEAPU8.subarray(v,v+s)],[w,D,k,u,_]=x();w.set(r),D.set(o),k.set(i),u.set(a),_.set(t);let C=e(s,v,L,b,d,G,M),[P,$,A,jr,Ar]=x();return r.set(P),o.set($),i.set(A),a.set(jr),t.set(Ar),C}finally{Q._free(c)}}(function(e){e[e.None=0]="None",e[e.IsMovable=1]="IsMovable",e[e.IsGeographic=2]="IsGeographic",e[e.IsRoot=4]="IsRoot"})(W||(W={}));var Sr=2,Rr=1,Nr=-1,mt,ct,yt,ht,ft,gt,Pr,Fr;(function(e){function t(){return Q.getMinIdealEdgeLength()}function r(o,i,a,s,d,l=Sr,m=Rr,h=Nr){return xe((E,g,c,L,b,G,M)=>Q.applyForceDirectedLayout(E,g,c,L,b,G,M,l,m,h),o,i,a,s,d)}e.getMinIdealEdgeLength=t,e.apply=r})(mt||(mt={})),function(e){function t(r,o,i,a,s,d=Sr,l=Rr,m=Nr){return xe((h,E,g,c,L,b,G)=>Q.applyCommunityLayout(h,E,g,c,L,b,G,d,l,m),r,o,i,a,s)}e.apply=t}(ct||(ct={})),function(e){function t(r,o,i,a,s){return xe(Q.applySimpleLayout,r,o,i,a,s)}e.apply=t}(yt||(yt={})),function(e){function t(r,o,i,a,s){return xe(Q.applyHierarchicalLayout,r,o,i,a,s)}e.apply=t}(ht||(ht={})),function(e){function t(r,o,i,a,s){return xe(Q.applyRadialTreeLayout,r,o,i,a,s)}e.apply=t}(ft||(ft={})),function(e){function t(r,o,i,a,s){return xe(Q.applySmartTreeLayout,r,o,i,a,s)}e.apply=t}(gt||(gt={})),function(e){e[e.Undirected=0]="Undirected",e[e.Directed=1]="Directed",e[e.Reversed=2]="Reversed"}(Pr||(Pr={})),function(e){e[e.ByCC_Raw=0]="ByCC_Raw",e[e.ByCC_NormalizeGlobally=1]="ByCC_NormalizeGlobally",e[e.ByCC_NormalizeByCC=2]="ByCC_NormalizeByCC"}(Fr||(Fr={}));var ho=(e,t,r)=>(e.has(t)||e.set(t,r()),e.get(t)),j=class extends Oe(je(Ue)){constructor(e){if(super(e),this.dataPreloadedInLocalCache=!1,this.defaultLinkChartConfig=null,this._currentLinkChartConfig={layoutMode:"RADIAL_TREE",xScaleFactor:1,yScaleFactor:1},this._graphTypeLookup=new Map,this.knowledgeGraph=null,this.layers=new Tt,this.linkChartDiagramLookup=new Map,this.linkChartExtent=new te({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7}),this.linkChartGeohashLookup=new Map,this.memberEntityTypes=null,this.memberRelationshipTypes=null,this.sublayerIdsCache=new Map,this.tables=new Tt,this.type="link-chart",this._originalInclusionList=e.inclusionModeDefinition,e.dataPreloadedInLocalCache&&!e.inclusionModeDefinition)throw new f("knowledge-graph:linkchart-layer-constructor","If creating a link chart composite layer and configured that data is already loaded in the cache, you must specify an inclusion list so the Composite Layer knows what records belong to it")}normalizeCtorArgs(e){return{url:e.url,title:e.title,dataPreloadedInLocalCache:e.dataPreloadedInLocalCache,defaultLinkChartConfig:e.defaultLinkChartConfig}}_initializeLayerProperties(e){if(!this.title&&this.url){let a=this.url.split("/");this.title=a[a.length-2]}let t=new Set,r=[],o=[];if(e.inclusionModeDefinition&&(!e.inclusionModeDefinition.namedTypeDefinitions||e.inclusionModeDefinition.namedTypeDefinitions.size<1))throw new f("knowledge-graph:composite-layer-constructor","If an explicit inclusion definition is defined, at least one namedTypeDefinition must also be defined");e.knowledgeGraph.dataModel.entityTypes?.forEach(a=>{a.name&&this._graphTypeLookup.set(a.name,a)}),e.knowledgeGraph.dataModel.relationshipTypes?.forEach(a=>{a.name&&this._graphTypeLookup.set(a.name,a)}),e.inclusionModeDefinition?.generateAllSublayers?(r=e.knowledgeGraph.dataModel.entityTypes??[],o=e.knowledgeGraph.dataModel.relationshipTypes??[]):e.inclusionModeDefinition?.namedTypeDefinitions&&e.inclusionModeDefinition?.namedTypeDefinitions.size>0?e.inclusionModeDefinition?.namedTypeDefinitions.forEach((a,s)=>{if(!this._graphTypeLookup.get(s))return Y.getLogger(this).warn(`A named type, ${s}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(s);this._graphTypeLookup.get(s)instanceof fe||"strictOrigin"in this._graphTypeLookup.get(s)?t.has(s)||(t.add(s),o.push(this._graphTypeLookup.get(s))):this._graphTypeLookup.get(s)instanceof he||"properties"in this._graphTypeLookup.get(s)?t.has(s)||(t.add(s),r.push(this._graphTypeLookup.get(s))):(Y.getLogger(this).warn(`A named type, ${s}, was in the inclusion list that wasn't properly modeled and will be removed`),e.inclusionModeDefinition?.namedTypeDefinitions.delete(s))}):(r=e.knowledgeGraph.dataModel.entityTypes??[],o=e.knowledgeGraph.dataModel.relationshipTypes??[]);let i=new B({knowledgeGraph:e.knowledgeGraph,inclusionModeDefinition:e.inclusionModeDefinition});this.knowledgeGraph=e.knowledgeGraph,this.memberEntityTypes=r,this.memberRelationshipTypes=o,this.dataManager=i}load(e){return this.addResolvingPromise(new Promise(t=>{kr(this.url).then(r=>{if(this._initializeLayerProperties({knowledgeGraph:r,inclusionModeDefinition:this._originalInclusionList}),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.size||(this.dataManager.inclusionModeDefinition={generateAllSublayers:!1,namedTypeDefinitions:new Map},this.dataManager.knowledgeGraph.dataModel.entityTypes?.forEach(o=>{o.name&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.set(o.name,{useAllData:!0})}),this.dataManager.knowledgeGraph.dataModel.relationshipTypes?.forEach(o=>{o.name&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.set(o.name,{useAllData:!0})})),this.dataPreloadedInLocalCache)this.loadLayerAssumingLocalCache(),this.dataManager.inclusionModeDefinition&&(this.dataManager.inclusionModeDefinition.generateAllSublayers=!1),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach(o=>{o.useAllData=!1,o.members?.forEach(i=>{let a;a=i.linkChartLocation instanceof xt?i.linkChartLocation:i.linkChartLocation?V(i.linkChartLocation):null,this.linkChartDiagramLookup.set(i.id,a),a&&a.coords.length===2&&a.lengths.length===0?this.linkChartGeohashLookup.set(i.id,Z(a.coords[1],a.coords[0],ae)):this.linkChartGeohashLookup.set(i.id,"")}),this.addResolvingPromise(this._initializeDiagram().then(()=>y(this,null,function*(){this.layers.forEach(i=>y(this,null,function*(){yield i.refreshCachedQueryEngine()})),this.tables.forEach(i=>y(this,null,function*(){yield i.refreshCachedQueryEngine()}))})))});else{let o=this.defaultLinkChartConfig?.layoutMode==="GEOGRAPHIC";this.addResolvingPromise(this.dataManager.refreshCacheContent(void 0,!1,o,!0).then(()=>y(this,null,function*(){zt(e);let i=[],a=[];this.loadLayerAssumingLocalCache(),this.dataManager.inclusionModeDefinition&&(this.dataManager.inclusionModeDefinition.generateAllSublayers=!1,this.dataManager.inclusionModeDefinition.namedTypeDefinitions.forEach(s=>{s.useAllData=!1})),yield this._initializeDiagram(),this.layers.forEach(s=>{a.push(s.refreshCachedQueryEngine()),i.push(new Promise(d=>{s.on("layerview-create",()=>{d(null)})}))}),this.tables.forEach(s=>{a.push(s.refreshCachedQueryEngine())}),yield Promise.all(a)})))}t(null)})})),Promise.resolve(this)}addRecords(e,t){return y(this,null,function*(){let r=[];t?.cascadeAddRelationshipEndNodes&&this.dataManager.knowledgeGraph.dataModel&&(r=yield Ir(e,this.dataManager.knowledgeGraph));let o=e.concat(r).filter(i=>!this.sublayerIdsCache.get(i.typeName)?.has(i.id));yield this._handleNewRecords(o)})}removeRecords(o){return y(this,arguments,function*(e,{cascadeRemoveRelationships:t=!0,recalculateLayout:r=!1}={cascadeRemoveRelationships:!0,recalculateLayout:!1}){let i=[];for(let s of e)this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.get(s.typeName)?.useAllData===!1&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.get(s.typeName)?.members?.has(s.id)&&i.push(s);if(t){let s=new Set,d=[];for(let l of i)if(this.dataManager.nodeConnectionsLookup.has(l.id))for(let m of this.dataManager.nodeConnectionsLookup.get(l.id))s.add(m);for(let l of s)this.dataManager.memberIdTypeLookup.has(l)&&d.push({id:l,typeName:this.dataManager.memberIdTypeLookup.get(l)});i=i.concat(d)}this.dataManager.removeFromLayer(i);for(let s of i)this.sublayerIdsCache.get(s.typeName)?.delete(s.id),this.linkChartDiagramLookup.delete(s.id);r&&(yield this.calculateLinkChartLayout(this._currentLinkChartConfig.layoutMode,{xScaleFactor:this._currentLinkChartConfig.xScaleFactor,yScaleFactor:this._currentLinkChartConfig.xScaleFactor}));let a=[];return this.layers.forEach(s=>{a.push(s.refreshCachedQueryEngine())}),yield Promise.all(a),this._refreshNamedTypes(),i})}expand(e){return y(this,null,function*(){let t=yield this.dataManager.getConnectedRecordIds(e),r=t.filter(o=>!this.sublayerIdsCache.get(o.typeName)?.has(o.id));return yield this._handleNewRecords(t),{records:r}})}loadLayerAssumingLocalCache(){this.memberRelationshipTypes.forEach(e=>{let t=new ut({objectType:e,parentCompositeLayer:this,graphType:"relationship",title:e.name});t.geometryType?this.layers.push(t):this.tables.push(t),this.dataManager.sublayerCaches.has(e.name)||this.dataManager.sublayerCaches.set(e.name,new Map)}),this.memberEntityTypes.forEach(e=>{let t=new ut({objectType:e,parentCompositeLayer:this,graphType:"entity",title:e.name});t.geometryType?this.layers.push(t):this.tables.push(t),this.dataManager.sublayerCaches.has(e.name)||this.dataManager.sublayerCaches.set(e.name,new Map)}),this.dataManager.inclusionModeDefinition?.namedTypeDefinitions&&this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach((e,t)=>{let r=ho(this.sublayerIdsCache,t,()=>new Set);e.members?.forEach(o=>{if(r.add(o.id),o.linkChartLocation)if(o.linkChartLocation instanceof xt)this.linkChartDiagramLookup.set(o.id,o.linkChartLocation),o.linkChartLocation.coords.length===2&&o.linkChartLocation.lengths.length===0?this.linkChartGeohashLookup.set(o.id,Z(o.linkChartLocation.coords[1],o.linkChartLocation.coords[0],ae)):this.linkChartGeohashLookup.set(o.id,"");else{let i=V(o.linkChartLocation);this.linkChartDiagramLookup.set(o.id,o.linkChartLocation?i:null),"x"in o.linkChartLocation&&"y"in o.linkChartLocation?this.linkChartGeohashLookup.set(o.id,Z(o.linkChartLocation.x,o.linkChartLocation.y,ae)):this.linkChartGeohashLookup.set(o.id,"")}})})}calculateLinkChartLayout(e="RADIAL_TREE",t){return y(this,null,function*(){let r=[],o=[];this.dataManager.sublayerCaches.forEach((u,_)=>{this.dataManager.entityTypeNames.has(_)?u.forEach(C=>{r.push({typeName:_,feature:C})}):this.dataManager.relationshipTypeNames.has(_)&&u.forEach(C=>{o.push({typeName:_,feature:C})})}),this.linkChartDiagramLookup=new Map;let i=new Map,a=new Map,s=new Map,d=new Map,l=new Uint8Array(r.length),m=new Float64Array(r.length),h=new Float64Array(r.length),E=new Uint32Array(o.length),g=new Uint32Array(o.length),c=[],L="FORCE_DIRECTED",b=t?.xScaleFactor??1,G=t?.yScaleFactor??1,M=new te({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7}),v,x="FORCE_DIRECTED",w=0,D=0;switch(x=e==="GEOGRAPHIC"?L:e,x){case"FORCE_DIRECTED":v=mt.apply;break;case"COMMUNITY":v=ct.apply;break;case"HIERARCHICAL":v=ht.apply;break;case"RADIAL_TREE":v=ft.apply;break;case"SMART_TREE":v=gt.apply;break;default:v=yt.apply}r.forEach(({typeName:u,feature:_})=>{if(t?.lockedNodeLocations?.has(_.attributes[I])){e==="GEOGRAPHIC"&&this.dataManager.geographicLookup.has(u)?l[w]=W.IsGeographic:l[w]=W.None;let C=t.lockedNodeLocations.get(_.attributes[I]);m[w]=C.x,h[w]=C.y}else if(e==="GEOGRAPHIC"&&this.dataManager.geographicLookup.has(u)){l[w]=W.IsGeographic;let C=null,P=_.attributes[this.dataManager.geographicLookup.get(u).name];switch(this.dataManager.geographicLookup.get(u)?.geometryType){case"esriGeometryPoint":m[w]=P?.x,h[w]=P?.y;break;case"esriGeometryPolygon":C=P?.centroid,C?.x!=null&&C?.y!=null?(m[w]=C.x,h[w]=C.y):l[w]=W.IsMovable;break;case"esriGeometryPolyline":case"esriGeometryMultipoint":C=P?.extent?.center,C?.x!=null&&C?.y!=null?(m[w]=C.x,h[w]=C.y):l[w]=W.IsMovable;break;default:l[w]=W.IsMovable}(m[w]==null||h[w]==null||Number.isNaN(m[w])||Number.isNaN(h[w]))&&(l[w]=W.IsMovable,m[w]=0,h[w]=0)}else l[w]=W.IsMovable,m[w]=0,h[w]=0;d.set(_.attributes[I],w),c[w]={feature:_,typeName:u},w++});let k=!1;if(o.forEach(u=>{let _=d.get(u.feature.attributes[Ee]),C=d.get(u.feature.attributes[dt]);_!==void 0&&C!==void 0?(E[D]=_,g[D]=C,D++):(k=!0,this.linkChartDiagramLookup.set(u.feature.attributes[Ee],null),this.linkChartGeohashLookup.set(u.feature.attributes[Ee],null))}),k&&Y.getLogger(this).warn("A relationship is a member of this layer that has either origin or destination entity nodes that are not members. The diagram geometry will be set to null"),yield Or(),!v(l,m,h,E,g))throw new f("knowledge-graph:layout-failed","Attempting to arrange the records in the specified layout failed");for(let u=0;u<c.length;u++){if(l[u]===W.IsMovable&&(m[u]=m[u]*b,h[u]=h[u]*G),h[u]>84.9999&&(h[u]=84.9999),h[u]<-84.9999&&(h[u]=-84.9999),m[u]>179.9999&&(m[u]=179.9999),m[u]<-179.9999&&(m[u]=-179.9999),c[u].feature.attributes[S]=new J(m[u],h[u]),i.has(c[u].typeName))i.get(c[u].typeName)?.set(c[u].feature.attributes[I],c[u].feature);else{let C=new Map;C.set(c[u].feature.attributes[I],c[u].feature),i.set(c[u].typeName,C)}s.set(c[u].feature.attributes[I],c[u].feature);let _=V(c[u].feature.attributes[S]);this.linkChartDiagramLookup.set(c[u].feature.attributes[I],c[u].feature.attributes[S]?_:null),this.linkChartGeohashLookup.set(c[u].feature.attributes[I],Z(c[u].feature.attributes[S].y,c[u].feature.attributes[S].x,ae)),c[u].feature.attributes[S].x<M.xmin&&(M.xmin=c[u].feature.attributes[S].x),c[u].feature.attributes[S].x>M.xmax&&(M.xmax=c[u].feature.attributes[S].x),c[u].feature.attributes[S].y<M.ymin&&(M.ymin=c[u].feature.attributes[S].y),c[u].feature.attributes[S].y>M.ymax&&(M.ymax=c[u].feature.attributes[S].y)}return this.linkChartExtent.xmin=M.xmin,this.linkChartExtent.xmax=M.xmax,this.linkChartExtent.ymin=M.ymin,this.linkChartExtent.ymax=M.ymax,o.forEach(u=>{let _=c[d.get(u.feature.attributes[Ee])]?.feature.attributes[S],C=c[d.get(u.feature.attributes[dt])]?.feature.attributes[S];if(!_||!C)return;let P=new H({paths:[[_.x,_.y],[C.x,C.y]]});if(u.feature.attributes[S]=P,a.has(u.typeName))a.get(u.typeName)?.set(u.feature.attributes[I],u.feature);else{let A=new Map;A.set(u.feature.attributes[I],u.feature),a.set(u.typeName,A)}s.set(u.feature.attributes[I],u.feature);let $=V(u.feature.attributes[S]);this.linkChartDiagramLookup.set(u.feature.attributes[I],u.feature.attributes[S]?$:null),this.linkChartGeohashLookup.set(u.feature.attributes[I],"")}),this._currentLinkChartConfig={layoutMode:e,xScaleFactor:b,yScaleFactor:G},{nodes:i,links:a,idMap:s}})}applyNewLinkChartLayout(e="RADIAL_TREE",t){return y(this,null,function*(){let r=[];yield this.calculateLinkChartLayout(e,t),this.layers.forEach(o=>{r.push(o.refreshCachedQueryEngine())}),yield Promise.all(r),this._refreshNamedTypes()})}getCurrentNodeLocations(){let e=new Map;return this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.forEach(t=>{t?.members?.forEach(r=>{let o=r.linkChartLocation,i,a=r.id;o&&(i="x"in o?{x:o.x,y:o.y}:{x:o.coords[0],y:o.coords[1]},e.set(a,new J({x:i.x,y:i.y})))})}),e}synchronizeInclusionListWithCache(){return y(this,null,function*(){return new Promise(e=>{this.dataManager.inclusionModeDefinition?.namedTypeDefinitions.forEach((t,r)=>{if(t.useAllData=!1,t.members&&t.members.size>0){if(!this.dataManager.sublayerCaches.get(r))return;let o=new Set(Array.from(this.dataManager.sublayerCaches.get(r).keys()));Array.from(t.members.keys()).filter(i=>!o.has(i)).forEach(i=>{t.members?.delete(i)})}}),e()})})}refreshLinkChartCache(e){return y(this,null,function*(){yield this.dataManager.refreshCacheContent(e);let t=[];this.layers.forEach(r=>{t.push(r.refreshCachedQueryEngine())}),yield Promise.all(t),this._refreshNamedTypes()})}_handleNewRecords(e){return y(this,null,function*(){let t=[];this.dataManager.addToLayer(e);for(let r of e)this.sublayerIdsCache.has(r.typeName)||(this.sublayerIdsCache.set(r.typeName,new Set),t.push(r.typeName)),this.sublayerIdsCache.get(r.typeName).add(r.id);for(let r of t)if(this._graphTypeLookup.has(r)){let o=this._graphTypeLookup.get(r),i="endPoints"in o?"relationship":"entity",a=new ut({objectType:o,parentCompositeLayer:this,graphType:i,title:r});i==="entity"?this.dataManager.entityTypeNames.add(r):this.dataManager.relationshipTypeNames.add(r),a.geometryType?this.layers.push(a):this.tables.push(a),this.dataManager.sublayerCaches.set(r,new Map)}yield this.dataManager.refreshCacheContent(e.map(r=>r.id)),yield this.applyNewLinkChartLayout(this._currentLinkChartConfig.layoutMode,{xScaleFactor:this._currentLinkChartConfig.xScaleFactor,yScaleFactor:this._currentLinkChartConfig.xScaleFactor})})}_initializeDiagram(){return y(this,null,function*(){this.defaultLinkChartConfig?this.defaultLinkChartConfig.doNotRecalculateLayout?(this.dataManager.inclusionModeDefinition?.namedTypeDefinitions?.forEach(e=>{e?.members?.forEach(t=>{let r=t.linkChartLocation,o,i=t.id;if(!r)return;o="x"in r?{x:r.x,y:r.y}:{x:r.coords[0],y:r.coords[1]};let a=V(o);this.linkChartDiagramLookup.set(i,a),this.linkChartGeohashLookup.set(i,Z(o.x,o.y,ae)),this.linkChartExtent.xmin>o.x&&(this.linkChartExtent.xmin=o.x),this.linkChartExtent.xmax<o.x&&(this.linkChartExtent.xmax=o.x),this.linkChartExtent.ymin>o.y&&(this.linkChartExtent.ymin=o.y),this.linkChartExtent.ymax<o.y&&(this.linkChartExtent.ymax=o.y)})}),this.memberRelationshipTypes.forEach(e=>{e.name&&this.dataManager.sublayerCaches.get(e.name)?.forEach(t=>{let r=this.linkChartDiagramLookup.get(t.attributes[Ee]),o=this.linkChartDiagramLookup.get(t.attributes[dt]);if(r&&o){let i=V(new H({paths:[[r.coords[0],r.coords[1]],[o.coords[0],o.coords[1]]]}));this.linkChartDiagramLookup.set(t.attributes[I],i)}else this.linkChartDiagramLookup.set(t.attributes[I],null);this.linkChartGeohashLookup.set(t.attributes[I],"")})})):yield this.calculateLinkChartLayout(this.defaultLinkChartConfig.layoutMode,{xScaleFactor:this.defaultLinkChartConfig.xScaleFactor,yScaleFactor:this.defaultLinkChartConfig.yScaleFactor,lockedNodeLocations:this.getCurrentNodeLocations()}):yield this.calculateLinkChartLayout("RADIAL_TREE",{lockedNodeLocations:this.getCurrentNodeLocations()})})}_refreshNamedTypes(){for(let e of this.layers)e.emit("refresh",{dataChanged:!0});for(let e of this.tables)e.emit("refresh",{dataChanged:!0})}};n([p()],j.prototype,"dataPreloadedInLocalCache",void 0),n([p()],j.prototype,"defaultLinkChartConfig",void 0),n([p()],j.prototype,"dataManager",void 0),n([p()],j.prototype,"knowledgeGraph",void 0),n([p()],j.prototype,"layers",void 0),n([p()],j.prototype,"linkChartDiagramLookup",void 0),n([p()],j.prototype,"linkChartExtent",void 0),n([p()],j.prototype,"linkChartGeohashLookup",void 0),n([p()],j.prototype,"memberEntityTypes",void 0),n([p()],j.prototype,"memberRelationshipTypes",void 0),n([p()],j.prototype,"sublayerIdsCache",void 0),n([p()],j.prototype,"tables",void 0),n([p({json:{read:!1}})],j.prototype,"type",void 0),j=n([T("esri.layers.LinkChartLayer")],j);var Td=j;export{Td as default};
