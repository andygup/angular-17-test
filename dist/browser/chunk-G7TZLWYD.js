import{B as g,f as u}from"./chunk-EKY6QR7N.js";import{d as o}from"./chunk-NKBP5F7I.js";import{a as S}from"./chunk-GIHBFCPM.js";import{a as m,c as l}from"./chunk-AQ74ANSJ.js";import{p as f,r as v}from"./chunk-465DRXTW.js";import{a as c}from"./chunk-ESDYQQXO.js";var b=(e,s)=>e&&((...t)=>s.warn("DEBUG:",...t))||(()=>null);function z(e){return u(e.minDataValue)&&u(e.maxDataValue)&&e.minSize!=null&&e.maxSize!=null?o.SIZE_MINMAX_VALUE:(e.expression&&e.expression==="view.scale"||e.valueExpression&&e.valueExpression==="$view.scale")&&Array.isArray(e.stops)?o.SIZE_SCALE_STOPS:(e.field!=null||e.expression&&e.expression!=="view.scale"||e.valueExpression&&e.valueExpression!=="$view.scale")&&(Array.isArray(e.stops)||"levels"in e&&e.levels)?o.SIZE_FIELD_STOPS:(e.field!=null||e.expression&&e.expression!=="view.scale"||e.valueExpression&&e.valueExpression!=="$view.scale")&&e.valueUnit!=null?o.SIZE_UNIT_VALUE:(f.getLogger("esri.views.2d.engine.webgl").error(new v("mapview-bad-type","Found invalid size VisualVariable",e)),o.NONE)}function Z(e,s){if(!e||!s)return e;switch(s){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e}function x(e){return{value:e.value,size:l(e.size)}}function p(e){return(e??[]).map(s=>x(s))}function y(e){if(typeof e=="string"||typeof e=="number")return l(e);let s=e;return{type:"size",expression:s.expression,stops:p(s.stops)}}var V=e=>{let s=[],t=[],i=p(e),n=i.length;for(let a=0;a<6;a++){let r=i[Math.min(a,n-1)];s.push(r.value),t.push(r.size==null?S:m(r.size))}return{values:new Float32Array(s),sizes:new Float32Array(t)}};function O(e){let s=e&&e.length>0?{}:null,t=s?{}:null;if(!s||!t)return{vvFields:s,vvRanges:t};for(let i of e)if(i.field&&(s[i.type]=i.field),i.type==="size"){t.size||(t.size={});let n=i;switch(z(n)){case o.SIZE_MINMAX_VALUE:t.size.minMaxValue={minDataValue:n.minDataValue,maxDataValue:n.maxDataValue,minSize:y(n.minSize),maxSize:y(n.maxSize)};break;case o.SIZE_SCALE_STOPS:t.size.scaleStops={stops:p(n.stops)};break;case o.SIZE_FIELD_STOPS:if(n.levels){let a={};for(let r in n.levels)a[r]=V(n.levels[r]);t.size.fieldStops={type:"level-dependent",levels:a}}else t.size.fieldStops=c({type:"static"},V(n.stops));break;case o.SIZE_UNIT_VALUE:t.size.unitValue={unit:n.valueUnit,valueRepresentation:n.valueRepresentation??void 0}}}else if(i.type==="color")t.color=h(i);else if(i.type==="opacity")t.opacity=E(i);else if(i.type==="rotation"){let n=i;t.rotation={type:n.rotationType}}return{vvFields:s,vvRanges:t}}function E(e){let s={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if(typeof e.field=="string"){if(!e.stops)return null;{if(e.stops.length>8)return null;let t=e.stops;for(let i=0;i<8;++i){let n=t[Math.min(i,t.length-1)];s.values[i]=n.value,s.opacities[i]=n.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return null;{let t=e.stops&&e.stops.length>=0?e.stops[0].opacity:0;for(let i=0;i<8;i++)s.values[i]=1/0,s.opacities[i]=t}}return s}function d(e,s,t){e[4*s]=t.r/255,e[4*s+1]=t.g/255,e[4*s+2]=t.b/255,e[4*s+3]=t.a}function h(e){if(e==null||e.normalizationField)return null;let s={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if(typeof e.field=="string"){if(!e.stops)return null;{if(e.stops.length>8)return null;s.field=e.field;let t=e.stops;for(let i=0;i<8;++i){let n=t[Math.min(i,t.length-1)];s.values[i]=n.value,d(s.colors,i,n.color)}}}else{if(!(e.stops&&e.stops.length>=0))return null;{let t=e.stops&&e.stops.length>=0&&e.stops[0].color;for(let i=0;i<8;i++)s.values[i]=1/0,d(s.colors,i,t)}}for(let t=0;t<32;t+=4)g(s.colors,t,!0);return s}export{b as a,z as b,Z as c,O as d};
