import{b as x,f as F}from"./chunk-5OGCWDP4.js";import{a as y,u as D,w as L}from"./chunk-VDN3XKL2.js";import{a as v}from"./chunk-SVEGZVCP.js";import{b as E}from"./chunk-6MGDEI2H.js";import"./chunk-QSGARGRB.js";import"./chunk-QZ4L25WE.js";import"./chunk-4ATIL3QV.js";import"./chunk-U62SHMHB.js";import"./chunk-55ESOXMJ.js";import"./chunk-BCREO4Q5.js";import"./chunk-EJ3VIBAJ.js";import"./chunk-4LHUJTP5.js";import"./chunk-NBRBW7H5.js";import{b as h}from"./chunk-WZKL6OPG.js";import"./chunk-WF37UVOV.js";import{h as w,i as b}from"./chunk-UZQ577CU.js";import"./chunk-PEPXQ7N3.js";import"./chunk-6QIKBCPR.js";import"./chunk-AHKJJNRE.js";import"./chunk-HBTOKQC5.js";import"./chunk-A52LT7YB.js";import"./chunk-CZPMRK53.js";import"./chunk-IDSF2RZ6.js";import"./chunk-2BBIRZVO.js";import"./chunk-WQAXQD4X.js";import"./chunk-IUPUERVS.js";import"./chunk-XF4NUYV7.js";import"./chunk-FNDPIYNC.js";import"./chunk-WMYPRHRR.js";import"./chunk-IAMDMFZ7.js";import"./chunk-53MWZ23O.js";import"./chunk-PT7S6WNL.js";import"./chunk-XDTDVCGP.js";import"./chunk-JPDAKIWT.js";import{p as g,r as f}from"./chunk-465DRXTW.js";import"./chunk-AC62Z3FX.js";import{g as d}from"./chunk-ESDYQQXO.js";var m=g.getLogger("esri.layers.support.labelFormatUtils"),p={type:"simple",evaluate:()=>null},T={getAttribute:(r,t)=>r.field(t)};function U(r,t,c){return d(this,null,function*(){if(!r||!r.symbol||!t)return p;let i=r.where,s=x(r),a;if(s.type==="arcade"){let e=yield E(s.expression,c,t);if(e==null)return p;a={type:"arcade",evaluate(l,n){try{let o="attributes"in l?e.repurposeFeature(l):l;o.contextTimeZone=n??null;let u=e.evaluate({$view:{timeZone:n},$feature:o},e.services);if(u!=null)return u.toString()}catch(o){m.error(new f("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:o,feature:l,expression:s}))}return null},needsHydrationToEvaluate:()=>F(s.expression)==null}}else a={type:"simple",evaluate:e=>s.expression.replaceAll(/{[^}]*}/g,l=>{let n=l.slice(1,-1),o=t.get(n);if(!o)return l;let u=null;return"attributes"in e?e&&e.attributes&&(u=e.attributes[o.name]):u=e.field(o.name),u==null?"":N(u,o)})};if(i){let e;try{e=yield v(i,t)}catch(n){return m.error(new f("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:i,error:n})),p}let l=a.evaluate;a.evaluate=(n,o)=>{let u="attributes"in n?void 0:T;try{if(e.testFeature(n,u))return l(n,o)}catch(A){m.error(new f("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:i,feature:n,error:A}))}return null}}return a})}function N(r,t){if(r==null)return"";let c=t.domain;if(c){if(c.type==="codedValue"||c.type==="coded-value"){let s=r;for(let a of c.codedValues)if(a.code===s)return a.name}else if(c.type==="range"){let{max:s,min:a}=y(t),e=+r;if(a!=null&&s!=null&&a<=e&&e<=s)return c.name}}let i=r;return L(t)?i=b(i,w("short-date")):D(t)&&(i=h(+i)),i||""}export{U as createLabelFunction,N as formatField};
