import{a as zt}from"./chunk-ZIQX3XYG.js";import{c as St,e as K,f as Y,g as V,h as At,i as jt,j as Nt}from"./chunk-DMYB246F.js";import{a as u,b as Gt}from"./chunk-ZOTIMGGE.js";import{a as xt,b as f,c as ht,d as Z,e as P,h as U,i as wt,j as X,k as bt,l as Rt,n as F,p as H}from"./chunk-OHIIU6WS.js";import{a as vt}from"./chunk-D6LLE2YP.js";import{b as gt,c as dt}from"./chunk-MXH75ZNY.js";import{a as yt}from"./chunk-QSGARGRB.js";import{f as _}from"./chunk-4ATIL3QV.js";import{b as L,d as D,e as J,o as Q}from"./chunk-URUYU25U.js";import{b as pt}from"./chunk-EJ3VIBAJ.js";import{c as mt}from"./chunk-NBRBW7H5.js";import{b as at}from"./chunk-FC3MPJI4.js";import{j as W}from"./chunk-6QIKBCPR.js";import{a as ft,i as A}from"./chunk-AHKJJNRE.js";import{a as ut}from"./chunk-HBTOKQC5.js";import{a as it,b as lt}from"./chunk-A52LT7YB.js";import{R as ct,n as E,o as st,z as I}from"./chunk-CZPMRK53.js";import{a as z}from"./chunk-2BBIRZVO.js";import{h as q}from"./chunk-FNDPIYNC.js";import{H as x}from"./chunk-WMYPRHRR.js";import{R as T,w}from"./chunk-IAMDMFZ7.js";import{a as y}from"./chunk-53MWZ23O.js";import{g as B}from"./chunk-ESDYQQXO.js";var b=class extends vt(q){constructor(...t){super(...t),this.position=new A([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(t,e,r,o){if(t&&typeof t=="object"&&("x"in t||Array.isArray(t))){let n={position:t};return e!=null&&(n.heading=e),r!=null&&(n.tilt=r),o!=null&&(n.fov=o),n}return t}writePosition(t,e,r,o){let n=t.clone();n.x=w(t.x||0),n.y=w(t.y||0),n.z=t.hasZ?w(t.z||0):t.z,e[r]=n.write({},o)}readPosition(t,e){let r=new A;return r.read(t,e),r.x=w(r.x||0),r.y=w(r.y||0),r.z=r.hasZ?w(r.z||0):r.z,r}equals(t){return t!=null&&this.tilt===t.tilt&&this.heading===t.heading&&this.fov===t.fov&&this.position.equals(t.position)}};y([x({type:A,json:{write:{isRequired:!0}}})],b.prototype,"position",void 0),y([it("position")],b.prototype,"writePosition",null),y([ut("position")],b.prototype,"readPosition",null),y([x({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),z(t=>zt.normalize(w(t)))],b.prototype,"heading",void 0),y([x({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),z(t=>pt(w(t),-180,180))],b.prototype,"tilt",void 0),y([x({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],b.prototype,"fov",void 0),b=y([T("esri.Camera")],b);var Pt=b;var tt,G=tt=class extends q{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new tt({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};function $(){return{enabled:!this.camera}}y([x({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:$}}}}})],G.prototype,"rotation",void 0),y([z("rotation")],G.prototype,"castRotation",null),y([x({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:$}}}}})],G.prototype,"scale",void 0),y([x({types:yt,json:{read:_,write:!0,origins:{"web-scene":{read:_,write:{overridePolicy:$}}}}})],G.prototype,"targetGeometry",void 0),y([x({type:Pt,json:{write:!0}})],G.prototype,"camera",void 0),G=tt=y([T("esri.Viewpoint")],G);var C=G;function N(){return[1,0,0,1,0,0]}function Et(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function It(t,e,r,o,n,a){return[t,e,r,o,n,a]}function Wt(t,e){return new Float64Array(t,e,6)}var ze=Object.freeze(Object.defineProperty({__proto__:null,clone:Et,create:N,createView:Wt,fromValues:It},Symbol.toStringTag,{value:"Module"}));var kt=96,Mt=39.37,_t=180/Math.PI;function Tt(t){return t.wkid?t:t.spatialReference||lt.WGS84}function rt(t,e){return e.type?f(t,e.x,e.y):xt(t,e)}function qt(t){return ct(t)}function O(t,e){let r=Math.max(1,e[0]),o=Math.max(1,e[1]);return Math.max(t.width/r,t.height/o)*Ut(t.spatialReference)}function k(t,e,r,o){return B(this,null,function*(){let n,a;if(!t||Array.isArray(t)&&!t.length)return null;if(at.isCollection(t)&&(t=t.toArray()),Array.isArray(t)&&t.length&&typeof t[0]=="object"){let c=t.every(m=>"attributes"in m),l=t.some(m=>!m.geometry),s=t;if(c&&l&&e&&e.allLayerViews){let m=new Map;for(let p of t){let d=p.layer,j=m.get(d)||[],R=p.attributes[d.objectIdField];R!=null&&j.push(R),m.set(d,j)}let g=[];m.forEach((p,d)=>{let j=e.allLayerViews.find(R=>R.layer.id===d.id);if(j&&"queryFeatures"in j){let R=d.createQuery();R.objectIds=p,R.returnGeometry=!0,g.push(j.queryFeatures(R))}});let h=yield Promise.all(g),S=[];for(let p of h)if(p&&p.features&&p.features.length)for(let d of p.features)d.geometry!=null&&S.push(d.geometry);s=S}for(let m of s)o=yield k(m,e,r,o);return o}if(Array.isArray(t)&&t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number")n=new A(t);else if(t instanceof ft)n=t;else if("geometry"in t){if(t.geometry)n=t.geometry;else if(t.layer){let c=t.layer,l=e.allLayerViews.find(s=>s.layer.id===c.id);if(l&&"queryFeatures"in l){let s=c.createQuery();s.objectIds=[t.attributes[c.objectIdField]],s.returnGeometry=!0,n=(yield l.queryFeatures(s))?.features?.[0]?.geometry}}}if(n==null)return null;switch(n.type){case"point":a=new W({xmin:n.x,ymin:n.y,xmax:n.x,ymax:n.y,spatialReference:n.spatialReference});break;case"extent":case"multipoint":case"polygon":case"polyline":a=gt(n);break;default:a=n.extent}if(!a)return null;L()||Q(a.spatialReference,r)||(yield D());let i=J(a,r);return i?o=o?o.union(i):i:null})}function Lt(t){if(t&&(!Array.isArray(t)||typeof t[0]!="number")&&(typeof t=="object"||Array.isArray(t)&&typeof t[0]=="object")){if("layer"in t&&t.layer?.minScale!=null&&t.layer.maxScale!=null){let e=t.layer;return{min:e.minScale,max:e.maxScale}}if(Array.isArray(t)&&t.length&&t.every(e=>"layer"in e)){let e=0,r=0;for(let o of t){let n=o.layer;n?.minScale&&n.maxScale&&(e=n.minScale<e?n.minScale:e,r=n.maxScale>r?n.maxScale:r)}return e&&r?{min:e,max:r}:null}}}function et(t,e){return E(Tt(t),e)?t:J(t,e)}function Je(t,e){return B(this,null,function*(){if(!t||!e)return new C({targetGeometry:new A,scale:0,rotation:0});let r=e.spatialReference,{constraints:o,padding:n,viewpoint:a,size:i}=e,c=[n?i[0]-n.left-n.right:i[0],n?i[1]-n.top-n.bottom:i[1]],l=null;t instanceof C?l=t:t.viewpoint?l=t.viewpoint:t.target&&t.target.declaredClass==="esri.Viewpoint"&&(l=t.target);let s=null;l?.targetGeometry?s=l.targetGeometry:t instanceof W?s=t:(t||t&&("center"in t||"extent"in t||"target"in t))&&(s=(yield k(t.center,e,r))||(yield k(t.extent,e,r))||(yield k(t.target,e,r))||(yield k(t,e,r))),!s&&a?.targetGeometry?s=a.targetGeometry:!s&&e.extent&&(s=e.extent),r||(r=Tt(e.spatialReference||e.extent||s)),L()||E(s.spatialReference,r)||Q(s.spatialReference,r)||(yield D());let m=et("center"in s?s.center:s,r);e.pickClosestTarget!==!1&&m.type==="point"&&a.targetGeometry?.type==="point"&&(m.x=dt(m.x,a.targetGeometry.x,m.spatialReference));let g=0;if(l?.targetGeometry!=null&&l.targetGeometry.type==="point")g=l.scale;else if("scale"in t&&t.scale)g=t.scale;else if("zoom"in t&&t.zoom!==-1&&o&&o.effectiveLODs)g=o.zoomToScale(t.zoom);else if(Array.isArray(s)||s.type==="point"||s.type==="extent"&&s.width===0&&s.height===0){let d=et(e.extent,r);g=d!=null?O(d,c):e.extent?O(e.extent,c):a.scale}else g=O(et(s.extent,r),c);let h=Lt(t.target??t);h&&(h.min&&h.min<g?g=h.min:h.max&&h.max>g&&(g=h.max));let S=0;l?S=l.rotation:t.hasOwnProperty("rotation")?S=t.rotation:a&&(S=a.rotation);let p=new C({targetGeometry:m,scale:g,rotation:S});return o&&(p=o.fit(p),o.constrainByGeometry(p),o.rotationEnabled||(p.rotation=a.rotation)),p})}function v(t,e){let r=t.targetGeometry,o=e.targetGeometry;return r.x=o.x,r.y=o.y,r.spatialReference=o.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}function Dt(t,e,r){return r?f(t,.5*(e[0]-r.right+r.left),.5*(e[1]-r.bottom+r.top)):P(t,e,.5)}var Qe=function(){let t=u();return function(e,r,o){let n=r.targetGeometry;rt(t,n);let a=.5*M(r);return e.xmin=t[0]-a*o[0],e.ymin=t[1]-a*o[1],e.xmax=t[0]+a*o[0],e.ymax=t[1]+a*o[1],e.spatialReference=n.spatialReference,e}}();function Ze(t,e,r,o,n){return Kt(t,e,r.center),t.scale=O(r,o),n?.constraints?.constrain(t),t}function Jt(t,e,r,o){return Ct(t,e,r,o),St(t,t)}var Ft=function(){let t=u();return function(e,r,o){return H(e,Xt(e,r),Dt(t,r,o))}}(),Qt=function(){let t=N(),e=u();return function(r,o,n,a){let i=M(o),c=ot(o);return f(e,i,i),jt(t,e),K(t,t,c),V(t,t,Ft(e,n,a)),V(t,t,[0,a.top-a.bottom]),f(r,t[4],t[5])}}();function M(t){return t.scale*Zt(t.targetGeometry)}function Zt(t){return t!=null&&I(t.spatialReference)?1/(qt(t.spatialReference)*Mt*kt):1}function ot(t){return mt(t.rotation)||0}function Ut(t){return I(t)?qt(t)*Mt*kt:1}function Xt(t,e){return P(t,e,.5)}var Vt=function(){let t=u(),e=u(),r=u();return function(o,n,a,i,c,l){return wt(t,n),P(e,a,.5*l),f(r,1/i*l,-1/i*l),Nt(o,e),c&&K(o,o,c),Y(o,o,r),V(o,o,t),o}}(),Ct=function(){let t=u();return function(e,r,o,n){let a=M(r),i=ot(r);return rt(t,r.targetGeometry),Vt(e,t,o,a,i,n)}}(),Ue=function(){let t=u();return function(e,r,o,n){let a=M(r);return rt(t,r.targetGeometry),Vt(e,t,o,a,0,n)}}();function Ht(t){let e=st(t);return e?e.valid[1]-e.valid[0]:0}function Xe(t,e){return Math.round(Ht(t)/e)}var He=function(){let t=u(),e=u(),r=[0,0,0];return function(o,n,a){Z(t,o,n),X(t,t),Z(e,o,a),X(e,e),Rt(r,t,e);let i=Math.acos(bt(t,e)/(U(t)*U(e)))*_t;return r[2]<0&&(i=-i),isNaN(i)&&(i=0),i}}(),Ke=function(){let t=u();return function(e,r,o,n){let a=e.targetGeometry;return v(e,r),Qt(t,r,o,n),a.x+=t[0],a.y+=t[1],e}}(),Kt=function(t,e,r){v(t,e);let o=t.targetGeometry;return o.x=r.x,o.y=r.y,o.spatialReference=r.spatialReference,t},Ye=function(){let t=u();return function(e,r,o,n,a){a||(a="center"),H(t,o,n),P(t,t,.5);let i=t[0],c=t[1];switch(a){case"center":f(t,0,0);break;case"left":f(t,-i,0);break;case"top":f(t,0,c);break;case"right":f(t,i,0);break;case"bottom":f(t,0,-c);break;case"top-left":f(t,-i,c);break;case"bottom-left":f(t,-i,-c);break;case"top-right":f(t,i,c);break;case"bottom-right":f(t,i,-c)}return nt(e,r,t),e}}();function $e(t,e,r){return v(t,e),t.rotation+=r,t}function tr(t,e,r){return v(t,e),t.rotation=r,t}var Yt=function(){let t=u();return function(e,r,o,n,a){return v(e,r),isNaN(o)||o===0||(Ot(t,n,r,a),e.scale=r.scale*o,Bt(t,t,e,a),nt(e,e,f(t,t[0]-n[0],n[1]-t[1]))),e}}();function er(t,e,r){return v(t,e),t.scale=r,t}var $t=function(){let t=u();return function(e,r,o,n,a,i){return v(e,r),isNaN(o)||o===0||(Ot(t,a,r,i),e.scale=r.scale*o,e.rotation+=n,Bt(t,t,e,i),nt(e,e,f(t,t[0]-a[0],a[1]-t[1]))),e}}(),rr=function(){let t=u(),e=u();return function(r,o,n,a,i,c,l){return Ft(e,c,l),ht(t,i,e),a?$t(r,o,n,a,t,c):Yt(r,o,n,t,c)}}(),Ot=function(){let t=N();return function(e,r,o,n){return F(e,r,Jt(t,o,n,1))}}(),Bt=function(){let t=N();return function(e,r,o,n){return F(e,r,Ct(t,o,n,1))}}(),nt=function(){let t=u(),e=N();return function(r,o,n){v(r,o);let a=M(o),i=r.targetGeometry;return At(e,ot(o)),Y(e,e,Gt(a,a)),F(t,n,e),i.x+=t[0],i.y+=t[1],r}}();export{C as a,N as b,O as c,Je as d,v as e,Dt as f,Qe as g,Ze as h,Ft as i,M as j,Vt as k,Ct as l,Ue as m,Ht as n,Xe as o,He as p,Ke as q,Kt as r,Ye as s,$e as t,tr as u,er as v,$t as w,rr as x,nt as y};
