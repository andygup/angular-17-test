import{a as d,b,c,e as W}from"./chunk-IUI3WMKL.js";import{a as H}from"./chunk-XW7QX6JS.js";import"./chunk-EGQHBYFL.js";import"./chunk-UULYHJV4.js";import{a as C}from"./chunk-6J7DCVWC.js";import{a as T}from"./chunk-CIQJCIGH.js";import{a as R}from"./chunk-RI77TKRA.js";import"./chunk-UW2TVJUN.js";import"./chunk-LGUXUFJ7.js";import{a as P}from"./chunk-Z7MKEISX.js";import{a as z}from"./chunk-5L5TH44W.js";import{a as K}from"./chunk-URPONBMS.js";import{e as A}from"./chunk-QB3NROF7.js";import{a as V}from"./chunk-5WCYRI4X.js";import"./chunk-KZREEH45.js";import"./chunk-BGARZEEH.js";import"./chunk-B3I4XIHJ.js";import"./chunk-6EFGHIXX.js";import"./chunk-DZ3DW7ED.js";import"./chunk-3XRT3SNQ.js";import"./chunk-YEFTRNE3.js";import"./chunk-JBJTQF7V.js";import"./chunk-CN5O6E6T.js";import"./chunk-4KJ462UD.js";import"./chunk-HSB35X5B.js";import"./chunk-FBHJEXCM.js";import"./chunk-IFUI4HFB.js";import"./chunk-JOOJSGLF.js";import"./chunk-MYELF7MV.js";import"./chunk-MS3ZOARX.js";import"./chunk-KCKP7FIY.js";import"./chunk-BQABCLW6.js";import"./chunk-HTB4QCFJ.js";import"./chunk-7K4WIBFN.js";import"./chunk-AUVYUYNK.js";import"./chunk-C7M5MSEL.js";import"./chunk-HPJ6EQFO.js";import"./chunk-5MJXKSZ4.js";import"./chunk-LGGJOMLJ.js";import"./chunk-VVAIF23J.js";import"./chunk-O5K35OSE.js";import"./chunk-D6LLE2YP.js";import"./chunk-I3S324BU.js";import"./chunk-O5IGEGOS.js";import"./chunk-EDSVJRYE.js";import"./chunk-QAVDKCSH.js";import"./chunk-H2AOS66Z.js";import"./chunk-YH4Z47PR.js";import"./chunk-CJJRHJ2S.js";import"./chunk-574KRDZU.js";import"./chunk-2APWMENK.js";import"./chunk-ZWFVPWKA.js";import"./chunk-JOYABHZZ.js";import"./chunk-IEXZWAIE.js";import"./chunk-VDN3XKL2.js";import"./chunk-SVEGZVCP.js";import"./chunk-AQ74ANSJ.js";import"./chunk-SAOUSUZE.js";import"./chunk-6MGDEI2H.js";import"./chunk-QSGARGRB.js";import"./chunk-SREKDU6P.js";import"./chunk-IXIJFOEL.js";import"./chunk-QZ4L25WE.js";import"./chunk-4ATIL3QV.js";import"./chunk-WUM4JBII.js";import"./chunk-URUYU25U.js";import"./chunk-3S2DT2SI.js";import"./chunk-7PPV2CP7.js";import"./chunk-U62SHMHB.js";import"./chunk-55ESOXMJ.js";import"./chunk-BCREO4Q5.js";import"./chunk-EJ3VIBAJ.js";import"./chunk-4LHUJTP5.js";import"./chunk-NBRBW7H5.js";import{a as y,c as S,d as g,f as p}from"./chunk-CBOFHDSC.js";import"./chunk-HB7BVTLV.js";import"./chunk-WZKL6OPG.js";import"./chunk-WF37UVOV.js";import"./chunk-UZQ577CU.js";import{b as u}from"./chunk-FC3MPJI4.js";import{a as N}from"./chunk-5ETRXDS4.js";import"./chunk-QDNKD3H5.js";import"./chunk-F72O5PVM.js";import"./chunk-B4PK7RBX.js";import{a as I}from"./chunk-6J4Y65BV.js";import"./chunk-RXHILZH7.js";import"./chunk-KBFIYTBH.js";import"./chunk-PEPXQ7N3.js";import"./chunk-VU5W7W6Y.js";import{j as m}from"./chunk-6QIKBCPR.js";import"./chunk-AHKJJNRE.js";import{a as h}from"./chunk-HBTOKQC5.js";import{a as J,b as w}from"./chunk-A52LT7YB.js";import"./chunk-CZPMRK53.js";import"./chunk-IDSF2RZ6.js";import"./chunk-2BBIRZVO.js";import"./chunk-WQAXQD4X.js";import"./chunk-IUPUERVS.js";import{H as j}from"./chunk-XF4NUYV7.js";import{f as _}from"./chunk-FNDPIYNC.js";import{H as i}from"./chunk-WMYPRHRR.js";import{R as f,z as M}from"./chunk-IAMDMFZ7.js";import{a as r}from"./chunk-53MWZ23O.js";import{k as F}from"./chunk-PT7S6WNL.js";import"./chunk-XDTDVCGP.js";import"./chunk-JPDAKIWT.js";import{n as k}from"./chunk-465DRXTW.js";import"./chunk-AC62Z3FX.js";import{a as O,g as E}from"./chunk-ESDYQQXO.js";var v,a=v=class extends N.EventedMixin(_(I)){constructor(...e){super(...e),this.description=null,this.fullExtent=null,this.id=null,this.networkLink=null,this.parent=null,this.sublayers=null,this.title=null,this.sourceJSON=null,this.layer=null,this.addHandles([S(()=>this.sublayers,"after-add",({item:t})=>{t.parent=this,t.layer=this.layer},p),S(()=>this.sublayers,"after-remove",({item:t})=>{t.layer=t.parent=null},p),y(()=>this.sublayers,(t,s)=>{if(s)for(let o of s)o.layer=o.parent=null;if(t)for(let o of t)o.parent=this,o.layer=this.layer},p),y(()=>this.layer,t=>{if(this.sublayers)for(let s of this.sublayers)s.layer=t},p)])}initialize(){g(()=>this.networkLink).then(()=>g(()=>this.visible===!0)).then(()=>this.load())}load(e){if(!this.networkLink||this.networkLink.viewFormat)return;let t=e!=null?e.signal:null,s=this._fetchService(this._get("networkLink")?.href??"",t).then(o=>{let n=W(o.sublayers);this.fullExtent=m.fromJSON(n),this.sourceJSON=o;let x=M(u.ofType(v),c(v,o));this.sublayers?this.sublayers.addMany(x):this.sublayers=x,this.layer?.emit("sublayer-update"),this.layer&&this.layer.notifyChange("visibleSublayers")});return this.addResolvingPromise(s),Promise.resolve(this)}get visible(){return this._get("visible")}set visible(e){this._get("visible")!==e&&(this._set("visible",e),this.layer&&this.layer.notifyChange("visibleSublayers"))}readVisible(e,t){return!!t.visibility}_fetchService(e,t){return b(e,this.layer.outSpatialReference,this.layer.refreshInterval,t).then(s=>d(s.data))}};r([i()],a.prototype,"description",void 0),r([i({type:m})],a.prototype,"fullExtent",void 0),r([i()],a.prototype,"id",void 0),r([i({readOnly:!0,value:null})],a.prototype,"networkLink",void 0),r([i({json:{write:{allowNull:!0}}})],a.prototype,"parent",void 0),r([i({type:u.ofType(a),json:{write:{allowNull:!0}}})],a.prototype,"sublayers",void 0),r([i({value:null,json:{read:{source:"name",reader:e=>k(e)}}})],a.prototype,"title",void 0),r([i({value:!0})],a.prototype,"visible",null),r([h("visible",["visibility"])],a.prototype,"readVisible",null),r([i()],a.prototype,"sourceJSON",void 0),r([i()],a.prototype,"layer",void 0),a=v=r([f("esri.layers.support.KMLSublayer")],a);var L=a;var B=["kml","xml"],l=class extends R(T(P(z(C(K(V)))))){constructor(...e){super(...e),this._visibleFolders=[],this.allSublayers=new H({getCollections:()=>[this.sublayers],getChildrenFunction:t=>t.sublayers}),this.outSpatialReference=w.WGS84,this.path=null,this.legendEnabled=!1,this.operationalLayerType="KML",this.sublayers=null,this.type="kml",this.url=null}initialize(){this.addHandles([y(()=>this.sublayers,(e,t)=>{t&&t.forEach(s=>{s.parent=null,s.layer=null}),e&&e.forEach(s=>{s.parent=this,s.layer=this})},p),this.on("sublayer-update",()=>this.notifyChange("fullExtent"))])}normalizeCtorArgs(e,t){return typeof e=="string"?O({url:e},t):e}readSublayersFromItemOrWebMap(e,t){this._visibleFolders=t.visibleFolders}readSublayers(e,t,s){return c(L,t,s,this._visibleFolders)}writeSublayers(e,t){let s=[],o=e.toArray();for(;o.length;){let n=o[0];n.networkLink||(n.visible&&s.push(n.id),n.sublayers&&o.push(...n.sublayers.toArray())),o.shift()}t.visibleFolders=s}get title(){let e=this._get("title");return e&&this.originOf("title")!=="defaults"?e:this.url?j(this.url,B)||"KML":e||""}set title(e){this._set("title",e)}get visibleSublayers(){let e=this.sublayers,t=[],s=o=>{o.visible&&(t.push(o),o.sublayers&&o.sublayers.forEach(s))};return e&&e.forEach(s),t}get fullExtent(){return this._recomputeFullExtent()}load(e){let t=e!=null?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["KML"],supportsData:!1},e).catch(F).then(()=>this._fetchService(t))),Promise.resolve(this)}destroy(){super.destroy(),this.allSublayers.destroy()}_fetchService(e){return E(this,null,function*(){let t=yield Promise.resolve().then(()=>this.resourceInfo?{ssl:!1,data:this.resourceInfo}:b(this.url??"",this.outSpatialReference,this.refreshInterval,e)),s=d(t.data);s&&this.read(s,{origin:"service"})})}_recomputeFullExtent(){let e=null;this.extent!=null&&(e=this.extent.clone());let t=s=>{if(s.sublayers)for(let o of s.sublayers.items)t(o),o.visible&&o.fullExtent&&(e!=null?e.union(o.fullExtent):e=o.fullExtent.clone())};return t(this),e}};r([i({readOnly:!0})],l.prototype,"allSublayers",void 0),r([i({type:w})],l.prototype,"outSpatialReference",void 0),r([i({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],l.prototype,"path",void 0),r([i({readOnly:!0,json:{read:!1,write:!1}})],l.prototype,"legendEnabled",void 0),r([i({type:["show","hide","hide-children"]})],l.prototype,"listMode",void 0),r([i({type:["KML"]})],l.prototype,"operationalLayerType",void 0),r([i({})],l.prototype,"resourceInfo",void 0),r([i({type:u.ofType(L),json:{write:{ignoreOrigin:!0}}})],l.prototype,"sublayers",void 0),r([h(["web-map","portal-item"],"sublayers",["visibleFolders"])],l.prototype,"readSublayersFromItemOrWebMap",null),r([h("service","sublayers",["sublayers"])],l.prototype,"readSublayers",null),r([J("sublayers")],l.prototype,"writeSublayers",null),r([i({readOnly:!0,json:{read:!1}})],l.prototype,"type",void 0),r([i({json:{origins:{"web-map":{read:{source:"title"}}},write:{ignoreOrigin:!0}}})],l.prototype,"title",null),r([i(A)],l.prototype,"url",void 0),r([i({readOnly:!0})],l.prototype,"visibleSublayers",null),r([i({type:m})],l.prototype,"extent",void 0),r([i()],l.prototype,"fullExtent",null),l=r([f("esri.layers.KMLLayer")],l);var Re=l;export{Re as default};
