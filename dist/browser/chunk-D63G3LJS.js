import{a as X}from"./chunk-QRBVWOV6.js";import"./chunk-4Y7EKSO4.js";import{a as $}from"./chunk-XKOINRUM.js";import{a as D,b as H,c as Q}from"./chunk-UITTMOEC.js";import{a as T}from"./chunk-IFG5AX52.js";import{a as _}from"./chunk-YG5DZH4E.js";import"./chunk-HRUHPNEV.js";import"./chunk-URSNN2E3.js";import"./chunk-BIAW42RV.js";import"./chunk-4573E3RZ.js";import"./chunk-BSQ5TFLX.js";import"./chunk-DDZ3KR2Q.js";import"./chunk-JHWJLQOC.js";import"./chunk-DTWRSK4M.js";import"./chunk-M3GEY4SR.js";import"./chunk-7QY3BMVN.js";import"./chunk-4HXOVZYF.js";import"./chunk-U2QVIRVP.js";import"./chunk-XW7QX6JS.js";import"./chunk-E4G7B7K5.js";import"./chunk-ZVPHD6FG.js";import"./chunk-BHUF7DXK.js";import{a as C}from"./chunk-VYBYHQTJ.js";import{a as V}from"./chunk-2SRHEZDP.js";import{a as B}from"./chunk-4YLYZGNM.js";import"./chunk-3AY2ZIM4.js";import"./chunk-XFFNQH2H.js";import"./chunk-VL6L3PH6.js";import"./chunk-EGQHBYFL.js";import{c as z}from"./chunk-MXNDRZNB.js";import{a as G}from"./chunk-XWKYTQFT.js";import"./chunk-RAIGRXV3.js";import"./chunk-UULYHJV4.js";import{a as Z}from"./chunk-6J7DCVWC.js";import{a as U}from"./chunk-CIQJCIGH.js";import{a as J}from"./chunk-RI77TKRA.js";import"./chunk-UW2TVJUN.js";import"./chunk-LGUXUFJ7.js";import{a as q}from"./chunk-Z7MKEISX.js";import{a as W}from"./chunk-5L5TH44W.js";import{a as j}from"./chunk-URPONBMS.js";import{e as K}from"./chunk-QB3NROF7.js";import{a as Y}from"./chunk-5WCYRI4X.js";import"./chunk-KZREEH45.js";import"./chunk-N3XRI3RU.js";import"./chunk-BGARZEEH.js";import"./chunk-B3I4XIHJ.js";import"./chunk-6EFGHIXX.js";import"./chunk-DZ3DW7ED.js";import"./chunk-3XRT3SNQ.js";import"./chunk-YEFTRNE3.js";import"./chunk-5OGCWDP4.js";import"./chunk-JBJTQF7V.js";import"./chunk-7EQBH2NW.js";import"./chunk-CN5O6E6T.js";import"./chunk-4KJ462UD.js";import"./chunk-HSB35X5B.js";import"./chunk-FBHJEXCM.js";import"./chunk-IFUI4HFB.js";import"./chunk-JOOJSGLF.js";import"./chunk-MYELF7MV.js";import"./chunk-MS3ZOARX.js";import"./chunk-KCKP7FIY.js";import"./chunk-BQABCLW6.js";import"./chunk-HTB4QCFJ.js";import"./chunk-7K4WIBFN.js";import"./chunk-AUVYUYNK.js";import"./chunk-C7M5MSEL.js";import"./chunk-HPJ6EQFO.js";import"./chunk-5MJXKSZ4.js";import"./chunk-TJ3KO5EG.js";import"./chunk-FC6HKZZX.js";import{a as k}from"./chunk-LGGJOMLJ.js";import"./chunk-VVAIF23J.js";import"./chunk-6N5DPLFH.js";import"./chunk-HI2T2YSZ.js";import"./chunk-O5K35OSE.js";import"./chunk-D6LLE2YP.js";import"./chunk-I3S324BU.js";import"./chunk-O5IGEGOS.js";import"./chunk-2UDQ3IWX.js";import"./chunk-MXH75ZNY.js";import"./chunk-PQKTT6AH.js";import"./chunk-OM24DGCK.js";import"./chunk-YQRTHGFD.js";import"./chunk-EDSVJRYE.js";import"./chunk-QAVDKCSH.js";import"./chunk-H2AOS66Z.js";import"./chunk-YH4Z47PR.js";import"./chunk-CJJRHJ2S.js";import{a as P}from"./chunk-ZYPPRX53.js";import"./chunk-574KRDZU.js";import"./chunk-2APWMENK.js";import"./chunk-ZWFVPWKA.js";import"./chunk-JOYABHZZ.js";import"./chunk-IEXZWAIE.js";import"./chunk-VDN3XKL2.js";import"./chunk-SVEGZVCP.js";import"./chunk-AQ74ANSJ.js";import"./chunk-SAOUSUZE.js";import"./chunk-6MGDEI2H.js";import"./chunk-QSGARGRB.js";import"./chunk-SREKDU6P.js";import"./chunk-IXIJFOEL.js";import"./chunk-QZ4L25WE.js";import"./chunk-4ATIL3QV.js";import"./chunk-WUM4JBII.js";import"./chunk-URUYU25U.js";import"./chunk-3S2DT2SI.js";import"./chunk-7PPV2CP7.js";import"./chunk-U62SHMHB.js";import"./chunk-55ESOXMJ.js";import"./chunk-BCREO4Q5.js";import"./chunk-EJ3VIBAJ.js";import"./chunk-4LHUJTP5.js";import"./chunk-NBRBW7H5.js";import"./chunk-CBOFHDSC.js";import"./chunk-HB7BVTLV.js";import"./chunk-WZKL6OPG.js";import"./chunk-WF37UVOV.js";import{d as w}from"./chunk-UZQ577CU.js";import"./chunk-FC3MPJI4.js";import"./chunk-5ETRXDS4.js";import"./chunk-QDNKD3H5.js";import"./chunk-F72O5PVM.js";import"./chunk-B4PK7RBX.js";import"./chunk-6J4Y65BV.js";import"./chunk-RXHILZH7.js";import"./chunk-KBFIYTBH.js";import"./chunk-PEPXQ7N3.js";import"./chunk-VU5W7W6Y.js";import{j as N}from"./chunk-6QIKBCPR.js";import"./chunk-AHKJJNRE.js";import{a as F}from"./chunk-HBTOKQC5.js";import{a as R}from"./chunk-A52LT7YB.js";import{p as A}from"./chunk-CZPMRK53.js";import"./chunk-IDSF2RZ6.js";import"./chunk-2BBIRZVO.js";import"./chunk-WQAXQD4X.js";import"./chunk-IUPUERVS.js";import{$ as v}from"./chunk-XF4NUYV7.js";import"./chunk-FNDPIYNC.js";import{H as o,l as b,n as I}from"./chunk-WMYPRHRR.js";import{H as M,R as L}from"./chunk-IAMDMFZ7.js";import{a as i}from"./chunk-53MWZ23O.js";import{k as O,p as E}from"./chunk-PT7S6WNL.js";import"./chunk-XDTDVCGP.js";import"./chunk-JPDAKIWT.js";import{r as x}from"./chunk-465DRXTW.js";import"./chunk-AC62Z3FX.js";import{a as l,b as d,g as h}from"./chunk-ESDYQQXO.js";var r=class extends J(z(q(Q(D(B(W(Z(j(U(V(G(Y)))))))))))){constructor(...e){super(...e),this.dateFieldsTimeZone=null,this.datesInUnknownTimezone=!1,this.dpi=96,this.gdbVersion=null,this.imageFormat="png24",this.imageMaxHeight=2048,this.imageMaxWidth=2048,this.imageTransparency=!0,this.isReference=null,this.labelsVisible=!1,this.operationalLayerType="ArcGISMapServiceLayer",this.preferredTimeZone=null,this.sourceJSON=null,this.sublayers=null,this.type="map-image",this.url=null}normalizeCtorArgs(e,t){return typeof e=="string"?l({url:e},t):e}load(e){let t=e!=null?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},e).catch(O).then(()=>this._fetchService(t))),Promise.resolve(this)}readImageFormat(e,t){let m=t.supportedImageFormatTypes;return m&&m.includes("PNG32")?"png32":"png24"}writeSublayers(e,t,m,a){if(!this.loaded||!e)return;let n=e.slice().reverse().flatten(({sublayers:p})=>p&&p.toArray().reverse()).toArray(),s=!1;if(this.capabilities&&this.capabilities.operations.supportsExportMap&&this.capabilities.exportMap?.supportsDynamicLayers){let p=I(a.origin);if(p===b.PORTAL_ITEM){let y=this.createSublayersForOrigin("service").sublayers;s=T(n,y,b.SERVICE)}else if(p>b.PORTAL_ITEM){let y=this.createSublayersForOrigin("portal-item");s=T(n,y.sublayers,I(y.origin))}}let c=[],u=l({writeSublayerStructure:s},a),f=s;n.forEach(p=>{let y=p.write({},u);c.push(y),f=f||p.originOf("visible")==="user"}),c.some(p=>Object.keys(p).length>1)&&(t.layers=c),f&&(t.visibleLayers=n.filter(p=>p.visible).map(p=>p.id))}createExportImageParameters(e,t,m,a){let n=a?.pixelRatio||1;e&&this.version>=10&&(e=e.clone().shiftCentralMeridian());let s=new X({layer:this,floors:a?.floors,scale:$({extent:e,width:t})*n}),c=s.toJSON();s.destroy();let u=!a?.rotation||this.version<10.3?{}:{rotation:-a.rotation},f=e?.spatialReference,p=A(f);c.dpi*=n;let y={};if(a?.timeExtent){let{start:g,end:S}=a.timeExtent.toJSON();y.time=g&&S&&g===S?""+g:`${g??"null"},${S??"null"}`}else this.timeInfo&&!this.timeInfo.hasLiveData&&(y.time="null,null");return l(l(l({bbox:e&&e.xmin+","+e.ymin+","+e.xmax+","+e.ymax,bboxSR:p,imageSR:p,size:t+","+m},c),u),y)}fetchImage(e,t,m,a){return h(this,null,function*(){let{data:n}=yield this._fetchImage("image",e,t,m,a);return n})}fetchImageBitmap(e,t,m,a){return h(this,null,function*(){let{data:n,url:s}=yield this._fetchImage("blob",e,t,m,a);return _(n,s,a?.signal)})}fetchRecomputedExtents(){return h(this,arguments,function*(e={}){let t=d(l({},e),{query:d(l({returnUpdates:!0,f:"json"},this.customParameters),{token:this.apiKey})}),{data:m}=yield v(this.url,t),{extent:a,fullExtent:n,timeExtent:s}=m,c=a||n;return{fullExtent:c&&N.fromJSON(c),timeExtent:s&&k.fromJSON({start:s[0],end:s[1]})}})}loadAll(){return P(this,e=>{e(this.allSublayers)})}serviceSupportsSpatialReference(e){return C(this,e)}_fetchImage(e,t,m,a,n){return h(this,null,function*(){let s={responseType:e,signal:n?.signal??null,query:d(l(l(d(l(l({},this.parsedUrl.query),this.createExportImageParameters(t,m,a,n)),{f:"image"}),this.refreshParameters),this.customParameters),{token:this.apiKey})},c=this.parsedUrl.path+"/export";if(s.query?.dynamicLayers!=null&&!this.capabilities?.exportMap?.supportsDynamicLayers)throw new x("mapimagelayer:dynamiclayer-not-supported",`service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`,{query:s.query});try{let{data:u}=yield v(c,s);return{data:u,url:c}}catch(u){throw E(u)?u:new x("mapimagelayer:image-fetch-error",`Unable to load image: ${c}`,{error:u})}})}_fetchService(e){return h(this,null,function*(){if(this.sourceJSON)return void this.read(this.sourceJSON,{origin:"service",url:this.parsedUrl});let{data:t,ssl:m}=yield v(this.parsedUrl.path,{query:d(l(l({f:"json"},this.parsedUrl.query),this.customParameters),{token:this.apiKey}),signal:e});m&&(this.url=this.url.replace(/^http:/i,"https:")),this.sourceJSON=t,this.read(t,{origin:"service",url:this.parsedUrl})})}};i([o(w("dateFieldsTimeReference"))],r.prototype,"dateFieldsTimeZone",void 0),i([o({type:Boolean})],r.prototype,"datesInUnknownTimezone",void 0),i([o()],r.prototype,"dpi",void 0),i([o()],r.prototype,"gdbVersion",void 0),i([o()],r.prototype,"imageFormat",void 0),i([F("imageFormat",["supportedImageFormatTypes"])],r.prototype,"readImageFormat",null),i([o({json:{origins:{service:{read:{source:"maxImageHeight"}}}}})],r.prototype,"imageMaxHeight",void 0),i([o({json:{origins:{service:{read:{source:"maxImageWidth"}}}}})],r.prototype,"imageMaxWidth",void 0),i([o()],r.prototype,"imageTransparency",void 0),i([o({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],r.prototype,"isReference",void 0),i([o({json:{read:!1,write:!1}})],r.prototype,"labelsVisible",void 0),i([o({type:["ArcGISMapServiceLayer"]})],r.prototype,"operationalLayerType",void 0),i([o({json:{read:!1,write:!1}})],r.prototype,"popupEnabled",void 0),i([o(w("preferredTimeReference"))],r.prototype,"preferredTimeZone",void 0),i([o()],r.prototype,"sourceJSON",void 0),i([o({json:{write:{ignoreOrigin:!0}}})],r.prototype,"sublayers",void 0),i([R("sublayers",{layers:{type:[H]},visibleLayers:{type:[M]}})],r.prototype,"writeSublayers",null),i([o({type:["show","hide","hide-children"]})],r.prototype,"listMode",void 0),i([o({json:{read:!1},readOnly:!0,value:"map-image"})],r.prototype,"type",void 0),i([o(K)],r.prototype,"url",void 0),r=i([L("esri.layers.MapImageLayer")],r);var qe=r;export{qe as default};
