import{a as I,c as g}from"./chunk-RUOXPMWE.js";import{$ as v,Ea as L,R as F,U as D,V as w,W as A,b as f,c as u,da as h,ea as _,fa as b,m as d,oa as T}from"./chunk-WMY3KSI4.js";import{p as z}from"./chunk-M3GEY4SR.js";import{a as G}from"./chunk-EDSVJRYE.js";import{f as y}from"./chunk-4ATIL3QV.js";import{a as o,c as m,h as p}from"./chunk-URPCXPAW.js";import{a as c,i as x}from"./chunk-AHKJJNRE.js";import{a as J,g as O}from"./chunk-ESDYQQXO.js";var S=class a{constructor(){this.arcadeDeclaredClass="esri.arcade.Feature",this._optimizedGeomDefinition=null,this._geometry=null,this.attributes=null,this._layer=null,this._fieldTypesFixed=!0,this.fieldsIndex=null,this.contextTimeZone=null,this.immutable=!0,this._fieldsToFixDataTypes=null,this.immutable=!0}static createFromGraphic(t,e){let i=new a;return i.contextTimeZone=e??null,i._geometry=t.geometry!=null?t.geometry:null,t.attributes===void 0||t.attributes===null?i.attributes={}:i.attributes=t.attributes,t._sourceLayer?(i._layer=t._sourceLayer,i._fieldTypesFixed=!1):t._layer?(i._layer=t._layer,i._fieldTypesFixed=!1):t.layer&&"fields"in t.layer?(i._layer=t.layer,i._fieldTypesFixed=!1):t.sourceLayer&&"fields"in t.sourceLayer&&(i._layer=t.sourceLayer,i._fieldTypesFixed=!1),i._layer&&!i._fieldTypesFixed&&(i.fieldsIndex=this.hydrateFieldsIndex(i._layer)),i}static createFromArcadeFeature(t){if(t instanceof a){let i=new a;return i._fieldTypesFixed=t._fieldTypesFixed,i.attributes=t.attributes,i._geometry=t._geometry,i._optimizedGeomDefinition=t._optimizedGeomDefinition,t._layer&&(i._layer=t._layer),i.fieldsIndex=t.fieldsIndex,i.contextTimeZone=t.contextTimeZone,i}let e={};for(let i of t.keys())e[i]=t.field(i);return a.createFromGraphicLikeObject(t.geometry(),e,t.fullSchema(),t.contextTimeZone)}static createFromOptimisedFeature(t,e,i){let s=new a;return s._geometry=t.geometry?{geometry:t.geometry}:null,s._optimizedGeomDefinition=i,s.attributes=t.attributes||{},s._layer=e,s._fieldTypesFixed=!1,s}static createFromArcadeDictionary(t){let e=new a;return e.attributes=t.field("attributes"),e.attributes!==null&&e.attributes instanceof g?(e.attributes=e.attributes.attributes,e.attributes===null&&(e.attributes={})):e.attributes={},e._geometry=t.field("geometry"),e._geometry!==null&&(e._geometry instanceof g?e._geometry=a.parseGeometryFromDictionary(e._geometry):e._geometry instanceof c||(e._geometry=null)),e}static createFromGraphicLikeObject(t,e,i=null,s){let n=new a;return n.contextTimeZone=s??null,e===null&&(e={}),n.attributes=e,n._geometry=t??null,n._layer=i,n._layer&&(n._fieldTypesFixed=!1,n.fieldsIndex=this.hydrateFieldsIndex(n._layer)),n}static hydrateFieldsIndex(t){return t===null?null:v(t)?t.getFieldsIndex():t.fieldsIndex?t.fieldsIndex:G.fromLayerJSON({datesInUnknownTimezone:t.datesInUnknownTimezone,fields:t.fields,timeInfo:t.timeInfo,editFieldsInfo:t.editFieldsInfo,dateFieldsTimeReference:t.dateFieldsTimeReference??{timeZone:"UTC",respectsDaylightSaving:!1}})}repurposeFromGraphicLikeObject(t,e,i=null){e===null&&(e={}),this.attributes=e,this._geometry=t??null,this._layer=i,this._layer?this._fieldTypesFixed=!1:this._fieldTypesFixed=!0}castToText(t=!1){let e="";this._fieldTypesFixed===!1&&this._fixFieldTypes();for(let i in this.attributes){e!==""&&(e+=",");let s=this.attributes[i];s==null?e+=JSON.stringify(i)+":null":w(s)||A(s)||D(s)?e+=JSON.stringify(i)+":"+JSON.stringify(s):s instanceof c?e+=JSON.stringify(i)+":"+T(s):s instanceof p||s instanceof m?e+=`${JSON.stringify(i)}:${JSON.stringify(s.toString())}`:s instanceof d||s instanceof Array?e+=JSON.stringify(i)+":"+T(s,null,t):s instanceof o?e+=t?JSON.stringify(i)+":"+JSON.stringify(s.getTime()):JSON.stringify(i)+":"+s.stringify():s!==null&&typeof s=="object"&&s.castToText!==void 0&&(e+=JSON.stringify(i)+":"+s.castToText(t))}return'{"geometry":'+(this.geometry()===null?"null":T(this.geometry()))+',"attributes":{'+e+"}}"}_fixFieldTypes(){if(this._fieldsToFixDataTypes&&this._fieldsToFixDataTypes?.length>0)return this._fixAllFields(this._fieldsToFixDataTypes),void(this._fieldTypesFixed=!0);let t=[],e=this._layer.fields;for(let i=0;i<e.length;i++){let s=e[i],{name:n,type:r}=s;switch(r){case"date":case"esriFieldTypeDate":t.push({field:n,dataType:"date"});break;case"date-only":case"esriFieldTypeDateOnly":t.push({field:n,dataType:"date-only"});break;case"time-only":case"esriFieldTypeTimeOnly":t.push({field:n,dataType:"time-only"});break;case"timestamp-offset":case"esriFieldTypeTimestampOffset":t.push({field:n,dataType:"timestamp-offset"})}}this._fieldsToFixDataTypes=t,t.length>0&&this._fixAllFields(t),this._fieldTypesFixed=!0}isUnknownDateTimeField(t){return this.fieldsIndex?.getTimeZone(t)==="unknown"}_fixAllFields(t){this.attributes=J({},this.attributes);let e=this.contextTimeZone??"system";for(let i=0;i<t.length;i++){let s=t[i].field,n=t[i].dataType,r=this.attributes[s];if(r===void 0){for(let l in this.attributes)if(l.toLowerCase()===s.toLowerCase()){if(r=this.attributes[l],r!==null){if(n==="time-only"){b(r)||(this.attributes[l]=p.fromReader(r.toString()));break}if(n==="date-only"){_(r)||(this.attributes[l]=m.fromReader(r.toString()));break}if(n==="timestamp-offset"){h(r)||(this.attributes[l]=o.fromReaderAsTimeStampOffset(r.toString()));break}let k=this.isUnknownDateTimeField(l);r instanceof Date?this.attributes[l]=k?o.unknownDateJSToArcadeDate(r):o.dateJSAndZoneToArcadeDate(r,e):h(r)||(this.attributes[l]=k?o.unknownEpochToArcadeDate(r):o.epochToArcadeDate(r,e))}break}}else if(r!==null){if(n==="time-only"){b(r)?this.attributes[s]=r:this.attributes[s]=p.fromReader(r.toString());continue}if(n==="date-only"){_(r)?this.attributes[s]=r:this.attributes[s]=m.fromReader(r.toString());continue}if(n==="timestamp-offset"){h(r)?this.attributes[s]=r:this.attributes[s]=o.fromReaderAsTimeStampOffset(r.toString());continue}let l=this.isUnknownDateTimeField(s);h(r)?this.attributes[s]=r:r instanceof Date?this.attributes[s]=l?o.unknownDateJSToArcadeDate(r):o.dateJSAndZoneToArcadeDate(r,e):this.attributes[s]=l?o.unknownEpochToArcadeDate(r):o.epochToArcadeDate(r,e)}}}geometry(){return this._geometry===null||this._geometry instanceof c||(this._optimizedGeomDefinition?(this._geometry=y(z(this._geometry,this._optimizedGeomDefinition.geometryType,this._optimizedGeomDefinition.hasZ,this._optimizedGeomDefinition.hasM)),this._geometry.spatialReference=this._optimizedGeomDefinition.spatialReference):this._geometry=y(this._geometry)),this._geometry}field(t){this._fieldTypesFixed||this._fixFieldTypes();let e=this.attributes[t];if(e!==void 0)return e;let i=t.toLowerCase();for(let s in this.attributes)if(s.toLowerCase()===i)return this.attributes[s];if(this._hasFieldDefinition(i))return null;throw new u(null,f.FieldNotFound,null,{key:t})}_hasFieldDefinition(t){if(this._layer===null)return!1;for(let e=0;e<this._layer.fields.length;e++)if(this._layer.fields[e].name.toLowerCase()===t)return!0;return!1}setField(t,e){if(this.immutable)throw new u(null,f.Immutable,null);if(e instanceof Date&&(e=this.isUnknownDateTimeField(t)?o.unknownDateJSToArcadeDate(e):o.dateJSToArcadeDate(e)),F(e)===!1)throw new u(null,f.TypeNotAllowedInFeature,null);let i=t.toLowerCase();if(this.attributes[t]===void 0){for(let s in this.attributes)if(s.toLowerCase()===i)return void(this.attributes[s]=e);this.attributes[t]=e}else this.attributes[t]=e}hasField(t){let e=t.toLowerCase();if(this.attributes[t]!==void 0)return!0;for(let i in this.attributes)if(i.toLowerCase()===e)return!0;return!!this._hasFieldDefinition(e)}keys(){let t=[],e={};for(let i in this.attributes)t.push(i),e[i.toLowerCase()]=1;if(this._layer!==null)for(let i=0;i<this._layer.fields.length;i++){let s=this._layer.fields[i];e[s.name.toLowerCase()]!==1&&t.push(s.name)}return t=t.sort(),t}static parseGeometryFromDictionary(t){let e=a._convertDictionaryToJson(t,!0);return e.hasm!==void 0&&(e.hasM=e.hasm,delete e.hasm),e.hasz!==void 0&&(e.hasZ=e.hasz,delete e.hasz),e.spatialreference!==void 0&&(e.spatialReference=e.spatialreference,delete e.spatialreference),e.rings!==void 0&&(e.rings=this._fixPathArrays(e.rings,e.hasZ===!0,e.hasZ===!0)),e.paths!==void 0&&(e.paths=this._fixPathArrays(e.paths,e.hasZ===!0,e.hasM===!0)),e.points!==void 0&&(e.points=this._fixPointArrays(e.points,e.hasZ===!0,e.hasM===!0)),y(e)}static _fixPathArrays(t,e,i){let s=[];if(t instanceof Array)for(let n=0;n<t.length;n++)s.push(this._fixPointArrays(t[n],e,i));else if(t instanceof d)for(let n=0;n<t.length();n++)s.push(this._fixPointArrays(t.get(n),e,i));return s}static _fixPointArrays(t,e,i){let s=[];if(t instanceof Array)for(let n=0;n<t.length;n++){let r=t[n];r instanceof x?e&&i?s.push([r.x,r.y,r.z,r.m]):e?s.push([r.x,r.y,r.z]):i?s.push([r.x,r.y,r.m]):s.push([r.x,r.y]):r instanceof d?s.push(r.toArray()):s.push(r)}else if(t instanceof d)for(let n=0;n<t.length();n++){let r=t.get(n);r instanceof x?e&&i?s.push([r.x,r.y,r.z,r.m]):e?s.push([r.x,r.y,r.z]):i?s.push([r.x,r.y,r.m]):s.push([r.x,r.y]):r instanceof d?s.push(r.toArray()):s.push(r)}return s}static _convertDictionaryToJson(t,e=!1){let i={};for(let s in t.attributes){let n=t.attributes[s];n instanceof g&&(n=a._convertDictionaryToJson(n)),e?i[s.toLowerCase()]=n:i[s]=n}return i}static parseAttributesFromDictionary(t){let e={};for(let i in t.attributes){let s=t.attributes[i];if(!F(s))throw new u(null,f.InvalidParameter,null);e[i]=s}return e}static fromJson(t,e){let i=null;t.geometry!==null&&t.geometry!==void 0&&(i=y(t.geometry));let s={};if(t.attributes!==null&&t.attributes!==void 0)for(let n in t.attributes){let r=t.attributes[n];if(r===null)s[n]=r;else{if(!(D(r)||A(r)||w(r)||h(r)||b(r)||_(r)))throw new u(null,f.InvalidParameter,null);s[n]=r}}return a.createFromGraphicLikeObject(i,s,null,e??null)}fullSchema(){return this._layer}gdbVersion(){if(this._layer===null)return"";let t=this._layer.gdbVersion;return t===void 0?"":t===""&&this._layer.capabilities?.isVersioned?"SDE.DEFAULT":t}castAsJson(t){let e={attributes:{},geometry:t?.keepGeometryType===!0?this.geometry():this.geometry()?.toJSON()??null};for(let i in this.attributes){let s=this.attributes[i];s!==void 0&&(e.attributes[i]=L(s,t))}return e}castAsJsonAsync(t=null,e){return O(this,null,function*(){return this.castAsJson(e)})}};I(S);export{S as a};
