import{a as Q,b as g,c as f}from"./chunk-AJBUCX6Q.js";import{a as F,b as x,c as z}from"./chunk-DLW5X5J6.js";import{a as k}from"./chunk-YJHTADW2.js";import"./chunk-TM5COHS7.js";import"./chunk-IPNDO5RF.js";import"./chunk-KHV2VDNY.js";import{a as C}from"./chunk-FYB33PIO.js";import"./chunk-AC55GQHL.js";import"./chunk-HBDWL3B4.js";import{a as P}from"./chunk-2ZJ3WQRV.js";import"./chunk-XUKLUIRQ.js";import{a as L,b as G}from"./chunk-6WWQ4Y2G.js";import"./chunk-6CRNHERM.js";import"./chunk-FJMWXCU4.js";import"./chunk-6GLCEHEN.js";import"./chunk-22K5GEMV.js";import"./chunk-YFMEPRZQ.js";import"./chunk-HTQH2YLG.js";import"./chunk-IOMUCP7J.js";import"./chunk-UEH4FZMX.js";import"./chunk-5ZJSZISC.js";import"./chunk-6XFWNJFJ.js";import"./chunk-WV4GLBNV.js";import"./chunk-X77FZHE2.js";import"./chunk-4Y7EKSO4.js";import"./chunk-XKOINRUM.js";import"./chunk-IFG5AX52.js";import"./chunk-RJDYQPCB.js";import"./chunk-FN72K46S.js";import"./chunk-EVB25YXG.js";import"./chunk-Z7J4BCLI.js";import"./chunk-GMW3QDVG.js";import"./chunk-3GBPXGQU.js";import"./chunk-BYXBJQAS.js";import"./chunk-AKKUUEQK.js";import"./chunk-BSIXRBVK.js";import"./chunk-H2E4J3PF.js";import"./chunk-G7TZLWYD.js";import"./chunk-N77PCW3L.js";import"./chunk-G3LBVS5W.js";import"./chunk-IGGE7N7W.js";import"./chunk-HOBRG36Z.js";import"./chunk-ZREXZJBZ.js";import"./chunk-WF6JACCV.js";import"./chunk-ICBFZ75C.js";import"./chunk-UYKZ3CEC.js";import"./chunk-Y5K4QJZR.js";import"./chunk-5WNLDCIP.js";import"./chunk-N3KNLXBG.js";import"./chunk-PLCDSZE2.js";import"./chunk-NTXQ55BD.js";import"./chunk-EKY6QR7N.js";import"./chunk-VK2CQJOC.js";import"./chunk-TTUUVT2M.js";import"./chunk-AUIMNX4Y.js";import"./chunk-N57AFEUK.js";import"./chunk-N7PHAMWX.js";import"./chunk-JV7BL2Y3.js";import"./chunk-VGW7YJZ7.js";import"./chunk-HX3FHHCG.js";import"./chunk-ZOOQQO74.js";import"./chunk-SHAZ7EU7.js";import"./chunk-NKBP5F7I.js";import"./chunk-EEYJPINK.js";import"./chunk-BZEC7TCW.js";import"./chunk-MBI4IOAA.js";import"./chunk-GIHBFCPM.js";import"./chunk-W5OI4BJ2.js";import"./chunk-TKTKGUCU.js";import"./chunk-DTWRSK4M.js";import"./chunk-G7LWVLCX.js";import"./chunk-M3GEY4SR.js";import"./chunk-7QY3BMVN.js";import"./chunk-4HXOVZYF.js";import"./chunk-U2QVIRVP.js";import"./chunk-VXOK76QV.js";import"./chunk-FYZRIMPP.js";import"./chunk-XFKEXQXK.js";import"./chunk-6XBO2ULB.js";import"./chunk-IRJFYPO2.js";import"./chunk-2UWML3DK.js";import{c as U}from"./chunk-R72KC7FJ.js";import"./chunk-WKOJXXCZ.js";import"./chunk-MNLP6AEE.js";import"./chunk-ZIQX3XYG.js";import"./chunk-RH6QQ4K6.js";import"./chunk-WSUW6W66.js";import"./chunk-RZU6EEB3.js";import"./chunk-XFFNQH2H.js";import"./chunk-VL6L3PH6.js";import"./chunk-LGUXUFJ7.js";import"./chunk-B3I4XIHJ.js";import"./chunk-DZ3DW7ED.js";import"./chunk-3XRT3SNQ.js";import"./chunk-5OGCWDP4.js";import"./chunk-JBJTQF7V.js";import"./chunk-CN5O6E6T.js";import"./chunk-4KJ462UD.js";import"./chunk-HSB35X5B.js";import"./chunk-JOOJSGLF.js";import"./chunk-MYELF7MV.js";import"./chunk-MS3ZOARX.js";import"./chunk-KCKP7FIY.js";import"./chunk-7K4WIBFN.js";import{a as S}from"./chunk-Z77VHNI3.js";import{a as b}from"./chunk-LMIKL5PS.js";import{a as q}from"./chunk-OKLB3DLR.js";import"./chunk-DWZPFSNU.js";import"./chunk-MCIUWLYC.js";import{a as u}from"./chunk-EEZEB3RB.js";import"./chunk-45GFWXQC.js";import"./chunk-AUVYUYNK.js";import"./chunk-PUCLHWWW.js";import"./chunk-DMYB246F.js";import"./chunk-YEFC7M4L.js";import"./chunk-C7M5MSEL.js";import"./chunk-HPJ6EQFO.js";import"./chunk-ZOTIMGGE.js";import"./chunk-7UQPY7PH.js";import"./chunk-OHIIU6WS.js";import"./chunk-RCWJNG4Z.js";import"./chunk-LGGJOMLJ.js";import"./chunk-VVAIF23J.js";import"./chunk-O5K35OSE.js";import"./chunk-D6LLE2YP.js";import"./chunk-I3S324BU.js";import"./chunk-2UDQ3IWX.js";import"./chunk-MXH75ZNY.js";import"./chunk-PQKTT6AH.js";import"./chunk-OM24DGCK.js";import"./chunk-YQRTHGFD.js";import"./chunk-EDSVJRYE.js";import"./chunk-TQYOVOJO.js";import"./chunk-QAVDKCSH.js";import"./chunk-H2AOS66Z.js";import"./chunk-VGGNZXSE.js";import"./chunk-CJJRHJ2S.js";import"./chunk-574KRDZU.js";import"./chunk-2APWMENK.js";import"./chunk-ZWFVPWKA.js";import"./chunk-JOYABHZZ.js";import"./chunk-IEXZWAIE.js";import"./chunk-VDN3XKL2.js";import"./chunk-SVEGZVCP.js";import"./chunk-AQ74ANSJ.js";import"./chunk-SAOUSUZE.js";import"./chunk-6MGDEI2H.js";import"./chunk-QSGARGRB.js";import"./chunk-SREKDU6P.js";import"./chunk-IXIJFOEL.js";import"./chunk-QZ4L25WE.js";import"./chunk-4ATIL3QV.js";import"./chunk-WUM4JBII.js";import"./chunk-URUYU25U.js";import"./chunk-3S2DT2SI.js";import"./chunk-7PPV2CP7.js";import"./chunk-U62SHMHB.js";import"./chunk-55ESOXMJ.js";import"./chunk-BCREO4Q5.js";import"./chunk-EJ3VIBAJ.js";import"./chunk-4LHUJTP5.js";import"./chunk-NBRBW7H5.js";import"./chunk-CBOFHDSC.js";import"./chunk-HB7BVTLV.js";import"./chunk-WZKL6OPG.js";import"./chunk-WF37UVOV.js";import"./chunk-UZQ577CU.js";import"./chunk-FC3MPJI4.js";import"./chunk-5ETRXDS4.js";import"./chunk-QDNKD3H5.js";import"./chunk-B4PK7RBX.js";import"./chunk-6J4Y65BV.js";import"./chunk-RXHILZH7.js";import"./chunk-URPCXPAW.js";import"./chunk-KBFIYTBH.js";import"./chunk-PEPXQ7N3.js";import"./chunk-VU5W7W6Y.js";import"./chunk-6QIKBCPR.js";import"./chunk-AHKJJNRE.js";import"./chunk-HBTOKQC5.js";import"./chunk-A52LT7YB.js";import{n as T}from"./chunk-CZPMRK53.js";import"./chunk-IDSF2RZ6.js";import"./chunk-2BBIRZVO.js";import"./chunk-WQAXQD4X.js";import"./chunk-IUPUERVS.js";import"./chunk-XF4NUYV7.js";import"./chunk-FNDPIYNC.js";import{H as c}from"./chunk-WMYPRHRR.js";import{R as H}from"./chunk-IAMDMFZ7.js";import{a as m}from"./chunk-53MWZ23O.js";import{a as v,p as n}from"./chunk-PT7S6WNL.js";import"./chunk-XDTDVCGP.js";import"./chunk-JPDAKIWT.js";import{p as V}from"./chunk-465DRXTW.js";import"./chunk-AC62Z3FX.js";import{a as y,b as I,g as h}from"./chunk-ESDYQQXO.js";var M=[0,0],p=class extends P(Q(L(G))){constructor(){super(...arguments),this._fetchQueue=null,this._highlightGraphics=new U,this._highlightView=null,this._popupHighlightHelper=null,this._tileStrategy=null,this.layer=null}get resampling(){return!("resampling"in this.layer)||this.layer.resampling!==!1}get tilemapCache(){return"tilemapCache"in this.layer?this.layer.tilemapCache:null}update(t){this._fetchQueue.pause(),this._fetchQueue.state=t.state,this._tileStrategy.update(t),this._fetchQueue.resume(),this._highlightView?.processUpdate(t)}attach(){let t="tileServers"in this.layer?this.layer.tileServers:null,i=this.tilemapCache;if(this._tileInfoView=new q(this.layer.tileInfo,this.layer.fullExtent,i?.effectiveMinLOD,i?.effectiveMaxLOD),this._fetchQueue=new b({tileInfoView:this._tileInfoView,concurrency:t&&10*t.length||10,process:(e,r)=>this.fetchTile(e,r)}),this._tileStrategy=new S({cachePolicy:"keep",resampling:this.resampling,acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),tileInfoView:this._tileInfoView}),F(this,this.layer)){let e=this._highlightView=new C({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new k(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1});this.container.addChild(this._highlightView.container),this._popupHighlightHelper=new x({createFetchPopupFeaturesQueryGeometry:(r,s)=>z(r,s,this.view),highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:(r,s)=>{e.graphicUpdateHandler({graphic:r,property:s})},layerView:this,updatingHandles:this._updatingHandles})}this.requestUpdate(),this.addAttachHandles(this._updatingHandles.add(()=>this.resampling,()=>{this.doRefresh()})),super.attach()}detach(){super.detach(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._popupHighlightHelper?.destroy(),this._highlightView?.destroy(),this._fetchQueue=this._tileStrategy=this._tileInfoView=this._popupHighlightHelper=null}fetchPopupFeatures(t,i){return h(this,null,function*(){return this._popupHighlightHelper?this._popupHighlightHelper.fetchPopupFeatures(t,i):[]})}highlight(t){return this._popupHighlightHelper?this._popupHighlightHelper.highlight(t):v()}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}supportsSpatialReference(t){return T(this.layer.tileInfo?.spatialReference,t)}doRefresh(){return h(this,null,function*(){if(this.attached){if(this.suspended)return this._tileStrategy.clear(),void this.requestUpdate();this._fetchQueue.reset(),this._tileStrategy.refresh(t=>this._updatingHandles.addPromise(this._enqueueTileFetch(t)))}})}acquireTile(t){let i=this._bitmapView.createTile(t),e=i.bitmap;return[e.x,e.y]=this._tileInfoView.getTileCoords(M,i.key),e.resolution=this._tileInfoView.getTileResolution(i.key),[e.width,e.height]=this._tileInfoView.tileInfo.size,this._updatingHandles.addPromise(this._enqueueTileFetch(i)),this._bitmapView.addChild(i),this.requestUpdate(),i}releaseTile(t){this._fetchQueue.abort(t.key.id),this._bitmapView.removeChild(t),t.once("detach",()=>t.destroy()),this.requestUpdate()}fetchTile(e){return h(this,arguments,function*(t,i={}){let r=this.tilemapCache,{signal:s,resamplingLevel:d=0}=i;if(!r)try{return yield this._fetchImage(t,s)}catch(o){if(!n(o)&&!this.resampling)return f(this._tileInfoView.tileInfo.size);if(d<3){let _=this._tileInfoView.getTileParentId(t.id);if(_){let w=new u(_),D=yield this.fetchTile(w,I(y({},i),{resamplingLevel:d+1}));return g(this._tileInfoView,D,w,t)}}throw o}let a=new u(0,0,0,0),l;try{if(yield r.fetchAvailabilityUpsample(t.level,t.row,t.col,a,{signal:s}),a.level!==t.level&&!this.resampling)return f(this._tileInfoView.tileInfo.size);l=yield this._fetchImage(a,s)}catch(o){if(n(o))throw o;l=yield this._fetchImage(t,s)}return this.resampling?g(this._tileInfoView,l,a,t):l})}_enqueueTileFetch(t){return h(this,null,function*(){if(!this._fetchQueue.has(t.key.id)){try{let i=yield this._fetchQueue.push(t.key);t.bitmap.source=i,t.bitmap.width=this._tileInfoView.tileInfo.size[0],t.bitmap.height=this._tileInfoView.tileInfo.size[1],t.once("attach",()=>this.requestUpdate())}catch(i){n(i)||V.getLogger(this).error(i)}this.requestUpdate()}})}_fetchImage(t,i){return h(this,null,function*(){return this.layer.fetchImageBitmapTile(t.level,t.row,t.col,{signal:i})})}};m([c()],p.prototype,"resampling",null),m([c()],p.prototype,"tilemapCache",null),p=m([H("esri.views.2d.layers.TileLayerView2D")],p);var Ti=p;export{Ti as default};
