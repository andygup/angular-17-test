import{a as g}from"./chunk-I7VAY2DR.js";import{a as f}from"./chunk-FQTXYWH5.js";import{b as y}from"./chunk-WAZIXELF.js";import{a as v,g as I}from"./chunk-FBHJEXCM.js";import{a as w}from"./chunk-F72O5PVM.js";import{c as b}from"./chunk-B4PK7RBX.js";import{r as s}from"./chunk-465DRXTW.js";import{a as u,b as c,g as p}from"./chunk-ESDYQQXO.js";function O(t,a,r){let e=r(t);if(!e.isValid)throw new s(`${a}:invalid-parameters`,e.errorMessage,{layer:t})}function $(t){return p(this,null,function*(){let{layer:a,errorNamePrefix:r,validateLayer:e}=t;yield a.load(),O(a,r,e)})}function S(t,a){return`Layer (title: ${t.title}, id: ${t.id}) of type '${t.declaredClass}' ${a}`}function h(t){let{item:a,itemType:r,errorNamePrefix:e,layer:n,validateItem:l}=t;if(g(a),a.type!==r)throw new s(`${e}:portal-item-wrong-type`,`Portal item type should be "${r}"`,{item:a,layer:n});if(l){let i=l(a);if(!i.isValid)throw new s(`${e}:invalid-parameters`,i.errorMessage,{layer:n})}}function C(t){let{layer:a,errorNamePrefix:r}=t,{portalItem:e}=a;if(!e)throw new s(`${r}:portal-item-not-set`,S(a,"requires the portalItem property to be set"));if(!e.loaded)throw new s(`${r}:portal-item-not-loaded`,S(a,"cannot be saved to a portal item that does not exist or is inaccessible"));h(c(u({},t),{item:e}))}function J(t){let{newItem:a,itemType:r}=t,e=w.from(a);return e.id&&(e=e.clone(),e.id=null),e.type??=r,e.portal??=b.getDefault(),h(c(u({},t),{item:e})),e}function K(t,a){let r=(t.messages??[]).filter(({type:e})=>e==="error").map(({name:e,message:n,details:l})=>new s(e,n,l));if(t.blockedRelativeUrls&&(r=r.concat(t.blockedRelativeUrls.map(e=>new s("url:unsupported",`Relative url '${e}' is not supported`)))),a?.ignoreUnsupported&&(r=r.filter(({name:e})=>e!=="layer:unsupported"&&e!=="symbol:unsupported"&&e!=="symbol-layer:unsupported"&&e!=="property:unsupported"&&e!=="url:unsupported")),r.length>0)throw new s("layer-write:unsupported","Failed to save layer due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:r})}function P(t,a,r){return p(this,null,function*(){"beforeSave"in t&&typeof t.beforeSave=="function"&&(yield t.beforeSave());let e=t.write({},a);return yield Promise.all(a.resources?.pendingOperations??[]),K(a,r),e})}function x(t){v(t,I.JSAPI),t.typeKeywords&&(t.typeKeywords=t.typeKeywords.filter((a,r,e)=>e.indexOf(a)===r))}function R(t,a,r){return p(this,null,function*(){let e=t.portal;yield e.signIn(),yield e.user?.addItem({item:t,data:a,folder:r?.folder})})}function F(t,a){return p(this,null,function*(){let{layer:r,createItemData:e,createJSONContext:n,saveResources:l}=t;yield $(t),C(t);let i=r.portalItem,o=n?n(i):y(i),m=yield P(r,o,a),d=yield e({layer:r,layerJSON:m},i);return x(i),yield i.update({data:d}),f(o),yield l?.(i,o),i})}function V(t,a){return p(this,null,function*(){let{layer:r,createItemData:e,createJSONContext:n,setItemProperties:l,saveResources:i}=t;yield $(t);let o=J(t),m=n?n(o):y(o),d=yield P(r,m,a),N=yield e({layer:r,layerJSON:d},o);return yield l(r,o),x(o),yield R(o,N,a),r.portalItem=o,f(m),yield i?.(o,m),o})}export{O as a,S as b,C as c,J as d,P as e,x as f,R as g,F as h,V as i};
