import{f as C,g as k}from"./chunk-XQPGHRLL.js";import"./chunk-TWR5EH2C.js";import{b as I,d as b}from"./chunk-LYLAJHBR.js";import{c as j}from"./chunk-2OHTUIOC.js";import"./chunk-VFGTXZIM.js";import{a as q}from"./chunk-XCLJ7TPP.js";import"./chunk-LLDE5IQ6.js";import{a as R}from"./chunk-C3SRECOD.js";import"./chunk-MCO7DSFO.js";import"./chunk-3CZHUHY5.js";import{a as T,b as x}from"./chunk-G7LWVLCX.js";import"./chunk-HHJJPMV6.js";import"./chunk-EHWWHYDE.js";import{o as w,p as S}from"./chunk-M3GEY4SR.js";import"./chunk-7QY3BMVN.js";import"./chunk-4HXOVZYF.js";import"./chunk-U2QVIRVP.js";import"./chunk-ATSTMTT4.js";import"./chunk-OVKL2WYY.js";import"./chunk-JKNGMCUA.js";import"./chunk-VXOK76QV.js";import"./chunk-FYZRIMPP.js";import"./chunk-HI2T2YSZ.js";import"./chunk-O5K35OSE.js";import"./chunk-O5IGEGOS.js";import"./chunk-MXH75ZNY.js";import"./chunk-PQKTT6AH.js";import"./chunk-OM24DGCK.js";import"./chunk-YQRTHGFD.js";import{a as E}from"./chunk-EDSVJRYE.js";import"./chunk-TQYOVOJO.js";import"./chunk-QAVDKCSH.js";import"./chunk-H2AOS66Z.js";import"./chunk-VGGNZXSE.js";import"./chunk-YH4Z47PR.js";import"./chunk-CJJRHJ2S.js";import"./chunk-HZP7XBNB.js";import"./chunk-YUZT5LSA.js";import"./chunk-725QQXBM.js";import"./chunk-ZYPPRX53.js";import"./chunk-574KRDZU.js";import"./chunk-2APWMENK.js";import"./chunk-ZWFVPWKA.js";import"./chunk-JOYABHZZ.js";import"./chunk-IEXZWAIE.js";import"./chunk-VDN3XKL2.js";import"./chunk-SVEGZVCP.js";import"./chunk-AQ74ANSJ.js";import"./chunk-SAOUSUZE.js";import"./chunk-6MGDEI2H.js";import"./chunk-QSGARGRB.js";import"./chunk-SREKDU6P.js";import"./chunk-IXIJFOEL.js";import"./chunk-QZ4L25WE.js";import"./chunk-4ATIL3QV.js";import"./chunk-WUM4JBII.js";import"./chunk-URUYU25U.js";import"./chunk-3S2DT2SI.js";import"./chunk-7PPV2CP7.js";import"./chunk-U62SHMHB.js";import"./chunk-55ESOXMJ.js";import"./chunk-BCREO4Q5.js";import"./chunk-EJ3VIBAJ.js";import"./chunk-4LHUJTP5.js";import"./chunk-NBRBW7H5.js";import"./chunk-CBOFHDSC.js";import{e as d}from"./chunk-HB7BVTLV.js";import"./chunk-WZKL6OPG.js";import"./chunk-WF37UVOV.js";import{c as _}from"./chunk-UZQ577CU.js";import"./chunk-FC3MPJI4.js";import"./chunk-5ETRXDS4.js";import"./chunk-QDNKD3H5.js";import"./chunk-F72O5PVM.js";import"./chunk-B4PK7RBX.js";import"./chunk-6J4Y65BV.js";import"./chunk-RXHILZH7.js";import"./chunk-REI3KXR7.js";import"./chunk-URPCXPAW.js";import"./chunk-KBFIYTBH.js";import"./chunk-PEPXQ7N3.js";import"./chunk-VU5W7W6Y.js";import"./chunk-6QIKBCPR.js";import"./chunk-AHKJJNRE.js";import"./chunk-HBTOKQC5.js";import"./chunk-A52LT7YB.js";import{n as F}from"./chunk-CZPMRK53.js";import"./chunk-IDSF2RZ6.js";import"./chunk-2BBIRZVO.js";import"./chunk-WQAXQD4X.js";import"./chunk-IUPUERVS.js";import"./chunk-XF4NUYV7.js";import"./chunk-FNDPIYNC.js";import"./chunk-WMYPRHRR.js";import"./chunk-IAMDMFZ7.js";import"./chunk-53MWZ23O.js";import{i as l,p as g}from"./chunk-PT7S6WNL.js";import"./chunk-XDTDVCGP.js";import"./chunk-JPDAKIWT.js";import{p as f,r as h}from"./chunk-465DRXTW.js";import"./chunk-AC62Z3FX.js";import{g as a}from"./chunk-ESDYQQXO.js";var P=class{constructor(){this._queryEngine=null,this._customParameters=null}destroy(){this._queryEngine?.destroy(),this._queryEngine=null}load(t,e){return a(this,null,function*(){let{getFeatureUrl:o,getFeatureOutputFormat:c,fields:n,geometryType:m,featureType:y,objectIdField:u,customParameters:p}=t,{spatialReference:i,getFeatureSpatialReference:r}=k(o,y,t.spatialReference);this._featureType=y,this._customParameters=p,this._getFeatureUrl=o,this._getFeatureOutputFormat=c,this._getFeatureSpatialReference=r;try{yield T(r,i)}catch{throw new h("unsupported-projection","Projection not supported",{inSpatialReference:r,outSpatialReference:i})}l(e);let s=E.fromLayerJSON({fields:n,dateFieldsTimeReference:n.some(A=>A.type==="esriFieldTypeDate")?{timeZoneIANA:_}:null}),O=yield this._snapshotFeatures({fieldsIndex:s,geometryType:m,objectIdField:u,spatialReference:i},e.signal);return this._queryEngine=new R({fieldsIndex:s,geometryType:m,hasM:!1,hasZ:!1,objectIdField:u,spatialReference:i,timeInfo:null,featureStore:new q({geometryType:m,hasM:!1,hasZ:!1})}),this._queryEngine.featureStore.addMany(O),{extent:(yield this._queryEngine.fetchRecomputedExtents()).fullExtent}})}applyEdits(){return a(this,null,function*(){throw new h("wfs-source:editing-not-supported","applyEdits() is not supported on WFSLayer")})}queryFeatures(){return a(this,arguments,function*(t={},e={}){return yield this._waitSnapshotComplete(),this._queryEngine.executeQuery(t,e.signal)})}queryFeatureCount(){return a(this,arguments,function*(t={},e={}){return yield this._waitSnapshotComplete(),this._queryEngine.executeQueryForCount(t,e.signal)})}queryObjectIds(){return a(this,arguments,function*(t={},e={}){return yield this._waitSnapshotComplete(),this._queryEngine.executeQueryForIds(t,e.signal)})}queryExtent(){return a(this,arguments,function*(t={},e={}){return yield this._waitSnapshotComplete(),this._queryEngine.executeQueryForExtent(t,e.signal)})}querySnapping(o){return a(this,arguments,function*(t,e={}){return yield this._waitSnapshotComplete(),this._queryEngine.executeQueryForSnapping(t,e.signal)})}refresh(t){return a(this,null,function*(){return this._customParameters=t,this._snapshotTask?.abort(),this._snapshotTask=d(e=>this._snapshotFeatures(this._queryEngine,e)),this._snapshotTask.promise.then(e=>{this._queryEngine.featureStore.clear(),e&&this._queryEngine.featureStore.addMany(e)},e=>{this._queryEngine.featureStore.clear(),g(e)||f.getLogger("esri.layers.WFSLayer").error(new h("wfs-layer:getfeature-error","An error occurred during the GetFeature request",{error:e}))}),yield this._waitSnapshotComplete(),{extent:(yield this._queryEngine.fetchRecomputedExtents()).fullExtent}})}_waitSnapshotComplete(){return a(this,null,function*(){if(this._snapshotTask&&!this._snapshotTask.finished){try{yield this._snapshotTask.promise}catch{}return this._waitSnapshotComplete()}})}_snapshotFeatures(m,y){return a(this,arguments,function*({objectIdField:t,geometryType:e,spatialReference:o,fieldsIndex:c},n){let u=yield C(this._getFeatureUrl??"",this._featureType.typeName,this._getFeatureSpatialReference,this._getFeatureOutputFormat,{customParameters:this._customParameters,signal:n});I(u,this._getFeatureSpatialReference.wkid),l(n);let p=b(u,{geometryType:e,hasZ:!1,objectIdField:t});if(!F(o,this._getFeatureSpatialReference))for(let r of p)r.geometry!=null&&(r.geometry=w(x(S(r.geometry,e,!1,!1),this._getFeatureSpatialReference,o)));let i=1;for(let r of p){let s={};j(c,s,r.attributes,!0),r.attributes=s,s[t]==null&&(r.objectId=s[t]=i++)}return p})}};export{P as default};
