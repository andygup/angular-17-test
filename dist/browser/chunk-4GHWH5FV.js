import{d as D}from"./chunk-PQYE2TOR.js";import"./chunk-HHJJPMV6.js";import{a as M}from"./chunk-KYW34JK7.js";import{a as z}from"./chunk-4R7MTAA6.js";import"./chunk-YH5YGPKQ.js";import{a as $}from"./chunk-OJTJKYFK.js";import"./chunk-WSUW6W66.js";import"./chunk-WF5LZUVW.js";import{a as W}from"./chunk-E4G7B7K5.js";import"./chunk-RZU6EEB3.js";import{b as Y}from"./chunk-WHNNLNN4.js";import{a as K}from"./chunk-PHG7WLHF.js";import{a as A}from"./chunk-3AY2ZIM4.js";import{a as H}from"./chunk-XFFNQH2H.js";import{g as V}from"./chunk-VL6L3PH6.js";import{b as G,c as Z}from"./chunk-EGQHBYFL.js";import{c as U}from"./chunk-MXNDRZNB.js";import{a as Q}from"./chunk-XWKYTQFT.js";import{a as X}from"./chunk-RAIGRXV3.js";import"./chunk-UULYHJV4.js";import{a as B}from"./chunk-6J7DCVWC.js";import{a as T}from"./chunk-CIQJCIGH.js";import{a as P}from"./chunk-RI77TKRA.js";import"./chunk-UW2TVJUN.js";import"./chunk-LGUXUFJ7.js";import{a as q}from"./chunk-Z7MKEISX.js";import{a as pe}from"./chunk-5L5TH44W.js";import{a as R}from"./chunk-URPONBMS.js";import{b as te,c as re,d as oe,e as ie,f as se,g as ne,i as ae,m as le}from"./chunk-QB3NROF7.js";import{a as ue}from"./chunk-5WCYRI4X.js";import"./chunk-DR5NPQZL.js";import"./chunk-6UQ2Y4IC.js";import"./chunk-KZREEH45.js";import"./chunk-N3XRI3RU.js";import"./chunk-BGARZEEH.js";import"./chunk-B3I4XIHJ.js";import"./chunk-6EFGHIXX.js";import"./chunk-DZ3DW7ED.js";import"./chunk-3XRT3SNQ.js";import{a as C}from"./chunk-YEFTRNE3.js";import"./chunk-5OGCWDP4.js";import"./chunk-JBJTQF7V.js";import"./chunk-5JBKPHFU.js";import"./chunk-CN5O6E6T.js";import{n as k}from"./chunk-4KJ462UD.js";import"./chunk-HSB35X5B.js";import"./chunk-FBHJEXCM.js";import"./chunk-IFUI4HFB.js";import"./chunk-JOOJSGLF.js";import"./chunk-MYELF7MV.js";import"./chunk-MS3ZOARX.js";import"./chunk-KCKP7FIY.js";import"./chunk-BQABCLW6.js";import"./chunk-HTB4QCFJ.js";import"./chunk-7K4WIBFN.js";import"./chunk-45GFWXQC.js";import"./chunk-AUVYUYNK.js";import"./chunk-C7M5MSEL.js";import"./chunk-HPJ6EQFO.js";import"./chunk-5MJXKSZ4.js";import{c as y}from"./chunk-TJ3KO5EG.js";import"./chunk-LGGJOMLJ.js";import"./chunk-VVAIF23J.js";import"./chunk-6N5DPLFH.js";import"./chunk-O5K35OSE.js";import"./chunk-D6LLE2YP.js";import"./chunk-I3S324BU.js";import{c as L}from"./chunk-O5IGEGOS.js";import"./chunk-2UDQ3IWX.js";import"./chunk-EDSVJRYE.js";import"./chunk-QAVDKCSH.js";import"./chunk-H2AOS66Z.js";import"./chunk-YH4Z47PR.js";import"./chunk-CJJRHJ2S.js";import"./chunk-574KRDZU.js";import"./chunk-2APWMENK.js";import"./chunk-ZWFVPWKA.js";import"./chunk-JOYABHZZ.js";import"./chunk-IEXZWAIE.js";import{c as E,d as ee}from"./chunk-VDN3XKL2.js";import"./chunk-SVEGZVCP.js";import"./chunk-AQ74ANSJ.js";import"./chunk-SAOUSUZE.js";import"./chunk-6MGDEI2H.js";import"./chunk-QSGARGRB.js";import"./chunk-SREKDU6P.js";import"./chunk-IXIJFOEL.js";import{a as b}from"./chunk-QZ4L25WE.js";import"./chunk-4ATIL3QV.js";import"./chunk-WUM4JBII.js";import"./chunk-URUYU25U.js";import"./chunk-3S2DT2SI.js";import"./chunk-7PPV2CP7.js";import{s as j}from"./chunk-U62SHMHB.js";import"./chunk-55ESOXMJ.js";import"./chunk-BCREO4Q5.js";import"./chunk-EJ3VIBAJ.js";import"./chunk-4LHUJTP5.js";import"./chunk-NBRBW7H5.js";import"./chunk-CBOFHDSC.js";import"./chunk-HB7BVTLV.js";import"./chunk-WZKL6OPG.js";import"./chunk-WF37UVOV.js";import{d as J}from"./chunk-UZQ577CU.js";import"./chunk-FC3MPJI4.js";import"./chunk-5ETRXDS4.js";import"./chunk-QDNKD3H5.js";import"./chunk-F72O5PVM.js";import"./chunk-B4PK7RBX.js";import{a as N}from"./chunk-6J4Y65BV.js";import"./chunk-RXHILZH7.js";import"./chunk-KBFIYTBH.js";import"./chunk-PEPXQ7N3.js";import"./chunk-VU5W7W6Y.js";import{j as g}from"./chunk-6QIKBCPR.js";import"./chunk-AHKJJNRE.js";import"./chunk-HBTOKQC5.js";import{b as I}from"./chunk-A52LT7YB.js";import"./chunk-CZPMRK53.js";import"./chunk-IDSF2RZ6.js";import"./chunk-2BBIRZVO.js";import"./chunk-WQAXQD4X.js";import"./chunk-IUPUERVS.js";import{g as S}from"./chunk-XF4NUYV7.js";import"./chunk-FNDPIYNC.js";import{H as o}from"./chunk-WMYPRHRR.js";import{R as f}from"./chunk-IAMDMFZ7.js";import{a as r}from"./chunk-53MWZ23O.js";import{k as _,y as w}from"./chunk-PT7S6WNL.js";import"./chunk-XDTDVCGP.js";import"./chunk-JPDAKIWT.js";import{p as O,r as F}from"./chunk-465DRXTW.js";import{a as x}from"./chunk-AC62Z3FX.js";import{a as v,g as m}from"./chunk-ESDYQQXO.js";var u=class extends N{constructor(){super(...arguments),this.type="geojson",this.refresh=w(e=>m(this,null,function*(){yield this.load();let{extent:t,timeExtent:s}=yield this._connection.invoke("refresh",e);return this.sourceJSON.extent=t,s&&(this.sourceJSON.timeInfo.timeExtent=[s.start,s.end]),{dataChanged:!0,updates:{extent:this.sourceJSON.extent,timeInfo:this.sourceJSON.timeInfo}}}))}load(e){let t=e!=null?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){this._connection?.close(),this._connection=null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}queryFeatures(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryFeatures",e?e.toJSON():null,t)).then(s=>C.fromJSON(s))}queryFeaturesJSON(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryFeatures",e?e.toJSON():null,t))}queryFeatureCount(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t))}queryObjectIds(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,t))}queryExtent(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,t)).then(s=>({count:s.count,extent:g.fromJSON(s.extent)}))}querySnapping(e,t={}){return this.load(t).then(()=>this._connection.invoke("querySnapping",e,t))}_applyEdits(e){if(!this._connection)throw new F("geojson-layer-source:edit-failure","Memory source not loaded");let t=this.layer.objectIdField,s=[],n=[],d=[];if(e.addFeatures)for(let a of e.addFeatures)s.push(this._serializeFeature(a));if(e.deleteFeatures)for(let a of e.deleteFeatures)"objectId"in a&&a.objectId!=null?n.push(a.objectId):"attributes"in a&&a.attributes[t]!=null&&n.push(a.attributes[t]);if(e.updateFeatures)for(let a of e.updateFeatures)d.push(this._serializeFeature(a));return this._connection.invoke("applyEdits",{adds:s,updates:d,deletes:n}).then(({extent:a,timeExtent:l,featureEditResults:p})=>(this.sourceJSON.extent=a,l&&(this.sourceJSON.timeInfo.timeExtent=[l.start,l.end]),this._createEditsResult(p)))}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){let t=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new F("geojson-layer-source:edit-failure",t.description,{code:t.code}):null}}_serializeFeature(e){let{attributes:t}=e,s=this._geometryForSerialization(e);return s?{geometry:s.toJSON(),attributes:t}:{attributes:t}}_geometryForSerialization(e){let{geometry:t}=e;return t==null?null:t.type==="mesh"||t.type==="extent"?j.fromExtent(t.extent):t}_startWorker(e){return m(this,null,function*(){this._connection=yield Y("GeoJSONSourceWorker",{strategy:x("feature-layers-workers")?"dedicated":"local",signal:e,registryTarget:this});let{fields:t,spatialReference:s,hasZ:n,geometryType:d,objectIdField:a,url:l,timeInfo:p,customParameters:de}=this.layer,me=this.layer.originOf("spatialReference")==="defaults",ye={url:l,customParameters:de,fields:t&&t.map(c=>c.toJSON()),geometryType:b.toJSON(d),hasZ:n,objectIdField:a,timeInfo:p?p.toJSON():null,spatialReference:me?null:s&&s.toJSON()},h=yield this._connection.invoke("load",ye,{signal:e});for(let c of h.warnings)O.getLogger(this.layer).warn("#load()",`$${c.message} (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{warning:c});h.featureErrors.length&&O.getLogger(this.layer).warn("#load()",`Encountered ${h.featureErrors.length} validation errors while loading features. (title: '${this.layer.title||"no title"}', id: '${this.layer.id??"no id"}')`,{errors:h.featureErrors}),this.sourceJSON=h.layerDefinition,this.capabilities=D(this.sourceJSON.hasZ,!0)})}};r([o()],u.prototype,"capabilities",void 0),r([o()],u.prototype,"type",void 0),r([o({constructOnly:!0})],u.prototype,"layer",void 0),r([o()],u.prototype,"sourceJSON",void 0),u=r([f("esri.layers.graphics.sources.GeoJSONSource")],u);var he=K(),i=class extends M(Q($(z(P(U(q(T(pe(B(R(ue))))))))))){constructor(e){super(e),this.copyright=null,this.dateFieldsTimeZone=null,this.definitionExpression=null,this.displayField=null,this.editingEnabled=!1,this.elevationInfo=null,this.fields=null,this.fieldsIndex=null,this.fullExtent=null,this.geometryType=null,this.hasZ=void 0,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.operationalLayerType="GeoJSON",this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.source=new u({layer:this}),this.spatialReference=I.WGS84,this.templates=null,this.title="GeoJSON",this.type="geojson",this.typeIdField=null,this.types=null}destroy(){this.source?.destroy()}load(e){let t=this.loadFromPortal({supportedTypes:["GeoJson"],supportsData:!1},e).catch(_).then(()=>this.source.load(e)).then(()=>{this.read(this.source.sourceJSON,{origin:"service",url:this.parsedUrl}),this.revert(["objectIdField","fields","timeInfo"],"service"),E(this.renderer,this.fieldsIndex),ee(this.timeInfo,this.fieldsIndex)});return this.addResolvingPromise(t),Promise.resolve(this)}get capabilities(){return this.source?this.source.capabilities:null}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("capabilities"),(this._get("createQueryVersion")||0)+1}get defaultPopupTemplate(){return this.createPopupTemplate()}get isTable(){return this.loaded&&this.geometryType==null}get parsedUrl(){return this.url?S(this.url):null}set renderer(e){E(e,this.fieldsIndex),this._set("renderer",e)}set url(e){if(!e)return void this._set("url",e);let t=S(e);this._set("url",t.path),t.query&&(this.customParameters=v(v({},this.customParameters),t.query))}applyEdits(e,t){return m(this,null,function*(){let{applyEdits:s}=yield import("./chunk-XYED2SK7.js");yield this.load();let n=yield s(this,this.source,e,t);return this.read({extent:this.source.sourceJSON.extent,timeInfo:this.source.sourceJSON.timeInfo},{origin:"service",ignoreDefaults:!0}),n})}on(e,t){return super.on(e,t)}createPopupTemplate(e){return X(this,e)}createQuery(){let e=new y,t=this.capabilities?.data;e.returnGeometry=!0,t&&t.supportsZ&&(e.returnZ=!0),e.outFields=["*"],e.where=this.definitionExpression||"1=1";let{timeOffset:s,timeExtent:n}=this;return e.timeExtent=s!=null&&n!=null?n.offset(-s.value,s.unit):n||null,e}getFieldDomain(e,t){let s,n=!1,d=t?.feature,a=d?.attributes,l=this.typeIdField&&a?.[this.typeIdField];return l!=null&&this.types&&(n=this.types.some(p=>p.id==l&&(s=p.domains&&p.domains[e],s&&s.type==="inherited"&&(s=this._getLayerDomain(e)),!0))),n||s||(s=this._getLayerDomain(e)),s}getField(e){return this.fieldsIndex.get(e)}queryFeatures(e,t){return this.load().then(()=>this.source.queryFeatures(y.from(e)||this.createQuery(),t)).then(s=>{if(s?.features)for(let n of s.features)n.layer=n.sourceLayer=this;return s})}queryObjectIds(e,t){return this.load().then(()=>this.source.queryObjectIds(y.from(e)||this.createQuery(),t))}queryFeatureCount(e,t){return this.load().then(()=>this.source.queryFeatureCount(y.from(e)||this.createQuery(),t))}queryExtent(e,t){return this.load().then(()=>this.source.queryExtent(y.from(e)||this.createQuery(),t))}hasDataChanged(){return m(this,null,function*(){try{let{dataChanged:e,updates:t}=yield this.source.refresh(this.customParameters);return t!=null&&this.read(t,{origin:"service",url:this.parsedUrl,ignoreDefaults:!0}),e}catch{}return!1})}_getLayerDomain(e){if(!this.fields)return null;let t=null;return this.fields.some(s=>(s.name===e&&(t=s.domain),!!t)),t}};r([o({readOnly:!0,json:{read:!1,write:!1}})],i.prototype,"capabilities",null),r([o({type:String})],i.prototype,"copyright",void 0),r([o({readOnly:!0})],i.prototype,"createQueryVersion",null),r([o(J("dateFieldsTimeReference"))],i.prototype,"dateFieldsTimeZone",void 0),r([o({readOnly:!0})],i.prototype,"defaultPopupTemplate",null),r([o({type:String,json:{name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],i.prototype,"definitionExpression",void 0),r([o({type:String})],i.prototype,"displayField",void 0),r([o({type:Boolean})],i.prototype,"editingEnabled",void 0),r([o(ne)],i.prototype,"elevationInfo",void 0),r([o({type:[L],json:{name:"layerDefinition.fields",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"fields"}}}})],i.prototype,"fields",void 0),r([o(he.fieldsIndex)],i.prototype,"fieldsIndex",void 0),r([o({type:g,json:{name:"extent"}})],i.prototype,"fullExtent",void 0),r([o({type:["point","polygon","polyline","multipoint"],json:{read:{reader:b.read}}})],i.prototype,"geometryType",void 0),r([o({type:Boolean})],i.prototype,"hasZ",void 0),r([o(le)],i.prototype,"id",void 0),r([o({type:Boolean,readOnly:!0})],i.prototype,"isTable",null),r([o(oe)],i.prototype,"labelsVisible",void 0),r([o({type:[V],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:H},write:!0}})],i.prototype,"labelingInfo",void 0),r([o(se)],i.prototype,"legendEnabled",void 0),r([o({type:["show","hide"]})],i.prototype,"listMode",void 0),r([o({type:String,json:{name:"layerDefinition.objectIdField",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"objectIdField"}}}})],i.prototype,"objectIdField",void 0),r([o(ae)],i.prototype,"opacity",void 0),r([o({type:["GeoJSON"]})],i.prototype,"operationalLayerType",void 0),r([o({readOnly:!0})],i.prototype,"parsedUrl",null),r([o(re)],i.prototype,"popupEnabled",void 0),r([o({type:k,json:{name:"popupInfo",write:!0}})],i.prototype,"popupTemplate",void 0),r([o({types:G,json:{name:"layerDefinition.drawingInfo.renderer",write:!0,origins:{service:{name:"drawingInfo.renderer"},"web-scene":{types:Z}}}})],i.prototype,"renderer",null),r([o(te)],i.prototype,"screenSizePerspectiveEnabled",void 0),r([o({readOnly:!0})],i.prototype,"source",void 0),r([o({type:I})],i.prototype,"spatialReference",void 0),r([o({type:[A]})],i.prototype,"templates",void 0),r([o()],i.prototype,"title",void 0),r([o({json:{read:!1},readOnly:!0})],i.prototype,"type",void 0),r([o({type:String,readOnly:!0})],i.prototype,"typeIdField",void 0),r([o({type:[W]})],i.prototype,"types",void 0),r([o(ie)],i.prototype,"url",null),i=r([f("esri.layers.GeoJSONLayer")],i);var Jt=i;export{Jt as default};
