import{a as H}from"./chunk-WBGXWYIY.js";import{a as w}from"./chunk-NG2BILDS.js";import{a as A}from"./chunk-2ZJ3WQRV.js";import"./chunk-XUKLUIRQ.js";import{a as U,b as W}from"./chunk-6WWQ4Y2G.js";import"./chunk-IOMUCP7J.js";import"./chunk-UEH4FZMX.js";import"./chunk-5ZJSZISC.js";import{a as L}from"./chunk-GYIJPI77.js";import"./chunk-XKOINRUM.js";import"./chunk-EVB25YXG.js";import"./chunk-Z7J4BCLI.js";import"./chunk-BYXBJQAS.js";import"./chunk-BSIXRBVK.js";import"./chunk-Y5K4QJZR.js";import"./chunk-EKY6QR7N.js";import"./chunk-VK2CQJOC.js";import"./chunk-AUIMNX4Y.js";import"./chunk-N7PHAMWX.js";import"./chunk-NKBP5F7I.js";import"./chunk-EEYJPINK.js";import"./chunk-BZEC7TCW.js";import"./chunk-GIHBFCPM.js";import"./chunk-W5OI4BJ2.js";import"./chunk-TKTKGUCU.js";import"./chunk-M3GEY4SR.js";import"./chunk-7QY3BMVN.js";import"./chunk-4HXOVZYF.js";import"./chunk-U2QVIRVP.js";import"./chunk-IRJFYPO2.js";import"./chunk-WKOJXXCZ.js";import"./chunk-MNLP6AEE.js";import"./chunk-LGUXUFJ7.js";import{k as q}from"./chunk-QB3NROF7.js";import"./chunk-HSB35X5B.js";import"./chunk-KCKP7FIY.js";import"./chunk-OKLB3DLR.js";import"./chunk-MCIUWLYC.js";import"./chunk-EEZEB3RB.js";import"./chunk-YEFC7M4L.js";import"./chunk-HPJ6EQFO.js";import"./chunk-ZOTIMGGE.js";import"./chunk-7UQPY7PH.js";import"./chunk-OHIIU6WS.js";import"./chunk-RCWJNG4Z.js";import"./chunk-HUZLTBDZ.js";import"./chunk-V2JYXY4D.js";import"./chunk-5MJXKSZ4.js";import"./chunk-LGGJOMLJ.js";import"./chunk-VVAIF23J.js";import"./chunk-O5K35OSE.js";import"./chunk-CJJRHJ2S.js";import"./chunk-574KRDZU.js";import"./chunk-2APWMENK.js";import"./chunk-ZWFVPWKA.js";import"./chunk-JOYABHZZ.js";import"./chunk-VDN3XKL2.js";import"./chunk-SVEGZVCP.js";import"./chunk-AQ74ANSJ.js";import"./chunk-SAOUSUZE.js";import"./chunk-6MGDEI2H.js";import"./chunk-QSGARGRB.js";import"./chunk-SREKDU6P.js";import"./chunk-IXIJFOEL.js";import"./chunk-QZ4L25WE.js";import"./chunk-4ATIL3QV.js";import"./chunk-U62SHMHB.js";import"./chunk-55ESOXMJ.js";import"./chunk-BCREO4Q5.js";import"./chunk-EJ3VIBAJ.js";import"./chunk-4LHUJTP5.js";import"./chunk-NBRBW7H5.js";import{a as V}from"./chunk-CBOFHDSC.js";import"./chunk-HB7BVTLV.js";import"./chunk-WZKL6OPG.js";import"./chunk-WF37UVOV.js";import"./chunk-UZQ577CU.js";import"./chunk-FC3MPJI4.js";import"./chunk-5ETRXDS4.js";import"./chunk-QDNKD3H5.js";import"./chunk-RXHILZH7.js";import"./chunk-PEPXQ7N3.js";import"./chunk-VU5W7W6Y.js";import{j as R}from"./chunk-6QIKBCPR.js";import"./chunk-AHKJJNRE.js";import"./chunk-HBTOKQC5.js";import"./chunk-A52LT7YB.js";import"./chunk-CZPMRK53.js";import"./chunk-IDSF2RZ6.js";import"./chunk-2BBIRZVO.js";import"./chunk-WQAXQD4X.js";import"./chunk-IUPUERVS.js";import"./chunk-XF4NUYV7.js";import"./chunk-FNDPIYNC.js";import{H as s}from"./chunk-WMYPRHRR.js";import{R as f}from"./chunk-IAMDMFZ7.js";import{a as i}from"./chunk-53MWZ23O.js";import{p as F}from"./chunk-PT7S6WNL.js";import{b as y}from"./chunk-XDTDVCGP.js";import"./chunk-JPDAKIWT.js";import{p as C,r as c}from"./chunk-465DRXTW.js";import"./chunk-AC62Z3FX.js";import{a as E,g as S}from"./chunk-ESDYQQXO.js";var _=e=>{let t=class extends e{initialize(){this.exportImageParameters=new L({layer:this.layer})}destroy(){this.exportImageParameters=y(this.exportImageParameters)}get exportImageVersion(){return this.exportImageParameters?.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}fetchPopupFeatures(a){let{layer:o}=this;if(!a)return Promise.reject(new c("wmslayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:o}));let{popupEnabled:m}=o;if(!m)return Promise.reject(new c("wmslayerview:fetchPopupFeatures","popupEnabled should be true",{popupEnabled:m}));let u=this.createFetchPopupFeaturesQuery(a);if(!u)return Promise.resolve([]);let{extent:r,width:p,height:n,x:d,y:l}=u;if(!(r&&p&&n))throw new c("wmslayerview:fetchPopupFeatures","WMSLayer does not support fetching features.",{extent:r,width:p,height:n});return o.fetchFeatureInfo(r,p,n,d,l)}};return i([s()],t.prototype,"exportImageParameters",void 0),i([s({readOnly:!0})],t.prototype,"exportImageVersion",null),i([s()],t.prototype,"layer",void 0),i([s(q)],t.prototype,"timeExtent",void 0),t=i([f("esri.layers.mixins.WMSLayerView")],t),t};var h=class extends _(A(U(W))){constructor(){super(...arguments),this.bitmapContainer=new w}supportsSpatialReference(e){return this.layer.serviceSupportsSpatialReference(e)}update(e){this.strategy.update(e).catch(t=>{F(t)||C.getLogger(this).error(t)})}attach(){let{layer:e}=this,{imageMaxHeight:t,imageMaxWidth:a}=e;this.bitmapContainer=new w,this.container.addChild(this.bitmapContainer),this.strategy=new H({container:this.bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:t,imageMaxWidth:a,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1}),this.addAttachHandles(V(()=>this.exportImageVersion,()=>this.requestUpdate()))}detach(){this.strategy=y(this.strategy),this.container.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQuery(e){let{view:t,bitmapContainer:a}=this,{x:o,y:m}=e,{spatialReference:u}=t,r,p=0,n=0;if(a.children.some(z=>{let{width:P,height:b,resolution:v,x:g,y:x}=z,I=g+v*P,M=x-v*b;return o>=g&&o<=I&&m<=x&&m>=M&&(r=new R({xmin:g,ymin:M,xmax:I,ymax:x,spatialReference:u}),p=P,n=b,!0)}),!r)return null;let d=r.width/p,l=Math.round((o-r.xmin)/d),j=Math.round((r.ymax-m)/d);return{extent:r,width:p,height:n,x:l,y:j}}doRefresh(){return S(this,null,function*(){this.requestUpdate()})}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(e,t,a,o){return this.layer.fetchImageBitmap(e,t,a,E({timeExtent:this.timeExtent},o))}};i([s()],h.prototype,"strategy",void 0),i([s()],h.prototype,"updating",void 0),h=i([f("esri.views.2d.layers.WMSLayerView2D")],h);var ft=h;export{ft as default};
