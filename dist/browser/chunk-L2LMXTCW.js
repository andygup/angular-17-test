import{a as x}from"./chunk-N2A5W4XS.js";import{a as It}from"./chunk-N6TWFTPQ.js";import{a as f}from"./chunk-IL3PPCCF.js";import{a as dt}from"./chunk-W5OI4BJ2.js";import{h as V}from"./chunk-TKTKGUCU.js";import{g as tt,i as Nt}from"./chunk-EJ3VIBAJ.js";import{A as H,B as z,C as $,I as pt,a as S,l as Q,m as X,n as gt,o as Z,x as mt}from"./chunk-4LHUJTP5.js";import{b as ut,j as lt}from"./chunk-AC62Z3FX.js";function W(t,e=0){let r=t.stride;return Array.from(t.fields.keys()).map(s=>{let n=t.fields.get(s),a=n.constructor.ElementCount,g=vt(n.constructor.ElementType),c=n.offset,N=!(!n.optional||!n.optional.glNormalized);return new dt(s,a,g,c,r,N,e)})}function vt(t){let e=xt[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}var xt={u8:V.UNSIGNED_BYTE,u16:V.UNSIGNED_SHORT,u32:V.UNSIGNED_INT,i8:V.BYTE,i16:V.SHORT,i32:V.INT,f32:V.FLOAT};var Et=x().vec3f(f.POSITION).u16(f.COMPONENTINDEX),Vt=x().vec2u8(f.SIDENESS),kt=W(Vt),K=x().vec3f(f.POSITION0).vec3f(f.POSITION1).vec3f(f.NORMAL).u16(f.COMPONENTINDEX).u8(f.VARIANTOFFSET,{glNormalized:!0}).u8(f.VARIANTSTROKE).u8(f.VARIANTEXTENSION,{glNormalized:!0}),G=x().vec3f(f.POSITION0).vec3f(f.POSITION1).vec3f(f.NORMALA).vec3f(f.NORMALB).u16(f.COMPONENTINDEX).u8(f.VARIANTOFFSET,{glNormalized:!0}).u8(f.VARIANTSTROKE).u8(f.VARIANTEXTENSION,{glNormalized:!0}),jt=new Map([[f.POSITION0,0],[f.POSITION1,1],[f.COMPONENTINDEX,2],[f.VARIANTOFFSET,3],[f.VARIANTSTROKE,4],[f.VARIANTEXTENSION,5],[f.NORMAL,6],[f.NORMALA,6],[f.NORMALB,7],[f.SIDENESS,8]]);var P=-1,ht;function At(t,e,r,s=Ft){let n=t.vertices.position,a=t.vertices.componentIndex,g=tt(s.anglePlanar),c=tt(s.angleSignificantEdge),N=Math.cos(c),u=Math.cos(g),l=ot.edge,I=l.position0,E=l.position1,d=l.faceNormal0,w=l.faceNormal1,h=Bt(t),L=Dt(t),o=L.length/4,i=e.allocate(o),m=0,p=o,A=r.allocate(p),y=0,v=0,O=0,it=lt(0,o),_=new Float32Array(o);_.forEach((M,T,C)=>{n.getVec(L[4*T],I),n.getVec(L[4*T+1],E),C[T]=mt(I,E)}),it.sort((M,T)=>_[T]-_[M]);let at=new Array,ct=new Array;for(let M=0;M<o;M++){let T=it[M],C=_[T],J=L[4*T],Lt=L[4*T+1],D=L[4*T+2],U=L[4*T+3],ft=U===P;if(n.getVec(J,I),n.getVec(Lt,E),ft)X(d,h[3*D],h[3*D+1],h[3*D+2]),Q(w,d),l.componentIndex=a.get(J),l.cosAngle=z(d,w);else{if(X(d,h[3*D],h[3*D+1],h[3*D+2]),X(w,h[3*U],h[3*U+1],h[3*U+2]),l.componentIndex=a.get(J),l.cosAngle=z(d,w),Pt(l,u))continue;l.cosAngle<-.9999&&Q(w,d)}v+=C,O++,ft||Rt(l,N)?(e.write(i,m++,l),at.push(C)):Mt(l,g)&&(r.write(A,y++,l),ct.push(C))}let yt=new Float32Array(at.reverse()),wt=new Float32Array(ct.reverse());return{regular:{instancesData:e.trim(i,m),lodInfo:{lengths:yt}},silhouette:{instancesData:r.trim(A,y),lodInfo:{lengths:wt}},averageEdgeLength:v/O}}function Rt(t,e){return t.cosAngle<e}function Pt(t,e){return t.cosAngle>e}function Mt(t,e){let r=Nt(t.cosAngle),s=ot.fwd,n=ot.ortho;return pt(s,t.position1,t.position0),r*(z($(n,t.faceNormal0,t.faceNormal1),s)>0?-1:1)>e}function Dt(t){let e=t.faces.length/3,r=t.faces,s=t.neighbors,n=0;for(let c=0;c<e;c++){let N=s[3*c],u=s[3*c+1],l=s[3*c+2],I=r[3*c],E=r[3*c+1],d=r[3*c+2];n+=N===P||I<E?1:0,n+=u===P||E<d?1:0,n+=l===P||d<I?1:0}let a=new Int32Array(4*n),g=0;for(let c=0;c<e;c++){let N=s[3*c],u=s[3*c+1],l=s[3*c+2],I=r[3*c],E=r[3*c+1],d=r[3*c+2];(N===P||I<E)&&(a[g++]=I,a[g++]=E,a[g++]=c,a[g++]=N),(u===P||E<d)&&(a[g++]=E,a[g++]=d,a[g++]=c,a[g++]=u),(l===P||d<I)&&(a[g++]=d,a[g++]=I,a[g++]=c,a[g++]=l)}return a}function Bt(t){let e=t.faces.length/3,r=t.vertices.position,s=t.faces,n=et.v0,a=et.v1,g=et.v2,c=new Float32Array(3*e);for(let N=0;N<e;N++){let u=s[3*N],l=s[3*N+1],I=s[3*N+2];r.getVec(u,n),r.getVec(l,a),r.getVec(I,g),Z(a,a,n),Z(g,g,n),$(n,a,g),H(n,n),c[3*N]=n[0],c[3*N+1]=n[1],c[3*N+2]=n[2]}return c}(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH"})(ht||(ht={}));var ot={edge:{position0:S(),position1:S(),faceNormal0:S(),faceNormal1:S(),componentIndex:0,cosAngle:0},ortho:S(),fwd:S()},et={v0:S(),v1:S(),v2:S()},Ft={anglePlanar:4,angleSignificantEdge:35};function rt(t,e,r){let s=e/3,n=new Uint32Array(r+1),a=new Uint32Array(r+1),g=(o,i)=>{o<i?n[o+1]++:a[i+1]++};for(let o=0;o<s;o++){let i=t[3*o],m=t[3*o+1],p=t[3*o+2];g(i,m),g(m,p),g(p,i)}let c=0,N=0;for(let o=0;o<r;o++){let i=n[o+1],m=a[o+1];n[o+1]=c,a[o+1]=N,c+=i,N+=m}let u=new Uint32Array(6*s),l=n[r],I=(o,i,m)=>{if(o<i){let p=n[o+1]++;u[2*p]=i,u[2*p+1]=m}else{let p=a[i+1]++;u[2*l+2*p]=o,u[2*l+2*p+1]=m}};for(let o=0;o<s;o++){let i=t[3*o],m=t[3*o+1],p=t[3*o+2];I(i,m,o),I(m,p,o),I(p,i,o)}let E=(o,i)=>{let m=2*o,p=i-o;for(let A=1;A<p;A++){let y=u[m+2*A],v=u[m+2*A+1],O=A-1;for(;O>=0&&u[m+2*O]>y;O--)u[m+2*O+2]=u[m+2*O],u[m+2*O+3]=u[m+2*O+1];u[m+2*O+2]=y,u[m+2*O+3]=v}};for(let o=0;o<r;o++)E(n[o],n[o+1]),E(l+a[o],l+a[o+1]);let d=new Int32Array(3*s),w=(o,i)=>o===t[3*i]?0:o===t[3*i+1]?1:o===t[3*i+2]?2:-1,h=(o,i)=>{let m=w(o,i);d[3*i+m]=-1},L=(o,i,m,p)=>{let A=w(o,i);d[3*i+A]=p;let y=w(m,p);d[3*p+y]=i};for(let o=0;o<r;o++){let i=n[o],m=n[o+1],p=a[o],A=a[o+1];for(;i<m&&p<A;){let y=u[2*i],v=u[2*l+2*p];y===v?(L(o,u[2*i+1],v,u[2*l+2*p+1]),i++,p++):y<v?(h(o,u[2*i+1]),i++):(h(v,u[2*l+2*p+1]),p++)}for(;i<m;)h(o,u[2*i+1]),i++;for(;p<A;)h(u[2*l+2*p],u[2*l+2*p+1]),p++}return d}var q=class{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?Ct:bt}write(e,r,s){let n=this._edgeHashFunction(s);j.seed=n;let a=j.getIntRange(0,255),g=j.getIntRange(0,this.settings.variants-1),c=.7,N=j.getFloat(),u=255*(.5*Wt(-(1-Math.min(N/c,1))+Math.max(0,N-c)/(1-c),1.2)+.5);e.position0.setVec(r,s.position0),e.position1.setVec(r,s.position1),e.componentIndex.set(r,s.componentIndex),e.variantOffset.set(r,a),e.variantStroke.set(r,g),e.variantExtension.set(r,u)}trim(e,r){return e.slice(0,r)}},nt=new Float32Array(6),Y=new Uint32Array(nt.buffer),R=new Uint32Array(1);function bt(t){let e=nt;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],R[0]=5381;for(let r=0;r<Y.length;r++)R[0]=31*R[0]+Y[r];return R[0]}function Ct(t){let e=nt;e[0]=B(t.position0[0]),e[1]=B(t.position0[1]),e[2]=B(t.position0[2]),e[3]=B(t.position1[0]),e[4]=B(t.position1[1]),e[5]=B(t.position1[2]),R[0]=5381;for(let r=0;r<Y.length;r++)R[0]=31*R[0]+Y[r];return R[0]}var Ot=1e4;function B(t){return Math.round(t*Ot)/Ot}function Wt(t,e){let r=t<0?-1:1;return Math.abs(t)**e*r}var F=class{constructor(){this._commonWriter=new q}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return K.createBuffer(e)}write(e,r,s){this._commonWriter.write(e,r,s),gt(k,s.faceNormal0,s.faceNormal1),H(k,k),e.normal.setVec(r,k)}trim(e,r){return this._commonWriter.trim(e,r)}};F.Layout=K,F.glLayout=W(K,1);var b=class{constructor(){this._commonWriter=new q}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return G.createBuffer(e)}write(e,r,s){this._commonWriter.write(e,r,s),e.normalA.setVec(r,s.faceNormal0),e.normalB.setVec(r,s.faceNormal1)}trim(e,r){return this._commonWriter.trim(e,r)}};b.Layout=G,b.glLayout=W(G,1);var k=S(),j=new ut;function pe(t){let e=_t(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return St.updateSettings(t.writerSettings),Tt.updateSettings(t.writerSettings),At(e,St,Tt)}function _t(t,e,r,s){if(e){let g=rt(r,s,t.count);return new st(r,s,g,t)}let n=It(t.buffer,t.stride/4,{originalIndices:r,originalIndicesLength:s}),a=rt(n.indices,s,n.uniqueCount);return{faces:n.indices,facesLength:n.indices.length,neighbors:a,vertices:Et.createView(n.buffer)}}var st=class{constructor(e,r,s,n){this.faces=e,this.facesLength=r,this.neighbors=s,this.vertices=n}},St=new F,Tt=new b,Ne=x().vec3f(f.POSITION0).vec3f(f.POSITION1),de=x().vec3f(f.POSITION0).vec3f(f.POSITION1).u16(f.COMPONENTINDEX);export{Et as a,At as b,pe as c,_t as d,Ne as e,de as f};
